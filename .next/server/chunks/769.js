exports.id=769,exports.ids=[769],exports.modules={1709:function(e,t,n){"use strict";var r,i,s=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.AwsClient=void 0;let o=n(18147),a=n(61658),l=n(6549),u=n(21146);class c extends a.BaseExternalAccountClient{constructor(e,t){super(e,t);let n=(0,u.originalOrCamelOptions)(e),o=n.get("credential_source"),a=n.get("aws_security_credentials_supplier");if(!o&&!a)throw Error("A credential source or AWS security credentials supplier must be specified.");if(o&&a)throw Error("Only one of credential source or AWS security credentials supplier can be specified.");if(a)this.awsSecurityCredentialsSupplier=a,this.regionalCredVerificationUrl=s(r,r,"f",i),this.credentialSourceType="programmatic";else{let e=(0,u.originalOrCamelOptions)(o);this.environmentId=e.get("environment_id");let t=e.get("region_url"),n=e.get("url"),r=e.get("imdsv2_session_token_url");this.awsSecurityCredentialsSupplier=new l.DefaultAwsSecurityCredentialsSupplier({regionUrl:t,securityCredentialsUrl:n,imdsV2SessionTokenUrl:r}),this.regionalCredVerificationUrl=e.get("regional_cred_verification_url"),this.credentialSourceType="aws",this.validateEnvironmentId()}this.awsRequestSigner=null,this.region=""}validateEnvironmentId(){var e;let t=null==(e=this.environmentId)?void 0:e.match(/^(aws)(\d+)$/);if(t&&this.regionalCredVerificationUrl){if(1!==parseInt(t[2],10))throw Error(`aws version "${t[2]}" is not supported in the current build.`)}else throw Error('No valid AWS "credential_source" provided')}async retrieveSubjectToken(){this.awsRequestSigner||(this.region=await this.awsSecurityCredentialsSupplier.getAwsRegion(this.supplierContext),this.awsRequestSigner=new o.AwsRequestSigner(async()=>this.awsSecurityCredentialsSupplier.getAwsSecurityCredentials(this.supplierContext),this.region));let e=await this.awsRequestSigner.getRequestOptions({...r.RETRY_CONFIG,url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),t=[],n=Object.assign({"x-goog-cloud-target-resource":this.audience},e.headers);for(let e in n)t.push({key:e,value:n[e]});return encodeURIComponent(JSON.stringify({url:e.url,method:e.method,headers:t}))}}t.AwsClient=c,r=c,i={value:"https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15"},c.AWS_EC2_METADATA_IPV4_ADDRESS="169.254.169.254",c.AWS_EC2_METADATA_IPV6_ADDRESS="fd00:ec2::254"},1928:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdentityPoolClient=void 0;let r=n(61658),i=n(21146),s=n(3228),o=n(27855);class a extends r.BaseExternalAccountClient{constructor(e,t){super(e,t);let n=(0,i.originalOrCamelOptions)(e),r=n.get("credential_source"),l=n.get("subject_token_supplier");if(!r&&!l)throw Error("A credential source or subject token supplier must be specified.");if(r&&l)throw Error("Only one of credential source or subject token supplier can be specified.");if(l)this.subjectTokenSupplier=l,this.credentialSourceType="programmatic";else{let e=(0,i.originalOrCamelOptions)(r),t=(0,i.originalOrCamelOptions)(e.get("format")),n=t.get("type")||"text",l=t.get("subject_token_field_name");if("json"!==n&&"text"!==n)throw Error(`Invalid credential_source format "${n}"`);if("json"===n&&!l)throw Error("Missing subject_token_field_name for JSON credential_source format");let u=e.get("file"),c=e.get("url"),d=e.get("headers");if(u&&c)throw Error('No valid Identity Pool "credential_source" provided, must be either file or url.');if(u&&!c)this.credentialSourceType="file",this.subjectTokenSupplier=new s.FileSubjectTokenSupplier({filePath:u,formatType:n,subjectTokenFieldName:l});else if(!u&&c)this.credentialSourceType="url",this.subjectTokenSupplier=new o.UrlSubjectTokenSupplier({url:c,formatType:n,subjectTokenFieldName:l,headers:d,additionalGaxiosOptions:a.RETRY_CONFIG});else throw Error('No valid Identity Pool "credential_source" provided, must be either file or url.')}}async retrieveSubjectToken(){return this.subjectTokenSupplier.getSubjectToken(this.supplierContext)}}t.IdentityPoolClient=a},1930:function(e,t,n){"use strict";var r,i,s,o,a=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},l=this&&this.__classPrivateFieldSet||function(e,t,n,r,i){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleAuth=t.GoogleAuthExceptionMessages=t.CLOUD_SDK_CLIENT_ID=void 0;let u=n(79646),c=n(29021),d=n(20322),h=n(21820),p=n(33873),f=n(8655),m=n(11433),g=n(42793),y=n(71482),_=n(66911),v=n(41229),E=n(20003),T=n(69204),C=n(17311),b=n(61658),A=n(75374),S=n(65232),w=n(21146);t.CLOUD_SDK_CLIENT_ID="764086051850-6qr4p6gpi6hn506pt8ejuq83di341hur.apps.googleusercontent.com",t.GoogleAuthExceptionMessages={API_KEY_WITH_CREDENTIALS:"API Keys and Credentials are mutually exclusive authentication methods and cannot be used together.",NO_PROJECT_ID_FOUND:"Unable to detect a Project Id in the current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_CREDENTIALS_FOUND:"Unable to find credentials in current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_ADC_FOUND:"Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.",NO_UNIVERSE_DOMAIN_FOUND:"Unable to detect a Universe Domain in the current environment.\nTo learn more about Universe Domain retrieval, visit: \nhttps://cloud.google.com/compute/docs/metadata/predefined-metadata-keys"};class O{get isGCE(){return this.checkIsGCE}constructor(e={}){if(r.add(this),this.checkIsGCE=void 0,this.jsonContent=null,this.cachedCredential=null,i.set(this,null),this.clientOptions={},this._cachedProjectId=e.projectId||null,this.cachedCredential=e.authClient||null,this.keyFilename=e.keyFilename||e.keyFile,this.scopes=e.scopes,this.clientOptions=e.clientOptions||{},this.jsonContent=e.credentials||null,this.apiKey=e.apiKey||this.clientOptions.apiKey||null,this.apiKey&&(this.jsonContent||this.clientOptions.credentials))throw RangeError(t.GoogleAuthExceptionMessages.API_KEY_WITH_CREDENTIALS);e.universeDomain&&(this.clientOptions.universeDomain=e.universeDomain)}setGapicJWTValues(e){e.defaultServicePath=this.defaultServicePath,e.useJWTAccessWithScope=this.useJWTAccessWithScope,e.defaultScopes=this.defaultScopes}getProjectId(e){if(!e)return this.getProjectIdAsync();this.getProjectIdAsync().then(t=>e(null,t),e)}async getProjectIdOptional(){try{return await this.getProjectId()}catch(e){if(e instanceof Error&&e.message===t.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)return null;throw e}}async findAndCacheProjectId(){let e=null;if((e=await this.getProductionProjectId())||(e=await this.getFileProjectId()),e||(e=await this.getDefaultServiceProjectId()),e||(e=await this.getGCEProjectId()),e||(e=await this.getExternalAccountClientProjectId()),e)return this._cachedProjectId=e,e;throw Error(t.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}async getUniverseDomainFromMetadataServer(){var e;let t;try{(t=await d.universe("universe-domain"))||(t=A.DEFAULT_UNIVERSE)}catch(n){if(n&&(null==(e=null==n?void 0:n.response)?void 0:e.status)===404)t=A.DEFAULT_UNIVERSE;else throw n}return t}async getUniverseDomain(){let e=(0,w.originalOrCamelOptions)(this.clientOptions).get("universe_domain");try{null!=e||(e=(await this.getClient()).universeDomain)}catch(t){null!=e||(e=A.DEFAULT_UNIVERSE)}return e}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(e={},t){let n;if("function"==typeof e?t=e:n=e,!t)return this.getApplicationDefaultAsync(n);this.getApplicationDefaultAsync(n).then(e=>t(null,e.credential,e.projectId),t)}async getApplicationDefaultAsync(e={}){let n;if(this.cachedCredential)return await a(this,r,"m",s).call(this,this.cachedCredential,null);if((n=await this._tryGetApplicationCredentialsFromEnvironmentVariable(e))||(n=await this._tryGetApplicationCredentialsFromWellKnownFile(e)))return n instanceof v.JWT?n.scopes=this.scopes:n instanceof b.BaseExternalAccountClient&&(n.scopes=this.getAnyScopes()),await a(this,r,"m",s).call(this,n);if(await this._checkIsGCE())return e.scopes=this.getAnyScopes(),await a(this,r,"m",s).call(this,new g.Compute(e));throw Error(t.GoogleAuthExceptionMessages.NO_ADC_FOUND)}async _checkIsGCE(){return void 0===this.checkIsGCE&&(this.checkIsGCE=d.getGCPResidency()||await d.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(e){let t=process.env.GOOGLE_APPLICATION_CREDENTIALS||process.env.google_application_credentials;if(!t||0===t.length)return null;try{return this._getApplicationCredentialsFromFilePath(t,e)}catch(e){throw e instanceof Error&&(e.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${e.message}`),e}}async _tryGetApplicationCredentialsFromWellKnownFile(e){let t=null;if(this._isWindows())t=process.env.APPDATA;else{let e=process.env.HOME;e&&(t=p.join(e,".config"))}return(t&&(t=p.join(t,"gcloud","application_default_credentials.json"),c.existsSync(t)||(t=null)),t)?await this._getApplicationCredentialsFromFilePath(t,e):null}async _getApplicationCredentialsFromFilePath(e,t={}){if(!e||0===e.length)throw Error("The file path is invalid.");try{if(e=c.realpathSync(e),!c.lstatSync(e).isFile())throw Error()}catch(t){throw t instanceof Error&&(t.message=`The file at ${e} does not exist, or it is not a file. ${t.message}`),t}let n=c.createReadStream(e);return this.fromStream(n,t)}fromImpersonatedJSON(e){var t,n,r,i;if(!e)throw Error("Must pass in a JSON object containing an  impersonated refresh token");if(e.type!==T.IMPERSONATED_ACCOUNT_TYPE)throw Error(`The incoming JSON object does not have the "${T.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!e.source_credentials)throw Error("The incoming JSON object does not contain a source_credentials field");if(!e.service_account_impersonation_url)throw Error("The incoming JSON object does not contain a service_account_impersonation_url field");let s=this.fromJSON(e.source_credentials);if((null==(t=e.service_account_impersonation_url)?void 0:t.length)>256)throw RangeError(`Target principal is too long: ${e.service_account_impersonation_url}`);let o=null==(r=null==(n=/(?<target>[^/]+):(generateAccessToken|generateIdToken)$/.exec(e.service_account_impersonation_url))?void 0:n.groups)?void 0:r.target;if(!o)throw RangeError(`Cannot extract target principal from ${e.service_account_impersonation_url}`);let a=null!=(i=this.getAnyScopes())?i:[];return new T.Impersonated({...e,sourceClient:s,targetPrincipal:o,targetScopes:Array.isArray(a)?a:[a]})}fromJSON(e,t={}){let n,r=(0,w.originalOrCamelOptions)(t).get("universe_domain");return e.type===E.USER_REFRESH_ACCOUNT_TYPE?(n=new E.UserRefreshClient(t)).fromJSON(e):e.type===T.IMPERSONATED_ACCOUNT_TYPE?n=this.fromImpersonatedJSON(e):e.type===b.EXTERNAL_ACCOUNT_TYPE?(n=C.ExternalAccountClient.fromJSON(e,t)).scopes=this.getAnyScopes():e.type===S.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?n=new S.ExternalAccountAuthorizedUserClient(e,t):(t.scopes=this.scopes,n=new v.JWT(t),this.setGapicJWTValues(n),n.fromJSON(e)),r&&(n.universeDomain=r),n}_cacheClientFromJSON(e,t){let n=this.fromJSON(e,t);return this.jsonContent=e,this.cachedCredential=n,n}fromStream(e,t={},n){let r={};if("function"==typeof t?n=t:r=t,!n)return this.fromStreamAsync(e,r);this.fromStreamAsync(e,r).then(e=>n(null,e),n)}fromStreamAsync(e,t){return new Promise((n,r)=>{if(!e)throw Error("Must pass in a stream containing the Google auth settings.");let i=[];e.setEncoding("utf8").on("error",r).on("data",e=>i.push(e)).on("end",()=>{try{try{let e=JSON.parse(i.join("")),r=this._cacheClientFromJSON(e,t);return n(r)}catch(t){if(!this.keyFilename)throw t;let e=new v.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=e,this.setGapicJWTValues(e),n(e)}}catch(e){return r(e)}})})}fromAPIKey(e,t={}){return new v.JWT({...t,apiKey:e})}_isWindows(){let e=h.platform();return!!e&&!!(e.length>=3)&&"win"===e.substring(0,3).toLowerCase()}async getDefaultServiceProjectId(){return new Promise(e=>{(0,u.exec)("gcloud config config-helper --format json",(t,n)=>{if(!t&&n)try{let t=JSON.parse(n).configuration.properties.core.project;e(t);return}catch(e){}e(null)})})}getProductionProjectId(){return process.env.GCLOUD_PROJECT||process.env.GOOGLE_CLOUD_PROJECT||process.env.gcloud_project||process.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let e=await this.getClient();if(e&&e.projectId)return e.projectId}let e=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return e?e.projectId:null}async getExternalAccountClientProjectId(){if(!this.jsonContent||this.jsonContent.type!==b.EXTERNAL_ACCOUNT_TYPE)return null;let e=await this.getClient();return await e.getProjectId()}async getGCEProjectId(){try{return await d.project("project-id")}catch(e){return null}}getCredentials(e){if(!e)return this.getCredentialsAsync();this.getCredentialsAsync().then(t=>e(null,t),e)}async getCredentialsAsync(){let e=await this.getClient();if(e instanceof T.Impersonated)return{client_email:e.getTargetPrincipal()};if(e instanceof b.BaseExternalAccountClient){let t=e.getServiceAccountEmail();if(t)return{client_email:t,universe_domain:e.universeDomain}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key,universe_domain:this.jsonContent.universe_domain};if(await this._checkIsGCE()){let[e,t]=await Promise.all([d.instance("service-accounts/default/email"),this.getUniverseDomain()]);return{client_email:e,universe_domain:t}}throw Error(t.GoogleAuthExceptionMessages.NO_CREDENTIALS_FOUND)}async getClient(){if(this.cachedCredential)return this.cachedCredential;l(this,i,a(this,i,"f")||a(this,r,"m",o).call(this),"f");try{return await a(this,i,"f")}finally{l(this,i,null,"f")}}async getIdTokenClient(e){let t=await this.getClient();if(!("fetchIdToken"in t))throw Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new y.IdTokenClient({targetAudience:e,idTokenProvider:t})}async getAccessToken(){let e=await this.getClient();return(await e.getAccessToken()).token}async getRequestHeaders(e){return(await this.getClient()).getRequestHeaders(e)}async authorizeRequest(e){let t=(e=e||{}).url||e.uri,n=await this.getClient(),r=await n.getRequestHeaders(t);return e.headers=Object.assign(e.headers||{},r),e}async request(e){return(await this.getClient()).request(e)}getEnv(){return(0,_.getEnv)()}async sign(e,t){let n=await this.getClient(),r=await this.getUniverseDomain();if(t=t||`https://iamcredentials.${r}/v1/projects/-/serviceAccounts/`,n instanceof T.Impersonated)return(await n.sign(e)).signedBlob;let i=(0,f.createCrypto)();if(n instanceof v.JWT&&n.key)return await i.sign(n.key,e);let s=await this.getCredentials();if(!s.client_email)throw Error("Cannot sign data without `client_email`.");return this.signBlob(i,s.client_email,e,t)}async signBlob(e,t,n,r){let i=new URL(r+`${t}:signBlob`);return(await this.request({method:"POST",url:i.href,data:{payload:e.encodeBase64StringUtf8(n)},retry:!0,retryConfig:{httpMethodsToRetry:["POST"]}})).data.signedBlob}}t.GoogleAuth=O,i=new WeakMap,r=new WeakSet,s=async function(e,t=process.env.GOOGLE_CLOUD_QUOTA_PROJECT||null){let n=await this.getProjectIdOptional();return t&&(e.quotaProjectId=t),this.cachedCredential=e,{credential:e,projectId:n}},o=async function(){if(this.jsonContent)return this._cacheClientFromJSON(this.jsonContent,this.clientOptions);if(this.keyFilename){let e=p.resolve(this.keyFilename),t=c.createReadStream(e);return await this.fromStreamAsync(t,this.clientOptions)}if(this.apiKey){let e=await this.fromAPIKey(this.apiKey,this.clientOptions);e.scopes=this.scopes;let{credential:t}=await a(this,r,"m",s).call(this,e);return t}{let{credential:e}=await this.getApplicationDefaultAsync(this.clientOptions);return e}},O.DefaultTransporter=m.DefaultTransporter},2968:(e,t,n)=>{"use strict";let r,i=n(74075),s=n(46471),o=n(52346),{kStatusCode:a}=n(32435),l=Buffer[Symbol.species],u=Buffer.from([0,0,255,255]),c=Symbol("permessage-deflate"),d=Symbol("total-length"),h=Symbol("callback"),p=Symbol("buffers"),f=Symbol("error");class m{constructor(e,t,n){this._maxPayload=0|n,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,r||(r=new o(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[h];this._deflate.close(),this._deflate=null,e&&e(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,n=e.find(e=>(!1!==t.serverNoContextTakeover||!e.server_no_context_takeover)&&(!e.server_max_window_bits||!1!==t.serverMaxWindowBits&&("number"!=typeof t.serverMaxWindowBits||!(t.serverMaxWindowBits>e.server_max_window_bits)))&&("number"!=typeof t.clientMaxWindowBits||!!e.client_max_window_bits));if(!n)throw Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(n.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?n.client_max_window_bits=t.clientMaxWindowBits:(!0===n.client_max_window_bits||!1===t.clientMaxWindowBits)&&delete n.client_max_window_bits,n}acceptAsClient(e){let t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let n=e[t];if(n.length>1)throw Error(`Parameter "${t}" must have only a single value`);if(n=n[0],"client_max_window_bits"===t){if(!0!==n){let e=+n;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${t}": ${n}`)}else if("server_max_window_bits"===t){let e=+n;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else if("client_no_context_takeover"===t||"server_no_context_takeover"===t){if(!0!==n)throw TypeError(`Invalid value for parameter "${t}": ${n}`)}else throw Error(`Unknown parameter "${t}"`);e[t]=n})}),e}decompress(e,t,n){r.add(r=>{this._decompress(e,t,(e,t)=>{r(),n(e,t)})})}compress(e,t,n){r.add(r=>{this._compress(e,t,(e,t)=>{r(),n(e,t)})})}_decompress(e,t,n){let r=this._isServer?"client":"server";if(!this._inflate){let e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=i.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[c]=this,this._inflate[d]=0,this._inflate[p]=[],this._inflate.on("error",_),this._inflate.on("data",y)}this._inflate[h]=n,this._inflate.write(e),t&&this._inflate.write(u),this._inflate.flush(()=>{let e=this._inflate[f];if(e){this._inflate.close(),this._inflate=null,n(e);return}let i=s.concat(this._inflate[p],this._inflate[d]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[d]=0,this._inflate[p]=[],t&&this.params[`${r}_no_context_takeover`]&&this._inflate.reset()),n(null,i)})}_compress(e,t,n){let r=this._isServer?"server":"client";if(!this._deflate){let e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=i.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[d]=0,this._deflate[p]=[],this._deflate.on("data",g)}this._deflate[h]=n,this._deflate.write(e),this._deflate.flush(i.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=s.concat(this._deflate[p],this._deflate[d]);t&&(e=new l(e.buffer,e.byteOffset,e.length-4)),this._deflate[h]=null,this._deflate[d]=0,this._deflate[p]=[],t&&this.params[`${r}_no_context_takeover`]&&this._deflate.reset(),n(null,e)})}}function g(e){this[p].push(e),this[d]+=e.length}function y(e){if(this[d]+=e.length,this[c]._maxPayload<1||this[d]<=this[c]._maxPayload)return void this[p].push(e);this[f]=RangeError("Max payload size exceeded"),this[f].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[f][a]=1009,this.removeListener("data",y),this.reset()}function _(e){if(this[c]._inflate=null,this[f])return void this[h](this[f]);e[a]=1007,this[h](e)}e.exports=m},3228:(e,t,n)=>{"use strict";var r,i,s;Object.defineProperty(t,"__esModule",{value:!0}),t.FileSubjectTokenSupplier=void 0;let o=n(28354),a=n(29021),l=(0,o.promisify)(null!=(r=a.readFile)?r:()=>{}),u=(0,o.promisify)(null!=(i=a.realpath)?i:()=>{}),c=(0,o.promisify)(null!=(s=a.lstat)?s:()=>{});class d{constructor(e){this.filePath=e.filePath,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName}async getSubjectToken(e){let t,n=this.filePath;try{if(n=await u(n),!(await c(n)).isFile())throw Error()}catch(e){throw e instanceof Error&&(e.message=`The file at ${n} does not exist, or it is not a file. ${e.message}`),e}let r=await l(n,{encoding:"utf8"});if("text"===this.formatType?t=r:"json"===this.formatType&&this.subjectTokenFieldName&&(t=JSON.parse(r)[this.subjectTokenFieldName]),!t)throw Error("Unable to parse the subject_token from the credential_source file");return t}}t.FileSubjectTokenSupplier=d},4352:(e,t,n)=>{var r=n(45158).Buffer,i=n(89019),s=n(78218),o=n(27910),a=n(9138),l=n(28354),u=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function c(e){var t=e.split(".",1)[0],n=r.from(t,"base64").toString("binary");if("[object Object]"===Object.prototype.toString.call(n))return n;try{return JSON.parse(n)}catch(e){return}}function d(e){return e.split(".")[2]}function h(e){return u.test(e)&&!!c(e)}function p(e,t,n){if(!t){var r=Error("Missing algorithm parameter for jws.verify");throw r.code="MISSING_ALGORITHM",r}var i=d(e=a(e)),o=e.split(".",2).join(".");return s(t).verify(o,i,n)}function f(e,t){if(t=t||{},!h(e=a(e)))return null;var n,i,s=c(e);if(!s)return null;var o=(n=n||"utf8",i=e.split(".")[1],r.from(i,"base64").toString(n));return("JWT"===s.typ||t.json)&&(o=JSON.parse(o,t.encoding)),{header:s,payload:o,signature:d(e)}}function m(e){var t=new i((e=e||{}).secret||e.publicKey||e.key);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=t,this.signature=new i(e.signature),this.secret.once("close",(function(){!this.signature.writable&&this.readable&&this.verify()}).bind(this)),this.signature.once("close",(function(){!this.secret.writable&&this.readable&&this.verify()}).bind(this))}l.inherits(m,o),m.prototype.verify=function(){try{var e=p(this.signature.buffer,this.algorithm,this.key.buffer),t=f(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},m.decode=f,m.isValid=h,m.verify=p,e.exports=m},4836:(e,t,n)=>{"use strict";t.kF=void 0;let r=n(1930);Object.defineProperty(t,"kF",{enumerable:!0,get:function(){return r.GoogleAuth}}),n(20322),n(88855),n(75374),n(42793),n(66911),n(72090),n(71482),n(52092),n(41229),n(69204),n(86679),n(94030),n(20003),n(1709),n(18147),n(1928),n(17311),n(61658),n(77084),n(32861),n(23773),n(11433),new r.GoogleAuth},4867:e=>{"use strict";let t=e=>null!==e&&"object"==typeof e&&"function"==typeof e.pipe;t.writable=e=>t(e)&&!1!==e.writable&&"function"==typeof e._write&&"object"==typeof e._writableState,t.readable=e=>t(e)&&!1!==e.readable&&"function"==typeof e._read&&"object"==typeof e._readableState,t.duplex=e=>t.writable(e)&&t.readable(e),t.transform=e=>t.duplex(e)&&"function"==typeof e._transform,e.exports=t},6549:function(e,t){"use strict";var n,r,i,s,o,a,l=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultAwsSecurityCredentialsSupplier=void 0;class u{constructor(e){n.add(this),this.regionUrl=e.regionUrl,this.securityCredentialsUrl=e.securityCredentialsUrl,this.imdsV2SessionTokenUrl=e.imdsV2SessionTokenUrl,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getAwsRegion(e){if(l(this,n,"a",o))return l(this,n,"a",o);let t={};if(!l(this,n,"a",o)&&this.imdsV2SessionTokenUrl&&(t["x-aws-ec2-metadata-token"]=await l(this,n,"m",r).call(this,e.transporter)),!this.regionUrl)throw Error('Unable to determine AWS region due to missing "options.credential_source.region_url"');let i={...this.additionalGaxiosOptions,url:this.regionUrl,method:"GET",responseType:"text",headers:t},s=await e.transporter.request(i);return s.data.substr(0,s.data.length-1)}async getAwsSecurityCredentials(e){if(l(this,n,"a",a))return l(this,n,"a",a);let t={};this.imdsV2SessionTokenUrl&&(t["x-aws-ec2-metadata-token"]=await l(this,n,"m",r).call(this,e.transporter));let o=await l(this,n,"m",i).call(this,t,e.transporter),u=await l(this,n,"m",s).call(this,o,t,e.transporter);return{accessKeyId:u.AccessKeyId,secretAccessKey:u.SecretAccessKey,token:u.Token}}}t.DefaultAwsSecurityCredentialsSupplier=u,n=new WeakSet,r=async function(e){let t={...this.additionalGaxiosOptions,url:this.imdsV2SessionTokenUrl,method:"PUT",responseType:"text",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return(await e.request(t)).data},i=async function(e,t){if(!this.securityCredentialsUrl)throw Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let n={...this.additionalGaxiosOptions,url:this.securityCredentialsUrl,method:"GET",responseType:"text",headers:e};return(await t.request(n)).data},s=async function(e,t,n){return(await n.request({...this.additionalGaxiosOptions,url:`${this.securityCredentialsUrl}/${e}`,responseType:"json",headers:t})).data},o=function(){return process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||null},a=function(){return process.env.AWS_ACCESS_KEY_ID&&process.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,token:process.env.AWS_SESSION_TOKEN}:null}},7773:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthClientAuthHandler=void 0,t.getErrorFromOAuthErrorResponse=function(e,t){let n=e.error,r=e.error_description,i=e.error_uri,s=`Error code ${n}`;void 0!==r&&(s+=`: ${r}`),void 0!==i&&(s+=` - ${i}`);let o=Error(s);if(t){let e=Object.keys(t);t.stack&&e.push("stack"),e.forEach(e=>{"message"!==e&&Object.defineProperty(o,e,{value:t[e],writable:!1,enumerable:!0})})}return o};let r=n(11723),i=n(8655),s=["PUT","POST","PATCH"];class o{constructor(e){this.clientAuthentication=e,this.crypto=(0,i.createCrypto)()}applyClientAuthenticationOptions(e,t){this.injectAuthenticatedHeaders(e,t),t||this.injectAuthenticatedRequestBody(e)}injectAuthenticatedHeaders(e,t){var n;if(t)e.headers=e.headers||{},Object.assign(e.headers,{Authorization:`Bearer ${t}}`});else if((null==(n=this.clientAuthentication)?void 0:n.confidentialClientType)==="basic"){e.headers=e.headers||{};let t=this.clientAuthentication.clientId,n=this.clientAuthentication.clientSecret||"",r=this.crypto.encodeBase64StringUtf8(`${t}:${n}`);Object.assign(e.headers,{Authorization:`Basic ${r}`})}}injectAuthenticatedRequestBody(e){var t;if((null==(t=this.clientAuthentication)?void 0:t.confidentialClientType)==="request-body"){let t=(e.method||"GET").toUpperCase();if(-1!==s.indexOf(t)){let t,n=e.headers||{};for(let e in n)if("content-type"===e.toLowerCase()&&n[e]){t=n[e].toLowerCase();break}if("application/x-www-form-urlencoded"===t){e.data=e.data||"";let t=r.parse(e.data);Object.assign(t,{client_id:this.clientAuthentication.clientId,client_secret:this.clientAuthentication.clientSecret||""}),e.data=r.stringify(t)}else if("application/json"===t)e.data=e.data||{},Object.assign(e.data,{client_id:this.clientAuthentication.clientId,client_secret:this.clientAuthentication.clientSecret||""});else throw Error(`${t} content-types are not supported with ${this.clientAuthentication.confidentialClientType} client authentication`)}else throw Error(`${t} HTTP method does not support ${this.clientAuthentication.confidentialClientType} client authentication`)}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}t.OAuthClientAuthHandler=o},8655:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createCrypto=function(){return s()?new r.BrowserCrypto:new i.NodeCrypto},t.hasBrowserCrypto=s,t.fromArrayBufferToHex=function(e){return Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join("")};let r=n(33450),i=n(15572);function s(){return"undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle}},8779:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parseProxyResponse=void 0;let i=(0,r(n(28794)).default)("https-proxy-agent:parse-proxy-response");t.parseProxyResponse=function(e){return new Promise((t,n)=>{let r=0,s=[];function o(){let l=e.read();l?function(l){s.push(l),r+=l.length;let u=Buffer.concat(s,r),c=u.indexOf("\r\n\r\n");if(-1===c){i("have not received end of HTTP headers yet..."),o();return}let d=u.slice(0,c).toString("ascii").split("\r\n"),h=d.shift();if(!h)return e.destroy(),n(Error("No header received from proxy CONNECT response"));let p=h.split(" "),f=+p[1],m=p.slice(2).join(" "),g={};for(let t of d){if(!t)continue;let r=t.indexOf(":");if(-1===r)return e.destroy(),n(Error(`Invalid header from proxy CONNECT response: "${t}"`));let i=t.slice(0,r).toLowerCase(),s=t.slice(r+1).trimStart(),o=g[i];"string"==typeof o?g[i]=[o,s]:Array.isArray(o)?o.push(s):g[i]=s}i("got proxy server response: %o %o",h,g),a(),t({connect:{statusCode:f,statusText:m,headers:g},buffered:u})}(l):e.once("readable",o)}function a(){e.removeListener("end",l),e.removeListener("error",u),e.removeListener("readable",o)}function l(){a(),i("onend"),n(Error("Proxy connection ended before receiving CONNECT response"))}function u(e){a(),i("onerror %o",e),n(e)}e.on("error",u),e.on("end",l),o()})}},9138:(e,t,n)=>{var r=n(79428).Buffer;e.exports=function(e){return"string"==typeof e?e:"number"==typeof e||r.isBuffer(e)?e.toString():JSON.stringify(e)}},10212:(e,t,n)=>{var r=n(71336),i=n(4352);t.ALGORITHMS=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"],t.sign=r.sign,t.verify=i.verify,t.decode=i.decode,t.isValid=i.isValid,t.createSign=function(e){return new r(e)},t.createVerify=function(e){return new i(e)}},11433:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultTransporter=void 0;let r=n(88855),i=n(54518),s=n(90630),o="google-api-nodejs-client";class a{constructor(){this.instance=new r.Gaxios}configure(e={}){if(e.headers=e.headers||{},"undefined"==typeof window){let t=e.headers["User-Agent"];if(t?t.includes(`${o}/`)||(e.headers["User-Agent"]=`${t} ${a.USER_AGENT}`):e.headers["User-Agent"]=a.USER_AGENT,!e.headers["x-goog-api-client"]){let t=process.version.replace(/^v/,"");e.headers["x-goog-api-client"]=`gl-node/${t}`}}return e}request(e){return e=this.configure(e),(0,i.validate)(e),this.instance.request(e).catch(e=>{throw this.processError(e)})}get defaults(){return this.instance.defaults}set defaults(e){this.instance.defaults=e}processError(e){let t=e.response,n=t?t.data:null;return t&&n&&n.error&&200!==t.status?"string"==typeof n.error?(e.message=n.error,e.status=t.status):Array.isArray(n.error.errors)?(e.message=n.error.errors.map(e=>e.message).join("\n"),e.code=n.error.code,e.errors=n.error.errors):(e.message=n.error.message,e.code=n.error.code):t&&t.status>=400&&(e.message=n,e.status=t.status),e}}t.DefaultTransporter=a,a.USER_AGENT=`${o}/${s.version}`},12666:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.Agent=void 0;let a=s(n(91645)),l=s(n(81630)),u=n(55591);o(n(34323),t);let c=Symbol("AgentBaseInternalState");class d extends l.Agent{constructor(e){super(e),this[c]={}}isSecureEndpoint(e){if(e){if("boolean"==typeof e.secureEndpoint)return e.secureEndpoint;if("string"==typeof e.protocol)return"https:"===e.protocol}let{stack:t}=Error();return"string"==typeof t&&t.split("\n").some(e=>-1!==e.indexOf("(https.js:")||-1!==e.indexOf("node:https:"))}incrementSockets(e){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[e]||(this.sockets[e]=[]);let t=new a.Socket({writable:!1});return this.sockets[e].push(t),this.totalSocketCount++,t}decrementSockets(e,t){if(!this.sockets[e]||null===t)return;let n=this.sockets[e],r=n.indexOf(t);-1!==r&&(n.splice(r,1),this.totalSocketCount--,0===n.length&&delete this.sockets[e])}getName(e){return("boolean"==typeof e.secureEndpoint?e.secureEndpoint:this.isSecureEndpoint(e))?u.Agent.prototype.getName.call(this,e):super.getName(e)}createSocket(e,t,n){let r={...t,secureEndpoint:this.isSecureEndpoint(t)},i=this.getName(r),s=this.incrementSockets(i);Promise.resolve().then(()=>this.connect(e,r)).then(o=>{if(this.decrementSockets(i,s),o instanceof l.Agent)try{return o.addRequest(e,r)}catch(e){return n(e)}this[c].currentSocket=o,super.createSocket(e,t,n)},e=>{this.decrementSockets(i,s),n(e)})}createConnection(){let e=this[c].currentSocket;if(this[c].currentSocket=void 0,!e)throw Error("No socket was returned in the `connect()` function");return e}get defaultPort(){return this[c].defaultPort??("https:"===this.protocol?443:80)}set defaultPort(e){this[c]&&(this[c].defaultPort=e)}get protocol(){return this[c].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(e){this[c]&&(this[c].protocol=e)}}t.Agent=d},15572:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NodeCrypto=void 0;let r=n(55511);class i{async sha256DigestBase64(e){return r.createHash("sha256").update(e).digest("base64")}randomBytesBase64(e){return r.randomBytes(e).toString("base64")}async verify(e,t,n){let i=r.createVerify("RSA-SHA256");return i.update(t),i.end(),i.verify(e,n,"base64")}async sign(e,t){let n=r.createSign("RSA-SHA256");return n.update(t),n.end(),n.sign(e,"base64")}decodeBase64StringUtf8(e){return Buffer.from(e,"base64").toString("utf-8")}encodeBase64StringUtf8(e){return Buffer.from(e,"utf-8").toString("base64")}async sha256DigestHex(e){return r.createHash("sha256").update(e).digest("hex")}async signWithHmacSha256(e,t){var n,i;let s="string"==typeof e?e:(n=e,Buffer.from(n));return(i=r.createHmac("sha256",s).update(t).digest()).buffer.slice(i.byteOffset,i.byteOffset+i.byteLength)}}t.NodeCrypto=i},15997:(e,t,n)=>{"use strict";let{Writable:r}=n(27910),i=n(2968),{BINARY_TYPES:s,EMPTY_BUFFER:o,kStatusCode:a,kWebSocket:l}=n(32435),{concat:u,toArrayBuffer:c,unmask:d}=n(46471),{isValidStatusCode:h,isValidUTF8:p}=n(58571),f=Buffer[Symbol.species];class m extends r{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||s[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[l]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,n){if(8===this._opcode&&0==this._state)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let t=this._buffers[0];return this._buffers[0]=new f(t.buffer,t.byteOffset+e,t.length-e),new f(t.buffer,t.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let n=this._buffers[0],r=t.length-e;e>=n.length?t.set(this._buffers.shift(),r):(t.set(new Uint8Array(n.buffer,n.byteOffset,e),r),this._buffers[0]=new f(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0);return t}startLoop(e){this._loop=!0;do switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((48&t[0])!=0)return void e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));let n=(64&t[0])==64;if(n&&!this._extensions[i.extensionName])return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._fin=(128&t[0])==128,this._opcode=15&t[0],this._payloadLength=127&t[1],0===this._opcode){if(n)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(!this._fragmented)return void e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));this._compressed=n}else{if(!(this._opcode>7)||!(this._opcode<11))return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));if(!this._fin)return void e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));if(n)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength)return void e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&t[1])==128,this._isServer){if(!this._masked)return void e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}else if(this._masked)return void e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),n=t.readUInt32BE(0);if(n>2097151)return void e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH"));this._payloadLength=0x100000000*n+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return void e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(e){let t=o;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!=0&&d(t,this._mask)}if(this._opcode>7)return void this.controlMessage(t,e);if(this._compressed){this._state=5,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[i.extensionName].decompress(e,this._fin,(e,n)=>{if(e)return t(e);if(n.length){if(this._messageLength+=n.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return void t(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(n)}this.dataMessage(t),0===this._state&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=0;return}let t=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let r;r="nodebuffer"===this._binaryType?u(n,t):"arraybuffer"===this._binaryType?c(u(n,t)):"blob"===this._binaryType?new Blob(n):n,this._allowSynchronousEvents?(this.emit("message",r,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",r,!0),this._state=0,this.startLoop(e)}))}else{let r=u(n,t);if(!this._skipUTF8Validation&&!p(r))return void e(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));5===this._state||this._allowSynchronousEvents?(this.emit("message",r,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",r,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8===this._opcode){if(0===e.length)this._loop=!1,this.emit("conclude",1005,o),this.end();else{let n=e.readUInt16BE(0);if(!h(n))return void t(this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE"));let r=new f(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!p(r))return void t(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));this._loop=!1,this.emit("conclude",n,r),this.end()}this._state=0;return}this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}))}createError(e,t,n,r,i){this._loop=!1,this._errored=!0;let s=new e(n?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(s,this.createError),s.code=i,s[a]=r,s}}e.exports=m},16809:(e,t,n)=>{"use strict";let r=n(94735),i=n(81630),{Duplex:s}=n(27910),{createHash:o}=n(55511),a=n(46987),l=n(2968),u=n(91596),c=n(32113),{GUID:d,kWebSocket:h}=n(32435),p=/^[+/0-9A-Za-z]{22}==$/;class f extends r{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:c,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=i.createServer((e,t)=>{let n=i.STATUS_CODES[426];t.writeHead(426,{"Content-Length":n.length,"Content-Type":"text/plain"}),t.end(n)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){let e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(let n of Object.keys(t))e.on(n,t[n]);return function(){for(let n of Object.keys(t))e.removeListener(n,t[n])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,n,r)=>{this.handleUpgrade(t,n,r,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state){e&&this.once("close",()=>{e(Error("The server is not running"))}),process.nextTick(m,this);return}if(e&&this.once("close",e),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(m,this);else{let e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{m(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,n,r){t.on("error",g);let i=e.headers["sec-websocket-key"],s=e.headers.upgrade,o=+e.headers["sec-websocket-version"];if("GET"!==e.method)return void _(this,e,t,405,"Invalid HTTP method");if(void 0===s||"websocket"!==s.toLowerCase())return void _(this,e,t,400,"Invalid Upgrade header");if(void 0===i||!p.test(i))return void _(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");if(8!==o&&13!==o)return void _(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header");if(!this.shouldHandle(e))return void y(t,400);let c=e.headers["sec-websocket-protocol"],d=new Set;if(void 0!==c)try{d=u.parse(c)}catch(n){_(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let h=e.headers["sec-websocket-extensions"],f={};if(this.options.perMessageDeflate&&void 0!==h){let n=new l(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let e=a.parse(h);e[l.extensionName]&&(n.accept(e[l.extensionName]),f[l.extensionName]=n)}catch(n){_(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let s={origin:e.headers[`${8===o?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(s,(s,o,a,l)=>{if(!s)return y(t,o||401,a,l);this.completeUpgrade(f,i,d,e,t,n,r)});if(!this.options.verifyClient(s))return y(t,401)}this.completeUpgrade(f,i,d,e,t,n,r)}completeUpgrade(e,t,n,r,i,s,u){if(!i.readable||!i.writable)return i.destroy();if(i[h])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return y(i,503);let c=o("sha1").update(t+d).digest("base64"),p=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${c}`],f=new this.options.WebSocket(null,void 0,this.options);if(n.size){let e=this.options.handleProtocols?this.options.handleProtocols(n,r):n.values().next().value;e&&(p.push(`Sec-WebSocket-Protocol: ${e}`),f._protocol=e)}if(e[l.extensionName]){let t=e[l.extensionName].params,n=a.format({[l.extensionName]:[t]});p.push(`Sec-WebSocket-Extensions: ${n}`),f._extensions=e}this.emit("headers",p,r),i.write(p.concat("\r\n").join("\r\n")),i.removeListener("error",g),f.setSocket(i,s,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(f),f.on("close",()=>{this.clients.delete(f),this._shouldEmitClose&&!this.clients.size&&process.nextTick(m,this)})),u(f,r)}}function m(e){e._state=2,e.emit("close")}function g(){this.destroy()}function y(e,t,n,r){n=n||i.STATUS_CODES[t],r={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(n),...r},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${i.STATUS_CODES[t]}\r
`+Object.keys(r).map(e=>`${e}: ${r[e]}`).join("\r\n")+"\r\n\r\n"+n)}function _(e,t,n,r,i){if(e.listenerCount("wsClientError")){let r=Error(i);Error.captureStackTrace(r,_),e.emit("wsClientError",r,n,t)}else y(n,r,i)}e.exports=f},17311:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalAccountClient=void 0;let r=n(61658),i=n(1928),s=n(1709),o=n(32861);class a{constructor(){throw Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(e,t){var n,a;return e&&e.type===r.EXTERNAL_ACCOUNT_TYPE?(null==(n=e.credential_source)?void 0:n.environment_id)?new s.AwsClient(e,t):(null==(a=e.credential_source)?void 0:a.executable)?new o.PluggableAuthClient(e,t):new i.IdentityPoolClient(e,t):null}}t.ExternalAccountClient=a},18147:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AwsRequestSigner=void 0;let r=n(8655),i="AWS4-HMAC-SHA256";class s{constructor(e,t){this.getCredentials=e,this.region=t,this.crypto=(0,r.createCrypto)()}async getRequestOptions(e){if(!e.url)throw Error('"url" is required in "amzOptions"');let t="object"==typeof e.data?JSON.stringify(e.data):e.data,n=e.url,r=e.method||"GET",i=e.body||t,s=e.headers,o=await this.getCredentials(),a=new URL(n),u=await l({crypto:this.crypto,host:a.host,canonicalUri:a.pathname,canonicalQuerystring:a.search.substr(1),method:r,region:this.region,securityCredentials:o,requestPayload:i,additionalAmzHeaders:s}),c=Object.assign(u.amzDate?{"x-amz-date":u.amzDate}:{},{Authorization:u.authorizationHeader,host:a.host},s||{});o.token&&Object.assign(c,{"x-amz-security-token":o.token});let d={url:n,method:r,headers:c};return void 0!==i&&(d.body=i),d}}async function o(e,t,n){return await e.signWithHmacSha256(t,n)}async function a(e,t,n,r,i){let s=await o(e,`AWS4${t}`,n),a=await o(e,s,r),l=await o(e,a,i);return await o(e,l,"aws4_request")}async function l(e){let t=e.additionalAmzHeaders||{},n=e.requestPayload||"",s=e.host.split(".")[0],l=new Date,u=l.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),c=l.toISOString().replace(/[-]/g,"").replace(/T.*/,""),d={};Object.keys(t).forEach(e=>{d[e.toLowerCase()]=t[e]}),e.securityCredentials.token&&(d["x-amz-security-token"]=e.securityCredentials.token);let h=Object.assign({host:e.host},d.date?{}:{"x-amz-date":u},d),p="",f=Object.keys(h).sort();f.forEach(e=>{p+=`${e}:${h[e]}
`});let m=f.join(";"),g=await e.crypto.sha256DigestHex(n),y=`${e.method}
${e.canonicalUri}
${e.canonicalQuerystring}
${p}
${m}
${g}`,_=`${c}/${e.region}/${s}/aws4_request`,v=`${i}
${u}
${_}
`+await e.crypto.sha256DigestHex(y),E=await a(e.crypto,e.securityCredentials.secretAccessKey,c,e.region,s),T=await o(e.crypto,E,v),C=`${i} Credential=${e.securityCredentials.accessKeyId}/${_}, SignedHeaders=${m}, Signature=${(0,r.fromArrayBufferToHex)(T)}`;return{amzDate:d.date?void 0:u,authorizationHeader:C,canonicalQuerystring:e.canonicalQuerystring}}t.AwsRequestSigner=s},18929:(e,t)=>{"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return(n+r)*3/4-r},t.toByteArray=function(e){var t,n,s=l(e),o=s[0],a=s[1],u=new i((o+a)*3/4-a),c=0,d=a>0?o-4:o;for(n=0;n<d;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;return 2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[c++]=255&t),1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t),u},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,s=[],o=0,a=r-i;o<a;o+=16383)s.push(function(e,t,r){for(var i,s=[],o=t;o<r;o+=3)i=(e[o]<<16&0xff0000)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(n[i>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return s.join("")}(e,o,o+16383>a?a:o+16383));return 1===i?s.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===i&&s.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),s.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=s.length;o<a;++o)n[o]=s[o],r[s.charCodeAt(o)]=o;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}r[45]=62,r[95]=63},20003:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserRefreshClient=t.USER_REFRESH_ACCOUNT_TYPE=void 0;let r=n(86679),i=n(11723);t.USER_REFRESH_ACCOUNT_TYPE="authorized_user";class s extends r.OAuth2Client{constructor(e,t,n,r,i){let s=e&&"object"==typeof e?e:{clientId:e,clientSecret:t,refreshToken:n,eagerRefreshThresholdMillis:r,forceRefreshOnFailure:i};super(s),this._refreshToken=s.refreshToken,this.credentials.refresh_token=s.refreshToken}async refreshTokenNoCache(e){return super.refreshTokenNoCache(this._refreshToken)}async fetchIdToken(e){return(await this.transporter.request({...s.RETRY_CONFIG,url:this.endpoints.oauth2TokenUrl,headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",data:(0,i.stringify)({client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token",refresh_token:this._refreshToken,target_audience:e})})).data.id_token}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the user refresh token");if("authorized_user"!==e.type)throw Error('The incoming JSON object does not have the "authorized_user" type');if(!e.client_id)throw Error("The incoming JSON object does not contain a client_id field");if(!e.client_secret)throw Error("The incoming JSON object does not contain a client_secret field");if(!e.refresh_token)throw Error("The incoming JSON object does not contain a refresh_token field");this._clientId=e.client_id,this._clientSecret=e.client_secret,this._refreshToken=e.refresh_token,this.credentials.refresh_token=e.refresh_token,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}async fromStreamAsync(e){return new Promise((t,n)=>{if(!e)return n(Error("Must pass in a stream containing the user refresh token."));let r="";e.setEncoding("utf8").on("error",n).on("data",e=>r+=e).on("end",()=>{try{let e=JSON.parse(r);return this.fromJSON(e),t()}catch(e){return n(e)}})})}static fromJSON(e){let t=new s;return t.fromJSON(e),t}}t.UserRefreshClient=s},20322:function(e,t,n){"use strict";let r;var i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.gcpResidencyCache=t.METADATA_SERVER_DETECTION=t.HEADERS=t.HEADER_VALUE=t.HEADER_NAME=t.SECONDARY_HOST_ADDRESS=t.HOST_ADDRESS=t.BASE_PATH=void 0,t.instance=function(e){return h("instance",e)},t.project=function(e){return h("project",e)},t.universe=function(e){return h("universe",e)},t.bulk=f,t.isAvailable=m,t.resetIsAvailableCache=function(){r=void 0},t.getGCPResidency=g,t.setGCPResidency=y,t.requestTimeout=_;let o=n(88855),a=n(96542),l=n(89293),u=n(91569);t.BASE_PATH="/computeMetadata/v1",t.HOST_ADDRESS="http://169.254.169.254",t.SECONDARY_HOST_ADDRESS="http://metadata.google.internal.",t.HEADER_NAME="Metadata-Flavor",t.HEADER_VALUE="Google",t.HEADERS=Object.freeze({[t.HEADER_NAME]:t.HEADER_VALUE});let c=u.log("gcp metadata");function d(e){return e||(e=process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST||t.HOST_ADDRESS),/^https?:\/\//.test(e)||(e=`http://${e}`),new URL(t.BASE_PATH,e).href}async function h(e,n={},r=3,i=!1){let s="",l={},u={};("object"==typeof e?(s=e.metadataKey,l=e.params||l,u=e.headers||u,r=e.noResponseRetries||r,i=e.fastFail||i):s=e,"string"==typeof n)?s+=`/${n}`:(Object.keys(n).forEach(e=>{switch(e){case"params":case"property":case"headers":break;case"qs":throw Error("'qs' is not a valid configuration option. Please use 'params' instead.");default:throw Error(`'${e}' is not a valid configuration option.`)}}),n.property&&(s+=`/${n.property}`),u=n.headers||u,l=n.params||l);let f=i?p:o.request,m={url:`${d()}/${s}`,headers:{...t.HEADERS,...u},retryConfig:{noResponseRetries:r},params:l,responseType:"text",timeout:_()};c.info("instance request %j",m);let g=await f(m);if(c.info("instance metadata is %s",g.data),g.headers[t.HEADER_NAME.toLowerCase()]!==t.HEADER_VALUE)throw Error(`Invalid response from metadata service: incorrect ${t.HEADER_NAME} header. Expected '${t.HEADER_VALUE}', got ${g.headers[t.HEADER_NAME.toLowerCase()]?`'${g.headers[t.HEADER_NAME.toLowerCase()]}'`:"no header"}`);if("string"==typeof g.data)try{return a.parse(g.data)}catch(e){}return g.data}async function p(e){var n;let r={...e,url:null==(n=e.url)?void 0:n.toString().replace(d(),d(t.SECONDARY_HOST_ADDRESS))},i=!1,s=(0,o.request)(e).then(e=>(i=!0,e)).catch(e=>{if(i)return a;throw i=!0,e}),a=(0,o.request)(r).then(e=>(i=!0,e)).catch(e=>{if(i)return s;throw i=!0,e});return Promise.race([s,a])}async function f(e){let t={};return await Promise.all(e.map(e=>(async()=>{let n=await h(e);t[e.metadataKey]=n})())),t}async function m(){if(process.env.METADATA_SERVER_DETECTION){let e=process.env.METADATA_SERVER_DETECTION.trim().toLocaleLowerCase();if(!(e in t.METADATA_SERVER_DETECTION))throw RangeError(`Unknown \`METADATA_SERVER_DETECTION\` env variable. Got \`${e}\`, but it should be \`${Object.keys(t.METADATA_SERVER_DETECTION).join("`, `")}\`, or unset`);switch(e){case"assume-present":return!0;case"none":return!1;case"bios-only":return g()}}try{return void 0===r&&(r=h("instance",void 0,process.env.DETECT_GCP_RETRIES?Number(process.env.DETECT_GCP_RETRIES):0,!(process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST))),await r,!0}catch(e){if(process.env.DEBUG_AUTH&&console.info(e),"request-timeout"===e.type||e.response&&404===e.response.status)return!1;if(!(e.response&&404===e.response.status)&&(!e.code||!["EHOSTDOWN","EHOSTUNREACH","ENETUNREACH","ENOENT","ENOTFOUND","ECONNREFUSED"].includes(e.code))){let t="UNKNOWN";e.code&&(t=e.code),process.emitWarning(`received unexpected error = ${e.message} code = ${t}`,"MetadataLookupWarning")}return!1}}function g(){return null===t.gcpResidencyCache&&y(),t.gcpResidencyCache}function y(e=null){t.gcpResidencyCache=null!==e?e:(0,l.detectGCPResidency)()}function _(){return 3e3*!g()}t.METADATA_SERVER_DETECTION=Object.freeze({"assume-present":"don't try to ping the metadata server, but assume it's present",none:"don't try to ping the metadata server, but don't try to use it either","bios-only":"treat the result of a BIOS probe as canonical (don't fall back to pinging)","ping-only":"skip the BIOS probe, and go straight to pinging"}),t.gcpResidencyCache=null,s(n(89293),t)},21146:function(e,t){"use strict";var n,r,i,s,o=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};function a(e){return e.replace(/([_][^_])/g,e=>e.slice(1).toUpperCase())}Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=void 0,t.snakeToCamel=a,t.originalOrCamelOptions=function(e){return{get:function(t){var n;let r=e||{};return null!=(n=r[t])?n:r[a(t)]}}};class l{constructor(e){n.add(this),r.set(this,new Map),this.capacity=e.capacity,this.maxAge=e.maxAge}set(e,t){o(this,n,"m",i).call(this,e,t),o(this,n,"m",s).call(this)}get(e){let t=o(this,r,"f").get(e);if(t)return o(this,n,"m",i).call(this,e,t.value),o(this,n,"m",s).call(this),t.value}}t.LRUCache=l,r=new WeakMap,n=new WeakSet,i=function(e,t){o(this,r,"f").delete(e),o(this,r,"f").set(e,{value:t,lastAccessed:Date.now()})},s=function(){let e=this.maxAge?Date.now()-this.maxAge:0,t=o(this,r,"f").entries().next();for(;!t.done&&(o(this,r,"f").size>this.capacity||t.value[1].lastAccessed<e);)o(this,r,"f").delete(t.value[0]),t=o(this,r,"f").entries().next()}},21761:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StsCredentials=void 0;let r=n(88855),i=n(11723),s=n(11433),o=n(7773);class a extends o.OAuthClientAuthHandler{constructor(e,t){super(t),this.tokenExchangeEndpoint=e,this.transporter=new s.DefaultTransporter}async exchangeToken(e,t,n){var s,l,u;let c={grant_type:e.grantType,resource:e.resource,audience:e.audience,scope:null==(s=e.scope)?void 0:s.join(" "),requested_token_type:e.requestedTokenType,subject_token:e.subjectToken,subject_token_type:e.subjectTokenType,actor_token:null==(l=e.actingParty)?void 0:l.actorToken,actor_token_type:null==(u=e.actingParty)?void 0:u.actorTokenType,options:n&&JSON.stringify(n)};Object.keys(c).forEach(e=>{void 0===c[e]&&delete c[e]});let d={"Content-Type":"application/x-www-form-urlencoded"};Object.assign(d,t||{});let h={...a.RETRY_CONFIG,url:this.tokenExchangeEndpoint.toString(),method:"POST",headers:d,data:i.stringify(c),responseType:"json"};this.applyClientAuthenticationOptions(h);try{let e=await this.transporter.request(h),t=e.data;return t.res=e,t}catch(e){if(e instanceof r.GaxiosError&&e.response)throw(0,o.getErrorFromOAuthErrorResponse)(e.response.data,e);throw e}}}t.StsCredentials=a},23055:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pkg=void 0,t.pkg=n(36547)},23773:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PassThroughClient=void 0;let r=n(75374);class i extends r.AuthClient{async request(e){return this.transporter.request(e)}async getAccessToken(){return{}}async getRequestHeaders(){return{}}}t.PassThroughClient=i,new i().getAccessToken()},24071:function(e,t,n){var r;!function(i){"use strict";var s,o=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,a=Math.ceil,l=Math.floor,u="[BigNumber Error] ",c=u+"Number primitive has more than 15 significant digits: ",d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13];function h(e){var t=0|e;return e>0||e===t?t:t-1}function p(e){for(var t,n,r=1,i=e.length,s=e[0]+"";r<i;){for(n=14-(t=e[r++]+"").length;n--;t="0"+t);s+=t}for(i=s.length;48===s.charCodeAt(--i););return s.slice(0,i+1||1)}function f(e,t){var n,r,i=e.c,s=t.c,o=e.s,a=t.s,l=e.e,u=t.e;if(!o||!a)return null;if(n=i&&!i[0],r=s&&!s[0],n||r)return n?r?0:-a:o;if(o!=a)return o;if(n=o<0,r=l==u,!i||!s)return r?0:!i^n?1:-1;if(!r)return l>u^n?1:-1;for(o=0,a=(l=i.length)<(u=s.length)?l:u;o<a;o++)if(i[o]!=s[o])return i[o]>s[o]^n?1:-1;return l==u?0:l>u^n?1:-1}function m(e,t,n,r){if(e<t||e>n||e!==l(e))throw Error(u+(r||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function g(e){var t=e.c.length-1;return h(e.e/14)==t&&e.c[t]%2!=0}function y(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function _(e,t,n){var r,i;if(t<0){for(i=n+".";++t;i+=n);e=i+e}else if(r=e.length,++t>r){for(i=n,t-=r;--t;i+=n);e+=i}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}(s=function e(t){var n,r,i,s,v,E,T,C,b,A=L.prototype={constructor:L,toString:null,valueOf:null},S=new L(1),w=20,O=4,k=-7,x=21,I=-1e7,N=1e7,R=!1,P=1,D=0,M={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xa0",suffix:""},U="0123456789abcdefghijklmnopqrstuvwxyz",j=!0;function L(e,t){var n,r,i,s,a,u,d,h,p=this;if(!(p instanceof L))return new L(e,t);if(null==t){if(e&&!0===e._isBigNumber){p.s=e.s,!e.c||e.e>N?p.c=p.e=null:e.e<I?p.c=[p.e=0]:(p.e=e.e,p.c=e.c.slice());return}if((u="number"==typeof e)&&0*e==0){if(p.s=1/e<0?(e=-e,-1):1,e===~~e){for(s=0,a=e;a>=10;a/=10,s++);s>N?p.c=p.e=null:(p.e=s,p.c=[e]);return}h=String(e)}else{if(!o.test(h=String(e)))return b(p,h,u);p.s=45==h.charCodeAt(0)?(h=h.slice(1),-1):1}(s=h.indexOf("."))>-1&&(h=h.replace(".","")),(a=h.search(/e/i))>0?(s<0&&(s=a),s+=+h.slice(a+1),h=h.substring(0,a)):s<0&&(s=h.length)}else{if(m(t,2,U.length,"Base"),10==t&&j)return q(p=new L(e),w+p.e+1,O);if(h=String(e),u="number"==typeof e){if(0*e!=0)return b(p,h,u,t);if(p.s=1/e<0?(h=h.slice(1),-1):1,L.DEBUG&&h.replace(/^0\.0*|\./,"").length>15)throw Error(c+e)}else p.s=45===h.charCodeAt(0)?(h=h.slice(1),-1):1;for(n=U.slice(0,t),s=a=0,d=h.length;a<d;a++)if(0>n.indexOf(r=h.charAt(a))){if("."==r){if(a>s){s=d;continue}}else if(!i&&(h==h.toUpperCase()&&(h=h.toLowerCase())||h==h.toLowerCase()&&(h=h.toUpperCase()))){i=!0,a=-1,s=0;continue}return b(p,String(e),u,t)}u=!1,(s=(h=C(h,t,10,p.s)).indexOf("."))>-1?h=h.replace(".",""):s=h.length}for(a=0;48===h.charCodeAt(a);a++);for(d=h.length;48===h.charCodeAt(--d););if(h=h.slice(a,++d)){if(d-=a,u&&L.DEBUG&&d>15&&(e>0x1fffffffffffff||e!==l(e)))throw Error(c+p.s*e);if((s=s-a-1)>N)p.c=p.e=null;else if(s<I)p.c=[p.e=0];else{if(p.e=s,p.c=[],a=(s+1)%14,s<0&&(a+=14),a<d){for(a&&p.c.push(+h.slice(0,a)),d-=14;a<d;)p.c.push(+h.slice(a,a+=14));a=14-(h=h.slice(a)).length}else a-=d;for(;a--;h+="0");p.c.push(+h)}}else p.c=[p.e=0]}function F(e,t,n,r){var i,s,o,a,l;if(null==n?n=O:m(n,0,8),!e.c)return e.toString();if(i=e.c[0],o=e.e,null==t)l=p(e.c),l=1==r||2==r&&(o<=k||o>=x)?y(l,o):_(l,o,"0");else if(s=(e=q(new L(e),t,n)).e,a=(l=p(e.c)).length,1==r||2==r&&(t<=s||s<=k)){for(;a<t;l+="0",a++);l=y(l,s)}else if(t-=o,l=_(l,s,"0"),s+1>a){if(--t>0)for(l+=".";t--;l+="0");}else if((t+=s-a)>0)for(s+1==a&&(l+=".");t--;l+="0");return e.s<0&&i?"-"+l:l}function G(e,t){for(var n,r,i=1,s=new L(e[0]);i<e.length;i++)(r=new L(e[i])).s&&(n=f(s,r))!==t&&(0!==n||s.s!==t)||(s=r);return s}function B(e,t,n){for(var r=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,r++);return(n=r+14*n-1)>N?e.c=e.e=null:n<I?e.c=[e.e=0]:(e.e=n,e.c=t),e}function q(e,t,n,r){var i,s,o,u,c,h,p,f=e.c;if(f){e:{for(i=1,u=f[0];u>=10;u/=10,i++);if((s=t-i)<0)s+=14,o=t,p=l((c=f[h=0])/d[i-o-1]%10);else if((h=a((s+1)/14))>=f.length)if(r){for(;f.length<=h;f.push(0));c=p=0,i=1,s%=14,o=s-14+1}else break e;else{for(i=1,c=u=f[h];u>=10;u/=10,i++);s%=14,p=(o=s-14+i)<0?0:l(c/d[i-o-1]%10)}if(r=r||t<0||null!=f[h+1]||(o<0?c:c%d[i-o-1]),r=n<4?(p||r)&&(0==n||n==(e.s<0?3:2)):p>5||5==p&&(4==n||r||6==n&&(s>0?o>0?c/d[i-o]:0:f[h-1])%10&1||n==(e.s<0?8:7)),t<1||!f[0])return f.length=0,r?(t-=e.e+1,f[0]=d[(14-t%14)%14],e.e=-t||0):f[0]=e.e=0,e;if(0==s?(f.length=h,u=1,h--):(f.length=h+1,u=d[14-s],f[h]=o>0?l(c/d[i-o]%d[o])*u:0),r)for(;;)if(0==h){for(s=1,o=f[0];o>=10;o/=10,s++);for(o=f[0]+=u,u=1;o>=10;o/=10,u++);s!=u&&(e.e++,1e14==f[0]&&(f[0]=1));break}else{if(f[h]+=u,1e14!=f[h])break;f[h--]=0,u=1}for(s=f.length;0===f[--s];f.pop());}e.e>N?e.c=e.e=null:e.e<I&&(e.c=[e.e=0])}return e}function $(e){var t,n=e.e;return null===n?e.toString():(t=p(e.c),t=n<=k||n>=x?y(t,n):_(t,n,"0"),e.s<0?"-"+t:t)}return L.clone=e,L.ROUND_UP=0,L.ROUND_DOWN=1,L.ROUND_CEIL=2,L.ROUND_FLOOR=3,L.ROUND_HALF_UP=4,L.ROUND_HALF_DOWN=5,L.ROUND_HALF_EVEN=6,L.ROUND_HALF_CEIL=7,L.ROUND_HALF_FLOOR=8,L.EUCLID=9,L.config=L.set=function(e){var t,n;if(null!=e)if("object"==typeof e){if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(m(n=e[t],0,1e9,t),w=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(m(n=e[t],0,8,t),O=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(m(n[0],-1e9,0,t),m(n[1],0,1e9,t),k=n[0],x=n[1]):(m(n,-1e9,1e9,t),k=-(x=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)m(n[0],-1e9,-1,t),m(n[1],1,1e9,t),I=n[0],N=n[1];else if(m(n,-1e9,1e9,t),n)I=-(N=n<0?-n:n);else throw Error(u+t+" cannot be zero: "+n);if(e.hasOwnProperty(t="CRYPTO"))if(!!(n=e[t])===n)if(n)if("undefined"!=typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))R=n;else throw R=!n,Error(u+"crypto unavailable");else R=n;else throw Error(u+t+" not true or false: "+n);if(e.hasOwnProperty(t="MODULO_MODE")&&(m(n=e[t],0,9,t),P=n),e.hasOwnProperty(t="POW_PRECISION")&&(m(n=e[t],0,1e9,t),D=n),e.hasOwnProperty(t="FORMAT"))if("object"==typeof(n=e[t]))M=n;else throw Error(u+t+" not an object: "+n);if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(u+t+" invalid: "+n);j="0123456789"==n.slice(0,10),U=n}}else throw Error(u+"Object expected: "+e);return{DECIMAL_PLACES:w,ROUNDING_MODE:O,EXPONENTIAL_AT:[k,x],RANGE:[I,N],CRYPTO:R,MODULO_MODE:P,POW_PRECISION:D,FORMAT:M,ALPHABET:U}},L.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!L.DEBUG)return!0;var t,n,r=e.c,i=e.e,s=e.s;e:if("[object Array]"==({}).toString.call(r)){if((1===s||-1===s)&&i>=-1e9&&i<=1e9&&i===l(i)){if(0===r[0]){if(0===i&&1===r.length)return!0;break e}if((t=(i+1)%14)<1&&(t+=14),String(r[0]).length==t){for(t=0;t<r.length;t++)if((n=r[t])<0||n>=1e14||n!==l(n))break e;if(0!==n)return!0}}}else if(null===r&&null===i&&(null===s||1===s||-1===s))return!0;throw Error(u+"Invalid BigNumber: "+e)},L.maximum=L.max=function(){return G(arguments,-1)},L.minimum=L.min=function(){return G(arguments,1)},n=0x20000000000000*Math.random()&2097151?function(){return l(0x20000000000000*Math.random())}:function(){return(0x40000000*Math.random()|0)*8388608+(8388608*Math.random()|0)},L.random=function(e){var t,r,i,s,o,c=0,h=[],p=new L(S);if(null==e?e=w:m(e,0,1e9),s=a(e/14),R)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(s*=2));c<s;)(o=131072*t[c]+(t[c+1]>>>11))>=9e15?(r=crypto.getRandomValues(new Uint32Array(2)),t[c]=r[0],t[c+1]=r[1]):(h.push(o%1e14),c+=2);c=s/2}else if(crypto.randomBytes){for(t=crypto.randomBytes(s*=7);c<s;)(o=(31&t[c])*0x1000000000000+0x10000000000*t[c+1]+0x100000000*t[c+2]+0x1000000*t[c+3]+(t[c+4]<<16)+(t[c+5]<<8)+t[c+6])>=9e15?crypto.randomBytes(7).copy(t,c):(h.push(o%1e14),c+=7);c=s/7}else throw R=!1,Error(u+"crypto unavailable");if(!R)for(;c<s;)(o=n())<9e15&&(h[c++]=o%1e14);for(s=h[--c],e%=14,s&&e&&(o=d[14-e],h[c]=l(s/o)*o);0===h[c];h.pop(),c--);if(c<0)h=[i=0];else{for(i=-1;0===h[0];h.splice(0,1),i-=14);for(c=1,o=h[0];o>=10;o/=10,c++);c<14&&(i-=14-c)}return p.e=i,p.c=h,p},L.sum=function(){for(var e=1,t=arguments,n=new L(t[0]);e<t.length;)n=n.plus(t[e++]);return n},C=function(){var e="0123456789";function t(e,t,n,r){for(var i,s,o=[0],a=0,l=e.length;a<l;){for(s=o.length;s--;o[s]*=t);for(o[0]+=r.indexOf(e.charAt(a++)),i=0;i<o.length;i++)o[i]>n-1&&(null==o[i+1]&&(o[i+1]=0),o[i+1]+=o[i]/n|0,o[i]%=n)}return o.reverse()}return function(n,r,i,s,o){var a,l,u,c,d,h,f,m,g=n.indexOf("."),y=w,v=O;for(g>=0&&(c=D,D=0,n=n.replace(".",""),h=(m=new L(r)).pow(n.length-g),D=c,m.c=t(_(p(h.c),h.e,"0"),10,i,e),m.e=m.c.length),u=c=(f=t(n,r,i,o?(a=U,e):(a=e,U))).length;0==f[--c];f.pop());if(!f[0])return a.charAt(0);if(g<0?--u:(h.c=f,h.e=u,h.s=s,f=(h=T(h,m,y,v,i)).c,d=h.r,u=h.e),g=f[l=u+y+1],c=i/2,d=d||l<0||null!=f[l+1],d=v<4?(null!=g||d)&&(0==v||v==(h.s<0?3:2)):g>c||g==c&&(4==v||d||6==v&&1&f[l-1]||v==(h.s<0?8:7)),l<1||!f[0])n=d?_(a.charAt(1),-y,a.charAt(0)):a.charAt(0);else{if(f.length=l,d)for(--i;++f[--l]>i;)f[l]=0,l||(++u,f=[1].concat(f));for(c=f.length;!f[--c];);for(g=0,n="";g<=c;n+=a.charAt(f[g++]));n=_(n,u,a.charAt(0))}return n}}(),T=function(){function e(e,t,n){var r,i,s,o,a=0,l=e.length,u=t%1e7,c=t/1e7|0;for(e=e.slice();l--;)r=c*(s=e[l]%1e7)+(o=e[l]/1e7|0)*u,a=((i=u*s+r%1e7*1e7+a)/n|0)+(r/1e7|0)+c*o,e[l]=i%n;return a&&(e=[a].concat(e)),e}function t(e,t,n,r){var i,s;if(n!=r)s=n>r?1:-1;else for(i=s=0;i<n;i++)if(e[i]!=t[i]){s=e[i]>t[i]?1:-1;break}return s}function n(e,t,n,r){for(var i=0;n--;)e[n]-=i,i=+(e[n]<t[n]),e[n]=i*r+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(r,i,s,o,a){var u,c,d,p,f,m,g,y,_,v,E,T,C,b,A,S,w,O=r.s==i.s?1:-1,k=r.c,x=i.c;if(!k||!k[0]||!x||!x[0])return new L(!r.s||!i.s||(k?x&&k[0]==x[0]:!x)?NaN:k&&0==k[0]||!x?0*O:O/0);for(_=(y=new L(O)).c=[],O=s+(c=r.e-i.e)+1,a||(a=1e14,c=h(r.e/14)-h(i.e/14),O=O/14|0),d=0;x[d]==(k[d]||0);d++);if(x[d]>(k[d]||0)&&c--,O<0)_.push(1),p=!0;else{for(b=k.length,S=x.length,d=0,O+=2,(f=l(a/(x[0]+1)))>1&&(x=e(x,f,a),k=e(k,f,a),S=x.length,b=k.length),C=S,E=(v=k.slice(0,S)).length;E<S;v[E++]=0);w=[0].concat(w=x.slice()),A=x[0],x[1]>=a/2&&A++;do{if(f=0,(u=t(x,v,S,E))<0){if(T=v[0],S!=E&&(T=T*a+(v[1]||0)),(f=l(T/A))>1)for(f>=a&&(f=a-1),g=(m=e(x,f,a)).length,E=v.length;1==t(m,v,g,E);)f--,n(m,S<g?w:x,g,a),g=m.length,u=1;else 0==f&&(u=f=1),g=(m=x.slice()).length;if(g<E&&(m=[0].concat(m)),n(v,m,E,a),E=v.length,-1==u)for(;1>t(x,v,S,E);)f++,n(v,S<E?w:x,E,a),E=v.length}else 0===u&&(f++,v=[0]);_[d++]=f,v[0]?v[E++]=k[C]||0:(v=[k[C]],E=1)}while((C++<b||null!=v[0])&&O--);p=null!=v[0],_[0]||_.splice(0,1)}if(1e14==a){for(d=1,O=_[0];O>=10;O/=10,d++);q(y,s+(y.e=d+14*c-1)+1,o,p)}else y.e=c,y.r=+p;return y}}(),r=/^(-?)0([xbo])(?=\w[\w.]*$)/i,i=/^([^.]+)\.$/,s=/^\.([^.]+)$/,v=/^-?(Infinity|NaN)$/,E=/^\s*\+(?=[\w.])|^\s+|\s+$/g,b=function(e,t,n,o){var a,l=n?t:t.replace(E,"");if(v.test(l))e.s=isNaN(l)?null:l<0?-1:1;else{if(!n&&(l=l.replace(r,function(e,t,n){return a="x"==(n=n.toLowerCase())?16:"b"==n?2:8,o&&o!=a?e:t}),o&&(a=o,l=l.replace(i,"$1").replace(s,"0.$1")),t!=l))return new L(l,a);if(L.DEBUG)throw Error(u+"Not a"+(o?" base "+o:"")+" number: "+t);e.s=null}e.c=e.e=null},A.absoluteValue=A.abs=function(){var e=new L(this);return e.s<0&&(e.s=1),e},A.comparedTo=function(e,t){return f(this,new L(e,t))},A.decimalPlaces=A.dp=function(e,t){var n,r,i;if(null!=e)return m(e,0,1e9),null==t?t=O:m(t,0,8),q(new L(this),e+this.e+1,t);if(!(n=this.c))return null;if(r=((i=n.length-1)-h(this.e/14))*14,i=n[i])for(;i%10==0;i/=10,r--);return r<0&&(r=0),r},A.dividedBy=A.div=function(e,t){return T(this,new L(e,t),w,O)},A.dividedToIntegerBy=A.idiv=function(e,t){return T(this,new L(e,t),0,1)},A.exponentiatedBy=A.pow=function(e,t){var n,r,i,s,o,c,d,h,p,f=this;if((e=new L(e)).c&&!e.isInteger())throw Error(u+"Exponent not an integer: "+$(e));if(null!=t&&(t=new L(t)),c=e.e>14,!f.c||!f.c[0]||1==f.c[0]&&!f.e&&1==f.c.length||!e.c||!e.c[0])return p=new L(Math.pow(+$(f),c?e.s*(2-g(e)):+$(e))),t?p.mod(t):p;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new L(NaN);(r=!d&&f.isInteger()&&t.isInteger())&&(f=f.mod(t))}else{if(e.e>9&&(f.e>0||f.e<-1||(0==f.e?f.c[0]>1||c&&f.c[1]>=24e7:f.c[0]<8e13||c&&f.c[0]<=9999975e7)))return s=f.s<0&&g(e)?-0:0,f.e>-1&&(s=1/s),new L(d?1/s:s);D&&(s=a(D/14+2))}for(c?(n=new L(.5),d&&(e.s=1),h=g(e)):h=(i=Math.abs(+$(e)))%2,p=new L(S);;){if(h){if(!(p=p.times(f)).c)break;s?p.c.length>s&&(p.c.length=s):r&&(p=p.mod(t))}if(i){if(0===(i=l(i/2)))break;h=i%2}else if(q(e=e.times(n),e.e+1,1),e.e>14)h=g(e);else{if(0==(i=+$(e)))break;h=i%2}f=f.times(f),s?f.c&&f.c.length>s&&(f.c.length=s):r&&(f=f.mod(t))}return r?p:(d&&(p=S.div(p)),t?p.mod(t):s?q(p,D,O,o):p)},A.integerValue=function(e){var t=new L(this);return null==e?e=O:m(e,0,8),q(t,t.e+1,e)},A.isEqualTo=A.eq=function(e,t){return 0===f(this,new L(e,t))},A.isFinite=function(){return!!this.c},A.isGreaterThan=A.gt=function(e,t){return f(this,new L(e,t))>0},A.isGreaterThanOrEqualTo=A.gte=function(e,t){return 1===(t=f(this,new L(e,t)))||0===t},A.isInteger=function(){return!!this.c&&h(this.e/14)>this.c.length-2},A.isLessThan=A.lt=function(e,t){return 0>f(this,new L(e,t))},A.isLessThanOrEqualTo=A.lte=function(e,t){return -1===(t=f(this,new L(e,t)))||0===t},A.isNaN=function(){return!this.s},A.isNegative=function(){return this.s<0},A.isPositive=function(){return this.s>0},A.isZero=function(){return!!this.c&&0==this.c[0]},A.minus=function(e,t){var n,r,i,s,o=this.s;if(t=(e=new L(e,t)).s,!o||!t)return new L(NaN);if(o!=t)return e.s=-t,this.plus(e);var a=this.e/14,l=e.e/14,u=this.c,c=e.c;if(!a||!l){if(!u||!c)return u?(e.s=-t,e):new L(c?this:NaN);if(!u[0]||!c[0])return c[0]?(e.s=-t,e):new L(u[0]?this:3==O?-0:0)}if(a=h(a),l=h(l),u=u.slice(),o=a-l){for((s=o<0)?(o=-o,i=u):(l=a,i=c),i.reverse(),t=o;t--;i.push(0));i.reverse()}else for(r=(s=(o=u.length)<(t=c.length))?o:t,o=t=0;t<r;t++)if(u[t]!=c[t]){s=u[t]<c[t];break}if(s&&(i=u,u=c,c=i,e.s=-e.s),(t=(r=c.length)-(n=u.length))>0)for(;t--;u[n++]=0);for(t=1e14-1;r>o;){if(u[--r]<c[r]){for(n=r;n&&!u[--n];u[n]=t);--u[n],u[r]+=1e14}u[r]-=c[r]}for(;0==u[0];u.splice(0,1),--l);return u[0]?B(e,u,l):(e.s=3==O?-1:1,e.c=[e.e=0],e)},A.modulo=A.mod=function(e,t){var n,r;return(e=new L(e,t),this.c&&e.s&&(!e.c||e.c[0]))?e.c&&(!this.c||this.c[0])?(9==P?(r=e.s,e.s=1,n=T(this,e,0,3),e.s=r,n.s*=r):n=T(this,e,0,P),(e=this.minus(n.times(e))).c[0]||1!=P||(e.s=this.s),e):new L(this):new L(NaN)},A.multipliedBy=A.times=function(e,t){var n,r,i,s,o,a,l,u,c,d,p,f,m,g=this.c,y=(e=new L(e,t)).c;if(!g||!y||!g[0]||!y[0])return this.s&&e.s&&(!g||g[0]||y)&&(!y||y[0]||g)?(e.s*=this.s,g&&y?(e.c=[0],e.e=0):e.c=e.e=null):e.c=e.e=e.s=null,e;for(r=h(this.e/14)+h(e.e/14),e.s*=this.s,(l=g.length)<(d=y.length)&&(m=g,g=y,y=m,i=l,l=d,d=i),i=l+d,m=[];i--;m.push(0));for(i=d;--i>=0;){for(n=0,p=y[i]%1e7,f=y[i]/1e7|0,s=i+(o=l);s>i;)a=f*(u=g[--o]%1e7)+(c=g[o]/1e7|0)*p,n=((u=p*u+a%1e7*1e7+m[s]+n)/1e14|0)+(a/1e7|0)+f*c,m[s--]=u%1e14;m[s]=n}return n?++r:m.splice(0,1),B(e,m,r)},A.negated=function(){var e=new L(this);return e.s=-e.s||null,e},A.plus=function(e,t){var n,r=this.s;if(t=(e=new L(e,t)).s,!r||!t)return new L(NaN);if(r!=t)return e.s=-t,this.minus(e);var i=this.e/14,s=e.e/14,o=this.c,a=e.c;if(!i||!s){if(!o||!a)return new L(r/0);if(!o[0]||!a[0])return a[0]?e:new L(o[0]?this:0*r)}if(i=h(i),s=h(s),o=o.slice(),r=i-s){for(r>0?(s=i,n=a):(r=-r,n=o),n.reverse();r--;n.push(0));n.reverse()}for((r=o.length)-(t=a.length)<0&&(n=a,a=o,o=n,t=r),r=0;t;)r=(o[--t]=o[t]+a[t]+r)/1e14|0,o[t]=1e14===o[t]?0:o[t]%1e14;return r&&(o=[r].concat(o),++s),B(e,o,s)},A.precision=A.sd=function(e,t){var n,r,i;if(null!=e&&!!e!==e)return m(e,1,1e9),null==t?t=O:m(t,0,8),q(new L(this),e,t);if(!(n=this.c))return null;if(r=14*(i=n.length-1)+1,i=n[i]){for(;i%10==0;i/=10,r--);for(i=n[0];i>=10;i/=10,r++);}return e&&this.e+1>r&&(r=this.e+1),r},A.shiftedBy=function(e){return m(e,-0x1fffffffffffff,0x1fffffffffffff),this.times("1e"+e)},A.squareRoot=A.sqrt=function(){var e,t,n,r,i,s=this.c,o=this.s,a=this.e,l=w+4,u=new L("0.5");if(1!==o||!s||!s[0])return new L(!o||o<0&&(!s||s[0])?NaN:s?this:1/0);if(0==(o=Math.sqrt(+$(this)))||o==1/0?(((t=p(s)).length+a)%2==0&&(t+="0"),o=Math.sqrt(+t),a=h((a+1)/2)-(a<0||a%2),n=new L(t=o==1/0?"5e"+a:(t=o.toExponential()).slice(0,t.indexOf("e")+1)+a)):n=new L(o+""),n.c[0]){for((o=(a=n.e)+l)<3&&(o=0);;)if(i=n,n=u.times(i.plus(T(this,i,l,1))),p(i.c).slice(0,o)===(t=p(n.c)).slice(0,o)){if(n.e<a&&--o,"9999"!=(t=t.slice(o-3,o+1))&&(r||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(q(n,n.e+w+2,1),e=!n.times(n).eq(this));break}if(!r&&(q(i,i.e+w+2,0),i.times(i).eq(this))){n=i;break}l+=4,o+=4,r=1}}return q(n,n.e+w+1,O,e)},A.toExponential=function(e,t){return null!=e&&(m(e,0,1e9),e++),F(this,e,t,1)},A.toFixed=function(e,t){return null!=e&&(m(e,0,1e9),e=e+this.e+1),F(this,e,t)},A.toFormat=function(e,t,n){var r;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=M;else if("object"!=typeof n)throw Error(u+"Argument not an object: "+n);if(r=this.toFixed(e,t),this.c){var i,s=r.split("."),o=+n.groupSize,a=+n.secondaryGroupSize,l=n.groupSeparator||"",c=s[0],d=s[1],h=this.s<0,p=h?c.slice(1):c,f=p.length;if(a&&(i=o,o=a,a=i,f-=i),o>0&&f>0){for(i=f%o||o,c=p.substr(0,i);i<f;i+=o)c+=l+p.substr(i,o);a>0&&(c+=l+p.slice(i)),h&&(c="-"+c)}r=d?c+(n.decimalSeparator||"")+((a=+n.fractionGroupSize)?d.replace(RegExp("\\d{"+a+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):d):c}return(n.prefix||"")+r+(n.suffix||"")},A.toFraction=function(e){var t,n,r,i,s,o,a,l,c,h,f,m,g=this.c;if(null!=e&&(!(a=new L(e)).isInteger()&&(a.c||1!==a.s)||a.lt(S)))throw Error(u+"Argument "+(a.isInteger()?"out of range: ":"not an integer: ")+$(a));if(!g)return new L(this);for(t=new L(S),c=n=new L(S),r=l=new L(S),m=p(g),s=t.e=m.length-this.e-1,t.c[0]=d[(o=s%14)<0?14+o:o],e=!e||a.comparedTo(t)>0?s>0?t:c:a,o=N,N=1/0,a=new L(m),l.c[0]=0;h=T(a,t,0,1),1!=(i=n.plus(h.times(r))).comparedTo(e);)n=r,r=i,c=l.plus(h.times(i=c)),l=i,t=a.minus(h.times(i=t)),a=i;return i=T(e.minus(n),r,0,1),l=l.plus(i.times(c)),n=n.plus(i.times(r)),l.s=c.s=this.s,s*=2,f=1>T(c,r,s,O).minus(this).abs().comparedTo(T(l,n,s,O).minus(this).abs())?[c,r]:[l,n],N=o,f},A.toNumber=function(){return+$(this)},A.toPrecision=function(e,t){return null!=e&&m(e,1,1e9),F(this,e,t,2)},A.toString=function(e){var t,n=this,r=n.s,i=n.e;return null===i?r?(t="Infinity",r<0&&(t="-"+t)):t="NaN":(null==e?t=i<=k||i>=x?y(p(n.c),i):_(p(n.c),i,"0"):10===e&&j?t=_(p((n=q(new L(n),w+i+1,O)).c),n.e,"0"):(m(e,2,U.length,"Base"),t=C(_(p(n.c),i,"0"),10,e,r,!0)),r<0&&n.c[0]&&(t="-"+t)),t},A.valueOf=A.toJSON=function(){return $(this)},A._isBigNumber=!0,null!=t&&L.set(t),L}()).default=s.BigNumber=s,void 0===(r=(function(){return s}).call(t,n,t,e))||(e.exports=r)}(0)},25388:e=>{"use strict";function t(e){return(e/8|0)+ +(e%8!=0)}var n={ES256:t(256),ES384:t(384),ES512:t(521)};e.exports=function(e){var t=n[e];if(t)return t;throw Error('Unknown algorithm "'+e+'"')}},26556:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=Object.defineProperty,i=Object.getOwnPropertyDescriptor,s=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===n.call(e)},o=function(e){if(!e||"[object Object]"!==n.call(e))return!1;var r,i=t.call(e,"constructor"),s=e.constructor&&e.constructor.prototype&&t.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!i&&!s)return!1;for(r in e);return void 0===r||t.call(e,r)},a=function(e,t){r&&"__proto__"===t.name?r(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},l=function(e,n){if("__proto__"===n){if(!t.call(e,n))return;else if(i)return i(e,n).value}return e[n]};e.exports=function e(){var t,n,r,i,u,c,d=arguments[0],h=1,p=arguments.length,f=!1;for("boolean"==typeof d&&(f=d,d=arguments[1]||{},h=2),(null==d||"object"!=typeof d&&"function"!=typeof d)&&(d={});h<p;++h)if(t=arguments[h],null!=t)for(n in t)r=l(d,n),d!==(i=l(t,n))&&(f&&i&&(o(i)||(u=s(i)))?(u?(u=!1,c=r&&s(r)?r:[]):c=r&&o(r)?r:{},a(d,{name:n,newValue:e(f,c,i)})):void 0!==i&&a(d,{name:n,newValue:i}));return d}},27855:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UrlSubjectTokenSupplier=void 0;class n{constructor(e){this.url=e.url,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName,this.headers=e.headers,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getSubjectToken(e){let t,n={...this.additionalGaxiosOptions,url:this.url,method:"GET",headers:this.headers,responseType:this.formatType};if("text"===this.formatType?t=(await e.transporter.request(n)).data:"json"===this.formatType&&this.subjectTokenFieldName&&(t=(await e.transporter.request(n)).data[this.subjectTokenFieldName]),!t)throw Error("Unable to parse the subject_token from the credential_source URL");return t}}t.UrlSubjectTokenSupplier=n},30035:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidSubjectTokenError=t.InvalidMessageFieldError=t.InvalidCodeFieldError=t.InvalidTokenTypeFieldError=t.InvalidExpirationTimeFieldError=t.InvalidSuccessFieldError=t.InvalidVersionFieldError=t.ExecutableResponseError=t.ExecutableResponse=void 0;let n="urn:ietf:params:oauth:token-type:saml2",r="urn:ietf:params:oauth:token-type:id_token",i="urn:ietf:params:oauth:token-type:jwt";class s{constructor(e){if(!e.version)throw new a("Executable response must contain a 'version' field.");if(void 0===e.success)throw new l("Executable response must contain a 'success' field.");if(this.version=e.version,this.success=e.success,this.success){if(this.expirationTime=e.expiration_time,this.tokenType=e.token_type,this.tokenType!==n&&this.tokenType!==r&&this.tokenType!==i)throw new c(`Executable response must contain a 'token_type' field when successful and it must be one of ${r}, ${i}, or ${n}.`);if(this.tokenType===n){if(!e.saml_response)throw new p(`Executable response must contain a 'saml_response' field when token_type=${n}.`);this.subjectToken=e.saml_response}else{if(!e.id_token)throw new p(`Executable response must contain a 'id_token' field when token_type=${r} or ${i}.`);this.subjectToken=e.id_token}}else{if(!e.code)throw new d("Executable response must contain a 'code' field when unsuccessful.");if(!e.message)throw new h("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=e.code,this.errorMessage=e.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return void 0!==this.expirationTime&&this.expirationTime<Math.round(Date.now()/1e3)}}t.ExecutableResponse=s;class o extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}t.ExecutableResponseError=o;class a extends o{}t.InvalidVersionFieldError=a;class l extends o{}t.InvalidSuccessFieldError=l;class u extends o{}t.InvalidExpirationTimeFieldError=u;class c extends o{}t.InvalidTokenTypeFieldError=c;class d extends o{}t.InvalidCodeFieldError=d;class h extends o{}t.InvalidMessageFieldError=h;class p extends o{}t.InvalidSubjectTokenError=p},32113:(e,t,n)=>{"use strict";let r=n(94735),i=n(55591),s=n(81630),o=n(91645),a=n(34631),{randomBytes:l,createHash:u}=n(55511),{Duplex:c,Readable:d}=n(27910),{URL:h}=n(79551),p=n(2968),f=n(15997),m=n(95773),{isBlob:g}=n(58571),{BINARY_TYPES:y,EMPTY_BUFFER:_,GUID:v,kForOnEventAttribute:E,kListener:T,kStatusCode:C,kWebSocket:b,NOOP:A}=n(32435),{EventTarget:{addEventListener:S,removeEventListener:w}}=n(56510),{format:O,parse:k}=n(46987),{toBuffer:x}=n(46471),I=Symbol("kAborted"),N=[8,13],R=["CONNECTING","OPEN","CLOSING","CLOSED"],P=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class D extends r{constructor(e,t,n){super(),this._binaryType=y[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=_,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=D.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(n=t,t=[]):t=[t]),function e(t,n,r,o){let a,c,d,f,m={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:N[1],maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...o,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=m.autoPong,!N.includes(m.protocolVersion))throw RangeError(`Unsupported protocol version: ${m.protocolVersion} (supported versions: ${N.join(", ")})`);if(n instanceof h)a=n;else try{a=new h(n)}catch(e){throw SyntaxError(`Invalid URL: ${n}`)}"http:"===a.protocol?a.protocol="ws:":"https:"===a.protocol&&(a.protocol="wss:"),t._url=a.href;let g="wss:"===a.protocol,y="ws+unix:"===a.protocol;if("ws:"===a.protocol||g||y?y&&!a.pathname?c="The URL's pathname is empty":a.hash&&(c="The URL contains a fragment identifier"):c='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',c){let e=SyntaxError(c);if(0!==t._redirects)return void M(t,e);throw e}let _=g?443:80,E=l(16).toString("base64"),T=g?i.request:s.request,C=new Set;if(m.createConnection=m.createConnection||(g?j:U),m.defaultPort=m.defaultPort||_,m.port=a.port||_,m.host=a.hostname.startsWith("[")?a.hostname.slice(1,-1):a.hostname,m.headers={...m.headers,"Sec-WebSocket-Version":m.protocolVersion,"Sec-WebSocket-Key":E,Connection:"Upgrade",Upgrade:"websocket"},m.path=a.pathname+a.search,m.timeout=m.handshakeTimeout,m.perMessageDeflate&&(d=new p(!0!==m.perMessageDeflate?m.perMessageDeflate:{},!1,m.maxPayload),m.headers["Sec-WebSocket-Extensions"]=O({[p.extensionName]:d.offer()})),r.length){for(let e of r){if("string"!=typeof e||!P.test(e)||C.has(e))throw SyntaxError("An invalid or duplicated subprotocol was specified");C.add(e)}m.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(m.origin&&(m.protocolVersion<13?m.headers["Sec-WebSocket-Origin"]=m.origin:m.headers.Origin=m.origin),(a.username||a.password)&&(m.auth=`${a.username}:${a.password}`),y){let e=m.path.split(":");m.socketPath=e[0],m.path=e[1]}if(m.followRedirects){if(0===t._redirects){t._originalIpc=y,t._originalSecure=g,t._originalHostOrSocketPath=y?m.socketPath:a.host;let e=o&&o.headers;if(o={...o,headers:{}},e)for(let[t,n]of Object.entries(e))o.headers[t.toLowerCase()]=n}else if(0===t.listenerCount("redirect")){let e=y?!!t._originalIpc&&m.socketPath===t._originalHostOrSocketPath:!t._originalIpc&&a.host===t._originalHostOrSocketPath;e&&(!t._originalSecure||g)||(delete m.headers.authorization,delete m.headers.cookie,e||delete m.headers.host,m.auth=void 0)}m.auth&&!o.headers.authorization&&(o.headers.authorization="Basic "+Buffer.from(m.auth).toString("base64")),f=t._req=T(m),t._redirects&&t.emit("redirect",t.url,f)}else f=t._req=T(m);m.timeout&&f.on("timeout",()=>{L(t,f,"Opening handshake has timed out")}),f.on("error",e=>{null===f||f[I]||(f=t._req=null,M(t,e))}),f.on("response",i=>{let s=i.headers.location,a=i.statusCode;if(s&&m.followRedirects&&a>=300&&a<400){let i;if(++t._redirects>m.maxRedirects)return void L(t,f,"Maximum redirects exceeded");f.abort();try{i=new h(s,n)}catch(e){M(t,SyntaxError(`Invalid URL: ${s}`));return}e(t,i,r,o)}else t.emit("unexpected-response",f,i)||L(t,f,`Unexpected server response: ${i.statusCode}`)}),f.on("upgrade",(e,n,r)=>{let i;if(t.emit("upgrade",e),t.readyState!==D.CONNECTING)return;f=t._req=null;let s=e.headers.upgrade;if(void 0===s||"websocket"!==s.toLowerCase())return void L(t,n,"Invalid Upgrade header");let o=u("sha1").update(E+v).digest("base64");if(e.headers["sec-websocket-accept"]!==o)return void L(t,n,"Invalid Sec-WebSocket-Accept header");let a=e.headers["sec-websocket-protocol"];if(void 0!==a?C.size?C.has(a)||(i="Server sent an invalid subprotocol"):i="Server sent a subprotocol but none was requested":C.size&&(i="Server sent no subprotocol"),i)return void L(t,n,i);a&&(t._protocol=a);let l=e.headers["sec-websocket-extensions"];if(void 0!==l){let e;if(!d)return void L(t,n,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");try{e=k(l)}catch(e){L(t,n,"Invalid Sec-WebSocket-Extensions header");return}let r=Object.keys(e);if(1!==r.length||r[0]!==p.extensionName)return void L(t,n,"Server indicated an extension that was not requested");try{d.accept(e[p.extensionName])}catch(e){L(t,n,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[p.extensionName]=d}t.setSocket(n,r,{allowSynchronousEvents:m.allowSynchronousEvents,generateMask:m.generateMask,maxPayload:m.maxPayload,skipUTF8Validation:m.skipUTF8Validation})}),m.finishRequest?m.finishRequest(f,t):f.end()}(this,e,t,n)):(this._autoPong=n.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){y.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,n){let r=new f({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation}),i=new m(e,this._extensions,n.generateMask);this._receiver=r,this._sender=i,this._socket=e,r[b]=this,i[b]=this,e[b]=this,r.on("conclude",G),r.on("drain",B),r.on("error",q),r.on("message",V),r.on("ping",H),r.on("pong",W),i.onerror=K,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Y),e.on("data",Z),e.on("end",X),e.on("error",Q),this._readyState=D.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=D.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[p.extensionName]&&this._extensions[p.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=D.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==D.CLOSED){if(this.readyState===D.CONNECTING)return void L(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===D.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=D.CLOSING,this._sender.close(e,t,!this._isServer,e=>{!e&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),z(this)}}pause(){this.readyState!==D.CONNECTING&&this.readyState!==D.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,n){if(this.readyState===D.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==D.OPEN)return void F(this,e,n);void 0===t&&(t=!this._isServer),this._sender.ping(e||_,t,n)}pong(e,t,n){if(this.readyState===D.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==D.OPEN)return void F(this,e,n);void 0===t&&(t=!this._isServer),this._sender.pong(e||_,t,n)}resume(){this.readyState!==D.CONNECTING&&this.readyState!==D.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,n){if(this.readyState===D.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(n=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==D.OPEN)return void F(this,e,n);let r={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[p.extensionName]||(r.compress=!1),this._sender.send(e||_,r,n)}terminate(){if(this.readyState!==D.CLOSED){if(this.readyState===D.CONNECTING)return void L(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this._readyState=D.CLOSING,this._socket.destroy())}}}function M(e,t){e._readyState=D.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function U(e){return e.path=e.socketPath,o.connect(e)}function j(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=o.isIP(e.host)?"":e.host),a.connect(e)}function L(e,t,n){e._readyState=D.CLOSING;let r=Error(n);Error.captureStackTrace(r,L),t.setHeader?(t[I]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(M,e,r)):(t.destroy(r),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function F(e,t,n){if(t){let n=g(t)?t.size:x(t).length;e._socket?e._sender._bufferedBytes+=n:e._bufferedAmount+=n}if(n){let t=Error(`WebSocket is not open: readyState ${e.readyState} (${R[e.readyState]})`);process.nextTick(n,t)}}function G(e,t){let n=this[b];n._closeFrameReceived=!0,n._closeMessage=t,n._closeCode=e,void 0!==n._socket[b]&&(n._socket.removeListener("data",Z),process.nextTick(J,n._socket),1005===e?n.close():n.close(e,t))}function B(){let e=this[b];e.isPaused||e._socket.resume()}function q(e){let t=this[b];void 0!==t._socket[b]&&(t._socket.removeListener("data",Z),process.nextTick(J,t._socket),t.close(e[C])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function $(){this[b].emitClose()}function V(e,t){this[b].emit("message",e,t)}function H(e){let t=this[b];t._autoPong&&t.pong(e,!this._isServer,A),t.emit("ping",e)}function W(e){this[b].emit("pong",e)}function J(e){e.resume()}function K(e){let t=this[b];t.readyState!==D.CLOSED&&(t.readyState===D.OPEN&&(t._readyState=D.CLOSING,z(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function z(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),3e4)}function Y(){let e,t=this[b];this.removeListener("close",Y),this.removeListener("data",Z),this.removeListener("end",X),t._readyState=D.CLOSING,this._readableState.endEmitted||t._closeFrameReceived||t._receiver._writableState.errorEmitted||null===(e=t._socket.read())||t._receiver.write(e),t._receiver.end(),this[b]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",$),t._receiver.on("finish",$))}function Z(e){this[b]._receiver.write(e)||this.pause()}function X(){let e=this[b];e._readyState=D.CLOSING,e._receiver.end(),this.end()}function Q(){let e=this[b];this.removeListener("error",Q),this.on("error",A),e&&(e._readyState=D.CLOSING,this.destroy())}Object.defineProperty(D,"CONNECTING",{enumerable:!0,value:R.indexOf("CONNECTING")}),Object.defineProperty(D.prototype,"CONNECTING",{enumerable:!0,value:R.indexOf("CONNECTING")}),Object.defineProperty(D,"OPEN",{enumerable:!0,value:R.indexOf("OPEN")}),Object.defineProperty(D.prototype,"OPEN",{enumerable:!0,value:R.indexOf("OPEN")}),Object.defineProperty(D,"CLOSING",{enumerable:!0,value:R.indexOf("CLOSING")}),Object.defineProperty(D.prototype,"CLOSING",{enumerable:!0,value:R.indexOf("CLOSING")}),Object.defineProperty(D,"CLOSED",{enumerable:!0,value:R.indexOf("CLOSED")}),Object.defineProperty(D.prototype,"CLOSED",{enumerable:!0,value:R.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(D.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(D.prototype,`on${e}`,{enumerable:!0,get(){for(let t of this.listeners(e))if(t[E])return t[T];return null},set(t){for(let t of this.listeners(e))if(t[E]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[E]:!0})}})}),D.prototype.addEventListener=S,D.prototype.removeEventListener=w,e.exports=D},32435:e=>{"use strict";let t=["nodebuffer","arraybuffer","fragments"],n="undefined"!=typeof Blob;n&&t.push("blob"),e.exports={BINARY_TYPES:t,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:n,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},32861:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PluggableAuthClient=t.ExecutableError=void 0;let r=n(61658),i=n(30035),s=n(53924);class o extends Error{constructor(e,t){super(`The executable failed with exit code: ${t} and error message: ${e}.`),this.code=t,Object.setPrototypeOf(this,new.target.prototype)}}t.ExecutableError=o;class a extends r.BaseExternalAccountClient{constructor(e,t){if(super(e,t),!e.credential_source.executable||(this.command=e.credential_source.executable.command,!this.command))throw Error('No valid Pluggable Auth "credential_source" provided.');if(void 0===e.credential_source.executable.timeout_millis)this.timeoutMillis=3e4;else if(this.timeoutMillis=e.credential_source.executable.timeout_millis,this.timeoutMillis<5e3||this.timeoutMillis>12e4)throw Error("Timeout must be between 5000120000 milliseconds.");this.outputFile=e.credential_source.executable.output_file,this.handler=new s.PluggableAuthHandler({command:this.command,timeoutMillis:this.timeoutMillis,outputFile:this.outputFile}),this.credentialSourceType="executable"}async retrieveSubjectToken(){let e;if("1"!==process.env.GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES)throw Error("Pluggable Auth executables need to be explicitly allowed to run by setting the GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES environment Variable to 1.");if(this.outputFile&&(e=await this.handler.retrieveCachedResponse()),!e){let t=new Map;t.set("GOOGLE_EXTERNAL_ACCOUNT_AUDIENCE",this.audience),t.set("GOOGLE_EXTERNAL_ACCOUNT_TOKEN_TYPE",this.subjectTokenType),t.set("GOOGLE_EXTERNAL_ACCOUNT_INTERACTIVE","0"),this.outputFile&&t.set("GOOGLE_EXTERNAL_ACCOUNT_OUTPUT_FILE",this.outputFile);let n=this.getServiceAccountEmail();n&&t.set("GOOGLE_EXTERNAL_ACCOUNT_IMPERSONATED_EMAIL",n),e=await this.handler.retrieveResponseFromExecutable(t)}if(e.version>1)throw Error("Version of executable is not currently supported, maximum supported version is 1.");if(!e.success)throw new o(e.errorMessage,e.errorCode);if(this.outputFile&&!e.expirationTime)throw new i.InvalidExpirationTimeFieldError("The executable response must contain the `expiration_time` field for successful responses when an output_file has been specified in the configuration.");if(e.isExpired())throw Error("Executable response is expired.");return e.subjectToken}}t.PluggableAuthClient=a},33450:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserCrypto=void 0;let r=n(18929),i=n(8655);class s{constructor(){if("undefined"==typeof window||void 0===window.crypto||void 0===window.crypto.subtle)throw Error("SubtleCrypto not found. Make sure it's an https:// website.")}async sha256DigestBase64(e){let t=new TextEncoder().encode(e),n=await window.crypto.subtle.digest("SHA-256",t);return r.fromByteArray(new Uint8Array(n))}randomBytesBase64(e){let t=new Uint8Array(e);return window.crypto.getRandomValues(t),r.fromByteArray(t)}static padBase64(e){for(;e.length%4!=0;)e+="=";return e}async verify(e,t,n){let i={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},o=new TextEncoder().encode(t),a=r.toByteArray(s.padBase64(n)),l=await window.crypto.subtle.importKey("jwk",e,i,!0,["verify"]);return await window.crypto.subtle.verify(i,l,a,o)}async sign(e,t){let n={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},i=new TextEncoder().encode(t),s=await window.crypto.subtle.importKey("jwk",e,n,!0,["sign"]),o=await window.crypto.subtle.sign(n,s,i);return r.fromByteArray(new Uint8Array(o))}decodeBase64StringUtf8(e){let t=r.toByteArray(s.padBase64(e));return new TextDecoder().decode(t)}encodeBase64StringUtf8(e){let t=new TextEncoder().encode(e);return r.fromByteArray(t)}async sha256DigestHex(e){let t=new TextEncoder().encode(e),n=await window.crypto.subtle.digest("SHA-256",t);return(0,i.fromArrayBufferToHex)(n)}async signWithHmacSha256(e,t){let n="string"==typeof e?e:String.fromCharCode(...new Uint16Array(e)),r=new TextEncoder,i=await window.crypto.subtle.importKey("raw",r.encode(n),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return window.crypto.subtle.sign("HMAC",i,r.encode(t))}}t.BrowserCrypto=s},34323:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.req=t.json=t.toBuffer=void 0;let o=s(n(81630)),a=s(n(55591));async function l(e){let t=0,n=[];for await(let r of e)t+=r.length,n.push(r);return Buffer.concat(n,t)}t.toBuffer=l,t.json=async function(e){let t=(await l(e)).toString("utf8");try{return JSON.parse(t)}catch(e){throw e.message+=` (input: ${t})`,e}},t.req=function(e,t={}){let n=(("string"==typeof e?e:e.href).startsWith("https:")?a:o).request(e,t),r=new Promise((e,t)=>{n.once("response",e).once("error",t).end()});return n.then=r.then.bind(r),n}},36547:e=>{"use strict";e.exports=JSON.parse('{"name":"gaxios","version":"6.7.1","description":"A simple common HTTP client specifically for Google APIs and services.","main":"build/src/index.js","types":"build/src/index.d.ts","files":["build/src"],"scripts":{"lint":"gts check","test":"c8 mocha build/test","presystem-test":"npm run compile","system-test":"mocha build/system-test --timeout 80000","compile":"tsc -p .","fix":"gts fix","prepare":"npm run compile","pretest":"npm run compile","webpack":"webpack","prebrowser-test":"npm run compile","browser-test":"node build/browser-test/browser-test-runner.js","docs":"compodoc src/","docs-test":"linkinator docs","predocs-test":"npm run docs","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","prelint":"cd samples; npm link ../; npm install","clean":"gts clean","precompile":"gts clean"},"repository":"googleapis/gaxios","keywords":["google"],"engines":{"node":">=14"},"author":"Google, LLC","license":"Apache-2.0","devDependencies":{"@babel/plugin-proposal-private-methods":"^7.18.6","@compodoc/compodoc":"1.1.19","@types/cors":"^2.8.6","@types/express":"^4.16.1","@types/extend":"^3.0.1","@types/mocha":"^9.0.0","@types/multiparty":"0.0.36","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^20.0.0","@types/node-fetch":"^2.5.7","@types/sinon":"^17.0.0","@types/tmp":"0.2.6","@types/uuid":"^10.0.0","abort-controller":"^3.0.0","assert":"^2.0.0","browserify":"^17.0.0","c8":"^8.0.0","cheerio":"1.0.0-rc.10","cors":"^2.8.5","execa":"^5.0.0","express":"^4.16.4","form-data":"^4.0.0","gts":"^5.0.0","is-docker":"^2.0.0","karma":"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-remap-coverage":"^0.1.5","karma-sourcemap-loader":"^0.4.0","karma-webpack":"5.0.0","linkinator":"^3.0.0","mocha":"^8.0.0","multiparty":"^4.2.1","mv":"^2.1.1","ncp":"^2.0.0","nock":"^13.0.0","null-loader":"^4.0.0","puppeteer":"^19.0.0","sinon":"^18.0.0","stream-browserify":"^3.0.0","tmp":"0.2.3","ts-loader":"^8.0.0","typescript":"^5.1.6","webpack":"^5.35.0","webpack-cli":"^4.0.0"},"dependencies":{"extend":"^3.0.2","https-proxy-agent":"^7.0.1","is-stream":"^2.0.0","node-fetch":"^2.6.9","uuid":"^9.0.1"}}')},37189:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HttpsProxyAgent=void 0;let a=s(n(91645)),l=s(n(34631)),u=o(n(12412)),c=o(n(28794)),d=n(12666),h=n(79551),p=n(8779),f=(0,c.default)("https-proxy-agent"),m=e=>void 0===e.servername&&e.host&&!a.isIP(e.host)?{...e,servername:e.host}:e;class g extends d.Agent{constructor(e,t){super(t),this.options={path:void 0},this.proxy="string"==typeof e?new h.URL(e):e,this.proxyHeaders=t?.headers??{},f("Creating new HttpsProxyAgent instance: %o",this.proxy.href);let n=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),r=this.proxy.port?parseInt(this.proxy.port,10):"https:"===this.proxy.protocol?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...t?_(t,"headers"):null,host:n,port:r}}async connect(e,t){let n,{proxy:r}=this;if(!t.host)throw TypeError('No "host" provided');"https:"===r.protocol?(f("Creating `tls.Socket`: %o",this.connectOpts),n=l.connect(m(this.connectOpts))):(f("Creating `net.Socket`: %o",this.connectOpts),n=a.connect(this.connectOpts));let i="function"==typeof this.proxyHeaders?this.proxyHeaders():{...this.proxyHeaders},s=a.isIPv6(t.host)?`[${t.host}]`:t.host,o=`CONNECT ${s}:${t.port} HTTP/1.1\r
`;if(r.username||r.password){let e=`${decodeURIComponent(r.username)}:${decodeURIComponent(r.password)}`;i["Proxy-Authorization"]=`Basic ${Buffer.from(e).toString("base64")}`}for(let e of(i.Host=`${s}:${t.port}`,i["Proxy-Connection"]||(i["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close"),Object.keys(i)))o+=`${e}: ${i[e]}\r
`;let c=(0,p.parseProxyResponse)(n);n.write(`${o}\r
`);let{connect:d,buffered:h}=await c;if(e.emit("proxyConnect",d),this.emit("proxyConnect",d,e),200===d.statusCode)return(e.once("socket",y),t.secureEndpoint)?(f("Upgrading socket connection to TLS"),l.connect({..._(m(t),"host","path","port"),socket:n})):n;n.destroy();let g=new a.Socket({writable:!1});return g.readable=!0,e.once("socket",e=>{f("Replaying proxy buffer for failed request"),(0,u.default)(e.listenerCount("data")>0),e.push(h),e.push(null)}),g}}function y(e){e.resume()}function _(e,...t){let n,r={};for(n in e)t.includes(n)||(r[n]=e[n]);return r}g.protocols=["http","https"],t.HttpsProxyAgent=g},37796:(e,t,n)=>{"use strict";n(32113);let{Duplex:r}=n(27910);function i(e){e.emit("close")}function s(){!this.destroyed&&this._writableState.finished&&this.destroy()}function o(e){this.removeListener("error",o),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}e.exports=function(e,t){let n=!0,a=new r({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",function(t,n){let r=!n&&a._readableState.objectMode?t.toString():t;a.push(r)||e.pause()}),e.once("error",function(e){a.destroyed||(n=!1,a.destroy(e))}),e.once("close",function(){a.destroyed||a.push(null)}),a._destroy=function(t,r){if(e.readyState===e.CLOSED){r(t),process.nextTick(i,a);return}let s=!1;e.once("error",function(e){s=!0,r(e)}),e.once("close",function(){s||r(t),process.nextTick(i,a)}),n&&e.terminate()},a._final=function(t){if(e.readyState===e.CONNECTING)return void e.once("open",function(){a._final(t)});null!==e._socket&&(e._socket._writableState.finished?(t(),a._readableState.endEmitted&&a.destroy()):(e._socket.once("finish",function(){t()}),e.close()))},a._read=function(){e.isPaused&&e.resume()},a._write=function(t,n,r){if(e.readyState===e.CONNECTING)return void e.once("open",function(){a._write(t,n,r)});e.send(t,r)},a.on("end",s),a.on("error",o),a}},40024:function(e,t,n){"use strict";var r,i,s,o,a,l,u,c,d=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},h=this&&this.__classPrivateFieldSet||function(e,t,n,r,i){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleToken=void 0;let p=n(29021),f=n(88855),m=n(10212),g=n(33873),y=n(28354),_=p.readFile?(0,y.promisify)(p.readFile):async()=>{throw new E("use key rather than keyFile.","MISSING_CREDENTIALS")},v="https://www.googleapis.com/oauth2/v4/token";class E extends Error{constructor(e,t){super(e),this.code=t}}class T{get accessToken(){return this.rawToken?this.rawToken.access_token:void 0}get idToken(){return this.rawToken?this.rawToken.id_token:void 0}get tokenType(){return this.rawToken?this.rawToken.token_type:void 0}get refreshToken(){return this.rawToken?this.rawToken.refresh_token:void 0}constructor(e){r.add(this),this.transporter={request:e=>(0,f.request)(e)},i.set(this,void 0),d(this,r,"m",u).call(this,e)}hasExpired(){let e=new Date().getTime();return!this.rawToken||!this.expiresAt||e>=this.expiresAt}isTokenExpiring(){var e;let t=new Date().getTime(),n=null!=(e=this.eagerRefreshThresholdMillis)?e:0;return!this.rawToken||!this.expiresAt||this.expiresAt<=t+n}getToken(e,t={}){if("object"==typeof e&&(t=e,e=void 0),t=Object.assign({forceRefresh:!1},t),e){let n=e;d(this,r,"m",s).call(this,t).then(e=>n(null,e),e);return}return d(this,r,"m",s).call(this,t)}async getCredentials(e){switch(g.extname(e)){case".json":{let t=JSON.parse(await _(e,"utf8")),n=t.private_key,r=t.client_email;if(!n||!r)throw new E("private_key and client_email are required.","MISSING_CREDENTIALS");return{privateKey:n,clientEmail:r}}case".der":case".crt":case".pem":return{privateKey:await _(e,"utf8")};case".p12":case".pfx":throw new E("*.p12 certificates are not supported after v6.1.2. Consider utilizing *.json format or converting *.p12 to *.pem using the OpenSSL CLI.","UNKNOWN_CERTIFICATE_TYPE");default:throw new E("Unknown certificate type. Type is determined based on file extension. Current supported extensions are *.json, and *.pem.","UNKNOWN_CERTIFICATE_TYPE")}}revokeToken(e){return e?void d(this,r,"m",l).call(this).then(()=>e(),e):d(this,r,"m",l).call(this)}}t.GoogleToken=T,i=new WeakMap,r=new WeakSet,s=async function(e){if(d(this,i,"f")&&!e.forceRefresh)return d(this,i,"f");try{return await h(this,i,d(this,r,"m",o).call(this,e),"f")}finally{h(this,i,void 0,"f")}},o=async function(e){if(!1===this.isTokenExpiring()&&!1===e.forceRefresh)return Promise.resolve(this.rawToken);if(!this.key&&!this.keyFile)throw Error("No key or keyFile set.");if(!this.key&&this.keyFile){let e=await this.getCredentials(this.keyFile);this.key=e.privateKey,this.iss=e.clientEmail||this.iss,e.clientEmail||d(this,r,"m",a).call(this)}return d(this,r,"m",c).call(this)},a=function(){if(!this.iss)throw new E("email is required.","MISSING_CREDENTIALS")},l=async function(){if(!this.accessToken)throw Error("No token to revoke.");let e="https://accounts.google.com/o/oauth2/revoke?token="+this.accessToken;await this.transporter.request({url:e,retry:!0}),d(this,r,"m",u).call(this,{email:this.iss,sub:this.sub,key:this.key,keyFile:this.keyFile,scope:this.scope,additionalClaims:this.additionalClaims})},u=function(e={}){this.keyFile=e.keyFile,this.key=e.key,this.rawToken=void 0,this.iss=e.email||e.iss,this.sub=e.sub,this.additionalClaims=e.additionalClaims,"object"==typeof e.scope?this.scope=e.scope.join(" "):this.scope=e.scope,this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis,e.transporter&&(this.transporter=e.transporter)},c=async function(){var e,t;let n=Math.floor(new Date().getTime()/1e3),r=this.additionalClaims||{},i=Object.assign({iss:this.iss,scope:this.scope,aud:v,exp:n+3600,iat:n,sub:this.sub},r),s=m.sign({header:{alg:"RS256"},payload:i,secret:this.key});try{let e=await this.transporter.request({method:"POST",url:v,data:{grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:s},headers:{"Content-Type":"application/x-www-form-urlencoded"},responseType:"json",retryConfig:{httpMethodsToRetry:["POST"]}});return this.rawToken=e.data,this.expiresAt=null===e.data.expires_in||void 0===e.data.expires_in?void 0:(n+e.data.expires_in)*1e3,this.rawToken}catch(r){this.rawToken=void 0,this.tokenExpires=void 0;let n=r.response&&(null==(e=r.response)?void 0:e.data)?null==(t=r.response)?void 0:t.data:{};if(n.error){let e=n.error_description?`: ${n.error_description}`:"";r.message=`${n.error}${e}`}throw r}}},41229:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JWT=void 0;let r=n(40024),i=n(52092),s=n(86679),o=n(75374);class a extends s.OAuth2Client{constructor(e,t,n,r,i,s){let o=e&&"object"==typeof e?e:{email:e,keyFile:t,key:n,keyId:s,scopes:r,subject:i};super(o),this.email=o.email,this.keyFile=o.keyFile,this.key=o.key,this.keyId=o.keyId,this.scopes=o.scopes,this.subject=o.subject,this.additionalClaims=o.additionalClaims,this.credentials={refresh_token:"jwt-placeholder",expiry_date:1}}createScoped(e){let t=new a(this);return t.scopes=e,t}async getRequestMetadataAsync(e){e=this.defaultServicePath?`https://${this.defaultServicePath}/`:e;let t=!this.hasUserScopes()&&e||this.useJWTAccessWithScope&&this.hasAnyScopes()||this.universeDomain!==o.DEFAULT_UNIVERSE;if(this.subject&&this.universeDomain!==o.DEFAULT_UNIVERSE)throw RangeError(`Service Account user is configured for the credential. Domain-wide delegation is not supported in universes other than ${o.DEFAULT_UNIVERSE}`);if(!this.apiKey&&t)if(this.additionalClaims&&this.additionalClaims.target_audience){let{tokens:e}=await this.refreshToken();return{headers:this.addSharedMetadataHeaders({Authorization:`Bearer ${e.id_token}`})}}else{let t;this.access||(this.access=new i.JWTAccess(this.email,this.key,this.keyId,this.eagerRefreshThresholdMillis)),this.hasUserScopes()?t=this.scopes:e||(t=this.defaultScopes);let n=this.useJWTAccessWithScope||this.universeDomain!==o.DEFAULT_UNIVERSE,r=await this.access.getRequestHeaders(null!=e?e:void 0,this.additionalClaims,n?t:void 0);return{headers:this.addSharedMetadataHeaders(r)}}return this.hasAnyScopes()||this.apiKey?super.getRequestMetadataAsync(e):{headers:{}}}async fetchIdToken(e){let t=new r.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:{target_audience:e},transporter:this.transporter});if(await t.getToken({forceRefresh:!0}),!t.idToken)throw Error("Unknown error: Failed to fetch ID token");return t.idToken}hasUserScopes(){return!!this.scopes&&this.scopes.length>0}hasAnyScopes(){return!!this.scopes&&!!(this.scopes.length>0)||!!this.defaultScopes&&!!(this.defaultScopes.length>0)}authorize(e){if(!e)return this.authorizeAsync();this.authorizeAsync().then(t=>e(null,t),e)}async authorizeAsync(){let e=await this.refreshToken();if(!e)throw Error("No result returned");return this.credentials=e.tokens,this.credentials.refresh_token="jwt-placeholder",this.key=this.gtoken.key,this.email=this.gtoken.iss,e.tokens}async refreshTokenNoCache(e){let t=this.createGToken(),n={access_token:(await t.getToken({forceRefresh:this.isTokenExpiring()})).access_token,token_type:"Bearer",expiry_date:t.expiresAt,id_token:t.idToken};return this.emit("tokens",n),{res:null,tokens:n}}createGToken(){return this.gtoken||(this.gtoken=new r.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:this.additionalClaims,transporter:this.transporter})),this.gtoken}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}fromStreamAsync(e){return new Promise((t,n)=>{if(!e)throw Error("Must pass in a stream containing the service account auth settings.");let r="";e.setEncoding("utf8").on("error",n).on("data",e=>r+=e).on("end",()=>{try{let e=JSON.parse(r);this.fromJSON(e),t()}catch(e){n(e)}})})}fromAPIKey(e){if("string"!=typeof e)throw Error("Must provide an API Key string.");this.apiKey=e}async getCredentials(){if(this.key)return{private_key:this.key,client_email:this.email};if(this.keyFile){let e=this.createGToken(),t=await e.getCredentials(this.keyFile);return{private_key:t.privateKey,client_email:t.clientEmail}}throw Error("A key or a keyFile must be provided to getCredentials.")}}t.JWT=a},42793:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Compute=void 0;let r=n(88855),i=n(20322),s=n(86679);class o extends s.OAuth2Client{constructor(e={}){super(e),this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=e.serviceAccountEmail||"default",this.scopes=Array.isArray(e.scopes)?e.scopes:e.scopes?[e.scopes]:[]}async refreshTokenNoCache(e){let t,n=`service-accounts/${this.serviceAccountEmail}/token`;try{let e={property:n};this.scopes.length>0&&(e.params={scopes:this.scopes.join(",")}),t=await i.instance(e)}catch(e){throw e instanceof r.GaxiosError&&(e.message=`Could not refresh access token: ${e.message}`,this.wrapError(e)),e}let s=t;return t&&t.expires_in&&(s.expiry_date=new Date().getTime()+1e3*t.expires_in,delete s.expires_in),this.emit("tokens",s),{tokens:s,res:null}}async fetchIdToken(e){let t,n=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${e}`;try{t=await i.instance({property:n})}catch(e){throw e instanceof Error&&(e.message=`Could not fetch ID token: ${e.message}`),e}return t}wrapError(e){let t=e.response;t&&t.status&&(e.status=t.status,403===t.status?e.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+e.message:404===t.status&&(e.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+e.message))}}t.Compute=o},45158:(e,t,n)=>{var r=n(79428),i=r.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(s(r,t),t.Buffer=o),o.prototype=Object.create(i.prototype),s(i,o),o.from=function(e,t,n){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return r.SlowBuffer(e)}},46471:(e,t,n)=>{"use strict";let{EMPTY_BUFFER:r}=n(32435),i=Buffer[Symbol.species];function s(e,t,n,r,i){for(let s=0;s<i;s++)n[r+s]=e[s]^t[3&s]}function o(e,t){for(let n=0;n<e.length;n++)e[n]^=t[3&n]}function a(e){let t;return(a.readOnly=!0,Buffer.isBuffer(e))?e:(e instanceof ArrayBuffer?t=new i(e):ArrayBuffer.isView(e)?t=new i(e.buffer,e.byteOffset,e.byteLength):(t=Buffer.from(e),a.readOnly=!1),t)}if(e.exports={concat:function(e,t){if(0===e.length)return r;if(1===e.length)return e[0];let n=Buffer.allocUnsafe(t),s=0;for(let t=0;t<e.length;t++){let r=e[t];n.set(r,s),s+=r.length}return s<t?new i(n.buffer,n.byteOffset,s):n},mask:s,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:a,unmask:o},!process.env.WS_NO_BUFFER_UTIL)try{let t=n(39727);e.exports.mask=function(e,n,r,i,o){o<48?s(e,n,r,i,o):t.mask(e,n,r,i,o)},e.exports.unmask=function(e,n){e.length<32?o(e,n):t.unmask(e,n)}}catch(e){}},46987:(e,t,n)=>{"use strict";let{tokenChars:r}=n(58571);function i(e,t,n){void 0===e[t]?e[t]=[n]:e[t].push(n)}e.exports={format:function(e){return Object.keys(e).map(t=>{let n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>[t].concat(Object.keys(e).map(t=>{let n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){let t,n,s=Object.create(null),o=Object.create(null),a=!1,l=!1,u=!1,c=-1,d=-1,h=-1,p=0;for(;p<e.length;p++)if(d=e.charCodeAt(p),void 0===t)if(-1===h&&1===r[d])-1===c&&(c=p);else if(0!==p&&(32===d||9===d))-1===h&&-1!==c&&(h=p);else if(59===d||44===d){if(-1===c)throw SyntaxError(`Unexpected character at index ${p}`);-1===h&&(h=p);let n=e.slice(c,h);44===d?(i(s,n,o),o=Object.create(null)):t=n,c=h=-1}else throw SyntaxError(`Unexpected character at index ${p}`);else if(void 0===n)if(-1===h&&1===r[d])-1===c&&(c=p);else if(32===d||9===d)-1===h&&-1!==c&&(h=p);else if(59===d||44===d){if(-1===c)throw SyntaxError(`Unexpected character at index ${p}`);-1===h&&(h=p),i(o,e.slice(c,h),!0),44===d&&(i(s,t,o),o=Object.create(null),t=void 0),c=h=-1}else if(61===d&&-1!==c&&-1===h)n=e.slice(c,p),c=h=-1;else throw SyntaxError(`Unexpected character at index ${p}`);else if(l){if(1!==r[d])throw SyntaxError(`Unexpected character at index ${p}`);-1===c?c=p:a||(a=!0),l=!1}else if(u)if(1===r[d])-1===c&&(c=p);else if(34===d&&-1!==c)u=!1,h=p;else if(92===d)l=!0;else throw SyntaxError(`Unexpected character at index ${p}`);else if(34===d&&61===e.charCodeAt(p-1))u=!0;else if(-1===h&&1===r[d])-1===c&&(c=p);else if(-1!==c&&(32===d||9===d))-1===h&&(h=p);else if(59===d||44===d){if(-1===c)throw SyntaxError(`Unexpected character at index ${p}`);-1===h&&(h=p);let r=e.slice(c,h);a&&(r=r.replace(/\\/g,""),a=!1),i(o,n,r),44===d&&(i(s,t,o),o=Object.create(null),t=void 0),n=void 0,c=h=-1}else throw SyntaxError(`Unexpected character at index ${p}`);if(-1===c||u||32===d||9===d)throw SyntaxError("Unexpected end of input");-1===h&&(h=p);let f=e.slice(c,h);return void 0===t?i(s,f,o):(void 0===n?i(o,f,!0):a?i(o,n,f.replace(/\\/g,"")):i(o,n,f),i(s,t,o)),s}}},52092:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JWTAccess=void 0;let r=n(10212),i=n(21146),s={alg:"RS256",typ:"JWT"};class o{constructor(e,t,n,r){this.cache=new i.LRUCache({capacity:500,maxAge:36e5}),this.email=e,this.key=t,this.keyId=n,this.eagerRefreshThresholdMillis=null!=r?r:3e5}getCachedKey(e,t){let n=e;if(t&&Array.isArray(t)&&t.length?n=e?`${e}_${t.join("_")}`:`${t.join("_")}`:"string"==typeof t&&(n=e?`${e}_${t}`:t),!n)throw Error("Scopes or url must be provided");return n}getRequestHeaders(e,t,n){let i,a=this.getCachedKey(e,n),l=this.cache.get(a),u=Date.now();if(l&&l.expiration-u>this.eagerRefreshThresholdMillis)return l.headers;let c=Math.floor(Date.now()/1e3),d=o.getExpirationTime(c);if(Array.isArray(n)&&(n=n.join(" ")),i=n?{iss:this.email,sub:this.email,scope:n,exp:d,iat:c}:{iss:this.email,sub:this.email,aud:e,exp:d,iat:c},t){for(let e in i)if(t[e])throw Error(`The '${e}' property is not allowed when passing additionalClaims. This claim is included in the JWT by default.`)}let h=this.keyId?{...s,kid:this.keyId}:s,p=Object.assign(i,t),f=r.sign({header:h,payload:p,secret:this.key}),m={Authorization:`Bearer ${f}`};return this.cache.set(a,{expiration:1e3*d,headers:m}),m}static getExpirationTime(e){return e+3600}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}fromStreamAsync(e){return new Promise((t,n)=>{e||n(Error("Must pass in a stream containing the service account auth settings."));let r="";e.setEncoding("utf8").on("data",e=>r+=e).on("error",n).on("end",()=>{try{let e=JSON.parse(r);this.fromJSON(e),t()}catch(e){n(e)}})})}}t.JWTAccess=o},52346:e=>{"use strict";let t=Symbol("kDone"),n=Symbol("kRun");class r{constructor(e){this[t]=()=>{this.pending--,this[n]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[n]()}[n](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[t])}}}e.exports=r},53924:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PluggableAuthHandler=void 0;let r=n(32861),i=n(30035),s=n(79646),o=n(29021);class a{constructor(e){if(!e.command)throw Error("No command provided.");if(this.commandComponents=a.parseCommand(e.command),this.timeoutMillis=e.timeoutMillis,!this.timeoutMillis)throw Error("No timeoutMillis provided.");this.outputFile=e.outputFile}retrieveResponseFromExecutable(e){return new Promise((t,n)=>{let o=s.spawn(this.commandComponents[0],this.commandComponents.slice(1),{env:{...process.env,...Object.fromEntries(e)}}),a="";o.stdout.on("data",e=>{a+=e}),o.stderr.on("data",e=>{a+=e});let l=setTimeout(()=>(o.removeAllListeners(),o.kill(),n(Error("The executable failed to finish within the timeout specified."))),this.timeoutMillis);o.on("close",e=>{if(clearTimeout(l),0!==e)return n(new r.ExecutableError(a,e.toString()));try{let e=JSON.parse(a),n=new i.ExecutableResponse(e);return t(n)}catch(e){if(e instanceof i.ExecutableResponseError)return n(e);return n(new i.ExecutableResponseError(`The executable returned an invalid response: ${a}`))}})})}async retrieveCachedResponse(){let e;if(!this.outputFile||0===this.outputFile.length)return;try{e=await o.promises.realpath(this.outputFile)}catch(e){return}if(!(await o.promises.lstat(e)).isFile())return;let t=await o.promises.readFile(e,{encoding:"utf8"});if(""!==t)try{let e=JSON.parse(t);if(new i.ExecutableResponse(e).isValid())return new i.ExecutableResponse(e);return}catch(e){if(e instanceof i.ExecutableResponseError)throw e;throw new i.ExecutableResponseError(`The output file contained an invalid response: ${t}`)}}static parseCommand(e){let t=e.match(/(?:[^\s"]+|"[^"]*")+/g);if(!t)throw Error(`Provided command: "${e}" could not be parsed.`);for(let e=0;e<t.length;e++)'"'===t[e][0]&&'"'===t[e].slice(-1)&&(t[e]=t[e].slice(1,-1));return t}}t.PluggableAuthHandler=a},54518:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validate=function(e){for(let t of[{invalid:"uri",expected:"url"},{invalid:"json",expected:"data"},{invalid:"qs",expected:"params"}])if(e[t.invalid])throw Error(`'${t.invalid}' is not a valid configuration option. Please use '${t.expected}' instead. This library is using Axios for requests. Please see https://github.com/axios/axios to learn more about the valid request options.`)}},56510:(e,t,n)=>{"use strict";let{kForOnEventAttribute:r,kListener:i}=n(32435),s=Symbol("kCode"),o=Symbol("kData"),a=Symbol("kError"),l=Symbol("kMessage"),u=Symbol("kReason"),c=Symbol("kTarget"),d=Symbol("kType"),h=Symbol("kWasClean");class p{constructor(e){this[c]=null,this[d]=e}get target(){return this[c]}get type(){return this[d]}}Object.defineProperty(p.prototype,"target",{enumerable:!0}),Object.defineProperty(p.prototype,"type",{enumerable:!0});class f extends p{constructor(e,t={}){super(e),this[s]=void 0===t.code?0:t.code,this[u]=void 0===t.reason?"":t.reason,this[h]=void 0!==t.wasClean&&t.wasClean}get code(){return this[s]}get reason(){return this[u]}get wasClean(){return this[h]}}Object.defineProperty(f.prototype,"code",{enumerable:!0}),Object.defineProperty(f.prototype,"reason",{enumerable:!0}),Object.defineProperty(f.prototype,"wasClean",{enumerable:!0});class m extends p{constructor(e,t={}){super(e),this[a]=void 0===t.error?null:t.error,this[l]=void 0===t.message?"":t.message}get error(){return this[a]}get message(){return this[l]}}Object.defineProperty(m.prototype,"error",{enumerable:!0}),Object.defineProperty(m.prototype,"message",{enumerable:!0});class g extends p{constructor(e,t={}){super(e),this[o]=void 0===t.data?null:t.data}get data(){return this[o]}}function y(e,t,n){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,n):e.call(t,n)}Object.defineProperty(g.prototype,"data",{enumerable:!0}),e.exports={CloseEvent:f,ErrorEvent:m,Event:p,EventTarget:{addEventListener(e,t,n={}){let s;for(let s of this.listeners(e))if(!n[r]&&s[i]===t&&!s[r])return;if("message"===e)s=function(e,n){let r=new g("message",{data:n?e:e.toString()});r[c]=this,y(t,this,r)};else if("close"===e)s=function(e,n){let r=new f("close",{code:e,reason:n.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});r[c]=this,y(t,this,r)};else if("error"===e)s=function(e){let n=new m("error",{error:e,message:e.message});n[c]=this,y(t,this,n)};else{if("open"!==e)return;s=function(){let e=new p("open");e[c]=this,y(t,this,e)}}s[r]=!!n[r],s[i]=t,n.once?this.once(e,s):this.on(e,s)},removeEventListener(e,t){for(let n of this.listeners(e))if(n[i]===t&&!n[r]){this.removeListener(e,n);break}}},MessageEvent:g}},57374:(e,t,n)=>{"use strict";let r,i;n.r(t),n.d(t,{NIL:()=>A,parse:()=>_,stringify:()=>f,v1:()=>y,v3:()=>E,v4:()=>C,v5:()=>b,validate:()=>d,version:()=>S});var s=n(55511),o=n.n(s);let a=new Uint8Array(256),l=a.length;function u(){return l>a.length-16&&(o().randomFillSync(a),l=0),a.slice(l,l+=16)}let c=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,d=function(e){return"string"==typeof e&&c.test(e)},h=[];for(let e=0;e<256;++e)h.push((e+256).toString(16).slice(1));function p(e,t=0){return h[e[t+0]]+h[e[t+1]]+h[e[t+2]]+h[e[t+3]]+"-"+h[e[t+4]]+h[e[t+5]]+"-"+h[e[t+6]]+h[e[t+7]]+"-"+h[e[t+8]]+h[e[t+9]]+"-"+h[e[t+10]]+h[e[t+11]]+h[e[t+12]]+h[e[t+13]]+h[e[t+14]]+h[e[t+15]]}let f=function(e,t=0){let n=p(e,t);if(!d(n))throw TypeError("Stringified UUID is invalid");return n},m=0,g=0,y=function(e,t,n){let s=t&&n||0,o=t||Array(16),a=(e=e||{}).node||r,l=void 0!==e.clockseq?e.clockseq:i;if(null==a||null==l){let t=e.random||(e.rng||u)();null==a&&(a=r=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==l&&(l=i=(t[6]<<8|t[7])&16383)}let c=void 0!==e.msecs?e.msecs:Date.now(),d=void 0!==e.nsecs?e.nsecs:g+1,h=c-m+(d-g)/1e4;if(h<0&&void 0===e.clockseq&&(l=l+1&16383),(h<0||c>m)&&void 0===e.nsecs&&(d=0),d>=1e4)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");m=c,g=d,i=l;let f=((0xfffffff&(c+=122192928e5))*1e4+d)%0x100000000;o[s++]=f>>>24&255,o[s++]=f>>>16&255,o[s++]=f>>>8&255,o[s++]=255&f;let y=c/0x100000000*1e4&0xfffffff;o[s++]=y>>>8&255,o[s++]=255&y,o[s++]=y>>>24&15|16,o[s++]=y>>>16&255,o[s++]=l>>>8|128,o[s++]=255&l;for(let e=0;e<6;++e)o[s+e]=a[e];return t||p(o)},_=function(e){let t;if(!d(e))throw TypeError("Invalid UUID");let n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/0x10000000000&255,n[11]=t/0x100000000&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};function v(e,t,n){function r(e,r,i,s){var o;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));let t=[];for(let n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=_(r)),(null==(o=r)?void 0:o.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let a=new Uint8Array(16+e.length);if(a.set(r),a.set(e,r.length),(a=n(a))[6]=15&a[6]|t,a[8]=63&a[8]|128,i){s=s||0;for(let e=0;e<16;++e)i[s+e]=a[e];return i}return p(a)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}let E=v("v3",48,function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),o().createHash("md5").update(e).digest()}),T={randomUUID:o().randomUUID},C=function(e,t,n){if(T.randomUUID&&!t&&!e)return T.randomUUID();let r=(e=e||{}).random||(e.rng||u)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return p(r)},b=v("v5",80,function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),o().createHash("sha1").update(e).digest()}),A="00000000-0000-0000-0000-000000000000",S=function(e){if(!d(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},58571:(e,t,n)=>{"use strict";let{isUtf8:r}=n(79428),{hasBlob:i}=n(32435);function s(e){let t=e.length,n=0;for(;n<t;)if((128&e[n])==0)n++;else if((224&e[n])==192){if(n+1===t||(192&e[n+1])!=128||(254&e[n])==192)return!1;n+=2}else if((240&e[n])==224){if(n+2>=t||(192&e[n+1])!=128||(192&e[n+2])!=128||224===e[n]&&(224&e[n+1])==128||237===e[n]&&(224&e[n+1])==160)return!1;n+=3}else{if((248&e[n])!=240||n+3>=t||(192&e[n+1])!=128||(192&e[n+2])!=128||(192&e[n+3])!=128||240===e[n]&&(240&e[n+1])==128||244===e[n]&&e[n+1]>143||e[n]>244)return!1;n+=4}return!0}if(e.exports={isBlob:function(e){return i&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:s,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},r)e.exports.isValidUTF8=function(e){return e.length<24?s(e):r(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=n(47990);e.exports.isValidUTF8=function(e){return e.length<32?s(e):t(e)}}catch(e){}},59293:(e,t,n)=>{var r=null;let i=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,s=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/;e.exports=function(e){"use strict";var t={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(null!=e){if(!0===e.strict&&(t.strict=!0),!0===e.storeAsString&&(t.storeAsString=!0),t.alwaysParseAsBig=!0===e.alwaysParseAsBig&&e.alwaysParseAsBig,t.useNativeBigInt=!0===e.useNativeBigInt&&e.useNativeBigInt,void 0!==e.constructorAction)if("error"===e.constructorAction||"ignore"===e.constructorAction||"preserve"===e.constructorAction)t.constructorAction=e.constructorAction;else throw Error(`Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed ${e.constructorAction}`);if(void 0!==e.protoAction)if("error"===e.protoAction||"ignore"===e.protoAction||"preserve"===e.protoAction)t.protoAction=e.protoAction;else throw Error(`Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed ${e.protoAction}`)}var o,a,l,u,c={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},d=function(e){throw{name:"SyntaxError",message:e,at:o,text:l}},h=function(e){return e&&e!==a&&d("Expected '"+e+"' instead of '"+a+"'"),a=l.charAt(o),o+=1,a},p=function(){var e,i="";for("-"===a&&(i="-",h("-"));a>="0"&&a<="9";)i+=a,h();if("."===a)for(i+=".";h()&&a>="0"&&a<="9";)i+=a;if("e"===a||"E"===a)for(i+=a,h(),("-"===a||"+"===a)&&(i+=a,h());a>="0"&&a<="9";)i+=a,h();if(isFinite(e=+i))return(null==r&&(r=n(24071)),i.length>15)?t.storeAsString?i:t.useNativeBigInt?BigInt(i):new r(i):t.alwaysParseAsBig?t.useNativeBigInt?BigInt(e):new r(e):e;d("Bad number")},f=function(){var e,t,n,r="";if('"'===a)for(var i=o;h();){if('"'===a)return o-1>i&&(r+=l.substring(i,o-1)),h(),r;if("\\"===a){if(o-1>i&&(r+=l.substring(i,o-1)),h(),"u"===a){for(t=0,n=0;t<4&&isFinite(e=parseInt(h(),16));t+=1)n=16*n+e;r+=String.fromCharCode(n)}else if("string"==typeof c[a])r+=c[a];else break;i=o}}d("Bad string")},m=function(){for(;a&&a<=" ";)h()},g=function(){switch(a){case"t":return h("t"),h("r"),h("u"),h("e"),!0;case"f":return h("f"),h("a"),h("l"),h("s"),h("e"),!1;case"n":return h("n"),h("u"),h("l"),h("l"),null}d("Unexpected '"+a+"'")},y=function(){var e=[];if("["===a){if(h("["),m(),"]"===a)return h("]"),e;for(;a;){if(e.push(u()),m(),"]"===a)return h("]"),e;h(","),m()}}d("Bad array")},_=function(){var e,n=Object.create(null);if("{"===a){if(h("{"),m(),"}"===a)return h("}"),n;for(;a;){if(e=f(),m(),h(":"),!0===t.strict&&Object.hasOwnProperty.call(n,e)&&d('Duplicate key "'+e+'"'),!0===i.test(e)?"error"===t.protoAction?d("Object contains forbidden prototype property"):"ignore"===t.protoAction?u():n[e]=u():!0===s.test(e)?"error"===t.constructorAction?d("Object contains forbidden constructor property"):"ignore"===t.constructorAction?u():n[e]=u():n[e]=u(),m(),"}"===a)return h("}"),n;h(","),m()}}d("Bad object")};return u=function(){switch(m(),a){case"{":return _();case"[":return y();case'"':return f();case"-":return p();default:return a>="0"&&a<="9"?p():g()}},function(e,t){var n;return l=e+"",o=0,a=" ",n=u(),m(),a&&d("Syntax error"),"function"==typeof t?function e(n,r){var i,s=n[r];return s&&"object"==typeof s&&Object.keys(s).forEach(function(t){void 0!==(i=e(s,t))?s[t]=i:delete s[t]}),t.call(n,r,s)}({"":n},""):n}}},61658:function(e,t,n){"use strict";var r,i,s,o=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},a=this&&this.__classPrivateFieldSet||function(e,t,n,r,i){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseExternalAccountClient=t.DEFAULT_UNIVERSE=t.CLOUD_RESOURCE_MANAGER=t.EXTERNAL_ACCOUNT_TYPE=t.EXPIRATION_TIME_OFFSET=void 0;let l=n(27910),u=n(75374),c=n(21761),d=n(21146),h="https://www.googleapis.com/auth/cloud-platform";t.EXPIRATION_TIME_OFFSET=3e5,t.EXTERNAL_ACCOUNT_TYPE="external_account",t.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";let p=n(90630);var f=n(75374);Object.defineProperty(t,"DEFAULT_UNIVERSE",{enumerable:!0,get:function(){return f.DEFAULT_UNIVERSE}});class m extends u.AuthClient{constructor(e,n){var s;super({...e,...n}),r.add(this),i.set(this,null);let o=(0,d.originalOrCamelOptions)(e),a=o.get("type");if(a&&a!==t.EXTERNAL_ACCOUNT_TYPE)throw Error(`Expected "${t.EXTERNAL_ACCOUNT_TYPE}" type but received "${e.type}"`);let l=o.get("client_id"),u=o.get("client_secret"),p=null!=(s=o.get("token_url"))?s:"https://sts.{universeDomain}/v1/token".replace("{universeDomain}",this.universeDomain),f=o.get("subject_token_type"),m=o.get("workforce_pool_user_project"),g=o.get("service_account_impersonation_url"),y=o.get("service_account_impersonation"),_=(0,d.originalOrCamelOptions)(y).get("token_lifetime_seconds");this.cloudResourceManagerURL=new URL(o.get("cloud_resource_manager_url")||`https://cloudresourcemanager.${this.universeDomain}/v1/projects/`),l&&(this.clientAuth={confidentialClientType:"basic",clientId:l,clientSecret:u}),this.stsCredential=new c.StsCredentials(p,this.clientAuth),this.scopes=o.get("scopes")||[h],this.cachedAccessToken=null,this.audience=o.get("audience"),this.subjectTokenType=f,this.workforcePoolUserProject=m;let v=RegExp("//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+");if(this.workforcePoolUserProject&&!this.audience.match(v))throw Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=g,this.serviceAccountImpersonationLifetime=_,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=3600),this.projectNumber=this.getProjectNumber(this.audience),this.supplierContext={audience:this.audience,subjectTokenType:this.subjectTokenType,transporter:this.transporter}}getServiceAccountEmail(){var e;if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);let t=/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl);return(null==(e=null==t?void 0:t.groups)?void 0:e.email)||null}return null}setCredentials(e){super.setCredentials(e),this.cachedAccessToken=e}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t={Authorization:`Bearer ${e.token}`};return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async getProjectId(){let e=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(e){let t=await this.getRequestHeaders(),n=await this.transporter.request({...m.RETRY_CONFIG,headers:t,url:`${this.cloudResourceManagerURL.toString()}${e}`,responseType:"json"});return this.projectId=n.data.projectId,this.projectId}return null}async requestAsync(e,t=!1){let n;try{let t=await this.getRequestHeaders();e.headers=e.headers||{},t&&t["x-goog-user-project"]&&(e.headers["x-goog-user-project"]=t["x-goog-user-project"]),t&&t.Authorization&&(e.headers.Authorization=t.Authorization),n=await this.transporter.request(e)}catch(r){let n=r.response;if(n){let r=n.status,i=n.config.data instanceof l.Readable;if(!t&&(401===r||403===r)&&!i&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw r}return n}async refreshAccessTokenAsync(){a(this,i,o(this,i,"f")||o(this,r,"m",s).call(this),"f");try{return await o(this,i,"f")}finally{a(this,i,null,"f")}}getProjectNumber(e){let t=e.match(/\/projects\/([^/]+)/);return t?t[1]:null}async getImpersonatedAccessToken(e){let t={...m.RETRY_CONFIG,url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"},responseType:"json"},n=await this.transporter.request(t),r=n.data;return{access_token:r.accessToken,expiry_date:new Date(r.expireTime).getTime(),res:n}}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}getScopesArray(){return"string"==typeof this.scopes?[this.scopes]:this.scopes||[h]}getMetricsHeaderValue(){let e=process.version.replace(/^v/,""),t=void 0!==this.serviceAccountImpersonationUrl,n=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${e} auth/${p.version} google-byoid-sdk source/${n} sa-impersonation/${t} config-lifetime/${this.configLifetimeRequested}`}}t.BaseExternalAccountClient=m,i=new WeakMap,r=new WeakSet,s=async function(){let e=await this.retrieveSubjectToken(),t={grantType:"urn:ietf:params:oauth:grant-type:token-exchange",audience:this.audience,requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:e,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[h]:this.getScopesArray()},n=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,r={"x-goog-api-client":this.getMetricsHeaderValue()},i=await this.stsCredential.exchangeToken(t,r,n);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(i.access_token):i.expires_in?this.cachedAccessToken={access_token:i.access_token,expiry_date:new Date().getTime()+1e3*i.expires_in,res:i.res}:this.cachedAccessToken={access_token:i.access_token,res:i.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken}},65232:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalAccountAuthorizedUserClient=t.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;let r=n(75374),i=n(7773),s=n(88855),o=n(27910),a=n(61658);t.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";class l extends i.OAuthClientAuthHandler{constructor(e,t,n){super(n),this.url=e,this.transporter=t}async refreshToken(e,t){let n=new URLSearchParams({grant_type:"refresh_token",refresh_token:e}),r={"Content-Type":"application/x-www-form-urlencoded",...t},o={...l.RETRY_CONFIG,url:this.url,method:"POST",headers:r,data:n.toString(),responseType:"json"};this.applyClientAuthenticationOptions(o);try{let e=await this.transporter.request(o),t=e.data;return t.res=e,t}catch(e){if(e instanceof s.GaxiosError&&e.response)throw(0,i.getErrorFromOAuthErrorResponse)(e.response.data,e);throw e}}}class u extends r.AuthClient{constructor(e,t){var n;super({...e,...t}),e.universe_domain&&(this.universeDomain=e.universe_domain),this.refreshToken=e.refresh_token;let r={confidentialClientType:"basic",clientId:e.client_id,clientSecret:e.client_secret};this.externalAccountAuthorizedUserHandler=new l(null!=(n=e.token_url)?n:"https://sts.{universeDomain}/v1/oauthtoken".replace("{universeDomain}",this.universeDomain),this.transporter,r),this.cachedAccessToken=null,this.quotaProjectId=e.quota_project_id,"number"!=typeof(null==t?void 0:t.eagerRefreshThresholdMillis)?this.eagerRefreshThresholdMillis=a.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=t.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!(null==t?void 0:t.forceRefreshOnFailure)}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t={Authorization:`Bearer ${e.token}`};return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){let n;try{let t=await this.getRequestHeaders();e.headers=e.headers||{},t&&t["x-goog-user-project"]&&(e.headers["x-goog-user-project"]=t["x-goog-user-project"]),t&&t.Authorization&&(e.headers.Authorization=t.Authorization),n=await this.transporter.request(e)}catch(r){let n=r.response;if(n){let r=n.status,i=n.config.data instanceof o.Readable;if(!t&&(401===r||403===r)&&!i&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw r}return n}async refreshAccessTokenAsync(){let e=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:e.access_token,expiry_date:new Date().getTime()+1e3*e.expires_in,res:e.res},void 0!==e.refresh_token&&(this.refreshToken=e.refresh_token),this.cachedAccessToken}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}}t.ExternalAccountAuthorizedUserClient=u},66911:(e,t,n)=>{"use strict";var r;let i;Object.defineProperty(t,"__esModule",{value:!0}),t.GCPEnv=void 0,t.clear=function(){i=void 0},t.getEnv=o;let s=n(20322);async function o(){return i||(i=a())}async function a(){let e=r.NONE;return process.env.GAE_SERVICE||process.env.GAE_MODULE_NAME?r.APP_ENGINE:process.env.FUNCTION_NAME||process.env.FUNCTION_TARGET?r.CLOUD_FUNCTIONS:await u()?await l()?r.KUBERNETES_ENGINE:process.env.K_CONFIGURATION?r.CLOUD_RUN:r.COMPUTE_ENGINE:r.NONE}async function l(){try{return await s.instance("attributes/cluster-name"),!0}catch(e){return!1}}async function u(){return s.isAvailable()}!function(e){e.APP_ENGINE="APP_ENGINE",e.KUBERNETES_ENGINE="KUBERNETES_ENGINE",e.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",e.COMPUTE_ENGINE="COMPUTE_ENGINE",e.CLOUD_RUN="CLOUD_RUN",e.NONE="NONE"}(r||(t.GCPEnv=r={}))},69204:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Impersonated=t.IMPERSONATED_ACCOUNT_TYPE=void 0;let r=n(86679),i=n(88855),s=n(21146);t.IMPERSONATED_ACCOUNT_TYPE="impersonated_service_account";class o extends r.OAuth2Client{constructor(e={}){var t,n,i,o,a,l;if(super(e),this.credentials={expiry_date:1,refresh_token:"impersonated-placeholder"},this.sourceClient=null!=(t=e.sourceClient)?t:new r.OAuth2Client,this.targetPrincipal=null!=(n=e.targetPrincipal)?n:"",this.delegates=null!=(i=e.delegates)?i:[],this.targetScopes=null!=(o=e.targetScopes)?o:[],this.lifetime=null!=(a=e.lifetime)?a:3600,(0,s.originalOrCamelOptions)(e).get("universe_domain")){if(this.sourceClient.universeDomain!==this.universeDomain)throw RangeError(`Universe domain ${this.sourceClient.universeDomain} in source credentials does not match ${this.universeDomain} universe domain set for impersonated credentials.`)}else this.universeDomain=this.sourceClient.universeDomain;this.endpoint=null!=(l=e.endpoint)?l:`https://iamcredentials.${this.universeDomain}`}async sign(e){await this.sourceClient.getAccessToken();let t=`projects/-/serviceAccounts/${this.targetPrincipal}`,n=`${this.endpoint}/v1/${t}:signBlob`,r={delegates:this.delegates,payload:Buffer.from(e).toString("base64")};return(await this.sourceClient.request({...o.RETRY_CONFIG,url:n,data:r,method:"POST"})).data}getTargetPrincipal(){return this.targetPrincipal}async refreshToken(){var e,t,n,r,s,a;try{await this.sourceClient.getAccessToken();let e="projects/-/serviceAccounts/"+this.targetPrincipal,t=`${this.endpoint}/v1/${e}:generateAccessToken`,n={delegates:this.delegates,scope:this.targetScopes,lifetime:this.lifetime+"s"},r=await this.sourceClient.request({...o.RETRY_CONFIG,url:t,data:n,method:"POST"}),i=r.data;return this.credentials.access_token=i.accessToken,this.credentials.expiry_date=Date.parse(i.expireTime),{tokens:this.credentials,res:r}}catch(u){if(!(u instanceof Error))throw u;let o=0,l="";if(u instanceof i.GaxiosError&&(o=null==(n=null==(t=null==(e=null==u?void 0:u.response)?void 0:e.data)?void 0:t.error)?void 0:n.status,l=null==(a=null==(s=null==(r=null==u?void 0:u.response)?void 0:r.data)?void 0:s.error)?void 0:a.message),o&&l)throw u.message=`${o}: unable to impersonate: ${l}`,u;throw u.message=`unable to impersonate: ${u}`,u}}async fetchIdToken(e,t){var n,r;await this.sourceClient.getAccessToken();let i=`projects/-/serviceAccounts/${this.targetPrincipal}`,s=`${this.endpoint}/v1/${i}:generateIdToken`,a={delegates:this.delegates,audience:e,includeEmail:null==(n=null==t?void 0:t.includeEmail)||n,useEmailAzp:null==(r=null==t?void 0:t.includeEmail)||r};return(await this.sourceClient.request({...o.RETRY_CONFIG,url:s,data:a,method:"POST"})).data.token}}t.Impersonated=o},70223:(e,t,n)=>{var r=n(24071),i=e.exports;!function(){"use strict";var e,t,n,s=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,o={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function a(e){return s.lastIndex=0,s.test(e)?'"'+e.replace(s,function(e){var t=o[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}"function"!=typeof i.stringify&&(i.stringify=function(i,s,o){var l;if(e="",t="","number"==typeof o)for(l=0;l<o;l+=1)t+=" ";else"string"==typeof o&&(t=o);if(n=s,s&&"function"!=typeof s&&("object"!=typeof s||"number"!=typeof s.length))throw Error("JSON.stringify");return function i(s,o){var l,u,c,d,h,p=e,f=o[s],m=null!=f&&(f instanceof r||r.isBigNumber(f));switch(f&&"object"==typeof f&&"function"==typeof f.toJSON&&(f=f.toJSON(s)),"function"==typeof n&&(f=n.call(o,s,f)),typeof f){case"string":if(m)return f;return a(f);case"number":return isFinite(f)?String(f):"null";case"boolean":case"null":case"bigint":return String(f);case"object":if(!f)return"null";if(e+=t,h=[],"[object Array]"===Object.prototype.toString.apply(f)){for(l=0,d=f.length;l<d;l+=1)h[l]=i(l,f)||"null";return c=0===h.length?"[]":e?"[\n"+e+h.join(",\n"+e)+"\n"+p+"]":"["+h.join(",")+"]",e=p,c}if(n&&"object"==typeof n)for(l=0,d=n.length;l<d;l+=1)"string"==typeof n[l]&&(c=i(u=n[l],f))&&h.push(a(u)+(e?": ":":")+c);else Object.keys(f).forEach(function(t){var n=i(t,f);n&&h.push(a(t)+(e?": ":":")+n)});return c=0===h.length?"{}":e?"{\n"+e+h.join(",\n"+e)+"\n"+p+"}":"{"+h.join(",")+"}",e=p,c}}("",{"":i})})}()},71336:(e,t,n)=>{var r=n(45158).Buffer,i=n(89019),s=n(78218),o=n(27910),a=n(9138),l=n(28354);function u(e,t){return r.from(e,t).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function c(e){var t,n,r,i=e.header,o=e.payload,c=e.secret||e.privateKey,d=e.encoding,h=s(i.alg),p=(t=(t=d)||"utf8",n=u(a(i),"binary"),r=u(a(o),t),l.format("%s.%s",n,r)),f=h.sign(p,c);return l.format("%s.%s",p,f)}function d(e){var t=new i(e.secret||e.privateKey||e.key);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=t,this.payload=new i(e.payload),this.secret.once("close",(function(){!this.payload.writable&&this.readable&&this.sign()}).bind(this)),this.payload.once("close",(function(){!this.secret.writable&&this.readable&&this.sign()}).bind(this))}l.inherits(d,o),d.prototype.sign=function(){try{var e=c({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},d.sign=c,e.exports=d},71482:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdTokenClient=void 0;let r=n(86679);class i extends r.OAuth2Client{constructor(e){super(e),this.targetAudience=e.targetAudience,this.idTokenProvider=e.idTokenProvider}async getRequestMetadataAsync(e){if(!this.credentials.id_token||!this.credentials.expiry_date||this.isTokenExpiring()){let e=await this.idTokenProvider.fetchIdToken(this.targetAudience);this.credentials={id_token:e,expiry_date:this.getIdTokenExpiryDate(e)}}return{headers:{Authorization:"Bearer "+this.credentials.id_token}}}getIdTokenExpiryDate(e){let t=e.split(".")[1];if(t)return 1e3*JSON.parse(Buffer.from(t,"base64").toString("ascii")).exp}}t.IdTokenClient=i},71820:function(e,t,n){"use strict";let r;var i,s,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.env=t.DebugLogBackendBase=t.placeholder=t.AdhocDebugLogger=t.LogSeverity=void 0,t.getNodeBackend=g,t.getDebugBackend=function(e){return new y(e)},t.getStructuredBackend=function(e){return new _(e)},t.setBackend=function(e){r=e,v.clear()},t.log=E;let u=n(78474),c=l(n(1708)),d=l(n(57975)),h=n(86660);(i=s||(t.LogSeverity=s={})).DEFAULT="DEFAULT",i.DEBUG="DEBUG",i.INFO="INFO",i.WARNING="WARNING",i.ERROR="ERROR";class p extends u.EventEmitter{constructor(e,t){super(),this.namespace=e,this.upstream=t,this.func=Object.assign(this.invoke.bind(this),{instance:this,on:(e,t)=>this.on(e,t)}),this.func.debug=(...e)=>this.invokeSeverity(s.DEBUG,...e),this.func.info=(...e)=>this.invokeSeverity(s.INFO,...e),this.func.warn=(...e)=>this.invokeSeverity(s.WARNING,...e),this.func.error=(...e)=>this.invokeSeverity(s.ERROR,...e),this.func.sublog=e=>E(e,this.func)}invoke(e,...t){this.upstream&&this.upstream(e,...t),this.emit("log",e,t)}invokeSeverity(e,...t){this.invoke({severity:e},...t)}}t.AdhocDebugLogger=p,t.placeholder=new p("",()=>{}).func;class f{constructor(){var e;this.cached=new Map,this.filters=[],this.filtersSet=!1;let n=null!=(e=c.env[t.env.nodeEnables])?e:"*";"all"===n&&(n="*"),this.filters=n.split(",")}log(e,t,...n){try{this.filtersSet||(this.setFilters(),this.filtersSet=!0);let r=this.cached.get(e);r||(r=this.makeLogger(e),this.cached.set(e,r)),r(t,...n)}catch(e){console.error(e)}}}t.DebugLogBackendBase=f;class m extends f{constructor(){super(...arguments),this.enabledRegexp=/.*/g}isEnabled(e){return this.enabledRegexp.test(e)}makeLogger(e){return this.enabledRegexp.test(e)?(t,...n)=>{var r;let i,o=`${h.Colours.green}${e}${h.Colours.reset}`,a=`${h.Colours.yellow}${c.pid}${h.Colours.reset}`;switch(t.severity){case s.ERROR:i=`${h.Colours.red}${t.severity}${h.Colours.reset}`;break;case s.INFO:i=`${h.Colours.magenta}${t.severity}${h.Colours.reset}`;break;case s.WARNING:i=`${h.Colours.yellow}${t.severity}${h.Colours.reset}`;break;default:i=null!=(r=t.severity)?r:s.DEFAULT}let l=d.formatWithOptions({colors:h.Colours.enabled},...n),u=Object.assign({},t);delete u.severity;let p=Object.getOwnPropertyNames(u).length?JSON.stringify(u):"",f=p?`${h.Colours.grey}${p}${h.Colours.reset}`:"";console.error("%s [%s|%s] %s%s",a,o,i,l,p?` ${f}`:"")}:()=>{}}setFilters(){let e=this.filters.join(",").replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^");this.enabledRegexp=RegExp(`^${e}$`,"i")}}function g(){return new m}class y extends f{constructor(e){super(),this.debugPkg=e}makeLogger(e){let t=this.debugPkg(e);return(e,...n)=>{t(n[0],...n.slice(1))}}setFilters(){var e;let t=null!=(e=c.env.NODE_DEBUG)?e:"";c.env.NODE_DEBUG=`${t}${t?",":""}${this.filters.join(",")}`}}class _ extends f{constructor(e){super(),this.upstream=null!=e?e:new m}makeLogger(e){let t=this.upstream.makeLogger(e);return(e,...n)=>{var r;let i=JSON.stringify(Object.assign({severity:null!=(r=e.severity)?r:s.INFO,message:d.format(...n)},e));t(e,i)}}setFilters(){this.upstream.setFilters()}}t.env={nodeEnables:"GOOGLE_SDK_NODE_LOGGING"};let v=new Map;function E(e,n){let i;if(!c.env[t.env.nodeEnables]||!e)return t.placeholder;n&&(e=`${n.instance.namespace}:${e}`);let s=v.get(e);if(s)return s.func;if(null===r)return t.placeholder;void 0===r&&(r=g());let o=new p(e,(t,...n)=>{if(i!==r){if(null===r)return;void 0===r&&(r=g()),i=r}null==r||r.log(e,t,...n)});return v.set(e,o),o.func}},72090:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IAMAuth=void 0;class n{constructor(e,t){this.selector=e,this.token=t,this.selector=e,this.token=t}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}}t.IAMAuth=n},75374:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuthClient=t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=t.DEFAULT_UNIVERSE=void 0;let r=n(94735),i=n(88855),s=n(11433),o=n(21146);t.DEFAULT_UNIVERSE="googleapis.com",t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=3e5;class a extends r.EventEmitter{constructor(e={}){var n,r,i,a,l;super(),this.credentials={},this.eagerRefreshThresholdMillis=t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS,this.forceRefreshOnFailure=!1,this.universeDomain=t.DEFAULT_UNIVERSE;let u=(0,o.originalOrCamelOptions)(e);this.apiKey=e.apiKey,this.projectId=null!=(n=u.get("project_id"))?n:null,this.quotaProjectId=u.get("quota_project_id"),this.credentials=null!=(r=u.get("credentials"))?r:{},this.universeDomain=null!=(i=u.get("universe_domain"))?i:t.DEFAULT_UNIVERSE,this.transporter=null!=(a=e.transporter)?a:new s.DefaultTransporter,e.transporterOptions&&(this.transporter.defaults=e.transporterOptions),e.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=null!=(l=e.forceRefreshOnFailure)&&l}get gaxios(){return this.transporter instanceof i.Gaxios?this.transporter:this.transporter instanceof s.DefaultTransporter||"instance"in this.transporter&&this.transporter.instance instanceof i.Gaxios?this.transporter.instance:null}setCredentials(e){this.credentials=e}addSharedMetadataHeaders(e){return!e["x-goog-user-project"]&&this.quotaProjectId&&(e["x-goog-user-project"]=this.quotaProjectId),e}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}t.AuthClient=a},77061:(e,t)=>{"use strict";async function n(e){var t,n;let s=i(e);if(!e||!e.config||!s&&!e.config.retry)return{shouldRetry:!1};(s=s||{}).currentRetryAttempt=s.currentRetryAttempt||0,s.retry=void 0===s.retry||null===s.retry?3:s.retry,s.httpMethodsToRetry=s.httpMethodsToRetry||["GET","HEAD","PUT","OPTIONS","DELETE"],s.noResponseRetries=void 0===s.noResponseRetries||null===s.noResponseRetries?2:s.noResponseRetries,s.retryDelayMultiplier=s.retryDelayMultiplier?s.retryDelayMultiplier:2,s.timeOfFirstRequest=s.timeOfFirstRequest?s.timeOfFirstRequest:Date.now(),s.totalTimeout=s.totalTimeout?s.totalTimeout:Number.MAX_SAFE_INTEGER,s.maxRetryDelay=s.maxRetryDelay?s.maxRetryDelay:Number.MAX_SAFE_INTEGER,s.statusCodesToRetry=s.statusCodesToRetry||[[100,199],[408,408],[429,429],[500,599]],e.config.retryConfig=s;let o=s.shouldRetry||r;if(!await o(e))return{shouldRetry:!1,config:e.config};let a=Math.min(((t=s).currentRetryAttempt?0:null!=(n=t.retryDelay)?n:100)+(Math.pow(t.retryDelayMultiplier,t.currentRetryAttempt)-1)/2*1e3,t.totalTimeout-(Date.now()-t.timeOfFirstRequest),t.maxRetryDelay);e.config.retryConfig.currentRetryAttempt+=1;let l=s.retryBackoff?s.retryBackoff(e,a):new Promise(e=>{setTimeout(e,a)});return s.onRetryAttempt&&s.onRetryAttempt(e),await l,{shouldRetry:!0,config:e.config}}function r(e){var t;let n=i(e);if("AbortError"===e.name||(null==(t=e.error)?void 0:t.name)==="AbortError"||!n||0===n.retry||!e.response&&(n.currentRetryAttempt||0)>=n.noResponseRetries||!e.config.method||0>n.httpMethodsToRetry.indexOf(e.config.method.toUpperCase()))return!1;if(e.response&&e.response.status){let t=!1;for(let[r,i]of n.statusCodesToRetry){let n=e.response.status;if(n>=r&&n<=i){t=!0;break}}if(!t)return!1}return n.currentRetryAttempt=n.currentRetryAttempt||0,!(n.currentRetryAttempt>=n.retry)}function i(e){if(e&&e.config&&e.config.retryConfig)return e.config.retryConfig}Object.defineProperty(t,"__esModule",{value:!0}),t.getRetryConfig=n},77084:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DownscopedClient=t.EXPIRATION_TIME_OFFSET=t.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;let r=n(27910),i=n(75374),s=n(21761);t.MAX_ACCESS_BOUNDARY_RULES_COUNT=10,t.EXPIRATION_TIME_OFFSET=3e5;class o extends i.AuthClient{constructor(e,n,r,i){if(super({...r,quotaProjectId:i}),this.authClient=e,this.credentialAccessBoundary=n,0===n.accessBoundary.accessBoundaryRules.length)throw Error("At least one access boundary rule needs to be defined.");if(n.accessBoundary.accessBoundaryRules.length>t.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw Error(`The provided access boundary has more than ${t.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(let e of n.accessBoundary.accessBoundaryRules)if(0===e.availablePermissions.length)throw Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new s.StsCredentials(`https://sts.${this.universeDomain}/v1/token`),this.cachedDownscopedAccessToken=null}setCredentials(e){if(!e.expiry_date)throw Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(e),this.cachedDownscopedAccessToken=e}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t={Authorization:`Bearer ${e.token}`};return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){let n;try{let t=await this.getRequestHeaders();e.headers=e.headers||{},t&&t["x-goog-user-project"]&&(e.headers["x-goog-user-project"]=t["x-goog-user-project"]),t&&t.Authorization&&(e.headers.Authorization=t.Authorization),n=await this.transporter.request(e)}catch(i){let n=i.response;if(n){let i=n.status,s=n.config.data instanceof r.Readable;if(!t&&(401===i||403===i)&&!s&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw i}return n}async refreshAccessTokenAsync(){var e;let t=(await this.authClient.getAccessToken()).token,n=await this.stsCredential.exchangeToken({grantType:"urn:ietf:params:oauth:grant-type:token-exchange",requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:t,subjectTokenType:"urn:ietf:params:oauth:token-type:access_token"},void 0,this.credentialAccessBoundary),r=(null==(e=this.authClient.credentials)?void 0:e.expiry_date)||null,i=n.expires_in?new Date().getTime()+1e3*n.expires_in:r;return this.cachedDownscopedAccessToken={access_token:n.access_token,expiry_date:i,res:n.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}}t.DownscopedClient=o},77569:function(e,t,n){"use strict";var r,i,s,o,a,l,u,c=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),d=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),h=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&c(t,e,n);return d(t,e),t},p=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},f=this&&this.__classPrivateFieldSet||function(e,t,n,r,i){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},m=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Gaxios=void 0;let g=m(n(26556)),y=n(55591),_=m(n(97294)),v=m(n(11723)),E=m(n(4867)),T=n(79551),C=n(90134),b=n(77061),A=n(27910),S=n(57374),w=n(80808),O="undefined"!=typeof window&&window&&window.fetch?window.fetch:_.default;function k(e,t){for(let n of(t=t.toLowerCase(),Object.keys((null==e?void 0:e.headers)||{})))if(t===n.toLowerCase())return e.headers[n]}class x{constructor(e){r.add(this),this.agentCache=new Map,this.defaults=e||{},this.interceptors={request:new w.GaxiosInterceptorManager,response:new w.GaxiosInterceptorManager}}async request(e={}){return e=await p(this,r,"m",a).call(this,e),e=await p(this,r,"m",s).call(this,e),p(this,r,"m",o).call(this,this._request(e))}async _defaultAdapter(e){let t=e.fetchImplementation||O,n=await t(e.url,e),r=await this.getResponseData(e,n);return this.translateResponse(e,n,r)}async _request(e={}){var t;try{let t;if(t=e.adapter?await e.adapter(e,this._defaultAdapter.bind(this)):await this._defaultAdapter(e),!e.validateStatus(t.status)){if("stream"===e.responseType){let e="";await new Promise(n=>{(null==t?void 0:t.data).on("data",t=>{e+=t}),(null==t?void 0:t.data).on("end",n)}),t.data=e}throw new C.GaxiosError(`Request failed with status code ${t.status}`,e,t)}return t}catch(s){let n=s instanceof C.GaxiosError?s:new C.GaxiosError(s.message,e,void 0,s),{shouldRetry:r,config:i}=await (0,b.getRetryConfig)(n);if(r&&i)return n.config.retryConfig.currentRetryAttempt=i.retryConfig.currentRetryAttempt,e.retryConfig=null==(t=n.config)?void 0:t.retryConfig,this._request(e);throw n}}async getResponseData(e,t){switch(e.responseType){case"stream":return t.body;case"json":{let e=await t.text();try{e=JSON.parse(e)}catch(e){}return e}case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"text":return t.text();default:return this.getResponseDataFromContentType(t)}}validateStatus(e){return e>=200&&e<300}paramsSerializer(e){return v.default.stringify(e)}translateResponse(e,t,n){let r={};return t.headers.forEach((e,t)=>{r[t]=e}),{config:e,data:n,headers:r,status:t.status,statusText:t.statusText,request:{responseURL:t.url}}}async getResponseDataFromContentType(e){let t=e.headers.get("Content-Type");if(null===t)return e.text();if((t=t.toLowerCase()).includes("application/json")){let t=await e.text();try{t=JSON.parse(t)}catch(e){}return t}return t.match(/^text\//)?e.text():e.blob()}async *getMultipartRequest(e,t){let n=`--${t}--`;for(let n of e){let e=n.headers["Content-Type"]||"application/octet-stream",r=`--${t}\r
Content-Type: ${e}\r
\r
`;yield r,"string"==typeof n.content?yield n.content:yield*n.content,yield"\r\n"}yield n}}t.Gaxios=x,r=new WeakSet,i=function(e,t=[]){var n,r;let i=new T.URL(e),s=[...t];for(let e of(null==(r=null!=(n=process.env.NO_PROXY)?n:process.env.no_proxy)?void 0:r.split(","))||[])s.push(e.trim());for(let e of s)if(e instanceof RegExp){if(e.test(i.toString()))return!1}else if(e instanceof T.URL){if(e.origin===i.origin)return!1}else if(e.startsWith("*.")||e.startsWith(".")){let t=e.replace(/^\*\./,".");if(i.hostname.endsWith(t))return!1}else if(e===i.origin||e===i.hostname||e===i.href)return!1;return!0},s=async function(e){let t=Promise.resolve(e);for(let e of this.interceptors.request.values())e&&(t=t.then(e.resolved,e.rejected));return t},o=async function(e){let t=Promise.resolve(e);for(let e of this.interceptors.response.values())e&&(t=t.then(e.resolved,e.rejected));return t},a=async function(e){var t,n,s,o;let a=(0,g.default)(!0,{},this.defaults,e);if(!a.url)throw Error("URL is required.");let l=a.baseUrl||a.baseURL;if(l&&(a.url=l.toString()+a.url),a.paramsSerializer=a.paramsSerializer||this.paramsSerializer,a.params&&Object.keys(a.params).length>0){let e=a.paramsSerializer(a.params);e.startsWith("?")&&(e=e.slice(1));let t=a.url.toString().includes("?")?"&":"?";a.url=a.url+t+e}if("number"==typeof e.maxContentLength&&(a.size=e.maxContentLength),"number"==typeof e.maxRedirects&&(a.follow=e.maxRedirects),a.headers=a.headers||{},void 0===a.multipart&&a.data){let e="undefined"!=typeof FormData&&(null==a?void 0:a.data)instanceof FormData;E.default.readable(a.data)?a.body=a.data:"undefined"!=typeof Buffer&&Buffer.isBuffer(a.data)?(a.body=a.data,k(a,"Content-Type")||(a.headers["Content-Type"]="application/json")):"object"==typeof a.data?e||("application/x-www-form-urlencoded"===k(a,"content-type")?a.body=a.paramsSerializer(a.data):(k(a,"Content-Type")||(a.headers["Content-Type"]="application/json"),a.body=JSON.stringify(a.data))):a.body=a.data}else if(a.multipart&&a.multipart.length>0){let e=(0,S.v4)();a.headers["Content-Type"]=`multipart/related; boundary=${e}`;let t=new A.PassThrough;a.body=t,(0,A.pipeline)(this.getMultipartRequest(a.multipart,e),t,()=>{})}a.validateStatus=a.validateStatus||this.validateStatus,a.responseType=a.responseType||"unknown",a.headers.Accept||"json"!==a.responseType||(a.headers.Accept="application/json"),a.method=a.method||"GET";let c=a.proxy||(null==(t=null==process?void 0:process.env)?void 0:t.HTTPS_PROXY)||(null==(n=null==process?void 0:process.env)?void 0:n.https_proxy)||(null==(s=null==process?void 0:process.env)?void 0:s.HTTP_PROXY)||(null==(o=null==process?void 0:process.env)?void 0:o.http_proxy),d=p(this,r,"m",i).call(this,a.url,a.noProxy);if(a.agent);else if(c&&d){let e=await p(x,x,"m",u).call(x);this.agentCache.has(c)?a.agent=this.agentCache.get(c):(a.agent=new e(c,{cert:a.cert,key:a.key}),this.agentCache.set(c,a.agent))}else a.cert&&a.key&&(this.agentCache.has(a.key)?a.agent=this.agentCache.get(a.key):(a.agent=new y.Agent({cert:a.cert,key:a.key}),this.agentCache.set(a.key,a.agent)));return"function"!=typeof a.errorRedactor&&!1!==a.errorRedactor&&(a.errorRedactor=C.defaultErrorRedactor),a},u=async function(){return f(this,x,p(this,x,"f",l)||(await Promise.resolve().then(()=>h(n(37189)))).HttpsProxyAgent,"f",l),p(this,x,"f",l)},l={value:void 0}},78218:(e,t,n)=>{var r,i=n(45158).Buffer,s=n(55511),o=n(81717),a=n(28354),l="secret must be a string or buffer",u="key must be a string or a buffer",c="function"==typeof s.createPublicKey;function d(e){if(!i.isBuffer(e)&&"string"!=typeof e&&(!c||"object"!=typeof e||"string"!=typeof e.type||"string"!=typeof e.asymmetricKeyType||"function"!=typeof e.export))throw m(u)}function h(e){if(!i.isBuffer(e)&&"string"!=typeof e&&"object"!=typeof e)throw m("key must be a string, a buffer or an object")}function p(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function f(e){var t=4-(e=e.toString()).length%4;if(4!==t)for(var n=0;n<t;++n)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function m(e){var t=[].slice.call(arguments,1);return TypeError(a.format.bind(a,e).apply(null,t))}function g(e){var t;return t=e,i.isBuffer(t)||"string"==typeof t||(e=JSON.stringify(e)),e}function y(e){return function(t,n){!function(e){if(!i.isBuffer(e)){if("string"!=typeof e){if(!c||"object"!=typeof e||"secret"!==e.type||"function"!=typeof e.export)throw m(l)}}}(n),t=g(t);var r=s.createHmac("sha"+e,n);return p((r.update(t),r.digest("base64")))}}c&&(u+=" or a KeyObject",l+="or a KeyObject");var _="timingSafeEqual"in s?function(e,t){return e.byteLength===t.byteLength&&s.timingSafeEqual(e,t)}:function(e,t){return r||(r=n(90876)),r(e,t)};function v(e){return function(t,n,r){var s=y(e)(t,r);return _(i.from(n),i.from(s))}}function E(e){return function(t,n){h(n),t=g(t);var r=s.createSign("RSA-SHA"+e);return p((r.update(t),r.sign(n,"base64")))}}function T(e){return function(t,n,r){d(r),t=g(t),n=f(n);var i=s.createVerify("RSA-SHA"+e);return i.update(t),i.verify(r,n,"base64")}}function C(e){return function(t,n){h(n),t=g(t);var r=s.createSign("RSA-SHA"+e);return p((r.update(t),r.sign({key:n,padding:s.constants.RSA_PKCS1_PSS_PADDING,saltLength:s.constants.RSA_PSS_SALTLEN_DIGEST},"base64")))}}function b(e){return function(t,n,r){d(r),t=g(t),n=f(n);var i=s.createVerify("RSA-SHA"+e);return i.update(t),i.verify({key:r,padding:s.constants.RSA_PKCS1_PSS_PADDING,saltLength:s.constants.RSA_PSS_SALTLEN_DIGEST},n,"base64")}}function A(e){var t=E(e);return function(){var n=t.apply(null,arguments);return o.derToJose(n,"ES"+e)}}function S(e){var t=T(e);return function(n,r,i){return t(n,r=o.joseToDer(r,"ES"+e).toString("base64"),i)}}function w(){return function(){return""}}function O(){return function(e,t){return""===t}}e.exports=function(e){var t=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/);if(!t)throw m('"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".',e);var n=(t[1]||t[3]).toLowerCase(),r=t[2];return{sign:({hs:y,rs:E,ps:C,es:A,none:w})[n](r),verify:({hs:v,rs:T,ps:b,es:S,none:O})[n](r)}}},80808:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GaxiosInterceptorManager=void 0;class n extends Set{}t.GaxiosInterceptorManager=n},81717:(e,t,n)=>{"use strict";var r=n(45158).Buffer,i=n(25388);function s(e){if(r.isBuffer(e))return e;if("string"==typeof e)return r.from(e,"base64");throw TypeError("ECDSA signature must be a Base64 string or a Buffer")}function o(e,t,n){for(var r=0;t+r<n&&0===e[t+r];)++r;return e[t+r]>=128&&--r,r}e.exports={derToJose:function(e,t){e=s(e);var n=i(t),o=n+1,a=e.length,l=0;if(48!==e[l++])throw Error('Could not find expected "seq"');var u=e[l++];if(129===u&&(u=e[l++]),a-l<u)throw Error('"seq" specified length of "'+u+'", only "'+(a-l)+'" remaining');if(2!==e[l++])throw Error('Could not find expected "int" for "r"');var c=e[l++];if(a-l-2<c)throw Error('"r" specified length of "'+c+'", only "'+(a-l-2)+'" available');if(o<c)throw Error('"r" specified length of "'+c+'", max of "'+o+'" is acceptable');var d=l;if(l+=c,2!==e[l++])throw Error('Could not find expected "int" for "s"');var h=e[l++];if(a-l!==h)throw Error('"s" specified length of "'+h+'", expected "'+(a-l)+'"');if(o<h)throw Error('"s" specified length of "'+h+'", max of "'+o+'" is acceptable');var p=l;if((l+=h)!==a)throw Error('Expected to consume entire buffer, but "'+(a-l)+'" bytes remain');var f=n-c,m=n-h,g=r.allocUnsafe(f+c+m+h);for(l=0;l<f;++l)g[l]=0;e.copy(g,l,d+Math.max(-f,0),d+c),l=n;for(var y=l;l<y+m;++l)g[l]=0;return e.copy(g,l,p+Math.max(-m,0),p+h),g=(g=g.toString("base64")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},joseToDer:function(e,t){e=s(e);var n=i(t),a=e.length;if(a!==2*n)throw TypeError('"'+t+'" signatures must be "'+2*n+'" bytes, saw "'+a+'"');var l=o(e,0,n),u=o(e,n,e.length),c=n-l,d=n-u,h=2+c+1+1+d,p=h<128,f=r.allocUnsafe((p?2:3)+h),m=0;return f[m++]=48,p?f[m++]=h:(f[m++]=129,f[m++]=255&h),f[m++]=2,f[m++]=c,l<0?(f[m++]=0,m+=e.copy(f,m,0,n)):m+=e.copy(f,m,l,n),f[m++]=2,f[m++]=d,u<0?(f[m++]=0,e.copy(f,m,n)):e.copy(f,m,n+u),f}}},81769:(e,t,n)=>{"use strict";let r,i,s;n.d(t,{M4:()=>rS}),function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let n of e)t[n]=n;return t},e.getValidEnumValues=t=>{let n=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),r={};for(let e of n)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(let n of e)if(t(n))return n},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(ej||(ej={})),(eL||(eL={})).mergeShapes=(e,t)=>({...e,...t});let o=ej.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),a=e=>{switch(typeof e){case"undefined":return o.undefined;case"string":return o.string;case"number":return Number.isNaN(e)?o.nan:o.number;case"boolean":return o.boolean;case"function":return o.function;case"bigint":return o.bigint;case"symbol":return o.symbol;case"object":if(Array.isArray(e))return o.array;if(null===e)return o.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return o.promise;if("undefined"!=typeof Map&&e instanceof Map)return o.map;if("undefined"!=typeof Set&&e instanceof Set)return o.set;if("undefined"!=typeof Date&&e instanceof Date)return o.date;return o.object;default:return o.unknown}},l=ej.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class u extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},n={_errors:[]},r=e=>{for(let i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(r);else if("invalid_return_type"===i.code)r(i.returnTypeError);else if("invalid_arguments"===i.code)r(i.argumentsError);else if(0===i.path.length)n._errors.push(t(i));else{let e=n,r=0;for(;r<i.path.length;){let n=i.path[r];r===i.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(i))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(this),n}static assert(e){if(!(e instanceof u))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ej.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},n=[];for(let r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}u.create=e=>new u(e);let c=(e,t)=>{let n;switch(e.code){case l.invalid_type:n=e.received===o.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case l.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,ej.jsonStringifyReplacer)}`;break;case l.unrecognized_keys:n=`Unrecognized key(s) in object: ${ej.joinValues(e.keys,", ")}`;break;case l.invalid_union:n="Invalid input";break;case l.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${ej.joinValues(e.options)}`;break;case l.invalid_enum_value:n=`Invalid enum value. Expected ${ej.joinValues(e.options)}, received '${e.received}'`;break;case l.invalid_arguments:n="Invalid function arguments";break;case l.invalid_return_type:n="Invalid function return type";break;case l.invalid_date:n="Invalid date";break;case l.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:ej.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case l.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case l.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case l.custom:n="Invalid input";break;case l.invalid_intersection_types:n="Intersection results could not be merged";break;case l.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case l.not_finite:n="Number must be finite";break;default:n=t.defaultError,ej.assertNever(e)}return{message:n}},d=e=>{let{data:t,path:n,errorMaps:r,issueData:i}=e,s=[...n,...i.path||[]],o={...i,path:s};if(void 0!==i.message)return{...i,path:s,message:i.message};let a="";for(let e of r.filter(e=>!!e).slice().reverse())a=e(o,{data:t,defaultError:a}).message;return{...i,path:s,message:a}};function h(e,t){let n=d({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,c,c==c?void 0:c].filter(e=>!!e)});e.common.issues.push(n)}class p{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let r of t){if("aborted"===r.status)return f;"dirty"===r.status&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){let n=[];for(let e of t){let t=await e.key,r=await e.value;n.push({key:t,value:r})}return p.mergeObjectSync(e,n)}static mergeObjectSync(e,t){let n={};for(let r of t){let{key:t,value:i}=r;if("aborted"===t.status||"aborted"===i.status)return f;"dirty"===t.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==i.value||r.alwaysSet)&&(n[t.value]=i.value)}return{status:e.value,value:n}}}let f=Object.freeze({status:"aborted"}),m=e=>({status:"dirty",value:e}),g=e=>({status:"valid",value:e}),y=e=>"aborted"===e.status,_=e=>"dirty"===e.status,v=e=>"valid"===e.status,E=e=>"undefined"!=typeof Promise&&e instanceof Promise;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(eF||(eF={}));class T{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let C=(e,t)=>{if(v(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new u(e.common.issues);return this._error=t,this._error}}};function b(e){if(!e)return{};let{errorMap:t,invalid_type_error:n,required_error:r,description:i}=e;if(t&&(n||r))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:i}:{errorMap:(t,i)=>{let{message:s}=e;return"invalid_enum_value"===t.code?{message:s??i.defaultError}:void 0===i.data?{message:s??r??i.defaultError}:"invalid_type"!==t.code?{message:i.defaultError}:{message:s??n??i.defaultError}},description:i}}class A{get description(){return this._def.description}_getType(e){return a(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:a(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new p,ctx:{common:e.parent.common,data:e.data,parsedType:a(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(E(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){let n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:a(e)},r=this._parseSync({data:e,path:n.path,parent:n});return C(n,r)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:a(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:t});return v(n)?{value:n.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>v(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:a(e)},r=this._parse({data:e,path:n.path,parent:n});return C(n,await (E(r)?r:Promise.resolve(r)))}refine(e,t){let n=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,r)=>{let i=e(t),s=()=>r.addIssue({code:l.custom,...n(t)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then(e=>!!e||(s(),!1)):!!i||(s(),!1)})}refinement(e,t){return this._refinement((n,r)=>!!e(n)||(r.addIssue("function"==typeof t?t(n,r):t),!1))}_refinement(e){return new ey({schema:this,typeName:eG.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return e_.create(this,this._def)}nullable(){return ev.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ee.create(this)}promise(){return eg.create(this,this._def)}or(e){return en.create([this,e],this._def)}and(e){return es.create(this,e,this._def)}transform(e){return new ey({...b(this._def),schema:this,typeName:eG.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new eE({...b(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:eG.ZodDefault})}brand(){return new eb({typeName:eG.ZodBranded,type:this,...b(this._def)})}catch(e){return new eT({...b(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:eG.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return eA.create(this,e)}readonly(){return eS.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let S=/^c[^\s-]{8,}$/i,w=/^[0-9a-z]+$/,O=/^[0-9A-HJKMNP-TV-Z]{26}$/i,k=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,x=/^[a-z0-9_-]{21}$/i,I=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,N=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,R=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,P=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,D=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,M=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,U=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,j=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,L=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,F="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",G=RegExp(`^${F}$`);function B(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let n=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}class q extends A{_parse(e){var t,n,i,s;let a;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==o.string){let t=this._getOrReturnCtx(e);return h(t,{code:l.invalid_type,expected:o.string,received:t.parsedType}),f}let u=new p;for(let o of this._def.checks)if("min"===o.kind)e.data.length<o.value&&(h(a=this._getOrReturnCtx(e,a),{code:l.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),u.dirty());else if("max"===o.kind)e.data.length>o.value&&(h(a=this._getOrReturnCtx(e,a),{code:l.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),u.dirty());else if("length"===o.kind){let t=e.data.length>o.value,n=e.data.length<o.value;(t||n)&&(a=this._getOrReturnCtx(e,a),t?h(a,{code:l.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):n&&h(a,{code:l.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),u.dirty())}else if("email"===o.kind)R.test(e.data)||(h(a=this._getOrReturnCtx(e,a),{validation:"email",code:l.invalid_string,message:o.message}),u.dirty());else if("emoji"===o.kind)r||(r=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),r.test(e.data)||(h(a=this._getOrReturnCtx(e,a),{validation:"emoji",code:l.invalid_string,message:o.message}),u.dirty());else if("uuid"===o.kind)k.test(e.data)||(h(a=this._getOrReturnCtx(e,a),{validation:"uuid",code:l.invalid_string,message:o.message}),u.dirty());else if("nanoid"===o.kind)x.test(e.data)||(h(a=this._getOrReturnCtx(e,a),{validation:"nanoid",code:l.invalid_string,message:o.message}),u.dirty());else if("cuid"===o.kind)S.test(e.data)||(h(a=this._getOrReturnCtx(e,a),{validation:"cuid",code:l.invalid_string,message:o.message}),u.dirty());else if("cuid2"===o.kind)w.test(e.data)||(h(a=this._getOrReturnCtx(e,a),{validation:"cuid2",code:l.invalid_string,message:o.message}),u.dirty());else if("ulid"===o.kind)O.test(e.data)||(h(a=this._getOrReturnCtx(e,a),{validation:"ulid",code:l.invalid_string,message:o.message}),u.dirty());else if("url"===o.kind)try{new URL(e.data)}catch{h(a=this._getOrReturnCtx(e,a),{validation:"url",code:l.invalid_string,message:o.message}),u.dirty()}else"regex"===o.kind?(o.regex.lastIndex=0,o.regex.test(e.data)||(h(a=this._getOrReturnCtx(e,a),{validation:"regex",code:l.invalid_string,message:o.message}),u.dirty())):"trim"===o.kind?e.data=e.data.trim():"includes"===o.kind?e.data.includes(o.value,o.position)||(h(a=this._getOrReturnCtx(e,a),{code:l.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),u.dirty()):"toLowerCase"===o.kind?e.data=e.data.toLowerCase():"toUpperCase"===o.kind?e.data=e.data.toUpperCase():"startsWith"===o.kind?e.data.startsWith(o.value)||(h(a=this._getOrReturnCtx(e,a),{code:l.invalid_string,validation:{startsWith:o.value},message:o.message}),u.dirty()):"endsWith"===o.kind?e.data.endsWith(o.value)||(h(a=this._getOrReturnCtx(e,a),{code:l.invalid_string,validation:{endsWith:o.value},message:o.message}),u.dirty()):"datetime"===o.kind?(function(e){let t=`${F}T${B(e)}`,n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,RegExp(`^${t}$`)})(o).test(e.data)||(h(a=this._getOrReturnCtx(e,a),{code:l.invalid_string,validation:"datetime",message:o.message}),u.dirty()):"date"===o.kind?G.test(e.data)||(h(a=this._getOrReturnCtx(e,a),{code:l.invalid_string,validation:"date",message:o.message}),u.dirty()):"time"===o.kind?RegExp(`^${B(o)}$`).test(e.data)||(h(a=this._getOrReturnCtx(e,a),{code:l.invalid_string,validation:"time",message:o.message}),u.dirty()):"duration"===o.kind?N.test(e.data)||(h(a=this._getOrReturnCtx(e,a),{validation:"duration",code:l.invalid_string,message:o.message}),u.dirty()):"ip"===o.kind?(t=e.data,!(("v4"===(n=o.version)||!n)&&P.test(t)||("v6"===n||!n)&&M.test(t))&&1&&(h(a=this._getOrReturnCtx(e,a),{validation:"ip",code:l.invalid_string,message:o.message}),u.dirty())):"jwt"===o.kind?!function(e,t){if(!I.test(e))return!1;try{let[n]=e.split("."),r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),i=JSON.parse(atob(r));if("object"!=typeof i||null===i||"typ"in i&&i?.typ!=="JWT"||!i.alg||t&&i.alg!==t)return!1;return!0}catch{return!1}}(e.data,o.alg)&&(h(a=this._getOrReturnCtx(e,a),{validation:"jwt",code:l.invalid_string,message:o.message}),u.dirty()):"cidr"===o.kind?(i=e.data,!(("v4"===(s=o.version)||!s)&&D.test(i)||("v6"===s||!s)&&U.test(i))&&1&&(h(a=this._getOrReturnCtx(e,a),{validation:"cidr",code:l.invalid_string,message:o.message}),u.dirty())):"base64"===o.kind?j.test(e.data)||(h(a=this._getOrReturnCtx(e,a),{validation:"base64",code:l.invalid_string,message:o.message}),u.dirty()):"base64url"===o.kind?L.test(e.data)||(h(a=this._getOrReturnCtx(e,a),{validation:"base64url",code:l.invalid_string,message:o.message}),u.dirty()):ej.assertNever(o);return{status:u.value,value:e.data}}_regex(e,t,n){return this.refinement(t=>e.test(t),{validation:t,code:l.invalid_string,...eF.errToObj(n)})}_addCheck(e){return new q({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...eF.errToObj(e)})}url(e){return this._addCheck({kind:"url",...eF.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...eF.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...eF.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...eF.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...eF.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...eF.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...eF.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...eF.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...eF.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...eF.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...eF.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...eF.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...eF.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...eF.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...eF.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...eF.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...eF.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...eF.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...eF.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...eF.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...eF.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...eF.errToObj(t)})}nonempty(e){return this.min(1,eF.errToObj(e))}trim(){return new q({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new q({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new q({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}q.create=e=>new q({checks:[],typeName:eG.ZodString,coerce:e?.coerce??!1,...b(e)});class $ extends A{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==o.number){let t=this._getOrReturnCtx(e);return h(t,{code:l.invalid_type,expected:o.number,received:t.parsedType}),f}let n=new p;for(let r of this._def.checks)"int"===r.kind?ej.isInteger(e.data)||(h(t=this._getOrReturnCtx(e,t),{code:l.invalid_type,expected:"integer",received:"float",message:r.message}),n.dirty()):"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(h(t=this._getOrReturnCtx(e,t),{code:l.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(h(t=this._getOrReturnCtx(e,t),{code:l.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"multipleOf"===r.kind?0!==function(e,t){let n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,i=n>r?n:r;return Number.parseInt(e.toFixed(i).replace(".",""))%Number.parseInt(t.toFixed(i).replace(".",""))/10**i}(e.data,r.value)&&(h(t=this._getOrReturnCtx(e,t),{code:l.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(h(t=this._getOrReturnCtx(e,t),{code:l.not_finite,message:r.message}),n.dirty()):ej.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,eF.toString(t))}gt(e,t){return this.setLimit("min",e,!1,eF.toString(t))}lte(e,t){return this.setLimit("max",e,!0,eF.toString(t))}lt(e,t){return this.setLimit("max",e,!1,eF.toString(t))}setLimit(e,t,n,r){return new $({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:eF.toString(r)}]})}_addCheck(e){return new $({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:eF.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:eF.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:eF.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:eF.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:eF.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:eF.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:eF.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:eF.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:eF.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&ej.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks)if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;else"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value);return Number.isFinite(t)&&Number.isFinite(e)}}$.create=e=>new $({checks:[],typeName:eG.ZodNumber,coerce:e?.coerce||!1,...b(e)});class V extends A{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==o.bigint)return this._getInvalidInput(e);let n=new p;for(let r of this._def.checks)"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(h(t=this._getOrReturnCtx(e,t),{code:l.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(h(t=this._getOrReturnCtx(e,t),{code:l.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(h(t=this._getOrReturnCtx(e,t),{code:l.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):ej.assertNever(r);return{status:n.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return h(t,{code:l.invalid_type,expected:o.bigint,received:t.parsedType}),f}gte(e,t){return this.setLimit("min",e,!0,eF.toString(t))}gt(e,t){return this.setLimit("min",e,!1,eF.toString(t))}lte(e,t){return this.setLimit("max",e,!0,eF.toString(t))}lt(e,t){return this.setLimit("max",e,!1,eF.toString(t))}setLimit(e,t,n,r){return new V({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:eF.toString(r)}]})}_addCheck(e){return new V({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:eF.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:eF.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:eF.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:eF.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:eF.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}V.create=e=>new V({checks:[],typeName:eG.ZodBigInt,coerce:e?.coerce??!1,...b(e)});class H extends A{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==o.boolean){let t=this._getOrReturnCtx(e);return h(t,{code:l.invalid_type,expected:o.boolean,received:t.parsedType}),f}return g(e.data)}}H.create=e=>new H({typeName:eG.ZodBoolean,coerce:e?.coerce||!1,...b(e)});class W extends A{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==o.date){let t=this._getOrReturnCtx(e);return h(t,{code:l.invalid_type,expected:o.date,received:t.parsedType}),f}if(Number.isNaN(e.data.getTime()))return h(this._getOrReturnCtx(e),{code:l.invalid_date}),f;let n=new p;for(let r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(h(t=this._getOrReturnCtx(e,t),{code:l.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),n.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(h(t=this._getOrReturnCtx(e,t),{code:l.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),n.dirty()):ej.assertNever(r);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new W({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:eF.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:eF.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}W.create=e=>new W({checks:[],coerce:e?.coerce||!1,typeName:eG.ZodDate,...b(e)});class J extends A{_parse(e){if(this._getType(e)!==o.symbol){let t=this._getOrReturnCtx(e);return h(t,{code:l.invalid_type,expected:o.symbol,received:t.parsedType}),f}return g(e.data)}}J.create=e=>new J({typeName:eG.ZodSymbol,...b(e)});class K extends A{_parse(e){if(this._getType(e)!==o.undefined){let t=this._getOrReturnCtx(e);return h(t,{code:l.invalid_type,expected:o.undefined,received:t.parsedType}),f}return g(e.data)}}K.create=e=>new K({typeName:eG.ZodUndefined,...b(e)});class z extends A{_parse(e){if(this._getType(e)!==o.null){let t=this._getOrReturnCtx(e);return h(t,{code:l.invalid_type,expected:o.null,received:t.parsedType}),f}return g(e.data)}}z.create=e=>new z({typeName:eG.ZodNull,...b(e)});class Y extends A{constructor(){super(...arguments),this._any=!0}_parse(e){return g(e.data)}}Y.create=e=>new Y({typeName:eG.ZodAny,...b(e)});class Z extends A{constructor(){super(...arguments),this._unknown=!0}_parse(e){return g(e.data)}}Z.create=e=>new Z({typeName:eG.ZodUnknown,...b(e)});class X extends A{_parse(e){let t=this._getOrReturnCtx(e);return h(t,{code:l.invalid_type,expected:o.never,received:t.parsedType}),f}}X.create=e=>new X({typeName:eG.ZodNever,...b(e)});class Q extends A{_parse(e){if(this._getType(e)!==o.undefined){let t=this._getOrReturnCtx(e);return h(t,{code:l.invalid_type,expected:o.void,received:t.parsedType}),f}return g(e.data)}}Q.create=e=>new Q({typeName:eG.ZodVoid,...b(e)});class ee extends A{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==o.array)return h(t,{code:l.invalid_type,expected:o.array,received:t.parsedType}),f;if(null!==r.exactLength){let e=t.data.length>r.exactLength.value,i=t.data.length<r.exactLength.value;(e||i)&&(h(t,{code:e?l.too_big:l.too_small,minimum:i?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(h(t,{code:l.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(h(t,{code:l.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((e,n)=>r.type._parseAsync(new T(t,e,t.path,n)))).then(e=>p.mergeArray(n,e));let i=[...t.data].map((e,n)=>r.type._parseSync(new T(t,e,t.path,n)));return p.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new ee({...this._def,minLength:{value:e,message:eF.toString(t)}})}max(e,t){return new ee({...this._def,maxLength:{value:e,message:eF.toString(t)}})}length(e,t){return new ee({...this._def,exactLength:{value:e,message:eF.toString(t)}})}nonempty(e){return this.min(1,e)}}ee.create=(e,t)=>new ee({type:e,minLength:null,maxLength:null,exactLength:null,typeName:eG.ZodArray,...b(t)});class et extends A{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=ej.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==o.object){let t=this._getOrReturnCtx(e);return h(t,{code:l.invalid_type,expected:o.object,received:t.parsedType}),f}let{status:t,ctx:n}=this._processInputParams(e),{shape:r,keys:i}=this._getCached(),s=[];if(!(this._def.catchall instanceof X&&"strip"===this._def.unknownKeys))for(let e in n.data)i.includes(e)||s.push(e);let a=[];for(let e of i){let t=r[e],i=n.data[e];a.push({key:{status:"valid",value:e},value:t._parse(new T(n,i,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof X){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of s)a.push({key:{status:"valid",value:e},value:{status:"valid",value:n.data[e]}});else if("strict"===e)s.length>0&&(h(n,{code:l.unrecognized_keys,keys:s}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of s){let r=n.data[t];a.push({key:{status:"valid",value:t},value:e._parse(new T(n,r,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of a){let n=await t.key,r=await t.value;e.push({key:n,value:r,alwaysSet:t.alwaysSet})}return e}).then(e=>p.mergeObjectSync(t,e)):p.mergeObjectSync(t,a)}get shape(){return this._def.shape()}strict(e){return eF.errToObj,new et({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,n)=>{let r=this._def.errorMap?.(t,n).message??n.defaultError;return"unrecognized_keys"===t.code?{message:eF.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new et({...this._def,unknownKeys:"strip"})}passthrough(){return new et({...this._def,unknownKeys:"passthrough"})}extend(e){return new et({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new et({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:eG.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new et({...this._def,catchall:e})}pick(e){let t={};for(let n of ej.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new et({...this._def,shape:()=>t})}omit(e){let t={};for(let n of ej.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new et({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof et){let n={};for(let r in t.shape){let i=t.shape[r];n[r]=e_.create(e(i))}return new et({...t._def,shape:()=>n})}if(t instanceof ee)return new ee({...t._def,type:e(t.element)});if(t instanceof e_)return e_.create(e(t.unwrap()));if(t instanceof ev)return ev.create(e(t.unwrap()));if(t instanceof eo)return eo.create(t.items.map(t=>e(t)));else return t}(this)}partial(e){let t={};for(let n of ej.objectKeys(this.shape)){let r=this.shape[n];e&&!e[n]?t[n]=r:t[n]=r.optional()}return new et({...this._def,shape:()=>t})}required(e){let t={};for(let n of ej.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof e_;)e=e._def.innerType;t[n]=e}return new et({...this._def,shape:()=>t})}keyof(){return ep(ej.objectKeys(this.shape))}}et.create=(e,t)=>new et({shape:()=>e,unknownKeys:"strip",catchall:X.create(),typeName:eG.ZodObject,...b(t)}),et.strictCreate=(e,t)=>new et({shape:()=>e,unknownKeys:"strict",catchall:X.create(),typeName:eG.ZodObject,...b(t)}),et.lazycreate=(e,t)=>new et({shape:e,unknownKeys:"strip",catchall:X.create(),typeName:eG.ZodObject,...b(t)});class en extends A{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map(async e=>{let n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let n of e)if("dirty"===n.result.status)return t.common.issues.push(...n.ctx.common.issues),n.result;let n=e.map(e=>new u(e.ctx.common.issues));return h(t,{code:l.invalid_union,unionErrors:n}),f});{let e,r=[];for(let i of n){let n={...t,common:{...t.common,issues:[]},parent:null},s=i._parseSync({data:t.data,path:t.path,parent:n});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let i=r.map(e=>new u(e));return h(t,{code:l.invalid_union,unionErrors:i}),f}}get options(){return this._def.options}}en.create=(e,t)=>new en({options:e,typeName:eG.ZodUnion,...b(t)});let er=e=>{if(e instanceof ed)return er(e.schema);if(e instanceof ey)return er(e.innerType());if(e instanceof eh)return[e.value];if(e instanceof ef)return e.options;if(e instanceof em)return ej.objectValues(e.enum);else if(e instanceof eE)return er(e._def.innerType);else if(e instanceof K)return[void 0];else if(e instanceof z)return[null];else if(e instanceof e_)return[void 0,...er(e.unwrap())];else if(e instanceof ev)return[null,...er(e.unwrap())];else if(e instanceof eb)return er(e.unwrap());else if(e instanceof eS)return er(e.unwrap());else if(e instanceof eT)return er(e._def.innerType);else return[]};class ei extends A{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==o.object)return h(t,{code:l.invalid_type,expected:o.object,received:t.parsedType}),f;let n=this.discriminator,r=t.data[n],i=this.optionsMap.get(r);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(h(t,{code:l.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),f)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let r=new Map;for(let n of t){let t=er(n.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let i of t){if(r.has(i))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);r.set(i,n)}}return new ei({typeName:eG.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...b(n)})}}class es extends A{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),r=(e,r)=>{if(y(e)||y(r))return f;let i=function e(t,n){let r=a(t),i=a(n);if(t===n)return{valid:!0,data:t};if(r===o.object&&i===o.object){let r=ej.objectKeys(n),i=ej.objectKeys(t).filter(e=>-1!==r.indexOf(e)),s={...t,...n};for(let r of i){let i=e(t[r],n[r]);if(!i.valid)return{valid:!1};s[r]=i.data}return{valid:!0,data:s}}if(r===o.array&&i===o.array){if(t.length!==n.length)return{valid:!1};let r=[];for(let i=0;i<t.length;i++){let s=e(t[i],n[i]);if(!s.valid)return{valid:!1};r.push(s.data)}return{valid:!0,data:r}}if(r===o.date&&i===o.date&&+t==+n)return{valid:!0,data:t};return{valid:!1}}(e.value,r.value);return i.valid?((_(e)||_(r))&&t.dirty(),{status:t.value,value:i.data}):(h(n,{code:l.invalid_intersection_types}),f)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([e,t])=>r(e,t)):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}es.create=(e,t,n)=>new es({left:e,right:t,typeName:eG.ZodIntersection,...b(n)});class eo extends A{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==o.array)return h(n,{code:l.invalid_type,expected:o.array,received:n.parsedType}),f;if(n.data.length<this._def.items.length)return h(n,{code:l.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),f;!this._def.rest&&n.data.length>this._def.items.length&&(h(n,{code:l.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let r=[...n.data].map((e,t)=>{let r=this._def.items[t]||this._def.rest;return r?r._parse(new T(n,e,n.path,t)):null}).filter(e=>!!e);return n.common.async?Promise.all(r).then(e=>p.mergeArray(t,e)):p.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new eo({...this._def,rest:e})}}eo.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new eo({items:e,typeName:eG.ZodTuple,rest:null,...b(t)})};class ea extends A{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==o.object)return h(n,{code:l.invalid_type,expected:o.object,received:n.parsedType}),f;let r=[],i=this._def.keyType,s=this._def.valueType;for(let e in n.data)r.push({key:i._parse(new T(n,e,n.path,e)),value:s._parse(new T(n,n.data[e],n.path,e)),alwaysSet:e in n.data});return n.common.async?p.mergeObjectAsync(t,r):p.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,n){return new ea(t instanceof A?{keyType:e,valueType:t,typeName:eG.ZodRecord,...b(n)}:{keyType:q.create(),valueType:e,typeName:eG.ZodRecord,...b(t)})}}class el extends A{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==o.map)return h(n,{code:l.invalid_type,expected:o.map,received:n.parsedType}),f;let r=this._def.keyType,i=this._def.valueType,s=[...n.data.entries()].map(([e,t],s)=>({key:r._parse(new T(n,e,n.path,[s,"key"])),value:i._parse(new T(n,t,n.path,[s,"value"]))}));if(n.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let n of s){let r=await n.key,i=await n.value;if("aborted"===r.status||"aborted"===i.status)return f;("dirty"===r.status||"dirty"===i.status)&&t.dirty(),e.set(r.value,i.value)}return{status:t.value,value:e}})}{let e=new Map;for(let n of s){let r=n.key,i=n.value;if("aborted"===r.status||"aborted"===i.status)return f;("dirty"===r.status||"dirty"===i.status)&&t.dirty(),e.set(r.value,i.value)}return{status:t.value,value:e}}}}el.create=(e,t,n)=>new el({valueType:t,keyType:e,typeName:eG.ZodMap,...b(n)});class eu extends A{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==o.set)return h(n,{code:l.invalid_type,expected:o.set,received:n.parsedType}),f;let r=this._def;null!==r.minSize&&n.data.size<r.minSize.value&&(h(n,{code:l.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&n.data.size>r.maxSize.value&&(h(n,{code:l.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());let i=this._def.valueType;function s(e){let n=new Set;for(let r of e){if("aborted"===r.status)return f;"dirty"===r.status&&t.dirty(),n.add(r.value)}return{status:t.value,value:n}}let a=[...n.data.values()].map((e,t)=>i._parse(new T(n,e,n.path,t)));return n.common.async?Promise.all(a).then(e=>s(e)):s(a)}min(e,t){return new eu({...this._def,minSize:{value:e,message:eF.toString(t)}})}max(e,t){return new eu({...this._def,maxSize:{value:e,message:eF.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}eu.create=(e,t)=>new eu({valueType:e,minSize:null,maxSize:null,typeName:eG.ZodSet,...b(t)});class ec extends A{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==o.function)return h(t,{code:l.invalid_type,expected:o.function,received:t.parsedType}),f;function n(e,n){return d({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,c,c].filter(e=>!!e),issueData:{code:l.invalid_arguments,argumentsError:n}})}function r(e,n){return d({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,c,c].filter(e=>!!e),issueData:{code:l.invalid_return_type,returnTypeError:n}})}let i={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof eg){let e=this;return g(async function(...t){let o=new u([]),a=await e._def.args.parseAsync(t,i).catch(e=>{throw o.addIssue(n(t,e)),o}),l=await Reflect.apply(s,this,a);return await e._def.returns._def.type.parseAsync(l,i).catch(e=>{throw o.addIssue(r(l,e)),o})})}{let e=this;return g(function(...t){let o=e._def.args.safeParse(t,i);if(!o.success)throw new u([n(t,o.error)]);let a=Reflect.apply(s,this,o.data),l=e._def.returns.safeParse(a,i);if(!l.success)throw new u([r(a,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ec({...this._def,args:eo.create(e).rest(Z.create())})}returns(e){return new ec({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new ec({args:e||eo.create([]).rest(Z.create()),returns:t||Z.create(),typeName:eG.ZodFunction,...b(n)})}}class ed extends A{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ed.create=(e,t)=>new ed({getter:e,typeName:eG.ZodLazy,...b(t)});class eh extends A{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return h(t,{received:t.data,code:l.invalid_literal,expected:this._def.value}),f}return{status:"valid",value:e.data}}get value(){return this._def.value}}function ep(e,t){return new ef({values:e,typeName:eG.ZodEnum,...b(t)})}eh.create=(e,t)=>new eh({value:e,typeName:eG.ZodLiteral,...b(t)});class ef extends A{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),n=this._def.values;return h(t,{expected:ej.joinValues(n),received:t.parsedType,code:l.invalid_type}),f}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),n=this._def.values;return h(t,{received:t.data,code:l.invalid_enum_value,options:n}),f}return g(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return ef.create(e,{...this._def,...t})}exclude(e,t=this._def){return ef.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}ef.create=ep;class em extends A{_parse(e){let t=ej.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==o.string&&n.parsedType!==o.number){let e=ej.objectValues(t);return h(n,{expected:ej.joinValues(e),received:n.parsedType,code:l.invalid_type}),f}if(this._cache||(this._cache=new Set(ej.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=ej.objectValues(t);return h(n,{received:n.data,code:l.invalid_enum_value,options:e}),f}return g(e.data)}get enum(){return this._def.values}}em.create=(e,t)=>new em({values:e,typeName:eG.ZodNativeEnum,...b(t)});class eg extends A{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==o.promise&&!1===t.common.async?(h(t,{code:l.invalid_type,expected:o.promise,received:t.parsedType}),f):g((t.parsedType===o.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}eg.create=(e,t)=>new eg({type:e,typeName:eG.ZodPromise,...b(t)});class ey extends A{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===eG.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,i={addIssue:e=>{h(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===r.type){let e=r.transform(n.data,i);if(n.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return f;let r=await this._def.schema._parseAsync({data:e,path:n.path,parent:n});return"aborted"===r.status?f:"dirty"===r.status||"dirty"===t.value?m(r.value):r});{if("aborted"===t.value)return f;let r=this._def.schema._parseSync({data:e,path:n.path,parent:n});return"aborted"===r.status?f:"dirty"===r.status||"dirty"===t.value?m(r.value):r}}if("refinement"===r.type){let e=e=>{let t=r.refinement(e,i);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==n.common.async)return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(n=>"aborted"===n.status?f:("dirty"===n.status&&t.dirty(),e(n.value).then(()=>({status:t.value,value:n.value}))));{let r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===r.status?f:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}}if("transform"===r.type)if(!1!==n.common.async)return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(e=>v(e)?Promise.resolve(r.transform(e.value,i)).then(e=>({status:t.value,value:e})):f);else{let e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!v(e))return f;let s=r.transform(e.value,i);if(s instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}ej.assertNever(r)}}ey.create=(e,t,n)=>new ey({schema:e,typeName:eG.ZodEffects,effect:t,...b(n)}),ey.createWithPreprocess=(e,t,n)=>new ey({schema:t,effect:{type:"preprocess",transform:e},typeName:eG.ZodEffects,...b(n)});class e_ extends A{_parse(e){return this._getType(e)===o.undefined?g(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}e_.create=(e,t)=>new e_({innerType:e,typeName:eG.ZodOptional,...b(t)});class ev extends A{_parse(e){return this._getType(e)===o.null?g(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ev.create=(e,t)=>new ev({innerType:e,typeName:eG.ZodNullable,...b(t)});class eE extends A{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===o.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}eE.create=(e,t)=>new eE({innerType:e,typeName:eG.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...b(t)});class eT extends A{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return E(r)?r.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new u(n.common.issues)},input:n.data})})):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new u(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}eT.create=(e,t)=>new eT({innerType:e,typeName:eG.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...b(t)});class eC extends A{_parse(e){if(this._getType(e)!==o.nan){let t=this._getOrReturnCtx(e);return h(t,{code:l.invalid_type,expected:o.nan,received:t.parsedType}),f}return{status:"valid",value:e.data}}}eC.create=e=>new eC({typeName:eG.ZodNaN,...b(e)}),Symbol("zod_brand");class eb extends A{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class eA extends A{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?f:"dirty"===e.status?(t.dirty(),m(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})();{let e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?f:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new eA({in:e,out:t,typeName:eG.ZodPipeline})}}class eS extends A{_parse(e){let t=this._def.innerType._parse(e),n=e=>(v(e)&&(e.value=Object.freeze(e.value)),e);return E(t)?t.then(e=>n(e)):n(t)}unwrap(){return this._def.innerType}}eS.create=(e,t)=>new eS({innerType:e,typeName:eG.ZodReadonly,...b(t)}),et.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(eG||(eG={}));let ew=q.create,eO=$.create;eC.create,V.create;let ek=H.create;W.create,J.create,K.create,z.create,Y.create;let ex=Z.create;X.create,Q.create;let eI=ee.create,eN=et.create;et.strictCreate;let eR=en.create;ei.create,es.create,eo.create;let eP=ea.create;el.create,eu.create,ec.create;let eD=ed.create;eh.create;let eM=ef.create;em.create,eg.create,ey.create,e_.create,ev.create,ey.createWithPreprocess,eA.create;let eU={string:e=>q.create({...e,coerce:!0})};var ej,eL,eF,eG,eB,eq,e$,eV,eH,eW,eJ,eK,ez,eY,eZ,eX,eQ,e0,e1,e2,e4,e5,e6,e3,e8,e9,e7,te,tt,tn,tr,ti,ts,to,ta,tl,tu,tc,td,th,tp,tf,tm,tg,ty=n(4836),t_=n(29021),tv=n(57075);n(37796),n(15997),n(95773);var tE=n(32113);n(16809);var tT=n(79748);class tC{}function tb(e,t){return e.replace(/\{([^}]+)\}/g,(e,n)=>{if(Object.prototype.hasOwnProperty.call(t,n)){let e=t[n];return null!=e?String(e):""}throw Error(`Key '${n}' not found in valueMap.`)})}function tA(e,t,n){for(let r=0;r<t.length-1;r++){let i=t[r];if(i.endsWith("[]")){let s=i.slice(0,-2);if(!(s in e))if(Array.isArray(n))e[s]=Array.from({length:n.length},()=>({}));else throw Error(`Value must be a list given an array path ${i}`);if(Array.isArray(e[s])){let i=e[s];if(Array.isArray(n))for(let e=0;e<i.length;e++)tA(i[e],t.slice(r+1),n[e]);else for(let e of i)tA(e,t.slice(r+1),n)}return}if(i.endsWith("[0]")){let s=i.slice(0,-3);s in e||(e[s]=[{}]),tA(e[s][0],t.slice(r+1),n);return}e[i]&&"object"==typeof e[i]||(e[i]={}),e=e[i]}let r=t[t.length-1],i=e[r];if(void 0!==i){if(!n||"object"==typeof n&&0===Object.keys(n).length||n===i)return;if("object"==typeof i&&"object"==typeof n&&null!==i&&null!==n)Object.assign(i,n);else throw Error(`Cannot set value for an existing key. Key: ${r}`)}else e[r]=n}function tS(e,t){try{if(1===t.length&&"_self"===t[0])return e;for(let n=0;n<t.length;n++){if("object"!=typeof e||null===e)return;let r=t[n];if(r.endsWith("[]")){let i=r.slice(0,-2);if(!(i in e))return;{let r=e[i];if(!Array.isArray(r))return;return r.map(e=>tS(e,t.slice(n+1)))}}e=e[r]}return e}catch(e){if(e instanceof TypeError)return;throw e}}!function(e){e.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",e.OUTCOME_OK="OUTCOME_OK",e.OUTCOME_FAILED="OUTCOME_FAILED",e.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"}(eB||(eB={})),function(e){e.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",e.PYTHON="PYTHON"}(eq||(eq={})),function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.STRING="STRING",e.NUMBER="NUMBER",e.INTEGER="INTEGER",e.BOOLEAN="BOOLEAN",e.ARRAY="ARRAY",e.OBJECT="OBJECT",e.NULL="NULL"}(e$||(e$={})),function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"}(eV||(eV={})),function(e){e.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",e.SEVERITY="SEVERITY",e.PROBABILITY="PROBABILITY"}(eH||(eH={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE",e.OFF="OFF"}(eW||(eW={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"}(eJ||(eJ={})),function(e){e.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",e.NO_AUTH="NO_AUTH",e.API_KEY_AUTH="API_KEY_AUTH",e.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",e.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",e.OAUTH="OAUTH",e.OIDC_AUTH="OIDC_AUTH"}(eK||(eK={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.IMAGE_SAFETY="IMAGE_SAFETY",e.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"}(ez||(ez={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(eY||(eY={})),function(e){e.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",e.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",e.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",e.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",e.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"}(eZ||(eZ={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT"}(eX||(eX={})),function(e){e.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",e.ON_DEMAND="ON_DEMAND",e.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"}(eQ||(eQ={})),function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.AUDIO="AUDIO"}(e0||(e0={})),function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"}(e1||(e1={})),function(e){e.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",e.JOB_STATE_QUEUED="JOB_STATE_QUEUED",e.JOB_STATE_PENDING="JOB_STATE_PENDING",e.JOB_STATE_RUNNING="JOB_STATE_RUNNING",e.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",e.JOB_STATE_FAILED="JOB_STATE_FAILED",e.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",e.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",e.JOB_STATE_PAUSED="JOB_STATE_PAUSED",e.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",e.JOB_STATE_UPDATING="JOB_STATE_UPDATING",e.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"}(e2||(e2={})),function(e){e.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",e.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",e.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",e.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",e.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",e.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",e.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"}(e4||(e4={})),function(e){e.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",e.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",e.BALANCED="BALANCED",e.PRIORITIZE_COST="PRIORITIZE_COST"}(e5||(e5={})),function(e){e.UNSPECIFIED="UNSPECIFIED",e.BLOCKING="BLOCKING",e.NON_BLOCKING="NON_BLOCKING"}(e6||(e6={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"}(e3||(e3={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"}(e8||(e8={})),function(e){e.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",e.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",e.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR"}(e9||(e9={})),function(e){e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(e7||(e7={})),function(e){e.DONT_ALLOW="DONT_ALLOW",e.ALLOW_ADULT="ALLOW_ADULT",e.ALLOW_ALL="ALLOW_ALL"}(te||(te={})),function(e){e.auto="auto",e.en="en",e.ja="ja",e.ko="ko",e.hi="hi"}(tt||(tt={})),function(e){e.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",e.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",e.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",e.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",e.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"}(tn||(tn={})),function(e){e.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",e.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",e.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",e.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"}(tr||(tr={})),function(e){e.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",e.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",e.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",e.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"}(ti||(ti={})),function(e){e.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",e.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",e.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",e.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",e.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",e.EDIT_MODE_STYLE="EDIT_MODE_STYLE",e.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",e.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"}(ts||(ts={})),function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.PROCESSING="PROCESSING",e.ACTIVE="ACTIVE",e.FAILED="FAILED"}(to||(to={})),function(e){e.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",e.UPLOADED="UPLOADED",e.GENERATED="GENERATED"}(ta||(ta={})),function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.DOCUMENT="DOCUMENT"}(tl||(tl={})),function(e){e.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",e.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",e.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"}(tu||(tu={})),function(e){e.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",e.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",e.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"}(tc||(tc={})),function(e){e.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",e.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",e.NO_INTERRUPTION="NO_INTERRUPTION"}(td||(td={})),function(e){e.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",e.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",e.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"}(th||(th={})),function(e){e.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",e.SILENT="SILENT",e.WHEN_IDLE="WHEN_IDLE",e.INTERRUPT="INTERRUPT"}(tp||(tp={})),function(e){e.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",e.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",e.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",e.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",e.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",e.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",e.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",e.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",e.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",e.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",e.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",e.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",e.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"}(tf||(tf={})),function(e){e.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",e.PLAY="PLAY",e.PAUSE="PAUSE",e.STOP="STOP",e.RESET_CONTEXT="RESET_CONTEXT"}(tm||(tm={}));function tw(e){return"object"==typeof e&&null!==e&&("fileData"in e||"text"in e||"functionCall"in e||"functionResponse"in e||"inlineData"in e||"videoMetadata"in e||"codeExecutionResult"in e||"executableCode"in e)}class tO{get text(){var e,t,n,r,i,s,o,a;if((null==(r=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let l="",u=!1,c=[];for(let e of null!=(a=null==(o=null==(s=null==(i=this.candidates)?void 0:i[0])?void 0:s.content)?void 0:o.parts)?a:[]){for(let[t,n]of Object.entries(e))"text"!==t&&"thought"!==t&&(null!==n||void 0!==n)&&c.push(t);if("string"==typeof e.text){if("boolean"==typeof e.thought&&e.thought)continue;u=!0,l+=e.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?l:void 0}get data(){var e,t,n,r,i,s,o,a;if((null==(r=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let l="",u=[];for(let e of null!=(a=null==(o=null==(s=null==(i=this.candidates)?void 0:i[0])?void 0:s.content)?void 0:o.parts)?a:[]){for(let[t,n]of Object.entries(e))"inlineData"!==t&&(null!==n||void 0!==n)&&u.push(t);e.inlineData&&"string"==typeof e.inlineData.data&&(l+=atob(e.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),l.length>0?btoa(l):void 0}get functionCalls(){var e,t,n,r,i,s,o,a;if((null==(r=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let l=null==(a=null==(o=null==(s=null==(i=this.candidates)?void 0:i[0])?void 0:s.content)?void 0:o.parts)?void 0:a.filter(e=>e.functionCall).map(e=>e.functionCall).filter(e=>void 0!==e);if((null==l?void 0:l.length)!==0)return l}get executableCode(){var e,t,n,r,i,s,o,a,l;if((null==(r=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let u=null==(a=null==(o=null==(s=null==(i=this.candidates)?void 0:i[0])?void 0:s.content)?void 0:o.parts)?void 0:a.filter(e=>e.executableCode).map(e=>e.executableCode).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null==(l=null==u?void 0:u[0])?void 0:l.code}get codeExecutionResult(){var e,t,n,r,i,s,o,a,l;if((null==(r=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let u=null==(a=null==(o=null==(s=null==(i=this.candidates)?void 0:i[0])?void 0:s.content)?void 0:o.parts)?void 0:a.filter(e=>e.codeExecutionResult).map(e=>e.codeExecutionResult).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null==(l=null==u?void 0:u[0])?void 0:l.output}}class tk{}class tx{}class tI{}class tN{}class tR{}class tP{}class tD{}class tM{}class tU{}class tj{}class tL{}class tF{}class tG{constructor(e){let t={};for(let n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class tB{}class tq{}class t${get text(){var e,t,n;let r="",i=!1,s=[];for(let o of null!=(n=null==(t=null==(e=this.serverContent)?void 0:e.modelTurn)?void 0:t.parts)?n:[]){for(let[e,t]of Object.entries(o))"text"!==e&&"thought"!==e&&null!==t&&s.push(e);if("string"==typeof o.text){if("boolean"==typeof o.thought&&o.thought)continue;i=!0,r+=o.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?r:void 0}get data(){var e,t,n;let r="",i=[];for(let s of null!=(n=null==(t=null==(e=this.serverContent)?void 0:e.modelTurn)?void 0:t.parts)?n:[]){for(let[e,t]of Object.entries(s))"inlineData"!==e&&null!==t&&i.push(e);s.inlineData&&"string"==typeof s.inlineData.data&&(r+=atob(s.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),r.length>0?btoa(r):void 0}}class tV{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}function tH(e,t){if(!t||"string"!=typeof t)throw Error("model is required and must be a string");if(e.isVertexAI())if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;else{if(!(t.indexOf("/")>=0))return`publishers/google/models/${t}`;let e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function tW(e,t){let n=tH(e,t);return n?n.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}`:n.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${n}`:n:""}function tJ(e,t){return Array.isArray(t)?t.map(t=>tK(e,t)):[tK(e,t)]}function tK(e,t){if("object"==typeof t&&null!==t)return t;throw Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function tz(e,t){if(null==t)throw Error("PartUnion is required");if("object"==typeof t)return t;if("string"==typeof t)return{text:t};throw Error(`Unsupported part type: ${typeof t}`)}function tY(e,t){if(null==t||Array.isArray(t)&&0===t.length)throw Error("PartListUnion is required");return Array.isArray(t)?t.map(t=>tz(e,t)):[tz(e,t)]}function tZ(e){return null!=e&&"object"==typeof e&&"parts"in e&&Array.isArray(e.parts)}function tX(e){return null!=e&&"object"==typeof e&&"functionCall"in e}function tQ(e){return null!=e&&"object"==typeof e&&"functionResponse"in e}function t0(e,t){if(null==t)throw Error("ContentUnion is required");return tZ(t)?t:{role:"user",parts:tY(e,t)}}function t1(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(t=>{let n=t0(e,t);return n.parts&&n.parts.length>0&&void 0!==n.parts[0].text?[n.parts[0].text]:[]});if(e.isVertexAI()){let n=t0(e,t);return n.parts&&n.parts.length>0&&void 0!==n.parts[0].text?[n.parts[0].text]:[]}return Array.isArray(t)?t.map(t=>t0(e,t)):[t0(e,t)]}function t2(e,t){if(null==t||Array.isArray(t)&&0===t.length)throw Error("contents are required");if(!Array.isArray(t)){if(tX(t)||tQ(t))throw Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[t0(e,t)]}let n=[],r=[],i=tZ(t[0]);for(let e of t){let t=tZ(e);if(t!=i)throw Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(t)n.push(e);else if(tX(e)||tQ(e))throw Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");else r.push(e)}return i||n.push({role:"user",parts:tY(e,r)}),n}let t4=new Set(["type","format","title","description","default","items","minItems","maxItems","enum","properties","required","minProperties","maxProperties","minimum","maximum","minLength","maxLength","pattern","anyOf","propertyOrdering"]),t5=eM(["string","number","integer","object","array","boolean","null"]),t6=eR([t5,eI(t5)]);function t3(e){let t={},n=["items"],r=["anyOf"],i=["properties"];if(e.type&&e.anyOf)throw Error("type and anyOf cannot be both populated.");let s=e.anyOf;for(let[o,a]of(null!=s&&2==s.length&&("null"===s[0].type?(t.nullable=!0,e=s[1]):"null"===s[1].type&&(t.nullable=!0,e=s[0])),e.type instanceof Array&&function(e,t){e.includes("null")&&(t.nullable=!0);let n=e.filter(e=>"null"!==e);if(1===n.length)t.type=Object.values(e$).includes(n[0].toUpperCase())?n[0].toUpperCase():e$.TYPE_UNSPECIFIED;else for(let e of(t.anyOf=[],n))t.anyOf.push({type:Object.values(e$).includes(e.toUpperCase())?e.toUpperCase():e$.TYPE_UNSPECIFIED})}(e.type,t),Object.entries(e)))if(null!=a)if("type"==o){if("null"===a)throw Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;t.type=Object.values(e$).includes(a.toUpperCase())?a.toUpperCase():e$.TYPE_UNSPECIFIED}else if(n.includes(o))t[o]=t3(a);else if(r.includes(o)){let e=[];for(let n of a){if("null"==n.type){t.nullable=!0;continue}e.push(t3(n))}t[o]=e}else if(i.includes(o)){let e={};for(let[t,n]of Object.entries(a))e[t]=t3(n);t[o]=e}else{if("additionalProperties"===o)continue;t[o]=a}return t}function t8(e,t){return Object.keys(t).includes("$schema")?(delete t.$schema,t3((function(e=!0){let t=eD(()=>{let n=eN({type:t6.optional(),format:ew().optional(),title:ew().optional(),description:ew().optional(),default:ex().optional(),items:t.optional(),minItems:eU.string().optional(),maxItems:eU.string().optional(),enum:eI(ex()).optional(),properties:eP(ew(),t).optional(),required:eI(ew()).optional(),minProperties:eU.string().optional(),maxProperties:eU.string().optional(),propertyOrdering:eI(ew()).optional(),minimum:eO().optional(),maximum:eO().optional(),minLength:eU.string().optional(),maxLength:eU.string().optional(),pattern:ew().optional(),anyOf:eI(t).optional(),additionalProperties:ek().optional()});return e?n.strict():n});return t})().parse(t))):t3(t)}function t9(e,t){if("object"==typeof t)return t;if("string"==typeof t)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw Error(`Unsupported speechConfig type: ${typeof t}`)}function t7(e,t){if("multiSpeakerVoiceConfig"in t)throw Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function ne(e,t){if(t.functionDeclarations)for(let n of t.functionDeclarations)n.parameters&&(n.parameters=t8(e,n.parameters)),n.response&&(n.response=t8(e,n.response));return t}function nt(e,t){if(null==t)throw Error("tools is required");if(!Array.isArray(t))throw Error("tools is required and must be an array of Tools");let n=[];for(let e of t)n.push(e);return n}function nn(e,t){if("string"!=typeof t)throw Error("name must be a string");return function(e,t,n,r=1){let i=!t.startsWith(`${n}/`)&&t.split("/").length===r;if(e.isVertexAI())if(t.startsWith("projects/"))return t;else if(t.startsWith("locations/"))return`projects/${e.getProject()}/${t}`;else if(t.startsWith(`${n}/`))return`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`;else if(i)return`projects/${e.getProject()}/locations/${e.getLocation()}/${n}/${t}`;else return t;return i?`${n}/${t}`:t}(e,t,"cachedContents")}function nr(e,t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function ni(e,t){if("string"!=typeof t)throw Error("fromImageBytes must be a string");return t}function ns(e){return null!=e&&"object"==typeof e&&"video"in e}function no(e){return null!=e&&"object"==typeof e&&"uri"in e}function na(e,t){var n;let r;if(null!=t&&"object"==typeof t&&"name"in t&&(r=t.name),!no(t)||void 0!==(r=t.uri)){if(!ns(t)||void 0!==(r=null==(n=t.video)?void 0:n.uri)){if("string"==typeof t&&(r=t),void 0===r)throw Error("Could not extract file name from the provided input.");if(r.startsWith("https://")){let e=r.split("files/")[1].match(/[a-z0-9]+/);if(null===e)throw Error(`Could not extract file name from URI ${r}`);r=e[0]}else r.startsWith("files/")&&(r=r.split("files/")[1]);return r}}}function nl(e,t){let n;return e.isVertexAI()?t?"publishers/google/models":"models":t?"models":"tunedModels"}function nu(e,t){for(let e of["models","tunedModels","publisherModels"]){var n,r;if(n=t,r=e,null!==n&&"object"==typeof n&&r in n)return t[e]}return[]}function nc(e,t){let n={},r=tS(t,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["videoMetadata"]);null!=r&&tA(n,["videoMetadata"],function(e,t){let n={},r=tS(t,["fps"]);null!=r&&tA(n,["fps"],r);let i=tS(t,["endOffset"]);null!=i&&tA(n,["endOffset"],i);let s=tS(t,["startOffset"]);return null!=s&&tA(n,["startOffset"],s),n}(0,r));let i=tS(t,["thought"]);null!=i&&tA(n,["thought"],i);let s=tS(t,["inlineData"]);null!=s&&tA(n,["inlineData"],function(e,t){let n={};if(void 0!==tS(t,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=tS(t,["data"]);null!=r&&tA(n,["data"],r);let i=tS(t,["mimeType"]);return null!=i&&tA(n,["mimeType"],i),n}(0,s));let o=tS(t,["fileData"]);null!=o&&tA(n,["fileData"],function(e,t){let n={};if(void 0!==tS(t,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=tS(t,["fileUri"]);null!=r&&tA(n,["fileUri"],r);let i=tS(t,["mimeType"]);return null!=i&&tA(n,["mimeType"],i),n}(0,o));let a=tS(t,["thoughtSignature"]);null!=a&&tA(n,["thoughtSignature"],a);let l=tS(t,["codeExecutionResult"]);null!=l&&tA(n,["codeExecutionResult"],l);let u=tS(t,["executableCode"]);null!=u&&tA(n,["executableCode"],u);let c=tS(t,["functionCall"]);null!=c&&tA(n,["functionCall"],c);let d=tS(t,["functionResponse"]);null!=d&&tA(n,["functionResponse"],d);let h=tS(t,["text"]);return null!=h&&tA(n,["text"],h),n})(0,e))),tA(n,["parts"],e)}let i=tS(t,["role"]);return null!=i&&tA(n,["role"],i),n}function nd(e,t){let n={},r=tS(t,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["videoMetadata"]);null!=r&&tA(n,["videoMetadata"],function(e,t){let n={},r=tS(t,["fps"]);null!=r&&tA(n,["fps"],r);let i=tS(t,["endOffset"]);null!=i&&tA(n,["endOffset"],i);let s=tS(t,["startOffset"]);return null!=s&&tA(n,["startOffset"],s),n}(0,r));let i=tS(t,["thought"]);null!=i&&tA(n,["thought"],i);let s=tS(t,["inlineData"]);null!=s&&tA(n,["inlineData"],function(e,t){let n={},r=tS(t,["displayName"]);null!=r&&tA(n,["displayName"],r);let i=tS(t,["data"]);null!=i&&tA(n,["data"],i);let s=tS(t,["mimeType"]);return null!=s&&tA(n,["mimeType"],s),n}(0,s));let o=tS(t,["fileData"]);null!=o&&tA(n,["fileData"],function(e,t){let n={},r=tS(t,["displayName"]);null!=r&&tA(n,["displayName"],r);let i=tS(t,["fileUri"]);null!=i&&tA(n,["fileUri"],i);let s=tS(t,["mimeType"]);return null!=s&&tA(n,["mimeType"],s),n}(0,o));let a=tS(t,["thoughtSignature"]);null!=a&&tA(n,["thoughtSignature"],a);let l=tS(t,["codeExecutionResult"]);null!=l&&tA(n,["codeExecutionResult"],l);let u=tS(t,["executableCode"]);null!=u&&tA(n,["executableCode"],u);let c=tS(t,["functionCall"]);null!=c&&tA(n,["functionCall"],c);let d=tS(t,["functionResponse"]);null!=d&&tA(n,["functionResponse"],d);let h=tS(t,["text"]);return null!=h&&tA(n,["text"],h),n})(0,e))),tA(n,["parts"],e)}let i=tS(t,["role"]);return null!=i&&tA(n,["role"],i),n}function nh(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["name"],r);let i=tS(t,["displayName"]);null!=i&&tA(n,["displayName"],i);let s=tS(t,["model"]);null!=s&&tA(n,["model"],s);let o=tS(t,["createTime"]);null!=o&&tA(n,["createTime"],o);let a=tS(t,["updateTime"]);null!=a&&tA(n,["updateTime"],a);let l=tS(t,["expireTime"]);null!=l&&tA(n,["expireTime"],l);let u=tS(t,["usageMetadata"]);return null!=u&&tA(n,["usageMetadata"],u),n}function np(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["name"],r);let i=tS(t,["displayName"]);null!=i&&tA(n,["displayName"],i);let s=tS(t,["model"]);null!=s&&tA(n,["model"],s);let o=tS(t,["createTime"]);null!=o&&tA(n,["createTime"],o);let a=tS(t,["updateTime"]);null!=a&&tA(n,["updateTime"],a);let l=tS(t,["expireTime"]);null!=l&&tA(n,["expireTime"],l);let u=tS(t,["usageMetadata"]);return null!=u&&tA(n,["usageMetadata"],u),n}!function(e){e.PAGED_ITEM_BATCH_JOBS="batchJobs",e.PAGED_ITEM_MODELS="models",e.PAGED_ITEM_TUNING_JOBS="tuningJobs",e.PAGED_ITEM_FILES="files",e.PAGED_ITEM_CACHED_CONTENTS="cachedContents"}(tg||(tg={}));class nf{constructor(e,t,n,r){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,r)}init(e,t,n){var r,i;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.idxInternal=0;let s={config:{}};(s=n?"object"==typeof n?Object.assign({},n):n:{config:{}}).config&&(s.config.pageToken=t.nextPageToken),this.paramsInternal=s,this.pageInternalSize=null!=(i=null==(r=s.config)?void 0:r.pageSize)?i:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(!this.hasNextPage())return{value:void 0,done:!0};else await this.nextPage();let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return(null==(e=this.params.config)?void 0:e.pageToken)!==void 0}}class nm extends tC{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new nf(tg.PAGED_ITEM_CACHED_CONTENTS,e=>this.listInternal(e),await this.listInternal(e),e)}async create(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["model"],tW(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],function(e,t,n){let r=tS(t,["ttl"]);void 0!==n&&null!=r&&tA(n,["ttl"],r);let i=tS(t,["expireTime"]);void 0!==n&&null!=i&&tA(n,["expireTime"],i);let s=tS(t,["displayName"]);void 0!==n&&null!=s&&tA(n,["displayName"],s);let o=tS(t,["contents"]);if(void 0!==n&&null!=o){let t=t2(e,o);Array.isArray(t)&&(t=t.map(t=>nd(e,t))),tA(n,["contents"],t)}let a=tS(t,["systemInstruction"]);void 0!==n&&null!=a&&tA(n,["systemInstruction"],nd(e,t0(e,a)));let l=tS(t,["tools"]);if(void 0!==n&&null!=l){let t=l;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={};if(void 0!==tS(t,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let r=tS(t,["description"]);null!=r&&tA(n,["description"],r);let i=tS(t,["name"]);null!=i&&tA(n,["name"],i);let s=tS(t,["parameters"]);null!=s&&tA(n,["parameters"],s);let o=tS(t,["response"]);return null!=o&&tA(n,["response"],o),n})(0,e))),tA(n,["functionDeclarations"],e)}let i=tS(t,["retrieval"]);null!=i&&tA(n,["retrieval"],i);let s=tS(t,["googleSearch"]);null!=s&&tA(n,["googleSearch"],function(e,t){let n={},r=tS(t,["timeRangeFilter"]);return null!=r&&tA(n,["timeRangeFilter"],function(e,t){let n={},r=tS(t,["startTime"]);null!=r&&tA(n,["startTime"],r);let i=tS(t,["endTime"]);return null!=i&&tA(n,["endTime"],i),n}(0,r)),n}(0,s));let o=tS(t,["googleSearchRetrieval"]);null!=o&&tA(n,["googleSearchRetrieval"],function(e,t){let n={},r=tS(t,["dynamicRetrievalConfig"]);return null!=r&&tA(n,["dynamicRetrievalConfig"],function(e,t){let n={},r=tS(t,["mode"]);null!=r&&tA(n,["mode"],r);let i=tS(t,["dynamicThreshold"]);return null!=i&&tA(n,["dynamicThreshold"],i),n}(0,r)),n}(0,o)),null!=tS(t,["enterpriseWebSearch"])&&tA(n,["enterpriseWebSearch"],{});let a=tS(t,["googleMaps"]);null!=a&&tA(n,["googleMaps"],function(e,t){let n={},r=tS(t,["authConfig"]);return null!=r&&tA(n,["authConfig"],function(e,t){let n={},r=tS(t,["apiKeyConfig"]);null!=r&&tA(n,["apiKeyConfig"],function(e,t){let n={},r=tS(t,["apiKeyString"]);return null!=r&&tA(n,["apiKeyString"],r),n}(0,r));let i=tS(t,["authType"]);null!=i&&tA(n,["authType"],i);let s=tS(t,["googleServiceAccountConfig"]);null!=s&&tA(n,["googleServiceAccountConfig"],s);let o=tS(t,["httpBasicAuthConfig"]);null!=o&&tA(n,["httpBasicAuthConfig"],o);let a=tS(t,["oauthConfig"]);null!=a&&tA(n,["oauthConfig"],a);let l=tS(t,["oidcConfig"]);return null!=l&&tA(n,["oidcConfig"],l),n}(0,r)),n}(e,a)),null!=tS(t,["urlContext"])&&tA(n,["urlContext"],{});let l=tS(t,["codeExecution"]);return null!=l&&tA(n,["codeExecution"],l),n})(e,t))),tA(n,["tools"],t)}let u=tS(t,["toolConfig"]);void 0!==n&&null!=u&&tA(n,["toolConfig"],function(e,t){let n={},r=tS(t,["functionCallingConfig"]);null!=r&&tA(n,["functionCallingConfig"],function(e,t){let n={},r=tS(t,["mode"]);null!=r&&tA(n,["mode"],r);let i=tS(t,["allowedFunctionNames"]);return null!=i&&tA(n,["allowedFunctionNames"],i),n}(0,r));let i=tS(t,["retrievalConfig"]);return null!=i&&tA(n,["retrievalConfig"],function(e,t){let n={},r=tS(t,["latLng"]);null!=r&&tA(n,["latLng"],function(e,t){let n={},r=tS(t,["latitude"]);null!=r&&tA(n,["latitude"],r);let i=tS(t,["longitude"]);return null!=i&&tA(n,["longitude"],i),n}(0,r));let i=tS(t,["languageCode"]);return null!=i&&tA(n,["languageCode"],i),n}(0,i)),n}(e,u));let c=tS(t,["kmsKeyName"]);return void 0!==n&&null!=c&&tA(n,["encryption_spec","kmsKeyName"],c),{}}(e,i,n)),n}(this.apiClient,e);return o=tb("cachedContents",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>np(this.apiClient,e))}{let t=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["model"],tW(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],function(e,t,n){let r=tS(t,["ttl"]);void 0!==n&&null!=r&&tA(n,["ttl"],r);let i=tS(t,["expireTime"]);void 0!==n&&null!=i&&tA(n,["expireTime"],i);let s=tS(t,["displayName"]);void 0!==n&&null!=s&&tA(n,["displayName"],s);let o=tS(t,["contents"]);if(void 0!==n&&null!=o){let t=t2(e,o);Array.isArray(t)&&(t=t.map(t=>nc(e,t))),tA(n,["contents"],t)}let a=tS(t,["systemInstruction"]);void 0!==n&&null!=a&&tA(n,["systemInstruction"],nc(e,t0(e,a)));let l=tS(t,["tools"]);if(void 0!==n&&null!=l){let t=l;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["behavior"]);null!=r&&tA(n,["behavior"],r);let i=tS(t,["description"]);null!=i&&tA(n,["description"],i);let s=tS(t,["name"]);null!=s&&tA(n,["name"],s);let o=tS(t,["parameters"]);null!=o&&tA(n,["parameters"],o);let a=tS(t,["response"]);return null!=a&&tA(n,["response"],a),n})(0,e))),tA(n,["functionDeclarations"],e)}if(void 0!==tS(t,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=tS(t,["googleSearch"]);null!=i&&tA(n,["googleSearch"],function(e,t){let n={},r=tS(t,["timeRangeFilter"]);return null!=r&&tA(n,["timeRangeFilter"],function(e,t){let n={},r=tS(t,["startTime"]);null!=r&&tA(n,["startTime"],r);let i=tS(t,["endTime"]);return null!=i&&tA(n,["endTime"],i),n}(0,r)),n}(0,i));let s=tS(t,["googleSearchRetrieval"]);if(null!=s&&tA(n,["googleSearchRetrieval"],function(e,t){let n={},r=tS(t,["dynamicRetrievalConfig"]);return null!=r&&tA(n,["dynamicRetrievalConfig"],function(e,t){let n={},r=tS(t,["mode"]);null!=r&&tA(n,["mode"],r);let i=tS(t,["dynamicThreshold"]);return null!=i&&tA(n,["dynamicThreshold"],i),n}(0,r)),n}(0,s)),void 0!==tS(t,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(void 0!==tS(t,["googleMaps"]))throw Error("googleMaps parameter is not supported in Gemini API.");null!=tS(t,["urlContext"])&&tA(n,["urlContext"],{});let o=tS(t,["codeExecution"]);return null!=o&&tA(n,["codeExecution"],o),n})(e,t))),tA(n,["tools"],t)}let u=tS(t,["toolConfig"]);if(void 0!==n&&null!=u&&tA(n,["toolConfig"],function(e,t){let n={},r=tS(t,["functionCallingConfig"]);null!=r&&tA(n,["functionCallingConfig"],function(e,t){let n={},r=tS(t,["mode"]);null!=r&&tA(n,["mode"],r);let i=tS(t,["allowedFunctionNames"]);return null!=i&&tA(n,["allowedFunctionNames"],i),n}(0,r));let i=tS(t,["retrievalConfig"]);return null!=i&&tA(n,["retrievalConfig"],function(e,t){let n={},r=tS(t,["latLng"]);null!=r&&tA(n,["latLng"],function(e,t){let n={},r=tS(t,["latitude"]);null!=r&&tA(n,["latitude"],r);let i=tS(t,["longitude"]);return null!=i&&tA(n,["longitude"],i),n}(0,r));let i=tS(t,["languageCode"]);return null!=i&&tA(n,["languageCode"],i),n}(0,i)),n}(e,u)),void 0!==tS(t,["kmsKeyName"]))throw Error("kmsKeyName parameter is not supported in Gemini API.");return{}}(e,i,n)),n}(this.apiClient,e);return o=tb("cachedContents",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>nh(this.apiClient,e))}}async get(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["_url","name"],nn(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],i),n}(this.apiClient,e);return o=tb("{name}",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>np(this.apiClient,e))}{let t=function(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["_url","name"],nn(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],i),n}(this.apiClient,e);return o=tb("{name}",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>nh(this.apiClient,e))}}async delete(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["_url","name"],nn(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],i),n}(this.apiClient,e);return o=tb("{name}",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(()=>{let e=new tj;return Object.assign(e,{}),e})}{let t=function(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["_url","name"],nn(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],i),n}(this.apiClient,e);return o=tb("{name}",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(()=>{let e=new tj;return Object.assign(e,{}),e})}}async update(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["_url","name"],nn(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],function(e,t,n){let r=tS(t,["ttl"]);void 0!==n&&null!=r&&tA(n,["ttl"],r);let i=tS(t,["expireTime"]);return void 0!==n&&null!=i&&tA(n,["expireTime"],i),{}}(0,i,n)),n}(this.apiClient,e);return o=tb("{name}",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"PATCH",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>np(this.apiClient,e))}{let t=function(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["_url","name"],nn(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],function(e,t,n){let r=tS(t,["ttl"]);void 0!==n&&null!=r&&tA(n,["ttl"],r);let i=tS(t,["expireTime"]);return void 0!==n&&null!=i&&tA(n,["expireTime"],i),{}}(0,i,n)),n}(this.apiClient,e);return o=tb("{name}",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"PATCH",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>nh(this.apiClient,e))}}async listInternal(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=tS(t,["config"]);return null!=r&&tA(n,["config"],function(e,t,n){let r=tS(t,["pageSize"]);void 0!==n&&null!=r&&tA(n,["_query","pageSize"],r);let i=tS(t,["pageToken"]);return void 0!==n&&null!=i&&tA(n,["_query","pageToken"],i),{}}(0,r,n)),n}(this.apiClient,e);return o=tb("cachedContents",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=tS(t,["nextPageToken"]);null!=r&&tA(n,["nextPageToken"],r);let i=tS(t,["cachedContents"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>np(e,t))),tA(n,["cachedContents"],t)}return n}(this.apiClient,e),n=new tL;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=tS(t,["config"]);return null!=r&&tA(n,["config"],function(e,t,n){let r=tS(t,["pageSize"]);void 0!==n&&null!=r&&tA(n,["_query","pageSize"],r);let i=tS(t,["pageToken"]);return void 0!==n&&null!=i&&tA(n,["_query","pageToken"],i),{}}(0,r,n)),n}(this.apiClient,e);return o=tb("cachedContents",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=tS(t,["nextPageToken"]);null!=r&&tA(n,["nextPageToken"],r);let i=tS(t,["cachedContents"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>nh(e,t))),tA(n,["cachedContents"],t)}return n}(this.apiClient,e),n=new tL;return Object.assign(n,t),n})}}}function ng(e){return this instanceof ng?(this.v=e,this):new ng(e)}function ny(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),r[Symbol.asyncIterator]=function(){return this},r;function o(e,t){i[e]&&(r[e]=function(t){return new Promise(function(n,r){s.push([e,t,n,r])>1||a(e,t)})},t&&(r[e]=t(r[e])))}function a(e,t){try{var n;(n=i[e](t)).value instanceof ng?Promise.resolve(n.value.v).then(l,u):c(s[0][2],n)}catch(e){c(s[0][3],e)}}function l(e){a("next",e)}function u(e){a("throw",e)}function c(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}function n_(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){var s,o,a;s=r,o=i,a=(t=e[n](t)).done,Promise.resolve(t.value).then(function(e){s({value:e,done:a})},o)})}}}function nv(e){if(void 0===e.parts||0===e.parts.length)return!1;for(let t of e.parts)if(void 0===t||0===Object.keys(t).length||!t.thought&&void 0!==t.text&&""===t.text)return!1;return!0}function nE(e){if(void 0===e||0===e.length)return[];let t=[],n=e.length,r=0;for(;r<n;)if("user"===e[r].role)t.push(e[r]),r++;else{let i=[],s=!0;for(;r<n&&"model"===e[r].role;)i.push(e[r]),s&&!nv(e[r])&&(s=!1),r++;s?t.push(...i):t.pop()}return t}"function"==typeof SuppressedError&&SuppressedError;class nT{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new nC(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class nC{constructor(e,t,n,r={},i=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=r,this.history=i,this.sendPromise=Promise.resolve(),function(e){if(0!==e.length){for(let t of e)if("user"!==t.role&&"model"!==t.role)throw Error(`Role must be user or model, but got ${t.role}.`)}}(i)}async sendMessage(e){var t;await this.sendPromise;let n=t0(this.apiClient,e.message),r=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:null!=(t=e.config)?t:this.config});return this.sendPromise=(async()=>{var e,t,i;let s=await r,o=null==(t=null==(e=s.candidates)?void 0:e[0])?void 0:t.content,a=s.automaticFunctionCallingHistory,l=this.getHistory(!0).length,u=[];null!=a&&(u=null!=(i=a.slice(l))?i:[]),this.recordHistory(n,o?[o]:[],u)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),r}async sendMessageStream(e){var t;await this.sendPromise;let n=t0(this.apiClient,e.message),r=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:null!=(t=e.config)?t:this.config});this.sendPromise=r.then(()=>void 0).catch(()=>void 0);let i=await r;return this.processStreamResponse(i,n)}getHistory(e=!1){return structuredClone(e?nE(this.history):this.history)}processStreamResponse(e,t){var n,r;return ny(this,arguments,function*(){var i,s,o,a;let l=[];try{for(var u,c=!0,d=n_(e);!(i=(u=yield ng(d.next())).done);c=!0){if(a=u.value,c=!1,function(e){var t;if(void 0==e.candidates||0===e.candidates.length)return!1;let n=null==(t=e.candidates[0])?void 0:t.content;return void 0!==n&&nv(n)}(a)){let e=null==(r=null==(n=a.candidates)?void 0:n[0])?void 0:r.content;void 0!==e&&l.push(e)}yield yield ng(a)}}catch(e){s={error:e}}finally{try{!c&&!i&&(o=d.return)&&(yield ng(o.call(d)))}finally{if(s)throw s.error}}this.recordHistory(t,l)})}recordHistory(e,t,n){let r=[];t.length>0&&t.every(e=>void 0!==e.role)?r=t:r.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...nE(n)):this.history.push(e),this.history.push(...r)}}function nb(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["name"],r);let i=tS(t,["displayName"]);null!=i&&tA(n,["displayName"],i);let s=tS(t,["mimeType"]);null!=s&&tA(n,["mimeType"],s);let o=tS(t,["sizeBytes"]);null!=o&&tA(n,["sizeBytes"],o);let a=tS(t,["createTime"]);null!=a&&tA(n,["createTime"],a);let l=tS(t,["expirationTime"]);null!=l&&tA(n,["expirationTime"],l);let u=tS(t,["updateTime"]);null!=u&&tA(n,["updateTime"],u);let c=tS(t,["sha256Hash"]);null!=c&&tA(n,["sha256Hash"],c);let d=tS(t,["uri"]);null!=d&&tA(n,["uri"],d);let h=tS(t,["downloadUri"]);null!=h&&tA(n,["downloadUri"],h);let p=tS(t,["state"]);null!=p&&tA(n,["state"],p);let f=tS(t,["source"]);null!=f&&tA(n,["source"],f);let m=tS(t,["videoMetadata"]);null!=m&&tA(n,["videoMetadata"],m);let g=tS(t,["error"]);return null!=g&&tA(n,["error"],function(e,t){let n={},r=tS(t,["details"]);null!=r&&tA(n,["details"],r);let i=tS(t,["message"]);null!=i&&tA(n,["message"],i);let s=tS(t,["code"]);return null!=s&&tA(n,["code"],s),n}(0,g)),n}class nA extends tC{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new nf(tg.PAGED_ITEM_FILES,e=>this.listInternal(e),await this.listInternal(e),e)}async upload(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(e=>nb(this.apiClient,e))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s=function(e,t){let n={},r=tS(t,["config"]);return null!=r&&tA(n,["config"],function(e,t,n){let r=tS(t,["pageSize"]);void 0!==n&&null!=r&&tA(n,["_query","pageSize"],r);let i=tS(t,["pageToken"]);return void 0!==n&&null!=i&&tA(n,["_query","pageToken"],i),{}}(0,r,n)),n}(this.apiClient,e);return r=tb("files",s._url),i=s._query,delete s.config,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=tS(t,["nextPageToken"]);null!=r&&tA(n,["nextPageToken"],r);let i=tS(t,["files"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>nb(e,t))),tA(n,["files"],t)}return n}(this.apiClient,e),n=new tF;return Object.assign(n,t),n})}}async createInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s=function(e,t){let n={},r=tS(t,["file"]);null!=r&&tA(n,["file"],function(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["name"],r);let i=tS(t,["displayName"]);null!=i&&tA(n,["displayName"],i);let s=tS(t,["mimeType"]);null!=s&&tA(n,["mimeType"],s);let o=tS(t,["sizeBytes"]);null!=o&&tA(n,["sizeBytes"],o);let a=tS(t,["createTime"]);null!=a&&tA(n,["createTime"],a);let l=tS(t,["expirationTime"]);null!=l&&tA(n,["expirationTime"],l);let u=tS(t,["updateTime"]);null!=u&&tA(n,["updateTime"],u);let c=tS(t,["sha256Hash"]);null!=c&&tA(n,["sha256Hash"],c);let d=tS(t,["uri"]);null!=d&&tA(n,["uri"],d);let h=tS(t,["downloadUri"]);null!=h&&tA(n,["downloadUri"],h);let p=tS(t,["state"]);null!=p&&tA(n,["state"],p);let f=tS(t,["source"]);null!=f&&tA(n,["source"],f);let m=tS(t,["videoMetadata"]);null!=m&&tA(n,["videoMetadata"],m);let g=tS(t,["error"]);return null!=g&&tA(n,["error"],function(e,t){let n={},r=tS(t,["details"]);null!=r&&tA(n,["details"],r);let i=tS(t,["message"]);null!=i&&tA(n,["message"],i);let s=tS(t,["code"]);return null!=s&&tA(n,["code"],s),n}(0,g)),n}(0,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],i),n}(this.apiClient,e);return r=tb("upload/v1beta/files",s._url),i=s._query,delete s.config,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(()=>{let e=new tB;return Object.assign(e,{}),e})}}async get(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s=function(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["_url","file"],na(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],i),n}(this.apiClient,e);return r=tb("files/{file}",s._url),i=s._query,delete s.config,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>nb(this.apiClient,e))}}async delete(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s=function(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["_url","file"],na(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],i),n}(this.apiClient,e);return r=tb("files/{file}",s._url),i=s._query,delete s.config,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(()=>{let e=new tq;return Object.assign(e,{}),e})}}}function nS(e,t){let n={},r=tS(t,["prebuiltVoiceConfig"]);return null!=r&&tA(n,["prebuiltVoiceConfig"],function(e,t){let n={},r=tS(t,["voiceName"]);return null!=r&&tA(n,["voiceName"],r),n}(0,r)),n}function nw(e,t){let n={},r=tS(t,["text"]);null!=r&&tA(n,["text"],r);let i=tS(t,["weight"]);return null!=i&&tA(n,["weight"],i),n}function nO(e,t){let n={},r=tS(t,["temperature"]);null!=r&&tA(n,["temperature"],r);let i=tS(t,["topK"]);null!=i&&tA(n,["topK"],i);let s=tS(t,["seed"]);null!=s&&tA(n,["seed"],s);let o=tS(t,["guidance"]);null!=o&&tA(n,["guidance"],o);let a=tS(t,["bpm"]);null!=a&&tA(n,["bpm"],a);let l=tS(t,["density"]);null!=l&&tA(n,["density"],l);let u=tS(t,["brightness"]);null!=u&&tA(n,["brightness"],u);let c=tS(t,["scale"]);null!=c&&tA(n,["scale"],c);let d=tS(t,["muteBass"]);null!=d&&tA(n,["muteBass"],d);let h=tS(t,["muteDrums"]);null!=h&&tA(n,["muteDrums"],h);let p=tS(t,["onlyBassAndDrums"]);return null!=p&&tA(n,["onlyBassAndDrums"],p),n}function nk(e,t){let n={},r=tS(t,["model"]);return null!=r&&tA(n,["model"],r),n}function nx(e,t){let n={},r=tS(t,["weightedPrompts"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>nw(e,t))),tA(n,["weightedPrompts"],t)}return n}function nI(e,t){let n={},r=tS(t,["setup"]);null!=r&&tA(n,["setup"],nk(e,r));let i=tS(t,["clientContent"]);null!=i&&tA(n,["clientContent"],nx(e,i));let s=tS(t,["musicGenerationConfig"]);null!=s&&tA(n,["musicGenerationConfig"],nO(e,s));let o=tS(t,["playbackControl"]);return null!=o&&tA(n,["playbackControl"],o),n}function nN(e,t){let n={},r=tS(t,["text"]);null!=r&&tA(n,["text"],r);let i=tS(t,["finished"]);return null!=i&&tA(n,["finished"],i),n}function nR(e,t){let n={},r=tS(t,["text"]);null!=r&&tA(n,["text"],r);let i=tS(t,["finished"]);return null!=i&&tA(n,["finished"],i),n}function nP(e,t){let n={},r=tS(t,["modality"]);null!=r&&tA(n,["modality"],r);let i=tS(t,["tokenCount"]);return null!=i&&tA(n,["tokenCount"],i),n}function nD(e,t){let n={},r=tS(t,["modality"]);null!=r&&tA(n,["modality"],r);let i=tS(t,["tokenCount"]);return null!=i&&tA(n,["tokenCount"],i),n}function nM(e,t){let n={},r=tS(t,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["videoMetadata"]);null!=r&&tA(n,["videoMetadata"],function(e,t){let n={},r=tS(t,["fps"]);null!=r&&tA(n,["fps"],r);let i=tS(t,["endOffset"]);null!=i&&tA(n,["endOffset"],i);let s=tS(t,["startOffset"]);return null!=s&&tA(n,["startOffset"],s),n}(0,r));let i=tS(t,["thought"]);null!=i&&tA(n,["thought"],i);let s=tS(t,["inlineData"]);null!=s&&tA(n,["inlineData"],function(e,t){let n={};if(void 0!==tS(t,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=tS(t,["data"]);null!=r&&tA(n,["data"],r);let i=tS(t,["mimeType"]);return null!=i&&tA(n,["mimeType"],i),n}(0,s));let o=tS(t,["fileData"]);null!=o&&tA(n,["fileData"],function(e,t){let n={};if(void 0!==tS(t,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=tS(t,["fileUri"]);null!=r&&tA(n,["fileUri"],r);let i=tS(t,["mimeType"]);return null!=i&&tA(n,["mimeType"],i),n}(0,o));let a=tS(t,["thoughtSignature"]);null!=a&&tA(n,["thoughtSignature"],a);let l=tS(t,["codeExecutionResult"]);null!=l&&tA(n,["codeExecutionResult"],l);let u=tS(t,["executableCode"]);null!=u&&tA(n,["executableCode"],u);let c=tS(t,["functionCall"]);null!=c&&tA(n,["functionCall"],c);let d=tS(t,["functionResponse"]);null!=d&&tA(n,["functionResponse"],d);let h=tS(t,["text"]);return null!=h&&tA(n,["text"],h),n})(0,e))),tA(n,["parts"],e)}let i=tS(t,["role"]);return null!=i&&tA(n,["role"],i),n}function nU(e,t){let n={},r=tS(t,["prebuiltVoiceConfig"]);return null!=r&&tA(n,["prebuiltVoiceConfig"],function(e,t){let n={},r=tS(t,["voiceName"]);return null!=r&&tA(n,["voiceName"],r),n}(0,r)),n}function nj(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","model"],tH(e,r));let i=tS(t,["contents"]);if(null!=i){let t=t2(e,i);Array.isArray(t)&&(t=t.map(t=>nM(e,t))),tA(n,["contents"],t)}let s=tS(t,["config"]);return null!=s&&tA(n,["generationConfig"],function(e,t,n){let r={},i=tS(t,["systemInstruction"]);void 0!==n&&null!=i&&tA(n,["systemInstruction"],nM(e,t0(e,i)));let s=tS(t,["temperature"]);null!=s&&tA(r,["temperature"],s);let o=tS(t,["topP"]);null!=o&&tA(r,["topP"],o);let a=tS(t,["topK"]);null!=a&&tA(r,["topK"],a);let l=tS(t,["candidateCount"]);null!=l&&tA(r,["candidateCount"],l);let u=tS(t,["maxOutputTokens"]);null!=u&&tA(r,["maxOutputTokens"],u);let c=tS(t,["stopSequences"]);null!=c&&tA(r,["stopSequences"],c);let d=tS(t,["responseLogprobs"]);null!=d&&tA(r,["responseLogprobs"],d);let h=tS(t,["logprobs"]);null!=h&&tA(r,["logprobs"],h);let p=tS(t,["presencePenalty"]);null!=p&&tA(r,["presencePenalty"],p);let f=tS(t,["frequencyPenalty"]);null!=f&&tA(r,["frequencyPenalty"],f);let m=tS(t,["seed"]);null!=m&&tA(r,["seed"],m);let g=tS(t,["responseMimeType"]);null!=g&&tA(r,["responseMimeType"],g);let y=tS(t,["responseSchema"]);if(null!=y&&tA(r,["responseSchema"],function(e,t){let n={},r=tS(t,["anyOf"]);null!=r&&tA(n,["anyOf"],r);let i=tS(t,["default"]);null!=i&&tA(n,["default"],i);let s=tS(t,["description"]);null!=s&&tA(n,["description"],s);let o=tS(t,["enum"]);null!=o&&tA(n,["enum"],o);let a=tS(t,["example"]);null!=a&&tA(n,["example"],a);let l=tS(t,["format"]);null!=l&&tA(n,["format"],l);let u=tS(t,["items"]);null!=u&&tA(n,["items"],u);let c=tS(t,["maxItems"]);null!=c&&tA(n,["maxItems"],c);let d=tS(t,["maxLength"]);null!=d&&tA(n,["maxLength"],d);let h=tS(t,["maxProperties"]);null!=h&&tA(n,["maxProperties"],h);let p=tS(t,["maximum"]);null!=p&&tA(n,["maximum"],p);let f=tS(t,["minItems"]);null!=f&&tA(n,["minItems"],f);let m=tS(t,["minLength"]);null!=m&&tA(n,["minLength"],m);let g=tS(t,["minProperties"]);null!=g&&tA(n,["minProperties"],g);let y=tS(t,["minimum"]);null!=y&&tA(n,["minimum"],y);let _=tS(t,["nullable"]);null!=_&&tA(n,["nullable"],_);let v=tS(t,["pattern"]);null!=v&&tA(n,["pattern"],v);let E=tS(t,["properties"]);null!=E&&tA(n,["properties"],E);let T=tS(t,["propertyOrdering"]);null!=T&&tA(n,["propertyOrdering"],T);let C=tS(t,["required"]);null!=C&&tA(n,["required"],C);let b=tS(t,["title"]);null!=b&&tA(n,["title"],b);let A=tS(t,["type"]);return null!=A&&tA(n,["type"],A),n}(0,t8(e,y))),void 0!==tS(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==tS(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let _=tS(t,["safetySettings"]);if(void 0!==n&&null!=_){let e=_;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={};if(void 0!==tS(t,["method"]))throw Error("method parameter is not supported in Gemini API.");let r=tS(t,["category"]);null!=r&&tA(n,["category"],r);let i=tS(t,["threshold"]);return null!=i&&tA(n,["threshold"],i),n})(0,e))),tA(n,["safetySettings"],e)}let v=tS(t,["tools"]);if(void 0!==n&&null!=v){let t=nt(e,v);Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["behavior"]);null!=r&&tA(n,["behavior"],r);let i=tS(t,["description"]);null!=i&&tA(n,["description"],i);let s=tS(t,["name"]);null!=s&&tA(n,["name"],s);let o=tS(t,["parameters"]);null!=o&&tA(n,["parameters"],o);let a=tS(t,["response"]);return null!=a&&tA(n,["response"],a),n})(0,e))),tA(n,["functionDeclarations"],e)}if(void 0!==tS(t,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=tS(t,["googleSearch"]);null!=i&&tA(n,["googleSearch"],function(e,t){let n={},r=tS(t,["timeRangeFilter"]);return null!=r&&tA(n,["timeRangeFilter"],function(e,t){let n={},r=tS(t,["startTime"]);null!=r&&tA(n,["startTime"],r);let i=tS(t,["endTime"]);return null!=i&&tA(n,["endTime"],i),n}(0,r)),n}(0,i));let s=tS(t,["googleSearchRetrieval"]);if(null!=s&&tA(n,["googleSearchRetrieval"],function(e,t){let n={},r=tS(t,["dynamicRetrievalConfig"]);return null!=r&&tA(n,["dynamicRetrievalConfig"],function(e,t){let n={},r=tS(t,["mode"]);null!=r&&tA(n,["mode"],r);let i=tS(t,["dynamicThreshold"]);return null!=i&&tA(n,["dynamicThreshold"],i),n}(0,r)),n}(0,s)),void 0!==tS(t,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(void 0!==tS(t,["googleMaps"]))throw Error("googleMaps parameter is not supported in Gemini API.");null!=tS(t,["urlContext"])&&tA(n,["urlContext"],{});let o=tS(t,["codeExecution"]);return null!=o&&tA(n,["codeExecution"],o),n})(e,ne(e,t)))),tA(n,["tools"],t)}let E=tS(t,["toolConfig"]);if(void 0!==n&&null!=E&&tA(n,["toolConfig"],function(e,t){let n={},r=tS(t,["functionCallingConfig"]);null!=r&&tA(n,["functionCallingConfig"],function(e,t){let n={},r=tS(t,["mode"]);null!=r&&tA(n,["mode"],r);let i=tS(t,["allowedFunctionNames"]);return null!=i&&tA(n,["allowedFunctionNames"],i),n}(0,r));let i=tS(t,["retrievalConfig"]);return null!=i&&tA(n,["retrievalConfig"],function(e,t){let n={},r=tS(t,["latLng"]);null!=r&&tA(n,["latLng"],function(e,t){let n={},r=tS(t,["latitude"]);null!=r&&tA(n,["latitude"],r);let i=tS(t,["longitude"]);return null!=i&&tA(n,["longitude"],i),n}(0,r));let i=tS(t,["languageCode"]);return null!=i&&tA(n,["languageCode"],i),n}(0,i)),n}(e,E)),void 0!==tS(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let T=tS(t,["cachedContent"]);void 0!==n&&null!=T&&tA(n,["cachedContent"],nn(e,T));let C=tS(t,["responseModalities"]);null!=C&&tA(r,["responseModalities"],C);let b=tS(t,["mediaResolution"]);null!=b&&tA(r,["mediaResolution"],b);let A=tS(t,["speechConfig"]);if(null!=A&&tA(r,["speechConfig"],function(e,t){let n={},r=tS(t,["voiceConfig"]);null!=r&&tA(n,["voiceConfig"],nU(e,r));let i=tS(t,["multiSpeakerVoiceConfig"]);null!=i&&tA(n,["multiSpeakerVoiceConfig"],function(e,t){let n={},r=tS(t,["speakerVoiceConfigs"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["speaker"]);null!=r&&tA(n,["speaker"],r);let i=tS(t,["voiceConfig"]);return null!=i&&tA(n,["voiceConfig"],nU(e,i)),n})(e,t))),tA(n,["speakerVoiceConfigs"],t)}return n}(e,i));let s=tS(t,["languageCode"]);return null!=s&&tA(n,["languageCode"],s),n}(e,t9(e,A))),void 0!==tS(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let S=tS(t,["thinkingConfig"]);return null!=S&&tA(r,["thinkingConfig"],function(e,t){let n={},r=tS(t,["includeThoughts"]);null!=r&&tA(n,["includeThoughts"],r);let i=tS(t,["thinkingBudget"]);return null!=i&&tA(n,["thinkingBudget"],i),n}(0,S)),r}(e,s,n)),n}function nL(e,t){let n={},r=tS(t,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["videoMetadata"]);null!=r&&tA(n,["videoMetadata"],function(e,t){let n={},r=tS(t,["fps"]);null!=r&&tA(n,["fps"],r);let i=tS(t,["endOffset"]);null!=i&&tA(n,["endOffset"],i);let s=tS(t,["startOffset"]);return null!=s&&tA(n,["startOffset"],s),n}(0,r));let i=tS(t,["thought"]);null!=i&&tA(n,["thought"],i);let s=tS(t,["inlineData"]);null!=s&&tA(n,["inlineData"],function(e,t){let n={},r=tS(t,["displayName"]);null!=r&&tA(n,["displayName"],r);let i=tS(t,["data"]);null!=i&&tA(n,["data"],i);let s=tS(t,["mimeType"]);return null!=s&&tA(n,["mimeType"],s),n}(0,s));let o=tS(t,["fileData"]);null!=o&&tA(n,["fileData"],function(e,t){let n={},r=tS(t,["displayName"]);null!=r&&tA(n,["displayName"],r);let i=tS(t,["fileUri"]);null!=i&&tA(n,["fileUri"],i);let s=tS(t,["mimeType"]);return null!=s&&tA(n,["mimeType"],s),n}(0,o));let a=tS(t,["thoughtSignature"]);null!=a&&tA(n,["thoughtSignature"],a);let l=tS(t,["codeExecutionResult"]);null!=l&&tA(n,["codeExecutionResult"],l);let u=tS(t,["executableCode"]);null!=u&&tA(n,["executableCode"],u);let c=tS(t,["functionCall"]);null!=c&&tA(n,["functionCall"],c);let d=tS(t,["functionResponse"]);null!=d&&tA(n,["functionResponse"],d);let h=tS(t,["text"]);return null!=h&&tA(n,["text"],h),n})(0,e))),tA(n,["parts"],e)}let i=tS(t,["role"]);return null!=i&&tA(n,["role"],i),n}function nF(e,t){let n={},r=tS(t,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={};if(void 0!==tS(t,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let r=tS(t,["description"]);null!=r&&tA(n,["description"],r);let i=tS(t,["name"]);null!=i&&tA(n,["name"],i);let s=tS(t,["parameters"]);null!=s&&tA(n,["parameters"],s);let o=tS(t,["response"]);return null!=o&&tA(n,["response"],o),n})(0,e))),tA(n,["functionDeclarations"],e)}let i=tS(t,["retrieval"]);null!=i&&tA(n,["retrieval"],i);let s=tS(t,["googleSearch"]);null!=s&&tA(n,["googleSearch"],function(e,t){let n={},r=tS(t,["timeRangeFilter"]);return null!=r&&tA(n,["timeRangeFilter"],function(e,t){let n={},r=tS(t,["startTime"]);null!=r&&tA(n,["startTime"],r);let i=tS(t,["endTime"]);return null!=i&&tA(n,["endTime"],i),n}(0,r)),n}(0,s));let o=tS(t,["googleSearchRetrieval"]);null!=o&&tA(n,["googleSearchRetrieval"],function(e,t){let n={},r=tS(t,["dynamicRetrievalConfig"]);return null!=r&&tA(n,["dynamicRetrievalConfig"],function(e,t){let n={},r=tS(t,["mode"]);null!=r&&tA(n,["mode"],r);let i=tS(t,["dynamicThreshold"]);return null!=i&&tA(n,["dynamicThreshold"],i),n}(0,r)),n}(0,o)),null!=tS(t,["enterpriseWebSearch"])&&tA(n,["enterpriseWebSearch"],{});let a=tS(t,["googleMaps"]);null!=a&&tA(n,["googleMaps"],function(e,t){let n={},r=tS(t,["authConfig"]);return null!=r&&tA(n,["authConfig"],function(e,t){let n={},r=tS(t,["apiKeyConfig"]);null!=r&&tA(n,["apiKeyConfig"],function(e,t){let n={},r=tS(t,["apiKeyString"]);return null!=r&&tA(n,["apiKeyString"],r),n}(0,r));let i=tS(t,["authType"]);null!=i&&tA(n,["authType"],i);let s=tS(t,["googleServiceAccountConfig"]);null!=s&&tA(n,["googleServiceAccountConfig"],s);let o=tS(t,["httpBasicAuthConfig"]);null!=o&&tA(n,["httpBasicAuthConfig"],o);let a=tS(t,["oauthConfig"]);null!=a&&tA(n,["oauthConfig"],a);let l=tS(t,["oidcConfig"]);return null!=l&&tA(n,["oidcConfig"],l),n}(0,r)),n}(e,a)),null!=tS(t,["urlContext"])&&tA(n,["urlContext"],{});let l=tS(t,["codeExecution"]);return null!=l&&tA(n,["codeExecution"],l),n}function nG(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","model"],tH(e,r));let i=tS(t,["contents"]);if(null!=i){let t=t2(e,i);Array.isArray(t)&&(t=t.map(t=>nL(e,t))),tA(n,["contents"],t)}let s=tS(t,["config"]);return null!=s&&tA(n,["generationConfig"],function(e,t,n){let r={},i=tS(t,["systemInstruction"]);void 0!==n&&null!=i&&tA(n,["systemInstruction"],nL(e,t0(e,i)));let s=tS(t,["temperature"]);null!=s&&tA(r,["temperature"],s);let o=tS(t,["topP"]);null!=o&&tA(r,["topP"],o);let a=tS(t,["topK"]);null!=a&&tA(r,["topK"],a);let l=tS(t,["candidateCount"]);null!=l&&tA(r,["candidateCount"],l);let u=tS(t,["maxOutputTokens"]);null!=u&&tA(r,["maxOutputTokens"],u);let c=tS(t,["stopSequences"]);null!=c&&tA(r,["stopSequences"],c);let d=tS(t,["responseLogprobs"]);null!=d&&tA(r,["responseLogprobs"],d);let h=tS(t,["logprobs"]);null!=h&&tA(r,["logprobs"],h);let p=tS(t,["presencePenalty"]);null!=p&&tA(r,["presencePenalty"],p);let f=tS(t,["frequencyPenalty"]);null!=f&&tA(r,["frequencyPenalty"],f);let m=tS(t,["seed"]);null!=m&&tA(r,["seed"],m);let g=tS(t,["responseMimeType"]);null!=g&&tA(r,["responseMimeType"],g);let y=tS(t,["responseSchema"]);null!=y&&tA(r,["responseSchema"],function(e,t){let n={},r=tS(t,["anyOf"]);null!=r&&tA(n,["anyOf"],r);let i=tS(t,["default"]);null!=i&&tA(n,["default"],i);let s=tS(t,["description"]);null!=s&&tA(n,["description"],s);let o=tS(t,["enum"]);null!=o&&tA(n,["enum"],o);let a=tS(t,["example"]);null!=a&&tA(n,["example"],a);let l=tS(t,["format"]);null!=l&&tA(n,["format"],l);let u=tS(t,["items"]);null!=u&&tA(n,["items"],u);let c=tS(t,["maxItems"]);null!=c&&tA(n,["maxItems"],c);let d=tS(t,["maxLength"]);null!=d&&tA(n,["maxLength"],d);let h=tS(t,["maxProperties"]);null!=h&&tA(n,["maxProperties"],h);let p=tS(t,["maximum"]);null!=p&&tA(n,["maximum"],p);let f=tS(t,["minItems"]);null!=f&&tA(n,["minItems"],f);let m=tS(t,["minLength"]);null!=m&&tA(n,["minLength"],m);let g=tS(t,["minProperties"]);null!=g&&tA(n,["minProperties"],g);let y=tS(t,["minimum"]);null!=y&&tA(n,["minimum"],y);let _=tS(t,["nullable"]);null!=_&&tA(n,["nullable"],_);let v=tS(t,["pattern"]);null!=v&&tA(n,["pattern"],v);let E=tS(t,["properties"]);null!=E&&tA(n,["properties"],E);let T=tS(t,["propertyOrdering"]);null!=T&&tA(n,["propertyOrdering"],T);let C=tS(t,["required"]);null!=C&&tA(n,["required"],C);let b=tS(t,["title"]);null!=b&&tA(n,["title"],b);let A=tS(t,["type"]);return null!=A&&tA(n,["type"],A),n}(0,t8(e,y)));let _=tS(t,["routingConfig"]);null!=_&&tA(r,["routingConfig"],_);let v=tS(t,["modelSelectionConfig"]);null!=v&&tA(r,["modelConfig"],function(e,t){let n={},r=tS(t,["featureSelectionPreference"]);return null!=r&&tA(n,["featureSelectionPreference"],r),n}(0,v));let E=tS(t,["safetySettings"]);if(void 0!==n&&null!=E){let e=E;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["method"]);null!=r&&tA(n,["method"],r);let i=tS(t,["category"]);null!=i&&tA(n,["category"],i);let s=tS(t,["threshold"]);return null!=s&&tA(n,["threshold"],s),n})(0,e))),tA(n,["safetySettings"],e)}let T=tS(t,["tools"]);if(void 0!==n&&null!=T){let t=nt(e,T);Array.isArray(t)&&(t=t.map(t=>nF(e,ne(e,t)))),tA(n,["tools"],t)}let C=tS(t,["toolConfig"]);void 0!==n&&null!=C&&tA(n,["toolConfig"],function(e,t){let n={},r=tS(t,["functionCallingConfig"]);null!=r&&tA(n,["functionCallingConfig"],function(e,t){let n={},r=tS(t,["mode"]);null!=r&&tA(n,["mode"],r);let i=tS(t,["allowedFunctionNames"]);return null!=i&&tA(n,["allowedFunctionNames"],i),n}(0,r));let i=tS(t,["retrievalConfig"]);return null!=i&&tA(n,["retrievalConfig"],function(e,t){let n={},r=tS(t,["latLng"]);null!=r&&tA(n,["latLng"],function(e,t){let n={},r=tS(t,["latitude"]);null!=r&&tA(n,["latitude"],r);let i=tS(t,["longitude"]);return null!=i&&tA(n,["longitude"],i),n}(0,r));let i=tS(t,["languageCode"]);return null!=i&&tA(n,["languageCode"],i),n}(0,i)),n}(e,C));let b=tS(t,["labels"]);void 0!==n&&null!=b&&tA(n,["labels"],b);let A=tS(t,["cachedContent"]);void 0!==n&&null!=A&&tA(n,["cachedContent"],nn(e,A));let S=tS(t,["responseModalities"]);null!=S&&tA(r,["responseModalities"],S);let w=tS(t,["mediaResolution"]);null!=w&&tA(r,["mediaResolution"],w);let O=tS(t,["speechConfig"]);null!=O&&tA(r,["speechConfig"],function(e,t){let n={},r=tS(t,["voiceConfig"]);if(null!=r&&tA(n,["voiceConfig"],function(e,t){let n={},r=tS(t,["prebuiltVoiceConfig"]);return null!=r&&tA(n,["prebuiltVoiceConfig"],function(e,t){let n={},r=tS(t,["voiceName"]);return null!=r&&tA(n,["voiceName"],r),n}(0,r)),n}(0,r)),void 0!==tS(t,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");let i=tS(t,["languageCode"]);return null!=i&&tA(n,["languageCode"],i),n}(e,t9(e,O)));let k=tS(t,["audioTimestamp"]);null!=k&&tA(r,["audioTimestamp"],k);let x=tS(t,["thinkingConfig"]);return null!=x&&tA(r,["thinkingConfig"],function(e,t){let n={},r=tS(t,["includeThoughts"]);null!=r&&tA(n,["includeThoughts"],r);let i=tS(t,["thinkingBudget"]);return null!=i&&tA(n,["thinkingBudget"],i),n}(0,x)),r}(e,s,n)),n}function nB(e,t){let n={},r=tS(t,["gcsUri"]);null!=r&&tA(n,["gcsUri"],r);let i=tS(t,["imageBytes"]);null!=i&&tA(n,["bytesBase64Encoded"],ni(e,i));let s=tS(t,["mimeType"]);return null!=s&&tA(n,["mimeType"],s),n}function nq(e,t){let n={},r=tS(t,["candidates"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["content"]);null!=r&&tA(n,["content"],function(e,t){let n={},r=tS(t,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["videoMetadata"]);null!=r&&tA(n,["videoMetadata"],function(e,t){let n={},r=tS(t,["fps"]);null!=r&&tA(n,["fps"],r);let i=tS(t,["endOffset"]);null!=i&&tA(n,["endOffset"],i);let s=tS(t,["startOffset"]);return null!=s&&tA(n,["startOffset"],s),n}(0,r));let i=tS(t,["thought"]);null!=i&&tA(n,["thought"],i);let s=tS(t,["inlineData"]);null!=s&&tA(n,["inlineData"],function(e,t){let n={},r=tS(t,["data"]);null!=r&&tA(n,["data"],r);let i=tS(t,["mimeType"]);return null!=i&&tA(n,["mimeType"],i),n}(0,s));let o=tS(t,["fileData"]);null!=o&&tA(n,["fileData"],function(e,t){let n={},r=tS(t,["fileUri"]);null!=r&&tA(n,["fileUri"],r);let i=tS(t,["mimeType"]);return null!=i&&tA(n,["mimeType"],i),n}(0,o));let a=tS(t,["thoughtSignature"]);null!=a&&tA(n,["thoughtSignature"],a);let l=tS(t,["codeExecutionResult"]);null!=l&&tA(n,["codeExecutionResult"],l);let u=tS(t,["executableCode"]);null!=u&&tA(n,["executableCode"],u);let c=tS(t,["functionCall"]);null!=c&&tA(n,["functionCall"],c);let d=tS(t,["functionResponse"]);null!=d&&tA(n,["functionResponse"],d);let h=tS(t,["text"]);return null!=h&&tA(n,["text"],h),n})(0,e))),tA(n,["parts"],e)}let i=tS(t,["role"]);return null!=i&&tA(n,["role"],i),n}(e,r));let i=tS(t,["citationMetadata"]);null!=i&&tA(n,["citationMetadata"],function(e,t){let n={},r=tS(t,["citationSources"]);return null!=r&&tA(n,["citations"],r),n}(0,i));let s=tS(t,["tokenCount"]);null!=s&&tA(n,["tokenCount"],s);let o=tS(t,["finishReason"]);null!=o&&tA(n,["finishReason"],o);let a=tS(t,["urlContextMetadata"]);null!=a&&tA(n,["urlContextMetadata"],function(e,t){let n={},r=tS(t,["urlMetadata"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["retrievedUrl"]);null!=r&&tA(n,["retrievedUrl"],r);let i=tS(t,["urlRetrievalStatus"]);return null!=i&&tA(n,["urlRetrievalStatus"],i),n})(0,e))),tA(n,["urlMetadata"],e)}return n}(0,a));let l=tS(t,["avgLogprobs"]);null!=l&&tA(n,["avgLogprobs"],l);let u=tS(t,["groundingMetadata"]);null!=u&&tA(n,["groundingMetadata"],u);let c=tS(t,["index"]);null!=c&&tA(n,["index"],c);let d=tS(t,["logprobsResult"]);null!=d&&tA(n,["logprobsResult"],d);let h=tS(t,["safetyRatings"]);return null!=h&&tA(n,["safetyRatings"],h),n})(e,t))),tA(n,["candidates"],t)}let i=tS(t,["modelVersion"]);null!=i&&tA(n,["modelVersion"],i);let s=tS(t,["promptFeedback"]);null!=s&&tA(n,["promptFeedback"],s);let o=tS(t,["usageMetadata"]);return null!=o&&tA(n,["usageMetadata"],o),n}function n$(e,t){let n={},r=tS(t,["safetyAttributes","categories"]);null!=r&&tA(n,["categories"],r);let i=tS(t,["safetyAttributes","scores"]);null!=i&&tA(n,["scores"],i);let s=tS(t,["contentType"]);return null!=s&&tA(n,["contentType"],s),n}function nV(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["name"],r);let i=tS(t,["displayName"]);null!=i&&tA(n,["displayName"],i);let s=tS(t,["description"]);null!=s&&tA(n,["description"],s);let o=tS(t,["version"]);null!=o&&tA(n,["version"],o);let a=tS(t,["_self"]);null!=a&&tA(n,["tunedModelInfo"],function(e,t){let n={},r=tS(t,["baseModel"]);null!=r&&tA(n,["baseModel"],r);let i=tS(t,["createTime"]);null!=i&&tA(n,["createTime"],i);let s=tS(t,["updateTime"]);return null!=s&&tA(n,["updateTime"],s),n}(0,a));let l=tS(t,["inputTokenLimit"]);null!=l&&tA(n,["inputTokenLimit"],l);let u=tS(t,["outputTokenLimit"]);null!=u&&tA(n,["outputTokenLimit"],u);let c=tS(t,["supportedGenerationMethods"]);return null!=c&&tA(n,["supportedActions"],c),n}function nH(e,t){let n={},r=tS(t,["candidates"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["content"]);null!=r&&tA(n,["content"],function(e,t){let n={},r=tS(t,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["videoMetadata"]);null!=r&&tA(n,["videoMetadata"],function(e,t){let n={},r=tS(t,["fps"]);null!=r&&tA(n,["fps"],r);let i=tS(t,["endOffset"]);null!=i&&tA(n,["endOffset"],i);let s=tS(t,["startOffset"]);return null!=s&&tA(n,["startOffset"],s),n}(0,r));let i=tS(t,["thought"]);null!=i&&tA(n,["thought"],i);let s=tS(t,["inlineData"]);null!=s&&tA(n,["inlineData"],function(e,t){let n={},r=tS(t,["displayName"]);null!=r&&tA(n,["displayName"],r);let i=tS(t,["data"]);null!=i&&tA(n,["data"],i);let s=tS(t,["mimeType"]);return null!=s&&tA(n,["mimeType"],s),n}(0,s));let o=tS(t,["fileData"]);null!=o&&tA(n,["fileData"],function(e,t){let n={},r=tS(t,["displayName"]);null!=r&&tA(n,["displayName"],r);let i=tS(t,["fileUri"]);null!=i&&tA(n,["fileUri"],i);let s=tS(t,["mimeType"]);return null!=s&&tA(n,["mimeType"],s),n}(0,o));let a=tS(t,["thoughtSignature"]);null!=a&&tA(n,["thoughtSignature"],a);let l=tS(t,["codeExecutionResult"]);null!=l&&tA(n,["codeExecutionResult"],l);let u=tS(t,["executableCode"]);null!=u&&tA(n,["executableCode"],u);let c=tS(t,["functionCall"]);null!=c&&tA(n,["functionCall"],c);let d=tS(t,["functionResponse"]);null!=d&&tA(n,["functionResponse"],d);let h=tS(t,["text"]);return null!=h&&tA(n,["text"],h),n})(0,e))),tA(n,["parts"],e)}let i=tS(t,["role"]);return null!=i&&tA(n,["role"],i),n}(e,r));let i=tS(t,["citationMetadata"]);null!=i&&tA(n,["citationMetadata"],function(e,t){let n={},r=tS(t,["citations"]);return null!=r&&tA(n,["citations"],r),n}(0,i));let s=tS(t,["finishMessage"]);null!=s&&tA(n,["finishMessage"],s);let o=tS(t,["finishReason"]);null!=o&&tA(n,["finishReason"],o);let a=tS(t,["urlContextMetadata"]);null!=a&&tA(n,["urlContextMetadata"],function(e,t){let n={},r=tS(t,["urlMetadata"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["retrievedUrl"]);null!=r&&tA(n,["retrievedUrl"],r);let i=tS(t,["urlRetrievalStatus"]);return null!=i&&tA(n,["urlRetrievalStatus"],i),n})(0,e))),tA(n,["urlMetadata"],e)}return n}(0,a));let l=tS(t,["avgLogprobs"]);null!=l&&tA(n,["avgLogprobs"],l);let u=tS(t,["groundingMetadata"]);null!=u&&tA(n,["groundingMetadata"],u);let c=tS(t,["index"]);null!=c&&tA(n,["index"],c);let d=tS(t,["logprobsResult"]);null!=d&&tA(n,["logprobsResult"],d);let h=tS(t,["safetyRatings"]);return null!=h&&tA(n,["safetyRatings"],h),n})(e,t))),tA(n,["candidates"],t)}let i=tS(t,["createTime"]);null!=i&&tA(n,["createTime"],i);let s=tS(t,["responseId"]);null!=s&&tA(n,["responseId"],s);let o=tS(t,["modelVersion"]);null!=o&&tA(n,["modelVersion"],o);let a=tS(t,["promptFeedback"]);null!=a&&tA(n,["promptFeedback"],a);let l=tS(t,["usageMetadata"]);return null!=l&&tA(n,["usageMetadata"],l),n}function nW(e,t){let n={},r=tS(t,["safetyAttributes","categories"]);null!=r&&tA(n,["categories"],r);let i=tS(t,["safetyAttributes","scores"]);null!=i&&tA(n,["scores"],i);let s=tS(t,["contentType"]);return null!=s&&tA(n,["contentType"],s),n}function nJ(e,t){let n={},r=tS(t,["_self"]);null!=r&&tA(n,["image"],function(e,t){let n={},r=tS(t,["gcsUri"]);null!=r&&tA(n,["gcsUri"],r);let i=tS(t,["bytesBase64Encoded"]);null!=i&&tA(n,["imageBytes"],ni(e,i));let s=tS(t,["mimeType"]);return null!=s&&tA(n,["mimeType"],s),n}(e,r));let i=tS(t,["raiFilteredReason"]);null!=i&&tA(n,["raiFilteredReason"],i);let s=tS(t,["_self"]);null!=s&&tA(n,["safetyAttributes"],nW(e,s));let o=tS(t,["prompt"]);return null!=o&&tA(n,["enhancedPrompt"],o),n}function nK(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["name"],r);let i=tS(t,["displayName"]);null!=i&&tA(n,["displayName"],i);let s=tS(t,["description"]);null!=s&&tA(n,["description"],s);let o=tS(t,["versionId"]);null!=o&&tA(n,["version"],o);let a=tS(t,["deployedModels"]);if(null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["endpoint"]);null!=r&&tA(n,["name"],r);let i=tS(t,["deployedModelId"]);return null!=i&&tA(n,["deployedModelId"],i),n})(0,e))),tA(n,["endpoints"],e)}let l=tS(t,["labels"]);null!=l&&tA(n,["labels"],l);let u=tS(t,["_self"]);null!=u&&tA(n,["tunedModelInfo"],function(e,t){let n={},r=tS(t,["labels","google-vertex-llm-tuning-base-model-id"]);null!=r&&tA(n,["baseModel"],r);let i=tS(t,["createTime"]);null!=i&&tA(n,["createTime"],i);let s=tS(t,["updateTime"]);return null!=s&&tA(n,["updateTime"],s),n}(0,u));let c=tS(t,["defaultCheckpointId"]);null!=c&&tA(n,["defaultCheckpointId"],c);let d=tS(t,["checkpoints"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["checkpointId"]);null!=r&&tA(n,["checkpointId"],r);let i=tS(t,["epoch"]);null!=i&&tA(n,["epoch"],i);let s=tS(t,["step"]);return null!=s&&tA(n,["step"],s),n})(0,e))),tA(n,["checkpoints"],e)}return n}let nz="x-goog-api-client",nY=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class nZ extends Error{constructor(e,t){t?super(e,{cause:t}):super(e,{cause:Error().stack}),this.message=e,this.name="ClientError"}}class nX extends Error{constructor(e,t){t?super(e,{cause:t}):super(e,{cause:Error().stack}),this.message=e,this.name="ServerError"}}class nQ{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let r={};this.clientOptions.vertexai?(r.apiVersion=null!=(t=this.clientOptions.apiVersion)?t:"v1beta1",r.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(r.apiVersion=null!=(n=this.clientOptions.apiVersion)?n:"v1beta",r.baseUrl="https://generativelanguage.googleapis.com/"),r.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=r,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(r,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&"global"!==this.clientOptions.location?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return null!=(e=this.clientOptions.vertexai)&&e}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||void 0===e.baseUrl||void 0===e.apiVersion)throw Error("HTTP options are not correctly set.");let t=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&""!==e.apiVersion&&t.push(e.apiVersion),t.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=new URL(this.getBaseUrl());return e.protocol="http:"==e.protocol?"ws":"wss",e.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let r=[this.getRequestUrlInternal(t)];return n&&r.push(this.getBaseResourcePath()),""!==e&&r.push(e),new URL(`${r.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||"GET"===e.httpMethod&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[t,n]of Object.entries(e.queryParams))r.searchParams.append(t,String(n));let i={};if("GET"===e.httpMethod){if(e.body&&"{}"!==e.body)throw Error("Request body should be empty for GET request, but got non empty request body")}else i.body=e.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,t,e.abortSignal),this.unaryApiCall(r,i,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[e,r]of Object.entries(t))"object"==typeof r?n[e]=Object.assign(Object.assign({},n[e]),r):void 0!==r&&(n[e]=r);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,n);r.searchParams.has("alt")&&"sse"===r.searchParams.get("alt")||r.searchParams.set("alt","sse");let i={};return i.body=e.body,i=await this.includeExtraHttpOptionsToRequestInit(i,t,e.abortSignal),this.streamApiCall(r,i,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n){if(t&&t.timeout||n){let r=new AbortController,i=r.signal;t.timeout&&(null==t?void 0:t.timeout)>0&&setTimeout(()=>r.abort(),t.timeout),n&&n.addEventListener("abort",()=>{r.abort()}),e.signal=i}return e.headers=await this.getHeadersInternal(t),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await n0(e),new tG(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await n0(e),this.processStreamResponse(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}processStreamResponse(e){var t;return ny(this,arguments,function*(){let n=null==(t=null==e?void 0:e.body)?void 0:t.getReader(),r=new TextDecoder("utf-8");if(!n)throw Error("Response body is empty");try{let t="";for(;;){let{done:i,value:s}=yield ng(n.read());if(i){if(t.trim().length>0)throw Error("Incomplete JSON segment at the end");break}let o=r.decode(s);try{let e=JSON.parse(o);if("error"in e){let t=JSON.parse(JSON.stringify(e.error)),n=t.status,r=t.code,i=`got status: ${n}. ${JSON.stringify(e)}`;if(r>=400&&r<500)throw new nZ(i);if(r>=500&&r<600)throw new nX(i)}}catch(e){if("ClientError"===e.name||"ServerError"===e.name)throw e}let a=(t+=o).match(nY);for(;a;){let n=a[1];try{let r=new Response(n,{headers:null==e?void 0:e.headers,status:null==e?void 0:e.status,statusText:null==e?void 0:e.statusText});yield yield ng(new tG(r)),a=(t=t.slice(a[0].length)).match(nY)}catch(e){throw Error(`exception parsing stream chunk ${n}. ${e}`)}}}}finally{n.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(e=>{throw Error(`exception ${e} sending request`)})}getDefaultHeaders(){let e={},t="google-genai-sdk/1.5.1 "+this.clientOptions.userAgentExtra;return e["User-Agent"]=t,e[nz]=t,e["Content-Type"]="application/json",e}async getHeadersInternal(e){let t=new Headers;if(e&&e.headers){for(let[n,r]of Object.entries(e.headers))t.append(n,r);e.timeout&&e.timeout>0&&t.append("X-Server-Timeout",String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(t),t}async uploadFile(e,t){var n;let r={};null!=t&&(r.mimeType=t.mimeType,r.name=t.name,r.displayName=t.displayName),r.name&&!r.name.startsWith("files/")&&(r.name=`files/${r.name}`);let i=this.clientOptions.uploader,s=await i.stat(e);r.sizeBytes=String(s.size);let o=null!=(n=null==t?void 0:t.mimeType)?n:s.type;if(void 0===o||""===o)throw Error("Can not determine mimeType. Please provide mimeType in the config.");r.mimeType=o;let a=await this.fetchUploadUrl(r,t);return i.upload(e,a,this)}async downloadFile(e){let t=this.clientOptions.downloader;await t.download(e,this)}async fetchUploadUrl(e,t){var n;let r={};r=(null==t?void 0:t.httpOptions)?t.httpOptions:{apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};let i={file:e},s=await this.request({path:tb("upload/v1beta/files",i._url),body:JSON.stringify(i),httpMethod:"POST",httpOptions:r});if(!s||!(null==s?void 0:s.headers))throw Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let o=null==(n=null==s?void 0:s.headers)?void 0:n["x-goog-upload-url"];if(void 0===o)throw Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return o}}async function n0(e){var t;if(void 0===e)throw new nX("response is undefined");if(!e.ok){let n,r=e.status,i=e.statusText;n=(null==(t=e.headers.get("content-type"))?void 0:t.includes("application/json"))?await e.json():{error:{message:await e.text(),code:e.status,status:e.statusText}};let s=`got status: ${r} ${i}. ${JSON.stringify(n)}`;if(r>=400&&r<500)throw new nZ(s);if(r>=500&&r<600)throw new nX(s);throw Error(s)}}function n1(e){for(let t of e)if(n4(t)||"object"==typeof t&&"inputSchema"in t)return!0;return!1}function n2(e){var t;let n=null!=(t=e[nz])?t:"";e[nz]=(n+" mcp_used/unknown").trimStart()}function n4(e){return null!==e&&"object"==typeof e&&e instanceof n5}class n5{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new n5(e,t)}async initialize(){var e,t,n,r;if(this.mcpTools.length>0)return;let i={},s=[];for(let u of this.mcpClients)try{for(var o,a=!0,l=(t=void 0,n_(function(e,t=100){return ny(this,arguments,function*(){let n,r=0;for(;r<t;){let t=yield ng(e.listTools({cursor:n}));for(let e of t.tools)yield yield ng(e),r++;if(!t.nextCursor)break;n=t.nextCursor}})}(u)));!(e=(o=await l.next()).done);a=!0){r=o.value,a=!1,s.push(r);let e=r.name;if(i[e])throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);i[e]=u}}catch(e){t={error:e}}finally{try{!a&&!e&&(n=l.return)&&await n.call(l)}finally{if(t)throw t.error}}this.mcpTools=s,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),function(e,t={}){let n=[],r=new Set;for(let i of e){let e=i.name;if(r.has(e))throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);r.add(e);let s=function(e,t={}){let n={name:e.name,description:e.description,parameters:t3(function e(t){let n=new Set(["items"]),r=new Set(["anyOf"]),i=new Set(["properties"]),s={};for(let[o,a]of Object.entries(t))if(n.has(o))s[o]=e(a);else if(r.has(o))s[o]=function(t){let n=[];for(let r of t)n.push(e(r));return n}(a);else if(i.has(o))s[o]=function(t){let n={};for(let[r,i]of Object.entries(t))n[r]=e(i);return n}(a);else if("type"===o){let e=a.toUpperCase();s[o]=Object.values(e$).includes(e)?e:e$.TYPE_UNSPECIFIED}else t4.has(o)&&(s[o]=a);return s}(e.inputSchema))};return t.behavior&&(n.behavior=t.behavior),{functionDeclarations:[n]}}(i,t);s.functionDeclarations&&n.push(...s.functionDeclarations)}return{functionDeclarations:n}}(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let e,r=this.functionNameToMcpClient[n.name];this.config.timeout&&(e={timeout:this.config.timeout});let i=await r.callTool({name:n.name,arguments:n.args},void 0,e);t.push({functionResponse:{name:n.name,response:i.isError?{error:i}:i}})}return t}}async function n6(e,t,n){let r,i=new tV;Object.assign(i,function(e,t){let n={};null!=tS(t,["setupComplete"])&&tA(n,["setupComplete"],{});let r=tS(t,["serverContent"]);null!=r&&tA(n,["serverContent"],function(e,t){let n={},r=tS(t,["audioChunks"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["data"]);null!=r&&tA(n,["data"],r);let i=tS(t,["mimeType"]);null!=i&&tA(n,["mimeType"],i);let s=tS(t,["sourceMetadata"]);return null!=s&&tA(n,["sourceMetadata"],function(e,t){let n={},r=tS(t,["clientContent"]);null!=r&&tA(n,["clientContent"],function(e,t){let n={},r=tS(t,["weightedPrompts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["text"]);null!=r&&tA(n,["text"],r);let i=tS(t,["weight"]);return null!=i&&tA(n,["weight"],i),n})(0,e))),tA(n,["weightedPrompts"],e)}return n}(0,r));let i=tS(t,["musicGenerationConfig"]);return null!=i&&tA(n,["musicGenerationConfig"],function(e,t){let n={},r=tS(t,["temperature"]);null!=r&&tA(n,["temperature"],r);let i=tS(t,["topK"]);null!=i&&tA(n,["topK"],i);let s=tS(t,["seed"]);null!=s&&tA(n,["seed"],s);let o=tS(t,["guidance"]);null!=o&&tA(n,["guidance"],o);let a=tS(t,["bpm"]);null!=a&&tA(n,["bpm"],a);let l=tS(t,["density"]);null!=l&&tA(n,["density"],l);let u=tS(t,["brightness"]);null!=u&&tA(n,["brightness"],u);let c=tS(t,["scale"]);null!=c&&tA(n,["scale"],c);let d=tS(t,["muteBass"]);null!=d&&tA(n,["muteBass"],d);let h=tS(t,["muteDrums"]);null!=h&&tA(n,["muteDrums"],h);let p=tS(t,["onlyBassAndDrums"]);return null!=p&&tA(n,["onlyBassAndDrums"],p),n}(0,i)),n}(e,s)),n})(e,t))),tA(n,["audioChunks"],t)}return n}(e,r));let i=tS(t,["filteredPrompt"]);return null!=i&&tA(n,["filteredPrompt"],function(e,t){let n={},r=tS(t,["text"]);null!=r&&tA(n,["text"],r);let i=tS(t,["filteredReason"]);return null!=i&&tA(n,["filteredReason"],i),n}(0,i)),n}(e,n.data instanceof Blob?JSON.parse(await n.data.text()):JSON.parse(n.data))),t(i)}class n3{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let r=this.apiClient.getWebsocketBaseUrl(),i=this.apiClient.getApiVersion(),s=function(e){let t=new Headers;for(let[n,r]of Object.entries(e))t.append(n,r);return t}(this.apiClient.getDefaultHeaders()),o=this.apiClient.getApiKey(),a=`${r}/ws/google.ai.generativelanguage.${i}.GenerativeService.BidiGenerateMusic?key=${o}`,l=()=>{},u=new Promise(e=>{l=e}),c=e.callbacks,d=this.apiClient,h={onopen:function(){l({})},onmessage:e=>{n6(d,c.onmessage,e)},onerror:null!=(t=null==c?void 0:c.onerror)?t:function(e){},onclose:null!=(n=null==c?void 0:c.onclose)?n:function(e){}},p=this.webSocketFactory.create(a,function(e){let t={};return e.forEach((e,n)=>{t[n]=e}),t}(s),h);p.connect(),await u;let f=tH(this.apiClient,e.model),m=nk(this.apiClient,{model:f}),g=nI(this.apiClient,{setup:m});return p.send(JSON.stringify(g)),new n8(p,this.apiClient)}}class n8{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||0===Object.keys(e.weightedPrompts).length)throw Error("Weighted prompts must be set and contain at least one entry.");let t=function(e,t){let n={},r=tS(t,["weightedPrompts"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>nw(e,t))),tA(n,["weightedPrompts"],t)}return n}(this.apiClient,e),n=nx(this.apiClient,t);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=function(e,t){let n={},r=tS(t,["musicGenerationConfig"]);return null!=r&&tA(n,["musicGenerationConfig"],nO(e,r)),n}(this.apiClient,e),n=nI(this.apiClient,t);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){let t=nI(this.apiClient,{playbackControl:e});this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(tm.PLAY)}pause(){this.sendPlaybackControl(tm.PAUSE)}stop(){this.sendPlaybackControl(tm.STOP)}resetContext(){this.sendPlaybackControl(tm.RESET_CONTEXT)}close(){this.conn.close()}}async function n9(e,t,n){let r,i=new t$;r=n.data instanceof Blob?JSON.parse(await n.data.text()):JSON.parse(n.data),e.isVertexAI()?Object.assign(i,function(e,t){let n={};null!=tS(t,["setupComplete"])&&tA(n,["setupComplete"],{});let r=tS(t,["serverContent"]);null!=r&&tA(n,["serverContent"],function(e,t){let n={},r=tS(t,["modelTurn"]);null!=r&&tA(n,["modelTurn"],function(e,t){let n={},r=tS(t,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["videoMetadata"]);null!=r&&tA(n,["videoMetadata"],function(e,t){let n={},r=tS(t,["fps"]);null!=r&&tA(n,["fps"],r);let i=tS(t,["endOffset"]);null!=i&&tA(n,["endOffset"],i);let s=tS(t,["startOffset"]);return null!=s&&tA(n,["startOffset"],s),n}(0,r));let i=tS(t,["thought"]);null!=i&&tA(n,["thought"],i);let s=tS(t,["inlineData"]);null!=s&&tA(n,["inlineData"],function(e,t){let n={},r=tS(t,["displayName"]);null!=r&&tA(n,["displayName"],r);let i=tS(t,["data"]);null!=i&&tA(n,["data"],i);let s=tS(t,["mimeType"]);return null!=s&&tA(n,["mimeType"],s),n}(0,s));let o=tS(t,["fileData"]);null!=o&&tA(n,["fileData"],function(e,t){let n={},r=tS(t,["displayName"]);null!=r&&tA(n,["displayName"],r);let i=tS(t,["fileUri"]);null!=i&&tA(n,["fileUri"],i);let s=tS(t,["mimeType"]);return null!=s&&tA(n,["mimeType"],s),n}(0,o));let a=tS(t,["thoughtSignature"]);null!=a&&tA(n,["thoughtSignature"],a);let l=tS(t,["codeExecutionResult"]);null!=l&&tA(n,["codeExecutionResult"],l);let u=tS(t,["executableCode"]);null!=u&&tA(n,["executableCode"],u);let c=tS(t,["functionCall"]);null!=c&&tA(n,["functionCall"],c);let d=tS(t,["functionResponse"]);null!=d&&tA(n,["functionResponse"],d);let h=tS(t,["text"]);return null!=h&&tA(n,["text"],h),n})(0,e))),tA(n,["parts"],e)}let i=tS(t,["role"]);return null!=i&&tA(n,["role"],i),n}(e,r));let i=tS(t,["turnComplete"]);null!=i&&tA(n,["turnComplete"],i);let s=tS(t,["interrupted"]);null!=s&&tA(n,["interrupted"],s);let o=tS(t,["groundingMetadata"]);null!=o&&tA(n,["groundingMetadata"],o);let a=tS(t,["generationComplete"]);null!=a&&tA(n,["generationComplete"],a);let l=tS(t,["inputTranscription"]);null!=l&&tA(n,["inputTranscription"],nR(e,l));let u=tS(t,["outputTranscription"]);return null!=u&&tA(n,["outputTranscription"],nR(e,u)),n}(e,r));let i=tS(t,["toolCall"]);null!=i&&tA(n,["toolCall"],function(e,t){let n={},r=tS(t,["functionCalls"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["args"]);null!=r&&tA(n,["args"],r);let i=tS(t,["name"]);return null!=i&&tA(n,["name"],i),n})(0,e))),tA(n,["functionCalls"],e)}return n}(0,i));let s=tS(t,["toolCallCancellation"]);null!=s&&tA(n,["toolCallCancellation"],function(e,t){let n={},r=tS(t,["ids"]);return null!=r&&tA(n,["ids"],r),n}(0,s));let o=tS(t,["usageMetadata"]);null!=o&&tA(n,["usageMetadata"],function(e,t){let n={},r=tS(t,["promptTokenCount"]);null!=r&&tA(n,["promptTokenCount"],r);let i=tS(t,["cachedContentTokenCount"]);null!=i&&tA(n,["cachedContentTokenCount"],i);let s=tS(t,["candidatesTokenCount"]);null!=s&&tA(n,["responseTokenCount"],s);let o=tS(t,["toolUsePromptTokenCount"]);null!=o&&tA(n,["toolUsePromptTokenCount"],o);let a=tS(t,["thoughtsTokenCount"]);null!=a&&tA(n,["thoughtsTokenCount"],a);let l=tS(t,["totalTokenCount"]);null!=l&&tA(n,["totalTokenCount"],l);let u=tS(t,["promptTokensDetails"]);if(null!=u){let t=u;Array.isArray(t)&&(t=t.map(t=>nD(e,t))),tA(n,["promptTokensDetails"],t)}let c=tS(t,["cacheTokensDetails"]);if(null!=c){let t=c;Array.isArray(t)&&(t=t.map(t=>nD(e,t))),tA(n,["cacheTokensDetails"],t)}let d=tS(t,["candidatesTokensDetails"]);if(null!=d){let t=d;Array.isArray(t)&&(t=t.map(t=>nD(e,t))),tA(n,["responseTokensDetails"],t)}let h=tS(t,["toolUsePromptTokensDetails"]);if(null!=h){let t=h;Array.isArray(t)&&(t=t.map(t=>nD(e,t))),tA(n,["toolUsePromptTokensDetails"],t)}let p=tS(t,["trafficType"]);return null!=p&&tA(n,["trafficType"],p),n}(e,o));let a=tS(t,["goAway"]);null!=a&&tA(n,["goAway"],function(e,t){let n={},r=tS(t,["timeLeft"]);return null!=r&&tA(n,["timeLeft"],r),n}(0,a));let l=tS(t,["sessionResumptionUpdate"]);return null!=l&&tA(n,["sessionResumptionUpdate"],function(e,t){let n={},r=tS(t,["newHandle"]);null!=r&&tA(n,["newHandle"],r);let i=tS(t,["resumable"]);null!=i&&tA(n,["resumable"],i);let s=tS(t,["lastConsumedClientMessageIndex"]);return null!=s&&tA(n,["lastConsumedClientMessageIndex"],s),n}(0,l)),n}(e,r)):Object.assign(i,function(e,t){let n={};null!=tS(t,["setupComplete"])&&tA(n,["setupComplete"],{});let r=tS(t,["serverContent"]);null!=r&&tA(n,["serverContent"],function(e,t){let n={},r=tS(t,["modelTurn"]);null!=r&&tA(n,["modelTurn"],function(e,t){let n={},r=tS(t,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["videoMetadata"]);null!=r&&tA(n,["videoMetadata"],function(e,t){let n={},r=tS(t,["fps"]);null!=r&&tA(n,["fps"],r);let i=tS(t,["endOffset"]);null!=i&&tA(n,["endOffset"],i);let s=tS(t,["startOffset"]);return null!=s&&tA(n,["startOffset"],s),n}(0,r));let i=tS(t,["thought"]);null!=i&&tA(n,["thought"],i);let s=tS(t,["inlineData"]);null!=s&&tA(n,["inlineData"],function(e,t){let n={},r=tS(t,["data"]);null!=r&&tA(n,["data"],r);let i=tS(t,["mimeType"]);return null!=i&&tA(n,["mimeType"],i),n}(0,s));let o=tS(t,["fileData"]);null!=o&&tA(n,["fileData"],function(e,t){let n={},r=tS(t,["fileUri"]);null!=r&&tA(n,["fileUri"],r);let i=tS(t,["mimeType"]);return null!=i&&tA(n,["mimeType"],i),n}(0,o));let a=tS(t,["thoughtSignature"]);null!=a&&tA(n,["thoughtSignature"],a);let l=tS(t,["codeExecutionResult"]);null!=l&&tA(n,["codeExecutionResult"],l);let u=tS(t,["executableCode"]);null!=u&&tA(n,["executableCode"],u);let c=tS(t,["functionCall"]);null!=c&&tA(n,["functionCall"],c);let d=tS(t,["functionResponse"]);null!=d&&tA(n,["functionResponse"],d);let h=tS(t,["text"]);return null!=h&&tA(n,["text"],h),n})(0,e))),tA(n,["parts"],e)}let i=tS(t,["role"]);return null!=i&&tA(n,["role"],i),n}(e,r));let i=tS(t,["turnComplete"]);null!=i&&tA(n,["turnComplete"],i);let s=tS(t,["interrupted"]);null!=s&&tA(n,["interrupted"],s);let o=tS(t,["groundingMetadata"]);null!=o&&tA(n,["groundingMetadata"],o);let a=tS(t,["generationComplete"]);null!=a&&tA(n,["generationComplete"],a);let l=tS(t,["inputTranscription"]);null!=l&&tA(n,["inputTranscription"],nN(e,l));let u=tS(t,["outputTranscription"]);null!=u&&tA(n,["outputTranscription"],nN(e,u));let c=tS(t,["urlContextMetadata"]);return null!=c&&tA(n,["urlContextMetadata"],function(e,t){let n={},r=tS(t,["urlMetadata"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["retrievedUrl"]);null!=r&&tA(n,["retrievedUrl"],r);let i=tS(t,["urlRetrievalStatus"]);return null!=i&&tA(n,["urlRetrievalStatus"],i),n})(0,e))),tA(n,["urlMetadata"],e)}return n}(0,c)),n}(e,r));let i=tS(t,["toolCall"]);null!=i&&tA(n,["toolCall"],function(e,t){let n={},r=tS(t,["functionCalls"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["id"]);null!=r&&tA(n,["id"],r);let i=tS(t,["args"]);null!=i&&tA(n,["args"],i);let s=tS(t,["name"]);return null!=s&&tA(n,["name"],s),n})(0,e))),tA(n,["functionCalls"],e)}return n}(0,i));let s=tS(t,["toolCallCancellation"]);null!=s&&tA(n,["toolCallCancellation"],function(e,t){let n={},r=tS(t,["ids"]);return null!=r&&tA(n,["ids"],r),n}(0,s));let o=tS(t,["usageMetadata"]);null!=o&&tA(n,["usageMetadata"],function(e,t){let n={},r=tS(t,["promptTokenCount"]);null!=r&&tA(n,["promptTokenCount"],r);let i=tS(t,["cachedContentTokenCount"]);null!=i&&tA(n,["cachedContentTokenCount"],i);let s=tS(t,["responseTokenCount"]);null!=s&&tA(n,["responseTokenCount"],s);let o=tS(t,["toolUsePromptTokenCount"]);null!=o&&tA(n,["toolUsePromptTokenCount"],o);let a=tS(t,["thoughtsTokenCount"]);null!=a&&tA(n,["thoughtsTokenCount"],a);let l=tS(t,["totalTokenCount"]);null!=l&&tA(n,["totalTokenCount"],l);let u=tS(t,["promptTokensDetails"]);if(null!=u){let t=u;Array.isArray(t)&&(t=t.map(t=>nP(e,t))),tA(n,["promptTokensDetails"],t)}let c=tS(t,["cacheTokensDetails"]);if(null!=c){let t=c;Array.isArray(t)&&(t=t.map(t=>nP(e,t))),tA(n,["cacheTokensDetails"],t)}let d=tS(t,["responseTokensDetails"]);if(null!=d){let t=d;Array.isArray(t)&&(t=t.map(t=>nP(e,t))),tA(n,["responseTokensDetails"],t)}let h=tS(t,["toolUsePromptTokensDetails"]);if(null!=h){let t=h;Array.isArray(t)&&(t=t.map(t=>nP(e,t))),tA(n,["toolUsePromptTokensDetails"],t)}return n}(e,o));let a=tS(t,["goAway"]);null!=a&&tA(n,["goAway"],function(e,t){let n={},r=tS(t,["timeLeft"]);return null!=r&&tA(n,["timeLeft"],r),n}(0,a));let l=tS(t,["sessionResumptionUpdate"]);return null!=l&&tA(n,["sessionResumptionUpdate"],function(e,t){let n={},r=tS(t,["newHandle"]);null!=r&&tA(n,["newHandle"],r);let i=tS(t,["resumable"]);null!=i&&tA(n,["resumable"],i);let s=tS(t,["lastConsumedClientMessageIndex"]);return null!=s&&tA(n,["lastConsumedClientMessageIndex"],s),n}(0,l)),n}(e,r)),t(i)}class n7{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new n3(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,r,i,s,o;let a,l=this.apiClient.getWebsocketBaseUrl(),u=this.apiClient.getApiVersion(),c=this.apiClient.getDefaultHeaders();e.config&&e.config.tools&&n1(e.config.tools)&&n2(c);let d=function(e){let t=new Headers;for(let[n,r]of Object.entries(e))t.append(n,r);return t}(c);if(this.apiClient.isVertexAI())a=`${l}/ws/google.cloud.aiplatform.${u}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(d);else{let e=this.apiClient.getApiKey(),t="BidiGenerateContent",n="key";(null==e?void 0:e.startsWith("auth_tokens/"))&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),t="BidiGenerateContentConstrained",n="access_token"),a=`${l}/ws/google.ai.generativelanguage.${u}.GenerativeService.${t}?${n}=${e}`}let h=()=>{},p=new Promise(e=>{h=e}),f=e.callbacks,m=this.apiClient,g={onopen:function(){var e;null==(e=null==f?void 0:f.onopen)||e.call(f),h({})},onmessage:e=>{n9(m,f.onmessage,e)},onerror:null!=(t=null==f?void 0:f.onerror)?t:function(e){},onclose:null!=(n=null==f?void 0:f.onclose)?n:function(e){}},y=this.webSocketFactory.create(a,function(e){let t={};return e.forEach((e,n)=>{t[n]=e}),t}(d),g);y.connect(),await p;let _=tH(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&_.startsWith("publishers/")){let e=this.apiClient.getProject(),t=this.apiClient.getLocation();_=`projects/${e}/locations/${t}/`+_}let v={};this.apiClient.isVertexAI()&&(null==(r=e.config)?void 0:r.responseModalities)===void 0&&(void 0===e.config?e.config={responseModalities:[e0.AUDIO]}:e.config.responseModalities=[e0.AUDIO]),(null==(i=e.config)?void 0:i.generationConfig)&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let E=null!=(o=null==(s=e.config)?void 0:s.tools)?o:[],T=[];for(let e of E)this.isCallableTool(e)?T.push(await e.tool()):T.push(e);T.length>0&&(e.config.tools=T);let C={model:_,config:e.config,callbacks:e.callbacks};return v=this.apiClient.isVertexAI()?function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["setup","model"],tH(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],function(e,t,n){let r=tS(t,["generationConfig"]);void 0!==n&&null!=r&&tA(n,["setup","generationConfig"],r);let i=tS(t,["responseModalities"]);void 0!==n&&null!=i&&tA(n,["setup","generationConfig","responseModalities"],i);let s=tS(t,["temperature"]);void 0!==n&&null!=s&&tA(n,["setup","generationConfig","temperature"],s);let o=tS(t,["topP"]);void 0!==n&&null!=o&&tA(n,["setup","generationConfig","topP"],o);let a=tS(t,["topK"]);void 0!==n&&null!=a&&tA(n,["setup","generationConfig","topK"],a);let l=tS(t,["maxOutputTokens"]);void 0!==n&&null!=l&&tA(n,["setup","generationConfig","maxOutputTokens"],l);let u=tS(t,["mediaResolution"]);void 0!==n&&null!=u&&tA(n,["setup","generationConfig","mediaResolution"],u);let c=tS(t,["seed"]);void 0!==n&&null!=c&&tA(n,["setup","generationConfig","seed"],c);let d=tS(t,["speechConfig"]);void 0!==n&&null!=d&&tA(n,["setup","generationConfig","speechConfig"],function(e,t){let n={},r=tS(t,["voiceConfig"]);if(null!=r&&tA(n,["voiceConfig"],function(e,t){let n={},r=tS(t,["prebuiltVoiceConfig"]);return null!=r&&tA(n,["prebuiltVoiceConfig"],function(e,t){let n={},r=tS(t,["voiceName"]);return null!=r&&tA(n,["voiceName"],r),n}(0,r)),n}(0,r)),void 0!==tS(t,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");let i=tS(t,["languageCode"]);return null!=i&&tA(n,["languageCode"],i),n}(e,t7(e,d)));let h=tS(t,["enableAffectiveDialog"]);void 0!==n&&null!=h&&tA(n,["setup","generationConfig","enableAffectiveDialog"],h);let p=tS(t,["systemInstruction"]);void 0!==n&&null!=p&&tA(n,["setup","systemInstruction"],function(e,t){let n={},r=tS(t,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["videoMetadata"]);null!=r&&tA(n,["videoMetadata"],function(e,t){let n={},r=tS(t,["fps"]);null!=r&&tA(n,["fps"],r);let i=tS(t,["endOffset"]);null!=i&&tA(n,["endOffset"],i);let s=tS(t,["startOffset"]);return null!=s&&tA(n,["startOffset"],s),n}(0,r));let i=tS(t,["thought"]);null!=i&&tA(n,["thought"],i);let s=tS(t,["inlineData"]);null!=s&&tA(n,["inlineData"],function(e,t){let n={},r=tS(t,["displayName"]);null!=r&&tA(n,["displayName"],r);let i=tS(t,["data"]);null!=i&&tA(n,["data"],i);let s=tS(t,["mimeType"]);return null!=s&&tA(n,["mimeType"],s),n}(0,s));let o=tS(t,["fileData"]);null!=o&&tA(n,["fileData"],function(e,t){let n={},r=tS(t,["displayName"]);null!=r&&tA(n,["displayName"],r);let i=tS(t,["fileUri"]);null!=i&&tA(n,["fileUri"],i);let s=tS(t,["mimeType"]);return null!=s&&tA(n,["mimeType"],s),n}(0,o));let a=tS(t,["thoughtSignature"]);null!=a&&tA(n,["thoughtSignature"],a);let l=tS(t,["codeExecutionResult"]);null!=l&&tA(n,["codeExecutionResult"],l);let u=tS(t,["executableCode"]);null!=u&&tA(n,["executableCode"],u);let c=tS(t,["functionCall"]);null!=c&&tA(n,["functionCall"],c);let d=tS(t,["functionResponse"]);null!=d&&tA(n,["functionResponse"],d);let h=tS(t,["text"]);return null!=h&&tA(n,["text"],h),n})(0,e))),tA(n,["parts"],e)}let i=tS(t,["role"]);return null!=i&&tA(n,["role"],i),n}(e,t0(e,p)));let f=tS(t,["tools"]);if(void 0!==n&&null!=f){let t=nt(e,f);Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={};if(void 0!==tS(t,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let r=tS(t,["description"]);null!=r&&tA(n,["description"],r);let i=tS(t,["name"]);null!=i&&tA(n,["name"],i);let s=tS(t,["parameters"]);null!=s&&tA(n,["parameters"],s);let o=tS(t,["response"]);return null!=o&&tA(n,["response"],o),n})(0,e))),tA(n,["functionDeclarations"],e)}let i=tS(t,["retrieval"]);null!=i&&tA(n,["retrieval"],i);let s=tS(t,["googleSearch"]);null!=s&&tA(n,["googleSearch"],function(e,t){let n={},r=tS(t,["timeRangeFilter"]);return null!=r&&tA(n,["timeRangeFilter"],function(e,t){let n={},r=tS(t,["startTime"]);null!=r&&tA(n,["startTime"],r);let i=tS(t,["endTime"]);return null!=i&&tA(n,["endTime"],i),n}(0,r)),n}(0,s));let o=tS(t,["googleSearchRetrieval"]);null!=o&&tA(n,["googleSearchRetrieval"],function(e,t){let n={},r=tS(t,["dynamicRetrievalConfig"]);return null!=r&&tA(n,["dynamicRetrievalConfig"],function(e,t){let n={},r=tS(t,["mode"]);null!=r&&tA(n,["mode"],r);let i=tS(t,["dynamicThreshold"]);return null!=i&&tA(n,["dynamicThreshold"],i),n}(0,r)),n}(0,o)),null!=tS(t,["enterpriseWebSearch"])&&tA(n,["enterpriseWebSearch"],{});let a=tS(t,["googleMaps"]);null!=a&&tA(n,["googleMaps"],function(e,t){let n={},r=tS(t,["authConfig"]);return null!=r&&tA(n,["authConfig"],function(e,t){let n={},r=tS(t,["apiKeyConfig"]);null!=r&&tA(n,["apiKeyConfig"],function(e,t){let n={},r=tS(t,["apiKeyString"]);return null!=r&&tA(n,["apiKeyString"],r),n}(0,r));let i=tS(t,["authType"]);null!=i&&tA(n,["authType"],i);let s=tS(t,["googleServiceAccountConfig"]);null!=s&&tA(n,["googleServiceAccountConfig"],s);let o=tS(t,["httpBasicAuthConfig"]);null!=o&&tA(n,["httpBasicAuthConfig"],o);let a=tS(t,["oauthConfig"]);null!=a&&tA(n,["oauthConfig"],a);let l=tS(t,["oidcConfig"]);return null!=l&&tA(n,["oidcConfig"],l),n}(0,r)),n}(e,a)),null!=tS(t,["urlContext"])&&tA(n,["urlContext"],{});let l=tS(t,["codeExecution"]);return null!=l&&tA(n,["codeExecution"],l),n})(e,ne(e,t)))),tA(n,["setup","tools"],t)}let m=tS(t,["sessionResumption"]);void 0!==n&&null!=m&&tA(n,["setup","sessionResumption"],function(e,t){let n={},r=tS(t,["handle"]);null!=r&&tA(n,["handle"],r);let i=tS(t,["transparent"]);return null!=i&&tA(n,["transparent"],i),n}(0,m));let g=tS(t,["inputAudioTranscription"]);void 0!==n&&null!=g&&tA(n,["setup","inputAudioTranscription"],{});let y=tS(t,["outputAudioTranscription"]);void 0!==n&&null!=y&&tA(n,["setup","outputAudioTranscription"],{});let _=tS(t,["realtimeInputConfig"]);void 0!==n&&null!=_&&tA(n,["setup","realtimeInputConfig"],function(e,t){let n={},r=tS(t,["automaticActivityDetection"]);null!=r&&tA(n,["automaticActivityDetection"],function(e,t){let n={},r=tS(t,["disabled"]);null!=r&&tA(n,["disabled"],r);let i=tS(t,["startOfSpeechSensitivity"]);null!=i&&tA(n,["startOfSpeechSensitivity"],i);let s=tS(t,["endOfSpeechSensitivity"]);null!=s&&tA(n,["endOfSpeechSensitivity"],s);let o=tS(t,["prefixPaddingMs"]);null!=o&&tA(n,["prefixPaddingMs"],o);let a=tS(t,["silenceDurationMs"]);return null!=a&&tA(n,["silenceDurationMs"],a),n}(0,r));let i=tS(t,["activityHandling"]);null!=i&&tA(n,["activityHandling"],i);let s=tS(t,["turnCoverage"]);return null!=s&&tA(n,["turnCoverage"],s),n}(0,_));let v=tS(t,["contextWindowCompression"]);void 0!==n&&null!=v&&tA(n,["setup","contextWindowCompression"],function(e,t){let n={},r=tS(t,["triggerTokens"]);null!=r&&tA(n,["triggerTokens"],r);let i=tS(t,["slidingWindow"]);return null!=i&&tA(n,["slidingWindow"],function(e,t){let n={},r=tS(t,["targetTokens"]);return null!=r&&tA(n,["targetTokens"],r),n}(0,i)),n}(0,v));let E=tS(t,["proactivity"]);return void 0!==n&&null!=E&&tA(n,["setup","proactivity"],function(e,t){let n={},r=tS(t,["proactiveAudio"]);return null!=r&&tA(n,["proactiveAudio"],r),n}(0,E)),{}}(e,i,n)),n}(this.apiClient,C):function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["setup","model"],tH(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],function(e,t,n){let r=tS(t,["generationConfig"]);void 0!==n&&null!=r&&tA(n,["setup","generationConfig"],r);let i=tS(t,["responseModalities"]);void 0!==n&&null!=i&&tA(n,["setup","generationConfig","responseModalities"],i);let s=tS(t,["temperature"]);void 0!==n&&null!=s&&tA(n,["setup","generationConfig","temperature"],s);let o=tS(t,["topP"]);void 0!==n&&null!=o&&tA(n,["setup","generationConfig","topP"],o);let a=tS(t,["topK"]);void 0!==n&&null!=a&&tA(n,["setup","generationConfig","topK"],a);let l=tS(t,["maxOutputTokens"]);void 0!==n&&null!=l&&tA(n,["setup","generationConfig","maxOutputTokens"],l);let u=tS(t,["mediaResolution"]);void 0!==n&&null!=u&&tA(n,["setup","generationConfig","mediaResolution"],u);let c=tS(t,["seed"]);void 0!==n&&null!=c&&tA(n,["setup","generationConfig","seed"],c);let d=tS(t,["speechConfig"]);void 0!==n&&null!=d&&tA(n,["setup","generationConfig","speechConfig"],function(e,t){let n={},r=tS(t,["voiceConfig"]);null!=r&&tA(n,["voiceConfig"],nS(e,r));let i=tS(t,["multiSpeakerVoiceConfig"]);null!=i&&tA(n,["multiSpeakerVoiceConfig"],function(e,t){let n={},r=tS(t,["speakerVoiceConfigs"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["speaker"]);null!=r&&tA(n,["speaker"],r);let i=tS(t,["voiceConfig"]);return null!=i&&tA(n,["voiceConfig"],nS(e,i)),n})(e,t))),tA(n,["speakerVoiceConfigs"],t)}return n}(e,i));let s=tS(t,["languageCode"]);return null!=s&&tA(n,["languageCode"],s),n}(e,t7(e,d)));let h=tS(t,["enableAffectiveDialog"]);void 0!==n&&null!=h&&tA(n,["setup","generationConfig","enableAffectiveDialog"],h);let p=tS(t,["systemInstruction"]);void 0!==n&&null!=p&&tA(n,["setup","systemInstruction"],function(e,t){let n={},r=tS(t,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["videoMetadata"]);null!=r&&tA(n,["videoMetadata"],function(e,t){let n={},r=tS(t,["fps"]);null!=r&&tA(n,["fps"],r);let i=tS(t,["endOffset"]);null!=i&&tA(n,["endOffset"],i);let s=tS(t,["startOffset"]);return null!=s&&tA(n,["startOffset"],s),n}(0,r));let i=tS(t,["thought"]);null!=i&&tA(n,["thought"],i);let s=tS(t,["inlineData"]);null!=s&&tA(n,["inlineData"],function(e,t){let n={};if(void 0!==tS(t,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=tS(t,["data"]);null!=r&&tA(n,["data"],r);let i=tS(t,["mimeType"]);return null!=i&&tA(n,["mimeType"],i),n}(0,s));let o=tS(t,["fileData"]);null!=o&&tA(n,["fileData"],function(e,t){let n={};if(void 0!==tS(t,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=tS(t,["fileUri"]);null!=r&&tA(n,["fileUri"],r);let i=tS(t,["mimeType"]);return null!=i&&tA(n,["mimeType"],i),n}(0,o));let a=tS(t,["thoughtSignature"]);null!=a&&tA(n,["thoughtSignature"],a);let l=tS(t,["codeExecutionResult"]);null!=l&&tA(n,["codeExecutionResult"],l);let u=tS(t,["executableCode"]);null!=u&&tA(n,["executableCode"],u);let c=tS(t,["functionCall"]);null!=c&&tA(n,["functionCall"],c);let d=tS(t,["functionResponse"]);null!=d&&tA(n,["functionResponse"],d);let h=tS(t,["text"]);return null!=h&&tA(n,["text"],h),n})(0,e))),tA(n,["parts"],e)}let i=tS(t,["role"]);return null!=i&&tA(n,["role"],i),n}(e,t0(e,p)));let f=tS(t,["tools"]);if(void 0!==n&&null!=f){let t=nt(e,f);Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["behavior"]);null!=r&&tA(n,["behavior"],r);let i=tS(t,["description"]);null!=i&&tA(n,["description"],i);let s=tS(t,["name"]);null!=s&&tA(n,["name"],s);let o=tS(t,["parameters"]);null!=o&&tA(n,["parameters"],o);let a=tS(t,["response"]);return null!=a&&tA(n,["response"],a),n})(0,e))),tA(n,["functionDeclarations"],e)}if(void 0!==tS(t,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=tS(t,["googleSearch"]);null!=i&&tA(n,["googleSearch"],function(e,t){let n={},r=tS(t,["timeRangeFilter"]);return null!=r&&tA(n,["timeRangeFilter"],function(e,t){let n={},r=tS(t,["startTime"]);null!=r&&tA(n,["startTime"],r);let i=tS(t,["endTime"]);return null!=i&&tA(n,["endTime"],i),n}(0,r)),n}(0,i));let s=tS(t,["googleSearchRetrieval"]);if(null!=s&&tA(n,["googleSearchRetrieval"],function(e,t){let n={},r=tS(t,["dynamicRetrievalConfig"]);return null!=r&&tA(n,["dynamicRetrievalConfig"],function(e,t){let n={},r=tS(t,["mode"]);null!=r&&tA(n,["mode"],r);let i=tS(t,["dynamicThreshold"]);return null!=i&&tA(n,["dynamicThreshold"],i),n}(0,r)),n}(0,s)),void 0!==tS(t,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(void 0!==tS(t,["googleMaps"]))throw Error("googleMaps parameter is not supported in Gemini API.");null!=tS(t,["urlContext"])&&tA(n,["urlContext"],{});let o=tS(t,["codeExecution"]);return null!=o&&tA(n,["codeExecution"],o),n})(e,ne(e,t)))),tA(n,["setup","tools"],t)}let m=tS(t,["sessionResumption"]);void 0!==n&&null!=m&&tA(n,["setup","sessionResumption"],function(e,t){let n={},r=tS(t,["handle"]);if(null!=r&&tA(n,["handle"],r),void 0!==tS(t,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return n}(0,m));let g=tS(t,["inputAudioTranscription"]);void 0!==n&&null!=g&&tA(n,["setup","inputAudioTranscription"],{});let y=tS(t,["outputAudioTranscription"]);void 0!==n&&null!=y&&tA(n,["setup","outputAudioTranscription"],{});let _=tS(t,["realtimeInputConfig"]);void 0!==n&&null!=_&&tA(n,["setup","realtimeInputConfig"],function(e,t){let n={},r=tS(t,["automaticActivityDetection"]);null!=r&&tA(n,["automaticActivityDetection"],function(e,t){let n={},r=tS(t,["disabled"]);null!=r&&tA(n,["disabled"],r);let i=tS(t,["startOfSpeechSensitivity"]);null!=i&&tA(n,["startOfSpeechSensitivity"],i);let s=tS(t,["endOfSpeechSensitivity"]);null!=s&&tA(n,["endOfSpeechSensitivity"],s);let o=tS(t,["prefixPaddingMs"]);null!=o&&tA(n,["prefixPaddingMs"],o);let a=tS(t,["silenceDurationMs"]);return null!=a&&tA(n,["silenceDurationMs"],a),n}(0,r));let i=tS(t,["activityHandling"]);null!=i&&tA(n,["activityHandling"],i);let s=tS(t,["turnCoverage"]);return null!=s&&tA(n,["turnCoverage"],s),n}(0,_));let v=tS(t,["contextWindowCompression"]);void 0!==n&&null!=v&&tA(n,["setup","contextWindowCompression"],function(e,t){let n={},r=tS(t,["triggerTokens"]);null!=r&&tA(n,["triggerTokens"],r);let i=tS(t,["slidingWindow"]);return null!=i&&tA(n,["slidingWindow"],function(e,t){let n={},r=tS(t,["targetTokens"]);return null!=r&&tA(n,["targetTokens"],r),n}(0,i)),n}(0,v));let E=tS(t,["proactivity"]);return void 0!==n&&null!=E&&tA(n,["setup","proactivity"],function(e,t){let n={},r=tS(t,["proactiveAudio"]);return null!=r&&tA(n,["proactiveAudio"],r),n}(0,E)),{}}(e,i,n)),n}(this.apiClient,C),delete v.config,y.send(JSON.stringify(v)),new rt(y,this.apiClient)}isCallableTool(e){return"callTool"in e&&"function"==typeof e.callTool}}let re={turnComplete:!0};class rt{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(null!==t.turns&&void 0!==t.turns){let n=[];try{n=t2(e,t.turns),n=e.isVertexAI()?n.map(t=>nL(e,t)):n.map(t=>nM(e,t))}catch(e){throw Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(null==t.functionResponses||0===(n=Array.isArray(t.functionResponses)?t.functionResponses:[t.functionResponses]).length)throw Error("functionResponses is required.");for(let t of n){if("object"!=typeof t||null===t||!("name"in t)||!("response"in t))throw Error(`Could not parse function response, type '${typeof t}'.`);if(!e.isVertexAI()&&!("id"in t))throw Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},re),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};t=this.apiClient.isVertexAI()?{realtimeInput:function(e,t){let n={},r=tS(t,["media"]);if(null!=r&&tA(n,["mediaChunks"],tJ(e,r)),void 0!==tS(t,["audio"]))throw Error("audio parameter is not supported in Vertex AI.");let i=tS(t,["audioStreamEnd"]);if(null!=i&&tA(n,["audioStreamEnd"],i),void 0!==tS(t,["video"]))throw Error("video parameter is not supported in Vertex AI.");if(void 0!==tS(t,["text"]))throw Error("text parameter is not supported in Vertex AI.");return null!=tS(t,["activityStart"])&&tA(n,["activityStart"],{}),null!=tS(t,["activityEnd"])&&tA(n,["activityEnd"],{}),n}(this.apiClient,e)}:{realtimeInput:function(e,t){let n={},r=tS(t,["media"]);null!=r&&tA(n,["mediaChunks"],tJ(e,r));let i=tS(t,["audio"]);null!=i&&tA(n,["audio"],function(e,t){let n=tK(e,t);if(n.mimeType&&n.mimeType.startsWith("audio/"))return n;throw Error(`Unsupported mime type: ${n.mimeType}`)}(e,i));let s=tS(t,["audioStreamEnd"]);null!=s&&tA(n,["audioStreamEnd"],s);let o=tS(t,["video"]);null!=o&&tA(n,["video"],function(e,t){let n=tK(e,t);if(n.mimeType&&n.mimeType.startsWith("image/"))return n;throw Error(`Unsupported mime type: ${n.mimeType}`)}(e,o));let a=tS(t,["text"]);return null!=a&&tA(n,["text"],a),null!=tS(t,["activityStart"])&&tA(n,["activityStart"],{}),null!=tS(t,["activityEnd"])&&tA(n,["activityEnd"],{}),n}(this.apiClient,e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(null==e.functionResponses)throw Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function rn(e){var t,n,r;if(null==(t=null==e?void 0:e.automaticFunctionCalling)?void 0:t.disable)return!0;let i=!1;for(let t of null!=(n=null==e?void 0:e.tools)?n:[])if(rr(t)){i=!0;break}if(!i)return!0;let s=null==(r=null==e?void 0:e.automaticFunctionCalling)?void 0:r.maximumRemoteCalls;return(!(!s||!(s<0)&&Number.isInteger(s))||0==s)&&(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",s),!0)}function rr(e){return"callTool"in e&&"function"==typeof e.callTool}function ri(e){var t;return!(null==(t=null==e?void 0:e.automaticFunctionCalling)?void 0:t.ignoreCallHistory)}class rs extends tC{constructor(e){super(),this.apiClient=e,this.generateContent=async e=>{var t,n,r,i,s;let o,a,l=await this.processParamsForMcpUsage(e);if(!function(e){var t,n,r;return null!=(r=null==(n=null==(t=e.config)?void 0:t.tools)?void 0:n.some(e=>n4(e)))&&r}(e)||rn(e.config))return await this.generateContentInternal(l);if(function(e){var t,n,r;return null!=(r=null==(n=null==(t=e.config)?void 0:t.tools)?void 0:n.some(e=>!n4(e)))&&r}(e))throw Error("Automatic function calling with CallableTools and Tools is not yet supported.");let u=t2(this.apiClient,l.contents),c=null!=(r=null==(n=null==(t=l.config)?void 0:t.automaticFunctionCalling)?void 0:n.maximumRemoteCalls)?r:10,d=0;for(;d<c&&(o=await this.generateContentInternal(l)).functionCalls&&0!==o.functionCalls.length;){let t=o.candidates[0].content,n=[];for(let t of null!=(s=null==(i=e.config)?void 0:i.tools)?s:[])if(rr(t)){let e=await t.callTool(o.functionCalls);n.push(...e)}d++,a={role:"user",parts:n},l.contents=t2(this.apiClient,l.contents),l.contents.push(t),l.contents.push(a),ri(l.config)&&(u.push(t),u.push(a))}return ri(l.config)&&(o.automaticFunctionCallingHistory=u),o},this.generateContentStream=async e=>{if(!rn(e.config))return await this.processAfcStream(e);{let t=await this.processParamsForMcpUsage(e);return await this.generateContentStreamInternal(t)}},this.generateImages=async e=>await this.generateImagesInternal(e).then(e=>{var t;let n,r,i=[];if(null==e?void 0:e.generatedImages)for(let r of e.generatedImages)r&&(null==r?void 0:r.safetyAttributes)&&(null==(t=null==r?void 0:r.safetyAttributes)?void 0:t.contentType)==="Positive Prompt"?n=null==r?void 0:r.safetyAttributes:i.push(r);return n?{generatedImages:i,positivePromptSafetyAttributes:n}:{generatedImages:i}}),this.list=async e=>{var t;let n={config:Object.assign(Object.assign({},{queryBase:!0}),null==e?void 0:e.config)};if(this.apiClient.isVertexAI()&&!n.config.queryBase)if(null==(t=n.config)?void 0:t.filter)throw Error("Filtering tuned models list for Vertex AI is not currently supported");else n.config.filter="labels.tune-type:*";return new nf(tg.PAGED_ITEM_MODELS,e=>this.listInternal(e),await this.listInternal(n),n)},this.editImage=async e=>{let t={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(t.referenceImages=e.referenceImages.map(e=>e.toReferenceImageAPI())),await this.editImageInternal(t)},this.upscaleImage=async e=>{let t={numberOfImages:1,mode:"upscale"};e.config&&(t=Object.assign(Object.assign({},t),e.config));let n={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:t};return await this.upscaleImageInternal(n)}}async processParamsForMcpUsage(e){var t,n,r;let i=null==(t=e.config)?void 0:t.tools;if(!i)return e;let s=await Promise.all(i.map(async e=>rr(e)?await e.tool():e)),o={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:s})};if(o.config.tools=s,e.config&&e.config.tools&&n1(e.config.tools)){let t=Object.assign({},null!=(r=null==(n=e.config.httpOptions)?void 0:n.headers)?r:{});0===Object.keys(t).length&&(t=this.apiClient.getDefaultHeaders()),n2(t),o.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:t})}return o}async initAfcToolsMap(e){var t,n,r;let i=new Map;for(let s of null!=(n=null==(t=e.config)?void 0:t.tools)?n:[])if(rr(s))for(let e of null!=(r=(await s.tool()).functionDeclarations)?r:[]){if(!e.name)throw Error("Function declaration name is required.");if(i.has(e.name))throw Error(`Duplicate tool declaration name: ${e.name}`);i.set(e.name,s)}return i}async processAfcStream(e){var t,n,r;let i=null!=(r=null==(n=null==(t=e.config)?void 0:t.automaticFunctionCalling)?void 0:n.maximumRemoteCalls)?r:10,s=!1,o=0;return function(e,t,n){var r,a;return ny(this,arguments,function*(){for(var l,u,c,d;o<i;){s&&(o++,s=!1);let m=yield ng(e.processParamsForMcpUsage(n)),g=yield ng(e.generateContentStreamInternal(m)),y=[],_=[];try{for(var h,p=!0,f=(u=void 0,n_(g));!(l=(h=yield ng(f.next())).done);p=!0)if(d=h.value,p=!1,yield yield ng(d),d.candidates&&(null==(r=d.candidates[0])?void 0:r.content)){for(let e of(_.push(d.candidates[0].content),null!=(a=d.candidates[0].content.parts)?a:[]))if(o<i&&e.functionCall){if(!e.functionCall.name)throw Error("Function call name was not returned by the model.");if(t.has(e.functionCall.name)){let n=yield ng(t.get(e.functionCall.name).callTool([e.functionCall]));y.push(...n)}else throw Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${t.keys()}, mising tool: ${e.functionCall.name}`)}}}catch(e){u={error:e}}finally{try{!p&&!l&&(c=f.return)&&(yield ng(c.call(f)))}finally{if(u)throw u.error}}if(y.length>0){s=!0;let t=new tO;t.candidates=[{content:{role:"user",parts:y}}],yield yield ng(t);let r=[];r.push(..._),r.push({role:"user",parts:y});let i=t2(e.apiClient,n.contents).concat(r);n.contents=i}else break}})}(this,await this.initAfcToolsMap(e),e)}async generateContentInternal(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=nG(this.apiClient,e);return o=tb("{model}:generateContent",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=nH(this.apiClient,e),n=new tO;return Object.assign(n,t),n})}{let t=nj(this.apiClient,e);return o=tb("{model}:generateContent",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>{let t=nq(this.apiClient,e),n=new tO;return Object.assign(n,t),n})}}async generateContentStreamInternal(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=nG(this.apiClient,e);o=tb("{model}:streamGenerateContent?alt=sse",r._url),a=r._query,delete r.config,delete r._url,delete r._query;let i=this.apiClient;return i.requestStream({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(function(e){return ny(this,arguments,function*(){var t,n,r,s;try{for(var o,a=!0,l=n_(e);!(t=(o=yield ng(l.next())).done);a=!0){s=o.value,a=!1;let e=nH(i,(yield ng(s.json()))),t=new tO;Object.assign(t,e),yield yield ng(t)}}catch(e){n={error:e}}finally{try{!a&&!t&&(r=l.return)&&(yield ng(r.call(l)))}finally{if(n)throw n.error}}})})}{let t=nj(this.apiClient,e);o=tb("{model}:streamGenerateContent?alt=sse",t._url),a=t._query,delete t.config,delete t._url,delete t._query;let n=this.apiClient;return n.requestStream({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(function(e){return ny(this,arguments,function*(){var t,r,i,s;try{for(var o,a=!0,l=n_(e);!(t=(o=yield ng(l.next())).done);a=!0){s=o.value,a=!1;let e=nq(n,(yield ng(s.json()))),t=new tO;Object.assign(t,e),yield yield ng(t)}}catch(e){r={error:e}}finally{try{!a&&!t&&(i=l.return)&&(yield ng(i.call(l)))}finally{if(r)throw r.error}}})})}}async embedContent(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","model"],tH(e,r));let i=tS(t,["contents"]);null!=i&&tA(n,["instances[]","content"],t1(e,i));let s=tS(t,["config"]);return null!=s&&tA(n,["config"],function(e,t,n){let r=tS(t,["taskType"]);void 0!==n&&null!=r&&tA(n,["instances[]","task_type"],r);let i=tS(t,["title"]);void 0!==n&&null!=i&&tA(n,["instances[]","title"],i);let s=tS(t,["outputDimensionality"]);void 0!==n&&null!=s&&tA(n,["parameters","outputDimensionality"],s);let o=tS(t,["mimeType"]);void 0!==n&&null!=o&&tA(n,["instances[]","mimeType"],o);let a=tS(t,["autoTruncate"]);return void 0!==n&&null!=a&&tA(n,["parameters","autoTruncate"],a),{}}(0,s,n)),n}(this.apiClient,e);return o=tb("{model}:predict",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=tS(t,["predictions[]","embeddings"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["values"]);null!=r&&tA(n,["values"],r);let i=tS(t,["statistics"]);return null!=i&&tA(n,["statistics"],function(e,t){let n={},r=tS(t,["truncated"]);null!=r&&tA(n,["truncated"],r);let i=tS(t,["token_count"]);return null!=i&&tA(n,["tokenCount"],i),n}(0,i)),n})(0,e))),tA(n,["embeddings"],e)}let i=tS(t,["metadata"]);return null!=i&&tA(n,["metadata"],function(e,t){let n={},r=tS(t,["billableCharacterCount"]);return null!=r&&tA(n,["billableCharacterCount"],r),n}(0,i)),n}(this.apiClient,e),n=new tk;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","model"],tH(e,r));let i=tS(t,["contents"]);null!=i&&tA(n,["requests[]","content"],t1(e,i));let s=tS(t,["config"]);null!=s&&tA(n,["config"],function(e,t,n){let r=tS(t,["taskType"]);void 0!==n&&null!=r&&tA(n,["requests[]","taskType"],r);let i=tS(t,["title"]);void 0!==n&&null!=i&&tA(n,["requests[]","title"],i);let s=tS(t,["outputDimensionality"]);if(void 0!==n&&null!=s&&tA(n,["requests[]","outputDimensionality"],s),void 0!==tS(t,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==tS(t,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.");return{}}(0,s,n));let o=tS(t,["model"]);return void 0!==o&&tA(n,["requests[]","model"],tH(e,o)),n}(this.apiClient,e);return o=tb("{model}:batchEmbedContents",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=tS(t,["embeddings"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["values"]);return null!=r&&tA(n,["values"],r),n})(0,e))),tA(n,["embeddings"],e)}return null!=tS(t,["metadata"])&&tA(n,["metadata"],{}),n}(this.apiClient,e),n=new tk;return Object.assign(n,t),n})}}async generateImagesInternal(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","model"],tH(e,r));let i=tS(t,["prompt"]);null!=i&&tA(n,["instances[0]","prompt"],i);let s=tS(t,["config"]);return null!=s&&tA(n,["config"],function(e,t,n){let r=tS(t,["outputGcsUri"]);void 0!==n&&null!=r&&tA(n,["parameters","storageUri"],r);let i=tS(t,["negativePrompt"]);void 0!==n&&null!=i&&tA(n,["parameters","negativePrompt"],i);let s=tS(t,["numberOfImages"]);void 0!==n&&null!=s&&tA(n,["parameters","sampleCount"],s);let o=tS(t,["aspectRatio"]);void 0!==n&&null!=o&&tA(n,["parameters","aspectRatio"],o);let a=tS(t,["guidanceScale"]);void 0!==n&&null!=a&&tA(n,["parameters","guidanceScale"],a);let l=tS(t,["seed"]);void 0!==n&&null!=l&&tA(n,["parameters","seed"],l);let u=tS(t,["safetyFilterLevel"]);void 0!==n&&null!=u&&tA(n,["parameters","safetySetting"],u);let c=tS(t,["personGeneration"]);void 0!==n&&null!=c&&tA(n,["parameters","personGeneration"],c);let d=tS(t,["includeSafetyAttributes"]);void 0!==n&&null!=d&&tA(n,["parameters","includeSafetyAttributes"],d);let h=tS(t,["includeRaiReason"]);void 0!==n&&null!=h&&tA(n,["parameters","includeRaiReason"],h);let p=tS(t,["language"]);void 0!==n&&null!=p&&tA(n,["parameters","language"],p);let f=tS(t,["outputMimeType"]);void 0!==n&&null!=f&&tA(n,["parameters","outputOptions","mimeType"],f);let m=tS(t,["outputCompressionQuality"]);void 0!==n&&null!=m&&tA(n,["parameters","outputOptions","compressionQuality"],m);let g=tS(t,["addWatermark"]);void 0!==n&&null!=g&&tA(n,["parameters","addWatermark"],g);let y=tS(t,["enhancePrompt"]);return void 0!==n&&null!=y&&tA(n,["parameters","enhancePrompt"],y),{}}(0,s,n)),n}(this.apiClient,e);return o=tb("{model}:predict",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=tS(t,["predictions"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>nJ(e,t))),tA(n,["generatedImages"],t)}let i=tS(t,["positivePromptSafetyAttributes"]);return null!=i&&tA(n,["positivePromptSafetyAttributes"],nW(e,i)),n}(this.apiClient,e),n=new tx;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","model"],tH(e,r));let i=tS(t,["prompt"]);null!=i&&tA(n,["instances[0]","prompt"],i);let s=tS(t,["config"]);return null!=s&&tA(n,["config"],function(e,t,n){if(void 0!==tS(t,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==tS(t,["negativePrompt"]))throw Error("negativePrompt parameter is not supported in Gemini API.");let r=tS(t,["numberOfImages"]);void 0!==n&&null!=r&&tA(n,["parameters","sampleCount"],r);let i=tS(t,["aspectRatio"]);void 0!==n&&null!=i&&tA(n,["parameters","aspectRatio"],i);let s=tS(t,["guidanceScale"]);if(void 0!==n&&null!=s&&tA(n,["parameters","guidanceScale"],s),void 0!==tS(t,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let o=tS(t,["safetyFilterLevel"]);void 0!==n&&null!=o&&tA(n,["parameters","safetySetting"],o);let a=tS(t,["personGeneration"]);void 0!==n&&null!=a&&tA(n,["parameters","personGeneration"],a);let l=tS(t,["includeSafetyAttributes"]);void 0!==n&&null!=l&&tA(n,["parameters","includeSafetyAttributes"],l);let u=tS(t,["includeRaiReason"]);void 0!==n&&null!=u&&tA(n,["parameters","includeRaiReason"],u);let c=tS(t,["language"]);void 0!==n&&null!=c&&tA(n,["parameters","language"],c);let d=tS(t,["outputMimeType"]);void 0!==n&&null!=d&&tA(n,["parameters","outputOptions","mimeType"],d);let h=tS(t,["outputCompressionQuality"]);if(void 0!==n&&null!=h&&tA(n,["parameters","outputOptions","compressionQuality"],h),void 0!==tS(t,["addWatermark"]))throw Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==tS(t,["enhancePrompt"]))throw Error("enhancePrompt parameter is not supported in Gemini API.");return{}}(0,s,n)),n}(this.apiClient,e);return o=tb("{model}:predict",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=tS(t,["predictions"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["_self"]);null!=r&&tA(n,["image"],function(e,t){let n={},r=tS(t,["bytesBase64Encoded"]);null!=r&&tA(n,["imageBytes"],ni(e,r));let i=tS(t,["mimeType"]);return null!=i&&tA(n,["mimeType"],i),n}(e,r));let i=tS(t,["raiFilteredReason"]);null!=i&&tA(n,["raiFilteredReason"],i);let s=tS(t,["_self"]);return null!=s&&tA(n,["safetyAttributes"],n$(e,s)),n})(e,t))),tA(n,["generatedImages"],t)}let i=tS(t,["positivePromptSafetyAttributes"]);return null!=i&&tA(n,["positivePromptSafetyAttributes"],n$(e,i)),n}(this.apiClient,e),n=new tx;return Object.assign(n,t),n})}}async editImageInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let s=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","model"],tH(e,r));let i=tS(t,["prompt"]);null!=i&&tA(n,["instances[0]","prompt"],i);let s=tS(t,["referenceImages"]);if(null!=s){let t=s;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["referenceImage"]);null!=r&&tA(n,["referenceImage"],nB(e,r));let i=tS(t,["referenceId"]);null!=i&&tA(n,["referenceId"],i);let s=tS(t,["referenceType"]);null!=s&&tA(n,["referenceType"],s);let o=tS(t,["maskImageConfig"]);null!=o&&tA(n,["maskImageConfig"],function(e,t){let n={},r=tS(t,["maskMode"]);null!=r&&tA(n,["maskMode"],r);let i=tS(t,["segmentationClasses"]);null!=i&&tA(n,["maskClasses"],i);let s=tS(t,["maskDilation"]);return null!=s&&tA(n,["dilation"],s),n}(0,o));let a=tS(t,["controlImageConfig"]);null!=a&&tA(n,["controlImageConfig"],function(e,t){let n={},r=tS(t,["controlType"]);null!=r&&tA(n,["controlType"],r);let i=tS(t,["enableControlImageComputation"]);return null!=i&&tA(n,["computeControl"],i),n}(0,a));let l=tS(t,["styleImageConfig"]);null!=l&&tA(n,["styleImageConfig"],function(e,t){let n={},r=tS(t,["styleDescription"]);return null!=r&&tA(n,["styleDescription"],r),n}(0,l));let u=tS(t,["subjectImageConfig"]);return null!=u&&tA(n,["subjectImageConfig"],function(e,t){let n={},r=tS(t,["subjectType"]);null!=r&&tA(n,["subjectType"],r);let i=tS(t,["subjectDescription"]);return null!=i&&tA(n,["subjectDescription"],i),n}(0,u)),n})(e,t))),tA(n,["instances[0]","referenceImages"],t)}let o=tS(t,["config"]);return null!=o&&tA(n,["config"],function(e,t,n){let r=tS(t,["outputGcsUri"]);void 0!==n&&null!=r&&tA(n,["parameters","storageUri"],r);let i=tS(t,["negativePrompt"]);void 0!==n&&null!=i&&tA(n,["parameters","negativePrompt"],i);let s=tS(t,["numberOfImages"]);void 0!==n&&null!=s&&tA(n,["parameters","sampleCount"],s);let o=tS(t,["aspectRatio"]);void 0!==n&&null!=o&&tA(n,["parameters","aspectRatio"],o);let a=tS(t,["guidanceScale"]);void 0!==n&&null!=a&&tA(n,["parameters","guidanceScale"],a);let l=tS(t,["seed"]);void 0!==n&&null!=l&&tA(n,["parameters","seed"],l);let u=tS(t,["safetyFilterLevel"]);void 0!==n&&null!=u&&tA(n,["parameters","safetySetting"],u);let c=tS(t,["personGeneration"]);void 0!==n&&null!=c&&tA(n,["parameters","personGeneration"],c);let d=tS(t,["includeSafetyAttributes"]);void 0!==n&&null!=d&&tA(n,["parameters","includeSafetyAttributes"],d);let h=tS(t,["includeRaiReason"]);void 0!==n&&null!=h&&tA(n,["parameters","includeRaiReason"],h);let p=tS(t,["language"]);void 0!==n&&null!=p&&tA(n,["parameters","language"],p);let f=tS(t,["outputMimeType"]);void 0!==n&&null!=f&&tA(n,["parameters","outputOptions","mimeType"],f);let m=tS(t,["outputCompressionQuality"]);void 0!==n&&null!=m&&tA(n,["parameters","outputOptions","compressionQuality"],m);let g=tS(t,["editMode"]);void 0!==n&&null!=g&&tA(n,["parameters","editMode"],g);let y=tS(t,["baseSteps"]);return void 0!==n&&null!=y&&tA(n,["parameters","editConfig","baseSteps"],y),{}}(0,o,n)),n}(this.apiClient,e);return r=tb("{model}:predict",s._url),i=s._query,delete s.config,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=tS(t,["predictions"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>nJ(e,t))),tA(n,["generatedImages"],t)}return n}(this.apiClient,e),n=new tI;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let s=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","model"],tH(e,r));let i=tS(t,["image"]);null!=i&&tA(n,["instances[0]","image"],nB(e,i));let s=tS(t,["upscaleFactor"]);null!=s&&tA(n,["parameters","upscaleConfig","upscaleFactor"],s);let o=tS(t,["config"]);return null!=o&&tA(n,["config"],function(e,t,n){let r=tS(t,["includeRaiReason"]);void 0!==n&&null!=r&&tA(n,["parameters","includeRaiReason"],r);let i=tS(t,["outputMimeType"]);void 0!==n&&null!=i&&tA(n,["parameters","outputOptions","mimeType"],i);let s=tS(t,["outputCompressionQuality"]);void 0!==n&&null!=s&&tA(n,["parameters","outputOptions","compressionQuality"],s);let o=tS(t,["numberOfImages"]);void 0!==n&&null!=o&&tA(n,["parameters","sampleCount"],o);let a=tS(t,["mode"]);return void 0!==n&&null!=a&&tA(n,["parameters","mode"],a),{}}(0,o,n)),n}(this.apiClient,e);return r=tb("{model}:predict",s._url),i=s._query,delete s.config,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=tS(t,["predictions"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>nJ(e,t))),tA(n,["generatedImages"],t)}return n}(this.apiClient,e),n=new tN;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","name"],tH(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],i),n}(this.apiClient,e);return o=tb("{name}",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>nK(this.apiClient,e))}{let t=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","name"],tH(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],i),n}(this.apiClient,e);return o=tb("{name}",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>nV(this.apiClient,e))}}async listInternal(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=tS(t,["config"]);return null!=r&&tA(n,["config"],function(e,t,n){let r=tS(t,["pageSize"]);void 0!==n&&null!=r&&tA(n,["_query","pageSize"],r);let i=tS(t,["pageToken"]);void 0!==n&&null!=i&&tA(n,["_query","pageToken"],i);let s=tS(t,["filter"]);void 0!==n&&null!=s&&tA(n,["_query","filter"],s);let o=tS(t,["queryBase"]);return void 0!==n&&null!=o&&tA(n,["_url","models_url"],nl(e,o)),{}}(e,r,n)),n}(this.apiClient,e);return o=tb("{models_url}",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=tS(t,["nextPageToken"]);null!=r&&tA(n,["nextPageToken"],r);let i=tS(t,["_self"]);if(null!=i){let t=nu(e,i);Array.isArray(t)&&(t=t.map(t=>nK(e,t))),tA(n,["models"],t)}return n}(this.apiClient,e),n=new tR;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=tS(t,["config"]);return null!=r&&tA(n,["config"],function(e,t,n){let r=tS(t,["pageSize"]);void 0!==n&&null!=r&&tA(n,["_query","pageSize"],r);let i=tS(t,["pageToken"]);void 0!==n&&null!=i&&tA(n,["_query","pageToken"],i);let s=tS(t,["filter"]);void 0!==n&&null!=s&&tA(n,["_query","filter"],s);let o=tS(t,["queryBase"]);return void 0!==n&&null!=o&&tA(n,["_url","models_url"],nl(e,o)),{}}(e,r,n)),n}(this.apiClient,e);return o=tb("{models_url}",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=tS(t,["nextPageToken"]);null!=r&&tA(n,["nextPageToken"],r);let i=tS(t,["_self"]);if(null!=i){let t=nu(e,i);Array.isArray(t)&&(t=t.map(t=>nV(e,t))),tA(n,["models"],t)}return n}(this.apiClient,e),n=new tR;return Object.assign(n,t),n})}}async update(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","model"],tH(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],function(e,t,n){let r=tS(t,["displayName"]);void 0!==n&&null!=r&&tA(n,["displayName"],r);let i=tS(t,["description"]);void 0!==n&&null!=i&&tA(n,["description"],i);let s=tS(t,["defaultCheckpointId"]);return void 0!==n&&null!=s&&tA(n,["defaultCheckpointId"],s),{}}(0,i,n)),n}(this.apiClient,e);return o=tb("{model}",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"PATCH",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>nK(this.apiClient,e))}{let t=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","name"],tH(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],function(e,t,n){let r=tS(t,["displayName"]);void 0!==n&&null!=r&&tA(n,["displayName"],r);let i=tS(t,["description"]);void 0!==n&&null!=i&&tA(n,["description"],i);let s=tS(t,["defaultCheckpointId"]);return void 0!==n&&null!=s&&tA(n,["defaultCheckpointId"],s),{}}(0,i,n)),n}(this.apiClient,e);return o=tb("{name}",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"PATCH",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>nV(this.apiClient,e))}}async delete(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","name"],tH(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],i),n}(this.apiClient,e);return o=tb("{name}",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(()=>{let e=new tP;return Object.assign(e,{}),e})}{let t=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","name"],tH(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],i),n}(this.apiClient,e);return o=tb("{name}",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(()=>{let e=new tP;return Object.assign(e,{}),e})}}async countTokens(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","model"],tH(e,r));let i=tS(t,["contents"]);if(null!=i){let t=t2(e,i);Array.isArray(t)&&(t=t.map(t=>nL(e,t))),tA(n,["contents"],t)}let s=tS(t,["config"]);return null!=s&&tA(n,["config"],function(e,t,n){let r=tS(t,["systemInstruction"]);void 0!==n&&null!=r&&tA(n,["systemInstruction"],nL(e,t0(e,r)));let i=tS(t,["tools"]);if(void 0!==n&&null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>nF(e,t))),tA(n,["tools"],t)}let s=tS(t,["generationConfig"]);return void 0!==n&&null!=s&&tA(n,["generationConfig"],s),{}}(e,s,n)),n}(this.apiClient,e);return o=tb("{model}:countTokens",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=tS(t,["totalTokens"]);return null!=r&&tA(n,["totalTokens"],r),n}(this.apiClient,e),n=new tD;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","model"],tH(e,r));let i=tS(t,["contents"]);if(null!=i){let t=t2(e,i);Array.isArray(t)&&(t=t.map(t=>nM(e,t))),tA(n,["contents"],t)}let s=tS(t,["config"]);return null!=s&&tA(n,["config"],function(e,t){if(void 0!==tS(t,["systemInstruction"]))throw Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==tS(t,["tools"]))throw Error("tools parameter is not supported in Gemini API.");if(void 0!==tS(t,["generationConfig"]))throw Error("generationConfig parameter is not supported in Gemini API.");return{}}(0,s)),n}(this.apiClient,e);return o=tb("{model}:countTokens",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=tS(t,["totalTokens"]);null!=r&&tA(n,["totalTokens"],r);let i=tS(t,["cachedContentTokenCount"]);return null!=i&&tA(n,["cachedContentTokenCount"],i),n}(this.apiClient,e),n=new tD;return Object.assign(n,t),n})}}async computeTokens(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let s=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","model"],tH(e,r));let i=tS(t,["contents"]);if(null!=i){let t=t2(e,i);Array.isArray(t)&&(t=t.map(t=>nL(e,t))),tA(n,["contents"],t)}let s=tS(t,["config"]);return null!=s&&tA(n,["config"],s),n}(this.apiClient,e);return r=tb("{model}:computeTokens",s._url),i=s._query,delete s.config,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=tS(t,["tokensInfo"]);return null!=r&&tA(n,["tokensInfo"],r),n}(this.apiClient,e),n=new tM;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async generateVideos(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","model"],tH(e,r));let i=tS(t,["prompt"]);null!=i&&tA(n,["instances[0]","prompt"],i);let s=tS(t,["image"]);null!=s&&tA(n,["instances[0]","image"],nB(e,s));let o=tS(t,["video"]);null!=o&&tA(n,["instances[0]","video"],function(e,t){let n={},r=tS(t,["uri"]);null!=r&&tA(n,["gcsUri"],r);let i=tS(t,["videoBytes"]);null!=i&&tA(n,["bytesBase64Encoded"],ni(e,i));let s=tS(t,["mimeType"]);return null!=s&&tA(n,["mimeType"],s),n}(e,o));let a=tS(t,["config"]);return null!=a&&tA(n,["config"],function(e,t,n){let r=tS(t,["numberOfVideos"]);void 0!==n&&null!=r&&tA(n,["parameters","sampleCount"],r);let i=tS(t,["outputGcsUri"]);void 0!==n&&null!=i&&tA(n,["parameters","storageUri"],i);let s=tS(t,["fps"]);void 0!==n&&null!=s&&tA(n,["parameters","fps"],s);let o=tS(t,["durationSeconds"]);void 0!==n&&null!=o&&tA(n,["parameters","durationSeconds"],o);let a=tS(t,["seed"]);void 0!==n&&null!=a&&tA(n,["parameters","seed"],a);let l=tS(t,["aspectRatio"]);void 0!==n&&null!=l&&tA(n,["parameters","aspectRatio"],l);let u=tS(t,["resolution"]);void 0!==n&&null!=u&&tA(n,["parameters","resolution"],u);let c=tS(t,["personGeneration"]);void 0!==n&&null!=c&&tA(n,["parameters","personGeneration"],c);let d=tS(t,["pubsubTopic"]);void 0!==n&&null!=d&&tA(n,["parameters","pubsubTopic"],d);let h=tS(t,["negativePrompt"]);void 0!==n&&null!=h&&tA(n,["parameters","negativePrompt"],h);let p=tS(t,["enhancePrompt"]);void 0!==n&&null!=p&&tA(n,["parameters","enhancePrompt"],p);let f=tS(t,["generateAudio"]);void 0!==n&&null!=f&&tA(n,["parameters","generateAudio"],f);let m=tS(t,["lastFrame"]);return void 0!==n&&null!=m&&tA(n,["instances[0]","lastFrame"],nB(e,m)),{}}(e,a,n)),n}(this.apiClient,e);return o=tb("{model}:predictLongRunning",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>(function(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["name"],r);let i=tS(t,["metadata"]);null!=i&&tA(n,["metadata"],i);let s=tS(t,["done"]);null!=s&&tA(n,["done"],s);let o=tS(t,["error"]);null!=o&&tA(n,["error"],o);let a=tS(t,["response"]);return null!=a&&tA(n,["response"],function(e,t){let n={},r=tS(t,["videos"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["_self"]);return null!=r&&tA(n,["video"],function(e,t){let n={},r=tS(t,["gcsUri"]);null!=r&&tA(n,["uri"],r);let i=tS(t,["bytesBase64Encoded"]);null!=i&&tA(n,["videoBytes"],ni(e,i));let s=tS(t,["mimeType"]);return null!=s&&tA(n,["mimeType"],s),n}(e,r)),n})(e,t))),tA(n,["generatedVideos"],t)}let i=tS(t,["raiMediaFilteredCount"]);null!=i&&tA(n,["raiMediaFilteredCount"],i);let s=tS(t,["raiMediaFilteredReasons"]);return null!=s&&tA(n,["raiMediaFilteredReasons"],s),n}(e,a)),n})(this.apiClient,e))}{let t=function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["_url","model"],tH(e,r));let i=tS(t,["prompt"]);null!=i&&tA(n,["instances[0]","prompt"],i);let s=tS(t,["image"]);if(null!=s&&tA(n,["instances[0]","image"],function(e,t){let n={};if(void 0!==tS(t,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");let r=tS(t,["imageBytes"]);null!=r&&tA(n,["bytesBase64Encoded"],ni(e,r));let i=tS(t,["mimeType"]);return null!=i&&tA(n,["mimeType"],i),n}(e,s)),void 0!==tS(t,["video"]))throw Error("video parameter is not supported in Gemini API.");let o=tS(t,["config"]);return null!=o&&tA(n,["config"],function(e,t,n){let r=tS(t,["numberOfVideos"]);if(void 0!==n&&null!=r&&tA(n,["parameters","sampleCount"],r),void 0!==tS(t,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==tS(t,["fps"]))throw Error("fps parameter is not supported in Gemini API.");let i=tS(t,["durationSeconds"]);if(void 0!==n&&null!=i&&tA(n,["parameters","durationSeconds"],i),void 0!==tS(t,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let s=tS(t,["aspectRatio"]);if(void 0!==n&&null!=s&&tA(n,["parameters","aspectRatio"],s),void 0!==tS(t,["resolution"]))throw Error("resolution parameter is not supported in Gemini API.");let o=tS(t,["personGeneration"]);if(void 0!==n&&null!=o&&tA(n,["parameters","personGeneration"],o),void 0!==tS(t,["pubsubTopic"]))throw Error("pubsubTopic parameter is not supported in Gemini API.");let a=tS(t,["negativePrompt"]);void 0!==n&&null!=a&&tA(n,["parameters","negativePrompt"],a);let l=tS(t,["enhancePrompt"]);if(void 0!==n&&null!=l&&tA(n,["parameters","enhancePrompt"],l),void 0!==tS(t,["generateAudio"]))throw Error("generateAudio parameter is not supported in Gemini API.");if(void 0!==tS(t,["lastFrame"]))throw Error("lastFrame parameter is not supported in Gemini API.");return{}}(0,o,n)),n}(this.apiClient,e);return o=tb("{model}:predictLongRunning",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>(function(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["name"],r);let i=tS(t,["metadata"]);null!=i&&tA(n,["metadata"],i);let s=tS(t,["done"]);null!=s&&tA(n,["done"],s);let o=tS(t,["error"]);null!=o&&tA(n,["error"],o);let a=tS(t,["response","generateVideoResponse"]);return null!=a&&tA(n,["response"],function(e,t){let n={},r=tS(t,["generatedSamples"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["_self"]);return null!=r&&tA(n,["video"],function(e,t){let n={},r=tS(t,["video","uri"]);null!=r&&tA(n,["uri"],r);let i=tS(t,["video","encodedVideo"]);null!=i&&tA(n,["videoBytes"],ni(e,i));let s=tS(t,["encoding"]);return null!=s&&tA(n,["mimeType"],s),n}(e,r)),n})(e,t))),tA(n,["generatedVideos"],t)}let i=tS(t,["raiMediaFilteredCount"]);null!=i&&tA(n,["raiMediaFilteredCount"],i);let s=tS(t,["raiMediaFilteredReasons"]);return null!=s&&tA(n,["raiMediaFilteredReasons"],s),n}(e,a)),n})(this.apiClient,e))}}}function ro(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["name"],r);let i=tS(t,["metadata"]);null!=i&&tA(n,["metadata"],i);let s=tS(t,["done"]);null!=s&&tA(n,["done"],s);let o=tS(t,["error"]);null!=o&&tA(n,["error"],o);let a=tS(t,["response"]);return null!=a&&tA(n,["response"],function(e,t){let n={},r=tS(t,["videos"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["_self"]);return null!=r&&tA(n,["video"],function(e,t){let n={},r=tS(t,["gcsUri"]);null!=r&&tA(n,["uri"],r);let i=tS(t,["bytesBase64Encoded"]);null!=i&&tA(n,["videoBytes"],ni(e,i));let s=tS(t,["mimeType"]);return null!=s&&tA(n,["mimeType"],s),n}(e,r)),n})(e,t))),tA(n,["generatedVideos"],t)}let i=tS(t,["raiMediaFilteredCount"]);null!=i&&tA(n,["raiMediaFilteredCount"],i);let s=tS(t,["raiMediaFilteredReasons"]);return null!=s&&tA(n,["raiMediaFilteredReasons"],s),n}(e,a)),n}class ra extends tC{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(!this.apiClient.isVertexAI())return this.getVideosOperationInternal({operationName:t.name,config:n});{let e,r=t.name.split("/operations/")[0];return n&&"httpOptions"in n&&(e=n.httpOptions),this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:e}})}}async getVideosOperationInternal(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=tS(t,["operationName"]);null!=r&&tA(n,["_url","operationName"],r);let i=tS(t,["config"]);return null!=i&&tA(n,["config"],i),n}(this.apiClient,e);return o=tb("{operationName}",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>ro(this.apiClient,e))}{let t=function(e,t){let n={},r=tS(t,["operationName"]);null!=r&&tA(n,["_url","operationName"],r);let i=tS(t,["config"]);return null!=i&&tA(n,["config"],i),n}(this.apiClient,e);return o=tb("{operationName}",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>(function(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["name"],r);let i=tS(t,["metadata"]);null!=i&&tA(n,["metadata"],i);let s=tS(t,["done"]);null!=s&&tA(n,["done"],s);let o=tS(t,["error"]);null!=o&&tA(n,["error"],o);let a=tS(t,["response","generateVideoResponse"]);return null!=a&&tA(n,["response"],function(e,t){let n={},r=tS(t,["generatedSamples"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["_self"]);return null!=r&&tA(n,["video"],function(e,t){let n={},r=tS(t,["video","uri"]);null!=r&&tA(n,["uri"],r);let i=tS(t,["video","encodedVideo"]);null!=i&&tA(n,["videoBytes"],ni(e,i));let s=tS(t,["encoding"]);return null!=s&&tA(n,["mimeType"],s),n}(e,r)),n})(e,t))),tA(n,["generatedVideos"],t)}let i=tS(t,["raiMediaFilteredCount"]);null!=i&&tA(n,["raiMediaFilteredCount"],i);let s=tS(t,["raiMediaFilteredReasons"]);return null!=s&&tA(n,["raiMediaFilteredReasons"],s),n}(e,a)),n})(this.apiClient,e))}}async fetchPredictVideosOperationInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let s=function(e,t){let n={},r=tS(t,["operationName"]);null!=r&&tA(n,["operationName"],r);let i=tS(t,["resourceName"]);null!=i&&tA(n,["_url","resourceName"],i);let s=tS(t,["config"]);return null!=s&&tA(n,["config"],s),n}(this.apiClient,e);return r=tb("{resourceName}:fetchPredictOperation",s._url),i=s._query,delete s.config,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>ro(this.apiClient,e))}throw Error("This method is only supported by the Vertex AI.")}}function rl(e,t){let n={},r=tS(t,["prebuiltVoiceConfig"]);return null!=r&&tA(n,["prebuiltVoiceConfig"],function(e,t){let n={},r=tS(t,["voiceName"]);return null!=r&&tA(n,["voiceName"],r),n}(0,r)),n}class ru extends tC{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let s=function(e,t){let n={},r=tS(t,["config"]);return null!=r&&tA(n,["config"],function(e,t,n){let r=tS(t,["expireTime"]);void 0!==n&&null!=r&&tA(n,["expireTime"],r);let i=tS(t,["newSessionExpireTime"]);void 0!==n&&null!=i&&tA(n,["newSessionExpireTime"],i);let s=tS(t,["uses"]);void 0!==n&&null!=s&&tA(n,["uses"],s);let o=tS(t,["liveConnectConstraints"]);void 0!==n&&null!=o&&tA(n,["bidiGenerateContentSetup"],function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["setup","model"],tH(e,r));let i=tS(t,["config"]);return null!=i&&tA(n,["config"],function(e,t,n){let r=tS(t,["generationConfig"]);void 0!==n&&null!=r&&tA(n,["setup","generationConfig"],r);let i=tS(t,["responseModalities"]);void 0!==n&&null!=i&&tA(n,["setup","generationConfig","responseModalities"],i);let s=tS(t,["temperature"]);void 0!==n&&null!=s&&tA(n,["setup","generationConfig","temperature"],s);let o=tS(t,["topP"]);void 0!==n&&null!=o&&tA(n,["setup","generationConfig","topP"],o);let a=tS(t,["topK"]);void 0!==n&&null!=a&&tA(n,["setup","generationConfig","topK"],a);let l=tS(t,["maxOutputTokens"]);void 0!==n&&null!=l&&tA(n,["setup","generationConfig","maxOutputTokens"],l);let u=tS(t,["mediaResolution"]);void 0!==n&&null!=u&&tA(n,["setup","generationConfig","mediaResolution"],u);let c=tS(t,["seed"]);void 0!==n&&null!=c&&tA(n,["setup","generationConfig","seed"],c);let d=tS(t,["speechConfig"]);void 0!==n&&null!=d&&tA(n,["setup","generationConfig","speechConfig"],function(e,t){let n={},r=tS(t,["voiceConfig"]);null!=r&&tA(n,["voiceConfig"],rl(e,r));let i=tS(t,["multiSpeakerVoiceConfig"]);null!=i&&tA(n,["multiSpeakerVoiceConfig"],function(e,t){let n={},r=tS(t,["speakerVoiceConfigs"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["speaker"]);null!=r&&tA(n,["speaker"],r);let i=tS(t,["voiceConfig"]);return null!=i&&tA(n,["voiceConfig"],rl(e,i)),n})(e,t))),tA(n,["speakerVoiceConfigs"],t)}return n}(e,i));let s=tS(t,["languageCode"]);return null!=s&&tA(n,["languageCode"],s),n}(e,t7(e,d)));let h=tS(t,["enableAffectiveDialog"]);void 0!==n&&null!=h&&tA(n,["setup","generationConfig","enableAffectiveDialog"],h);let p=tS(t,["systemInstruction"]);void 0!==n&&null!=p&&tA(n,["setup","systemInstruction"],function(e,t){let n={},r=tS(t,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["videoMetadata"]);null!=r&&tA(n,["videoMetadata"],function(e,t){let n={},r=tS(t,["fps"]);null!=r&&tA(n,["fps"],r);let i=tS(t,["endOffset"]);null!=i&&tA(n,["endOffset"],i);let s=tS(t,["startOffset"]);return null!=s&&tA(n,["startOffset"],s),n}(0,r));let i=tS(t,["thought"]);null!=i&&tA(n,["thought"],i);let s=tS(t,["inlineData"]);null!=s&&tA(n,["inlineData"],function(e,t){let n={};if(void 0!==tS(t,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=tS(t,["data"]);null!=r&&tA(n,["data"],r);let i=tS(t,["mimeType"]);return null!=i&&tA(n,["mimeType"],i),n}(0,s));let o=tS(t,["fileData"]);null!=o&&tA(n,["fileData"],function(e,t){let n={};if(void 0!==tS(t,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=tS(t,["fileUri"]);null!=r&&tA(n,["fileUri"],r);let i=tS(t,["mimeType"]);return null!=i&&tA(n,["mimeType"],i),n}(0,o));let a=tS(t,["thoughtSignature"]);null!=a&&tA(n,["thoughtSignature"],a);let l=tS(t,["codeExecutionResult"]);null!=l&&tA(n,["codeExecutionResult"],l);let u=tS(t,["executableCode"]);null!=u&&tA(n,["executableCode"],u);let c=tS(t,["functionCall"]);null!=c&&tA(n,["functionCall"],c);let d=tS(t,["functionResponse"]);null!=d&&tA(n,["functionResponse"],d);let h=tS(t,["text"]);return null!=h&&tA(n,["text"],h),n})(0,e))),tA(n,["parts"],e)}let i=tS(t,["role"]);return null!=i&&tA(n,["role"],i),n}(e,t0(e,p)));let f=tS(t,["tools"]);if(void 0!==n&&null!=f){let t=nt(e,f);Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=tS(t,["functionDeclarations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["behavior"]);null!=r&&tA(n,["behavior"],r);let i=tS(t,["description"]);null!=i&&tA(n,["description"],i);let s=tS(t,["name"]);null!=s&&tA(n,["name"],s);let o=tS(t,["parameters"]);null!=o&&tA(n,["parameters"],o);let a=tS(t,["response"]);return null!=a&&tA(n,["response"],a),n})(0,e))),tA(n,["functionDeclarations"],e)}if(void 0!==tS(t,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=tS(t,["googleSearch"]);null!=i&&tA(n,["googleSearch"],function(e,t){let n={},r=tS(t,["timeRangeFilter"]);return null!=r&&tA(n,["timeRangeFilter"],function(e,t){let n={},r=tS(t,["startTime"]);null!=r&&tA(n,["startTime"],r);let i=tS(t,["endTime"]);return null!=i&&tA(n,["endTime"],i),n}(0,r)),n}(0,i));let s=tS(t,["googleSearchRetrieval"]);if(null!=s&&tA(n,["googleSearchRetrieval"],function(e,t){let n={},r=tS(t,["dynamicRetrievalConfig"]);return null!=r&&tA(n,["dynamicRetrievalConfig"],function(e,t){let n={},r=tS(t,["mode"]);null!=r&&tA(n,["mode"],r);let i=tS(t,["dynamicThreshold"]);return null!=i&&tA(n,["dynamicThreshold"],i),n}(0,r)),n}(0,s)),void 0!==tS(t,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(void 0!==tS(t,["googleMaps"]))throw Error("googleMaps parameter is not supported in Gemini API.");null!=tS(t,["urlContext"])&&tA(n,["urlContext"],{});let o=tS(t,["codeExecution"]);return null!=o&&tA(n,["codeExecution"],o),n})(e,ne(e,t)))),tA(n,["setup","tools"],t)}let m=tS(t,["sessionResumption"]);void 0!==n&&null!=m&&tA(n,["setup","sessionResumption"],function(e,t){let n={},r=tS(t,["handle"]);if(null!=r&&tA(n,["handle"],r),void 0!==tS(t,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return n}(0,m));let g=tS(t,["inputAudioTranscription"]);void 0!==n&&null!=g&&tA(n,["setup","inputAudioTranscription"],{});let y=tS(t,["outputAudioTranscription"]);void 0!==n&&null!=y&&tA(n,["setup","outputAudioTranscription"],{});let _=tS(t,["realtimeInputConfig"]);void 0!==n&&null!=_&&tA(n,["setup","realtimeInputConfig"],function(e,t){let n={},r=tS(t,["automaticActivityDetection"]);null!=r&&tA(n,["automaticActivityDetection"],function(e,t){let n={},r=tS(t,["disabled"]);null!=r&&tA(n,["disabled"],r);let i=tS(t,["startOfSpeechSensitivity"]);null!=i&&tA(n,["startOfSpeechSensitivity"],i);let s=tS(t,["endOfSpeechSensitivity"]);null!=s&&tA(n,["endOfSpeechSensitivity"],s);let o=tS(t,["prefixPaddingMs"]);null!=o&&tA(n,["prefixPaddingMs"],o);let a=tS(t,["silenceDurationMs"]);return null!=a&&tA(n,["silenceDurationMs"],a),n}(0,r));let i=tS(t,["activityHandling"]);null!=i&&tA(n,["activityHandling"],i);let s=tS(t,["turnCoverage"]);return null!=s&&tA(n,["turnCoverage"],s),n}(0,_));let v=tS(t,["contextWindowCompression"]);void 0!==n&&null!=v&&tA(n,["setup","contextWindowCompression"],function(e,t){let n={},r=tS(t,["triggerTokens"]);null!=r&&tA(n,["triggerTokens"],r);let i=tS(t,["slidingWindow"]);return null!=i&&tA(n,["slidingWindow"],function(e,t){let n={},r=tS(t,["targetTokens"]);return null!=r&&tA(n,["targetTokens"],r),n}(0,i)),n}(0,v));let E=tS(t,["proactivity"]);return void 0!==n&&null!=E&&tA(n,["setup","proactivity"],function(e,t){let n={},r=tS(t,["proactiveAudio"]);return null!=r&&tA(n,["proactiveAudio"],r),n}(0,E)),{}}(e,i,n)),n}(e,o));let a=tS(t,["lockAdditionalFields"]);return void 0!==n&&null!=a&&tA(n,["fieldMask"],a),{}}(e,r,n)),n}(this.apiClient,e);r=tb("auth_tokens",s._url),i=s._query,delete s.config,delete s._url,delete s._query;let o=function(e,t){let n=null,r=e.bidiGenerateContentSetup;if("object"==typeof r&&null!==r&&"setup"in r){let t=r.setup;"object"==typeof t&&null!==t?(e.bidiGenerateContentSetup=t,n=t):delete e.bidiGenerateContentSetup}else void 0!==r&&delete e.bidiGenerateContentSetup;let i=e.fieldMask;if(n){let r=function(e){let t=[];for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let r=e[n];if("object"==typeof r&&null!=r&&Object.keys(r).length>0){let e=Object.keys(r).map(e=>`${n}.${e}`);t.push(...e)}else t.push(n)}return t.join(",")}(n);if(Array.isArray(null==t?void 0:t.lockAdditionalFields)&&(null==t?void 0:t.lockAdditionalFields.length)===0)r?e.fieldMask=r:delete e.fieldMask;else if((null==t?void 0:t.lockAdditionalFields)&&t.lockAdditionalFields.length>0&&null!==i&&Array.isArray(i)&&i.length>0){let t=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],n=[];i.length>0&&(n=i.map(e=>t.includes(e)?`generationConfig.${e}`:e));let s=[];r&&s.push(r),n.length>0&&s.push(...n),s.length>0?e.fieldMask=s.join(","):delete e.fieldMask}else delete e.fieldMask}else null!==i&&Array.isArray(i)&&i.length>0?e.fieldMask=i.join(","):delete e.fieldMask;return e}(s,e.config);return this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>(function(e,t){let n={},r=tS(t,["name"]);return null!=r&&tA(n,["name"],r),n})(this.apiClient,e))}}}let rc="x-goog-api-key",rd="https://www.googleapis.com/auth/cloud-platform";class rh{constructor(e){if(void 0!==e.apiKey){this.apiKey=e.apiKey;return}let t=function(e){let t;if(!e)return{scopes:[rd]};if((t=e).scopes){if("string"==typeof t.scopes&&t.scopes!==rd||Array.isArray(t.scopes)&&0>t.scopes.indexOf(rd))throw Error(`Invalid auth scopes. Scopes must include: ${rd}`)}else t.scopes=[rd];return t}(e.googleAuthOptions);this.googleAuth=new ty.kF(t)}async addAuthHeaders(e){if(void 0!==this.apiKey){if(this.apiKey.startsWith("auth_tokens/"))throw Error("Ephemeral tokens are only supported by the live API.");this.addKeyHeader(e);return}return this.addGoogleAuthHeaders(e)}addKeyHeader(e){if(null===e.get(rc)){if(void 0===this.apiKey)throw Error("Trying to set API key header but apiKey is not set");e.append(rc,this.apiKey)}}async addGoogleAuthHeaders(e){if(void 0===this.googleAuth)throw Error("Trying to set google-auth headers but googleAuth is unset");let t=await this.googleAuth.getRequestHeaders();for(let n in t)null===e.get(n)&&e.append(n,t[n])}}class rp{async download(e,t){if(e.downloadPath){let n=await rf(e,t);if(n instanceof tG){let t=(0,t_.createWriteStream)(e.downloadPath);tv.Readable.fromWeb(n.responseInternal.body).pipe(t)}else(0,t_.writeFile)(e.downloadPath,n,{encoding:"base64"},t=>{if(t)throw Error(`Failed to write file to ${e.downloadPath}: ${t}`)})}}}async function rf(e,t){var n,r,i;let s=na(t,e.file);if(void 0!==s)return await t.request({path:`files/${s}:download`,httpMethod:"GET",queryParams:{alt:"media"},httpOptions:null==(n=e.config)?void 0:n.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal});if(ns(e.file)){let t=null==(i=e.file.video)?void 0:i.videoBytes;if("string"==typeof t)return t;throw Error("Failed to download generated video, Uri or videoBytes not found.")}if(no(e.file)){let t=e.file.videoBytes;if("string"==typeof t)return t;throw Error("Failed to download video, Uri or videoBytes not found.")}throw Error("Unsupported file type")}class rm{create(e,t,n){return new rg(e,t,n)}}class rg{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new tE(this.url,{headers:this.headers}),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.send(e)}close(){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.close()}}function ry(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["name"],r);let i=tS(t,["state"]);null!=i&&tA(n,["state"],nr(e,i));let s=tS(t,["createTime"]);null!=s&&tA(n,["createTime"],s);let o=tS(t,["tuningTask","startTime"]);null!=o&&tA(n,["startTime"],o);let a=tS(t,["tuningTask","completeTime"]);null!=a&&tA(n,["endTime"],a);let l=tS(t,["updateTime"]);null!=l&&tA(n,["updateTime"],l);let u=tS(t,["description"]);null!=u&&tA(n,["description"],u);let c=tS(t,["baseModel"]);null!=c&&tA(n,["baseModel"],c);let d=tS(t,["_self"]);null!=d&&tA(n,["tunedModel"],function(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["model"],r);let i=tS(t,["name"]);return null!=i&&tA(n,["endpoint"],i),n}(0,d));let h=tS(t,["distillationSpec"]);null!=h&&tA(n,["distillationSpec"],h);let p=tS(t,["experiment"]);null!=p&&tA(n,["experiment"],p);let f=tS(t,["labels"]);null!=f&&tA(n,["labels"],f);let m=tS(t,["pipelineJob"]);null!=m&&tA(n,["pipelineJob"],m);let g=tS(t,["serviceAccount"]);null!=g&&tA(n,["serviceAccount"],g);let y=tS(t,["tunedModelDisplayName"]);return null!=y&&tA(n,["tunedModelDisplayName"],y),n}function r_(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["name"],r);let i=tS(t,["state"]);null!=i&&tA(n,["state"],nr(e,i));let s=tS(t,["createTime"]);null!=s&&tA(n,["createTime"],s);let o=tS(t,["startTime"]);null!=o&&tA(n,["startTime"],o);let a=tS(t,["endTime"]);null!=a&&tA(n,["endTime"],a);let l=tS(t,["updateTime"]);null!=l&&tA(n,["updateTime"],l);let u=tS(t,["error"]);null!=u&&tA(n,["error"],u);let c=tS(t,["description"]);null!=c&&tA(n,["description"],c);let d=tS(t,["baseModel"]);null!=d&&tA(n,["baseModel"],d);let h=tS(t,["tunedModel"]);null!=h&&tA(n,["tunedModel"],function(e,t){let n={},r=tS(t,["model"]);null!=r&&tA(n,["model"],r);let i=tS(t,["endpoint"]);null!=i&&tA(n,["endpoint"],i);let s=tS(t,["checkpoints"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["checkpointId"]);null!=r&&tA(n,["checkpointId"],r);let i=tS(t,["epoch"]);null!=i&&tA(n,["epoch"],i);let s=tS(t,["step"]);null!=s&&tA(n,["step"],s);let o=tS(t,["endpoint"]);return null!=o&&tA(n,["endpoint"],o),n})(0,e))),tA(n,["checkpoints"],e)}return n}(0,h));let p=tS(t,["supervisedTuningSpec"]);null!=p&&tA(n,["supervisedTuningSpec"],p);let f=tS(t,["tuningDataStats"]);null!=f&&tA(n,["tuningDataStats"],f);let m=tS(t,["encryptionSpec"]);null!=m&&tA(n,["encryptionSpec"],m);let g=tS(t,["partnerModelTuningSpec"]);null!=g&&tA(n,["partnerModelTuningSpec"],g);let y=tS(t,["distillationSpec"]);null!=y&&tA(n,["distillationSpec"],y);let _=tS(t,["experiment"]);null!=_&&tA(n,["experiment"],_);let v=tS(t,["labels"]);null!=v&&tA(n,["labels"],v);let E=tS(t,["pipelineJob"]);null!=E&&tA(n,["pipelineJob"],E);let T=tS(t,["serviceAccount"]);null!=T&&tA(n,["serviceAccount"],T);let C=tS(t,["tunedModelDisplayName"]);return null!=C&&tA(n,["tunedModelDisplayName"],C),n}class rv extends tC{constructor(e){super(),this.apiClient=e,this.get=async e=>await this.getInternal(e),this.list=async(e={})=>new nf(tg.PAGED_ITEM_TUNING_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.tune=async e=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(e);{let t=await this.tuneMldevInternal(e),n="";return void 0!==t.metadata&&void 0!==t.metadata.tunedModel?n=t.metadata.tunedModel:void 0!==t.name&&t.name.includes("/operations/")&&(n=t.name.split("/operations/")[0]),{name:n,state:e2.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["_url","name"],r);let i=tS(t,["config"]);return null!=i&&tA(n,["config"],i),n}(this.apiClient,e);return o=tb("{name}",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>r_(this.apiClient,e))}{let t=function(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["_url","name"],r);let i=tS(t,["config"]);return null!=i&&tA(n,["config"],i),n}(this.apiClient,e);return o=tb("{name}",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>ry(this.apiClient,e))}}async listInternal(e){var t,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=tS(t,["config"]);return null!=r&&tA(n,["config"],function(e,t,n){let r=tS(t,["pageSize"]);void 0!==n&&null!=r&&tA(n,["_query","pageSize"],r);let i=tS(t,["pageToken"]);void 0!==n&&null!=i&&tA(n,["_query","pageToken"],i);let s=tS(t,["filter"]);return void 0!==n&&null!=s&&tA(n,["_query","filter"],s),{}}(0,r,n)),n}(this.apiClient,e);return o=tb("tuningJobs",r._url),a=r._query,delete r.config,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=tS(t,["nextPageToken"]);null!=r&&tA(n,["nextPageToken"],r);let i=tS(t,["tuningJobs"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>r_(e,t))),tA(n,["tuningJobs"],t)}return n}(this.apiClient,e),n=new tU;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=tS(t,["config"]);return null!=r&&tA(n,["config"],function(e,t,n){let r=tS(t,["pageSize"]);void 0!==n&&null!=r&&tA(n,["_query","pageSize"],r);let i=tS(t,["pageToken"]);void 0!==n&&null!=i&&tA(n,["_query","pageToken"],i);let s=tS(t,["filter"]);return void 0!==n&&null!=s&&tA(n,["_query","filter"],s),{}}(0,r,n)),n}(this.apiClient,e);return o=tb("tunedModels",t._url),a=t._query,delete t.config,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null==(r=e.config)?void 0:r.httpOptions,abortSignal:null==(i=e.config)?void 0:i.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e,t){let n={},r=tS(t,["nextPageToken"]);null!=r&&tA(n,["nextPageToken"],r);let i=tS(t,["tunedModels"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>ry(e,t))),tA(n,["tuningJobs"],t)}return n}(this.apiClient,e),n=new tU;return Object.assign(n,t),n})}}async tuneInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let s=function(e,t){let n={},r=tS(t,["baseModel"]);null!=r&&tA(n,["baseModel"],r);let i=tS(t,["trainingDataset"]);null!=i&&tA(n,["supervisedTuningSpec","trainingDatasetUri"],function(e,t,n){let r=tS(t,["gcsUri"]);if(void 0!==n&&null!=r&&tA(n,["supervisedTuningSpec","trainingDatasetUri"],r),void 0!==tS(t,["examples"]))throw Error("examples parameter is not supported in Vertex AI.");return{}}(0,i,n));let s=tS(t,["config"]);return null!=s&&tA(n,["config"],function(e,t,n){let r=tS(t,["validationDataset"]);void 0!==n&&null!=r&&tA(n,["supervisedTuningSpec"],function(e,t){let n={},r=tS(t,["gcsUri"]);return null!=r&&tA(n,["validationDatasetUri"],r),n}(0,r));let i=tS(t,["tunedModelDisplayName"]);void 0!==n&&null!=i&&tA(n,["tunedModelDisplayName"],i);let s=tS(t,["description"]);void 0!==n&&null!=s&&tA(n,["description"],s);let o=tS(t,["epochCount"]);void 0!==n&&null!=o&&tA(n,["supervisedTuningSpec","hyperParameters","epochCount"],o);let a=tS(t,["learningRateMultiplier"]);void 0!==n&&null!=a&&tA(n,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],a);let l=tS(t,["exportLastCheckpointOnly"]);void 0!==n&&null!=l&&tA(n,["supervisedTuningSpec","exportLastCheckpointOnly"],l);let u=tS(t,["adapterSize"]);if(void 0!==n&&null!=u&&tA(n,["supervisedTuningSpec","hyperParameters","adapterSize"],u),void 0!==tS(t,["batchSize"]))throw Error("batchSize parameter is not supported in Vertex AI.");if(void 0!==tS(t,["learningRate"]))throw Error("learningRate parameter is not supported in Vertex AI.");return{}}(0,s,n)),n}(this.apiClient,e);return r=tb("tuningJobs",s._url),i=s._query,delete s.config,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>r_(this.apiClient,e))}throw Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let s=function(e,t){let n={},r=tS(t,["baseModel"]);null!=r&&tA(n,["baseModel"],r);let i=tS(t,["trainingDataset"]);null!=i&&tA(n,["tuningTask","trainingData"],function(e,t){let n={};if(void 0!==tS(t,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");let r=tS(t,["examples"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e,t){let n={},r=tS(t,["textInput"]);null!=r&&tA(n,["textInput"],r);let i=tS(t,["output"]);return null!=i&&tA(n,["output"],i),n})(0,e))),tA(n,["examples","examples"],e)}return n}(0,i));let s=tS(t,["config"]);return null!=s&&tA(n,["config"],function(e,t,n){let r={};if(void 0!==tS(t,["validationDataset"]))throw Error("validationDataset parameter is not supported in Gemini API.");let i=tS(t,["tunedModelDisplayName"]);if(void 0!==n&&null!=i&&tA(n,["displayName"],i),void 0!==tS(t,["description"]))throw Error("description parameter is not supported in Gemini API.");let s=tS(t,["epochCount"]);void 0!==n&&null!=s&&tA(n,["tuningTask","hyperparameters","epochCount"],s);let o=tS(t,["learningRateMultiplier"]);if(null!=o&&tA(r,["tuningTask","hyperparameters","learningRateMultiplier"],o),void 0!==tS(t,["exportLastCheckpointOnly"]))throw Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(void 0!==tS(t,["adapterSize"]))throw Error("adapterSize parameter is not supported in Gemini API.");let a=tS(t,["batchSize"]);void 0!==n&&null!=a&&tA(n,["tuningTask","hyperparameters","batchSize"],a);let l=tS(t,["learningRate"]);return void 0!==n&&null!=l&&tA(n,["tuningTask","hyperparameters","learningRate"],l),r}(0,s,n)),n}(this.apiClient,e);return r=tb("tunedModels",s._url),i=s._query,delete s.config,delete s._url,delete s._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>(function(e,t){let n={},r=tS(t,["name"]);null!=r&&tA(n,["name"],r);let i=tS(t,["metadata"]);null!=i&&tA(n,["metadata"],i);let s=tS(t,["done"]);null!=s&&tA(n,["done"],s);let o=tS(t,["error"]);return null!=o&&tA(n,["error"],o),n})(this.apiClient,e))}}}let rE="x-goog-upload-status";async function rT(e,t,n){var r,i,s;let o=0,a=0,l=new tG(new Response),u="upload";for(o=e.size;a<o;){let s=Math.min(8388608,o-a),c=e.slice(a,a+s);a+s>=o&&(u+=", finalize");let d=0,h=1e3;for(;d<3&&(null==(r=null==(l=await n.request({path:"",body:c,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(a),"Content-Length":String(s)}}}))?void 0:l.headers)||!r[rE]);)d++,await rb(h),h*=2;if(a+=s,(null==(i=null==l?void 0:l.headers)?void 0:i[rE])!=="active")break;if(o<=a)throw Error("All content has been uploaded, but the upload status is not finalized.")}let c=await (null==l?void 0:l.json());if((null==(s=null==l?void 0:l.headers)?void 0:s[rE])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return c.file}async function rC(e){return{size:e.size,type:e.type}}function rb(e){return new Promise(t=>setTimeout(t,e))}class rA{async stat(e){let t={size:0,type:void 0};return"string"==typeof e?(t.size=(await tT.stat(e)).size,t.type=this.inferMimeType(e),t):await rC(e)}async upload(e,t,n){return"string"==typeof e?await this.uploadFileFromPath(e,t,n):rT(e,t,n)}inferMimeType(e){return({aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gz:"application/gzip",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz+xml",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"})[e.slice(e.lastIndexOf(".")+1).toLowerCase()]}async uploadFileFromPath(e,t,n){var r,i,s;let o,a=0,l=0,u=new tG(new Response),c="upload";try{if(!(o=await tT.open(e,"r")))throw Error("Failed to open file");for(a=(await o.stat()).size;l<a;){let e=Math.min(8388608,a-l);l+e>=a&&(c+=", finalize");let s=new Uint8Array(e),{bytesRead:d}=await o.read(s,0,e,l);if(d!==e)throw Error(`Failed to read ${e} bytes from file at offset ${l}. bytes actually read: ${d}`);let h=new Blob([s]),p=0,f=1e3;for(;p<3&&(null==(r=null==(u=await n.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(l),"Content-Length":String(d)}}}))?void 0:u.headers)||!r[rE]);)p++,await rb(f),f*=2;if(l+=d,(null==(i=null==u?void 0:u.headers)?void 0:i[rE])!=="active")break;if(a<=l)throw Error("All content has been uploaded, but the upload status is not finalized.")}let d=await (null==u?void 0:u.json());if((null==(s=null==u?void 0:u.headers)?void 0:s[rE])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return d.file}finally{o&&await o.close()}}}class rS{constructor(e){var t,n,r,o,a,l;if((e.project||e.location)&&e.apiKey)throw Error("Project/location and API key are mutually exclusive in the client initializer.");this.vertexai=null!=(n=null!=(t=e.vertexai)?t:function(e){var t;return void 0!==(t=rw(e))&&"true"===t.toLowerCase()}("GOOGLE_GENAI_USE_VERTEXAI"))&&n;let u=function(){let e=rw("GOOGLE_API_KEY"),t=rw("GEMINI_API_KEY");return e&&t&&console.warn("Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY."),e||t}(),c=rw("GOOGLE_CLOUD_PROJECT"),d=rw("GOOGLE_CLOUD_LOCATION");this.apiKey=null!=(r=e.apiKey)?r:u,this.project=null!=(o=e.project)?o:c,this.location=null!=(a=e.location)?a:d,e.vertexai&&((null==(l=e.googleAuthOptions)?void 0:l.credentials)&&(console.debug("The user provided Google Cloud credentials will take precedence over the API key from the environment variable."),this.apiKey=void 0),(c||d)&&e.apiKey?(console.debug("The user provided Vertex AI API key will take precedence over the project/location from the environment variables."),this.project=void 0,this.location=void 0):(e.project||e.location)&&u?(console.debug("The user provided project/location will take precedence over the API key from the environment variables."),this.apiKey=void 0):(c||d)&&u&&(console.debug("The project/location from the environment variables will take precedence over the API key from the environment variables."),this.apiKey=void 0));let h=function(e,t,n){var r,o,a;if(!(null==(r=e.httpOptions)?void 0:r.baseUrl)){let r={geminiUrl:i,vertexUrl:s};return e.vertexai?null!=(o=r.vertexUrl)?o:t:null!=(a=r.geminiUrl)?a:n}return e.httpOptions.baseUrl}(e,rw("GOOGLE_VERTEX_BASE_URL"),rw("GOOGLE_GEMINI_BASE_URL"));h&&(e.httpOptions?e.httpOptions.baseUrl=h:e.httpOptions={baseUrl:h}),this.apiVersion=e.apiVersion;let p=new rh({apiKey:this.apiKey,googleAuthOptions:e.googleAuthOptions});this.apiClient=new nQ({auth:p,project:this.project,location:this.location,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:"gl-node/"+process.version,uploader:new rA,downloader:new rp}),this.models=new rs(this.apiClient),this.live=new n7(this.apiClient,p,new rm),this.chats=new nT(this.models,this.apiClient),this.caches=new nm(this.apiClient),this.files=new nA(this.apiClient),this.operations=new ra(this.apiClient),this.authTokens=new ru(this.apiClient),this.tunings=new rv(this.apiClient)}}function rw(e){var t,n,r;return null!=(r=null==(n=null==(t=null==process?void 0:process.env)?void 0:t[e])?void 0:n.trim())?r:void 0}},86660:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Colours=void 0;class n{static isEnabled(e){return e.isTTY&&("function"!=typeof e.getColorDepth||e.getColorDepth()>2)}static refresh(){n.enabled=n.isEnabled(process.stderr),this.enabled?(n.reset="\x1b[0m",n.bright="\x1b[1m",n.dim="\x1b[2m",n.red="\x1b[31m",n.green="\x1b[32m",n.yellow="\x1b[33m",n.blue="\x1b[34m",n.magenta="\x1b[35m",n.cyan="\x1b[36m",n.white="\x1b[37m",n.grey="\x1b[90m"):(n.reset="",n.bright="",n.dim="",n.red="",n.green="",n.yellow="",n.blue="",n.magenta="",n.cyan="",n.white="",n.grey="")}}t.Colours=n,n.enabled=!1,n.reset="",n.bright="",n.dim="",n.red="",n.green="",n.yellow="",n.blue="",n.magenta="",n.cyan="",n.white="",n.grey="",n.refresh()},86679:(e,t,n)=>{"use strict";var r,i,s;Object.defineProperty(t,"__esModule",{value:!0}),t.OAuth2Client=t.ClientAuthentication=t.CertificateFormat=t.CodeChallengeMethod=void 0;let o=n(88855),a=n(11723),l=n(27910),u=n(81717),c=n(8655),d=n(75374),h=n(94030);!function(e){e.Plain="plain",e.S256="S256"}(r||(t.CodeChallengeMethod=r={})),function(e){e.PEM="PEM",e.JWK="JWK"}(i||(t.CertificateFormat=i={})),function(e){e.ClientSecretPost="ClientSecretPost",e.ClientSecretBasic="ClientSecretBasic",e.None="None"}(s||(t.ClientAuthentication=s={}));class p extends d.AuthClient{constructor(e,t,n){let r=e&&"object"==typeof e?e:{clientId:e,clientSecret:t,redirectUri:n};super(r),this.certificateCache={},this.certificateExpiry=null,this.certificateCacheFormat=i.PEM,this.refreshTokenPromises=new Map,this._clientId=r.clientId,this._clientSecret=r.clientSecret,this.redirectUri=r.redirectUri,this.endpoints={tokenInfoUrl:"https://oauth2.googleapis.com/tokeninfo",oauth2AuthBaseUrl:"https://accounts.google.com/o/oauth2/v2/auth",oauth2TokenUrl:"https://oauth2.googleapis.com/token",oauth2RevokeUrl:"https://oauth2.googleapis.com/revoke",oauth2FederatedSignonPemCertsUrl:"https://www.googleapis.com/oauth2/v1/certs",oauth2FederatedSignonJwkCertsUrl:"https://www.googleapis.com/oauth2/v3/certs",oauth2IapPublicKeyUrl:"https://www.gstatic.com/iap/verify/public_key",...r.endpoints},this.clientAuthentication=r.clientAuthentication||s.ClientSecretPost,this.issuers=r.issuers||["accounts.google.com","https://accounts.google.com",this.universeDomain]}generateAuthUrl(e={}){if(e.code_challenge_method&&!e.code_challenge)throw Error("If a code_challenge_method is provided, code_challenge must be included.");return e.response_type=e.response_type||"code",e.client_id=e.client_id||this._clientId,e.redirect_uri=e.redirect_uri||this.redirectUri,Array.isArray(e.scope)&&(e.scope=e.scope.join(" ")),this.endpoints.oauth2AuthBaseUrl.toString()+"?"+a.stringify(e)}generateCodeVerifier(){throw Error("generateCodeVerifier is removed, please use generateCodeVerifierAsync instead.")}async generateCodeVerifierAsync(){let e=(0,c.createCrypto)(),t=e.randomBytesBase64(96).replace(/\+/g,"~").replace(/=/g,"_").replace(/\//g,"-"),n=(await e.sha256DigestBase64(t)).split("=")[0].replace(/\+/g,"-").replace(/\//g,"_");return{codeVerifier:t,codeChallenge:n}}getToken(e,t){let n="string"==typeof e?{code:e}:e;if(!t)return this.getTokenAsync(n);this.getTokenAsync(n).then(e=>t(null,e.tokens,e.res),e=>t(e,null,e.response))}async getTokenAsync(e){let t=this.endpoints.oauth2TokenUrl.toString(),n={"Content-Type":"application/x-www-form-urlencoded"},r={client_id:e.client_id||this._clientId,code_verifier:e.codeVerifier,code:e.code,grant_type:"authorization_code",redirect_uri:e.redirect_uri||this.redirectUri};if(this.clientAuthentication===s.ClientSecretBasic){let e=Buffer.from(`${this._clientId}:${this._clientSecret}`);n.Authorization=`Basic ${e.toString("base64")}`}this.clientAuthentication===s.ClientSecretPost&&(r.client_secret=this._clientSecret);let i=await this.transporter.request({...p.RETRY_CONFIG,method:"POST",url:t,data:a.stringify(r),headers:n}),o=i.data;return i.data&&i.data.expires_in&&(o.expiry_date=new Date().getTime()+1e3*i.data.expires_in,delete o.expires_in),this.emit("tokens",o),{tokens:o,res:i}}async refreshToken(e){if(!e)return this.refreshTokenNoCache(e);if(this.refreshTokenPromises.has(e))return this.refreshTokenPromises.get(e);let t=this.refreshTokenNoCache(e).then(t=>(this.refreshTokenPromises.delete(e),t),t=>{throw this.refreshTokenPromises.delete(e),t});return this.refreshTokenPromises.set(e,t),t}async refreshTokenNoCache(e){var t;let n;if(!e)throw Error("No refresh token is set.");let r=this.endpoints.oauth2TokenUrl.toString(),i={refresh_token:e,client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token"};try{n=await this.transporter.request({...p.RETRY_CONFIG,method:"POST",url:r,data:a.stringify(i),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}catch(e){throw e instanceof o.GaxiosError&&"invalid_grant"===e.message&&(null==(t=e.response)?void 0:t.data)&&/ReAuth/i.test(e.response.data.error_description)&&(e.message=JSON.stringify(e.response.data)),e}let s=n.data;return n.data&&n.data.expires_in&&(s.expiry_date=new Date().getTime()+1e3*n.data.expires_in,delete s.expires_in),this.emit("tokens",s),{tokens:s,res:n}}refreshAccessToken(e){if(!e)return this.refreshAccessTokenAsync();this.refreshAccessTokenAsync().then(t=>e(null,t.credentials,t.res),e)}async refreshAccessTokenAsync(){let e=await this.refreshToken(this.credentials.refresh_token),t=e.tokens;return t.refresh_token=this.credentials.refresh_token,this.credentials=t,{credentials:this.credentials,res:e.res}}getAccessToken(e){if(!e)return this.getAccessTokenAsync();this.getAccessTokenAsync().then(t=>e(null,t.token,t.res),e)}async getAccessTokenAsync(){if(!(!this.credentials.access_token||this.isTokenExpiring()))return{token:this.credentials.access_token};{if(!this.credentials.refresh_token)if(this.refreshHandler){let e=await this.processAndValidateRefreshHandler();if(null==e?void 0:e.access_token)return this.setCredentials(e),{token:this.credentials.access_token}}else throw Error("No refresh token or refresh handler callback is set.");let e=await this.refreshAccessTokenAsync();if(!e.credentials||e.credentials&&!e.credentials.access_token)throw Error("Could not refresh access token.");return{token:e.credentials.access_token,res:e.res}}}async getRequestHeaders(e){return(await this.getRequestMetadataAsync(e)).headers}async getRequestMetadataAsync(e){let t=this.credentials;if(!t.access_token&&!t.refresh_token&&!this.apiKey&&!this.refreshHandler)throw Error("No access, refresh token, API key or refresh handler callback is set.");if(t.access_token&&!this.isTokenExpiring()){t.token_type=t.token_type||"Bearer";let e={Authorization:t.token_type+" "+t.access_token};return{headers:this.addSharedMetadataHeaders(e)}}if(this.refreshHandler){let e=await this.processAndValidateRefreshHandler();if(null==e?void 0:e.access_token){this.setCredentials(e);let t={Authorization:"Bearer "+this.credentials.access_token};return{headers:this.addSharedMetadataHeaders(t)}}}if(this.apiKey)return{headers:{"X-Goog-Api-Key":this.apiKey}};let n=null,r=null;try{r=(n=await this.refreshToken(t.refresh_token)).tokens}catch(e){throw e.response&&(403===e.response.status||404===e.response.status)&&(e.message=`Could not refresh access token: ${e.message}`),e}let i=this.credentials;i.token_type=i.token_type||"Bearer",r.refresh_token=i.refresh_token,this.credentials=r;let s={Authorization:i.token_type+" "+r.access_token};return{headers:this.addSharedMetadataHeaders(s),res:n.res}}static getRevokeTokenUrl(e){return new p().getRevokeTokenURL(e).toString()}getRevokeTokenURL(e){let t=new URL(this.endpoints.oauth2RevokeUrl);return t.searchParams.append("token",e),t}revokeToken(e,t){let n={...p.RETRY_CONFIG,url:this.getRevokeTokenURL(e).toString(),method:"POST"};if(!t)return this.transporter.request(n);this.transporter.request(n).then(e=>t(null,e),t)}revokeCredentials(e){if(!e)return this.revokeCredentialsAsync();this.revokeCredentialsAsync().then(t=>e(null,t),e)}async revokeCredentialsAsync(){let e=this.credentials.access_token;if(this.credentials={},e)return this.revokeToken(e);throw Error("No access token to revoke.")}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){let n;try{let t=await this.getRequestMetadataAsync(e.url);e.headers=e.headers||{},t.headers&&t.headers["x-goog-user-project"]&&(e.headers["x-goog-user-project"]=t.headers["x-goog-user-project"]),t.headers&&t.headers.Authorization&&(e.headers.Authorization=t.headers.Authorization),this.apiKey&&(e.headers["X-Goog-Api-Key"]=this.apiKey),n=await this.transporter.request(e)}catch(r){let n=r.response;if(n){let r=n.status,i=this.credentials&&this.credentials.access_token&&this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure),s=this.credentials&&this.credentials.access_token&&!this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure)&&this.refreshHandler,o=n.config.data instanceof l.Readable,a=401===r||403===r;if(!t&&a&&!o&&i)return await this.refreshAccessTokenAsync(),this.requestAsync(e,!0);if(!t&&a&&!o&&s){let t=await this.processAndValidateRefreshHandler();return(null==t?void 0:t.access_token)&&this.setCredentials(t),this.requestAsync(e,!0)}}throw r}return n}verifyIdToken(e,t){if(t&&"function"!=typeof t)throw Error("This method accepts an options object as the first parameter, which includes the idToken, audience, and maxExpiry.");if(!t)return this.verifyIdTokenAsync(e);this.verifyIdTokenAsync(e).then(e=>t(null,e),t)}async verifyIdTokenAsync(e){if(!e.idToken)throw Error("The verifyIdToken method requires an ID Token");let t=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(e.idToken,t.certs,e.audience,this.issuers,e.maxExpiry)}async getTokenInfo(e){let{data:t}=await this.transporter.request({...p.RETRY_CONFIG,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${e}`},url:this.endpoints.tokenInfoUrl.toString()}),n=Object.assign({expiry_date:new Date().getTime()+1e3*t.expires_in,scopes:t.scope.split(" ")},t);return delete n.expires_in,delete n.scope,n}getFederatedSignonCerts(e){if(!e)return this.getFederatedSignonCertsAsync();this.getFederatedSignonCertsAsync().then(t=>e(null,t.certs,t.res),e)}async getFederatedSignonCertsAsync(){let e,t,n=new Date().getTime(),r=(0,c.hasBrowserCrypto)()?i.JWK:i.PEM;if(this.certificateExpiry&&n<this.certificateExpiry.getTime()&&this.certificateCacheFormat===r)return{certs:this.certificateCache,format:r};switch(r){case i.PEM:t=this.endpoints.oauth2FederatedSignonPemCertsUrl.toString();break;case i.JWK:t=this.endpoints.oauth2FederatedSignonJwkCertsUrl.toString();break;default:throw Error(`Unsupported certificate format ${r}`)}try{e=await this.transporter.request({...p.RETRY_CONFIG,url:t})}catch(e){throw e instanceof Error&&(e.message=`Failed to retrieve verification certificates: ${e.message}`),e}let s=e?e.headers["cache-control"]:void 0,o=-1;if(s){let e=RegExp("max-age=([0-9]*)").exec(s);e&&2===e.length&&(o=1e3*Number(e[1]))}let a={};switch(r){case i.PEM:a=e.data;break;case i.JWK:for(let t of e.data.keys)a[t.kid]=t;break;default:throw Error(`Unsupported certificate format ${r}`)}let l=new Date;return this.certificateExpiry=-1===o?null:new Date(l.getTime()+o),this.certificateCache=a,this.certificateCacheFormat=r,{certs:a,format:r,res:e}}getIapPublicKeys(e){if(!e)return this.getIapPublicKeysAsync();this.getIapPublicKeysAsync().then(t=>e(null,t.pubkeys,t.res),e)}async getIapPublicKeysAsync(){let e,t=this.endpoints.oauth2IapPublicKeyUrl.toString();try{e=await this.transporter.request({...p.RETRY_CONFIG,url:t})}catch(e){throw e instanceof Error&&(e.message=`Failed to retrieve verification certificates: ${e.message}`),e}return{pubkeys:e.data,res:e}}verifySignedJwtWithCerts(){throw Error("verifySignedJwtWithCerts is removed, please use verifySignedJwtWithCertsAsync instead.")}async verifySignedJwtWithCertsAsync(e,t,n,r,i){let s,o,a=(0,c.createCrypto)();i||(i=p.DEFAULT_MAX_TOKEN_LIFETIME_SECS_);let l=e.split(".");if(3!==l.length)throw Error("Wrong number of segments in token: "+e);let d=l[0]+"."+l[1],f=l[2];try{s=JSON.parse(a.decodeBase64StringUtf8(l[0]))}catch(e){throw e instanceof Error&&(e.message=`Can't parse token envelope: ${l[0]}': ${e.message}`),e}if(!s)throw Error("Can't parse token envelope: "+l[0]);try{o=JSON.parse(a.decodeBase64StringUtf8(l[1]))}catch(e){throw e instanceof Error&&(e.message=`Can't parse token payload '${l[0]}`),e}if(!o)throw Error("Can't parse token payload: "+l[1]);if(!Object.prototype.hasOwnProperty.call(t,s.kid))throw Error("No pem found for envelope: "+JSON.stringify(s));let m=t[s.kid];if("ES256"===s.alg&&(f=u.joseToDer(f,"ES256").toString("base64")),!await a.verify(m,d,f))throw Error("Invalid token signature: "+e);if(!o.iat)throw Error("No issue time in token: "+JSON.stringify(o));if(!o.exp)throw Error("No expiration time in token: "+JSON.stringify(o));let g=Number(o.iat);if(isNaN(g))throw Error("iat field using invalid format");let y=Number(o.exp);if(isNaN(y))throw Error("exp field using invalid format");let _=new Date().getTime()/1e3;if(y>=_+i)throw Error("Expiration time too far in future: "+JSON.stringify(o));let v=g-p.CLOCK_SKEW_SECS_,E=y+p.CLOCK_SKEW_SECS_;if(_<v)throw Error("Token used too early, "+_+" < "+v+": "+JSON.stringify(o));if(_>E)throw Error("Token used too late, "+_+" > "+E+": "+JSON.stringify(o));if(r&&0>r.indexOf(o.iss))throw Error("Invalid issuer, expected one of ["+r+"], but got "+o.iss);if(null!=n){let e=o.aud,t=!1;if(!(n.constructor===Array?n.indexOf(e)>-1:e===n))throw Error("Wrong recipient, payload audience != requiredAudience")}return new h.LoginTicket(s,o)}async processAndValidateRefreshHandler(){if(this.refreshHandler){let e=await this.refreshHandler();if(!e.access_token)throw Error("No access token is returned by the refreshHandler callback.");return e}}isTokenExpiring(){let e=this.credentials.expiry_date;return!!e&&e<=new Date().getTime()+this.eagerRefreshThresholdMillis}}t.OAuth2Client=p,p.GOOGLE_TOKEN_INFO_URL="https://oauth2.googleapis.com/tokeninfo",p.CLOCK_SKEW_SECS_=300,p.DEFAULT_MAX_TOKEN_LIFETIME_SECS_=86400},88855:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.instance=t.Gaxios=t.GaxiosError=void 0,t.request=a;let s=n(77569);Object.defineProperty(t,"Gaxios",{enumerable:!0,get:function(){return s.Gaxios}});var o=n(90134);async function a(e){return t.instance.request(e)}Object.defineProperty(t,"GaxiosError",{enumerable:!0,get:function(){return o.GaxiosError}}),i(n(80808),t),t.instance=new s.Gaxios},89019:(e,t,n)=>{var r=n(45158).Buffer,i=n(27910);function s(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=r.alloc(0),this;if("function"==typeof e.pipe)return this.buffer=r.alloc(0),e.pipe(this),this;if(e.length||"object"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick((function(){this.emit("end",e),this.readable=!1,this.emit("close")}).bind(this)),this;throw TypeError("Unexpected data type ("+typeof e+")")}n(28354).inherits(s,i),s.prototype.write=function(e){this.buffer=r.concat([this.buffer,r.from(e)]),this.emit("data",e)},s.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1},e.exports=s},89293:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GCE_LINUX_BIOS_PATHS=void 0,t.isGoogleCloudServerless=o,t.isGoogleComputeEngineLinux=a,t.isGoogleComputeEngineMACAddress=l,t.isGoogleComputeEngine=u,t.detectGCPResidency=function(){return o()||u()};let r=n(29021),i=n(21820);t.GCE_LINUX_BIOS_PATHS={BIOS_DATE:"/sys/class/dmi/id/bios_date",BIOS_VENDOR:"/sys/class/dmi/id/bios_vendor"};let s=/^42:01/;function o(){return!!(process.env.CLOUD_RUN_JOB||process.env.FUNCTION_NAME||process.env.K_SERVICE)}function a(){if("linux"!==(0,i.platform)())return!1;try{(0,r.statSync)(t.GCE_LINUX_BIOS_PATHS.BIOS_DATE);let e=(0,r.readFileSync)(t.GCE_LINUX_BIOS_PATHS.BIOS_VENDOR,"utf8");return/Google/.test(e)}catch(e){return!1}}function l(){for(let e of Object.values((0,i.networkInterfaces)()))if(e){for(let{mac:t}of e)if(s.test(t))return!0}return!1}function u(){return a()||l()}},90134:function(e,t,n){"use strict";var r,i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GaxiosError=t.GAXIOS_ERROR_SYMBOL=void 0,t.defaultErrorRedactor=function e(t){let n="<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.";function r(e){if(e)for(let t of Object.keys(e))/^authentication$/i.test(t)&&(e[t]=n),/^authorization$/i.test(t)&&(e[t]=n),/secret/i.test(t)&&(e[t]=n)}function i(e,t){if("object"==typeof e&&null!==e&&"string"==typeof e[t]){let r=e[t];(/grant_type=/i.test(r)||/assertion=/i.test(r)||/secret/i.test(r))&&(e[t]=n)}}function o(e){"object"==typeof e&&null!==e&&("grant_type"in e&&(e.grant_type=n),"assertion"in e&&(e.assertion=n),"client_secret"in e&&(e.client_secret=n))}if(t.config){r(t.config.headers),i(t.config,"data"),o(t.config.data),i(t.config,"body"),o(t.config.body);try{let e=new s.URL("",t.config.url);e.searchParams.has("token")&&e.searchParams.set("token",n),e.searchParams.has("client_secret")&&e.searchParams.set("client_secret",n),t.config.url=e.toString()}catch(e){}}return t.response&&(e({config:t.response.config}),r(t.response.headers),i(t.response,"data"),o(t.response.data)),t};let s=n(79551),o=n(23055),a=i(n(26556));t.GAXIOS_ERROR_SYMBOL=Symbol.for(`${o.pkg.name}-gaxios-error`);class l extends Error{static[(r=t.GAXIOS_ERROR_SYMBOL,Symbol.hasInstance)](e){return!!e&&"object"==typeof e&&t.GAXIOS_ERROR_SYMBOL in e&&e[t.GAXIOS_ERROR_SYMBOL]===o.pkg.version||Function.prototype[Symbol.hasInstance].call(l,e)}constructor(e,t,n,i){var s;if(super(e),this.config=t,this.response=n,this.error=i,this[r]=o.pkg.version,this.config=(0,a.default)(!0,{},t),this.response&&(this.response.config=(0,a.default)(!0,{},this.response.config)),this.response){try{this.response.data=function(e,t){switch(e){case"stream":default:return t;case"json":return JSON.parse(JSON.stringify(t));case"arraybuffer":return JSON.parse(Buffer.from(t).toString("utf8"));case"blob":return JSON.parse(t.text())}}(this.config.responseType,null==(s=this.response)?void 0:s.data)}catch(e){}this.status=this.response.status}i&&"code"in i&&i.code&&(this.code=i.code),t.errorRedactor&&t.errorRedactor({config:this.config,response:this.response})}}t.GaxiosError=l},90630:e=>{"use strict";e.exports=JSON.parse('{"name":"google-auth-library","version":"9.15.1","author":"Google Inc.","description":"Google APIs Authentication Client Library for Node.js","engines":{"node":">=14"},"main":"./build/src/index.js","types":"./build/src/index.d.ts","repository":"googleapis/google-auth-library-nodejs.git","keywords":["google","api","google apis","client","client library"],"dependencies":{"base64-js":"^1.3.0","ecdsa-sig-formatter":"^1.0.11","gaxios":"^6.1.1","gcp-metadata":"^6.1.0","gtoken":"^7.0.0","jws":"^4.0.0"},"devDependencies":{"@types/base64-js":"^1.2.5","@types/chai":"^4.1.7","@types/jws":"^3.1.0","@types/mocha":"^9.0.0","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^20.4.2","@types/sinon":"^17.0.0","assert-rejects":"^1.0.0","c8":"^8.0.0","chai":"^4.2.0","cheerio":"1.0.0-rc.12","codecov":"^3.0.2","engine.io":"6.6.2","gts":"^5.0.0","is-docker":"^2.0.0","jsdoc":"^4.0.0","jsdoc-fresh":"^3.0.0","jsdoc-region-tag":"^3.0.0","karma":"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-sourcemap-loader":"^0.4.0","karma-webpack":"5.0.0","keypair":"^1.0.4","linkinator":"^4.0.0","mocha":"^9.2.2","mv":"^2.1.1","ncp":"^2.0.0","nock":"^13.0.0","null-loader":"^4.0.0","pdfmake":"0.2.12","puppeteer":"^21.0.0","sinon":"^18.0.0","ts-loader":"^8.0.0","typescript":"^5.1.6","webpack":"^5.21.2","webpack-cli":"^4.0.0"},"files":["build/src","!build/src/**/*.map"],"scripts":{"test":"c8 mocha build/test","clean":"gts clean","prepare":"npm run compile","lint":"gts check","compile":"tsc -p .","fix":"gts fix","pretest":"npm run compile -- --sourceMap","docs":"jsdoc -c .jsdoc.json","samples-setup":"cd samples/ && npm link ../ && npm run setup && cd ../","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","system-test":"mocha build/system-test --timeout 60000","presystem-test":"npm run compile -- --sourceMap","webpack":"webpack","browser-test":"karma start","docs-test":"linkinator docs","predocs-test":"npm run docs","prelint":"cd samples; npm link ../; npm install","precompile":"gts clean"},"license":"Apache-2.0"}')},90876:(e,t,n)=>{"use strict";var r=n(79428).Buffer,i=n(79428).SlowBuffer;function s(e,t){if(!r.isBuffer(e)||!r.isBuffer(t)||e.length!==t.length)return!1;for(var n=0,i=0;i<e.length;i++)n|=e[i]^t[i];return 0===n}e.exports=s,s.install=function(){r.prototype.equal=i.prototype.equal=function(e){return s(this,e)}};var o=r.prototype.equal,a=i.prototype.equal;s.restore=function(){r.prototype.equal=o,i.prototype.equal=a}},91569:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(71820),t)},91596:(e,t,n)=>{"use strict";let{tokenChars:r}=n(58571);e.exports={parse:function(e){let t=new Set,n=-1,i=-1,s=0;for(;s<e.length;s++){let o=e.charCodeAt(s);if(-1===i&&1===r[o])-1===n&&(n=s);else if(0!==s&&(32===o||9===o))-1===i&&-1!==n&&(i=s);else if(44===o){if(-1===n)throw SyntaxError(`Unexpected character at index ${s}`);-1===i&&(i=s);let r=e.slice(n,i);if(t.has(r))throw SyntaxError(`The "${r}" subprotocol is duplicated`);t.add(r),n=i=-1}else throw SyntaxError(`Unexpected character at index ${s}`)}if(-1===n||-1!==i)throw SyntaxError("Unexpected end of input");let o=e.slice(n,s);if(t.has(o))throw SyntaxError(`The "${o}" subprotocol is duplicated`);return t.add(o),t}}},94030:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoginTicket=void 0;class n{constructor(e,t){this.envelope=e,this.payload=t}getEnvelope(){return this.envelope}getPayload(){return this.payload}getUserId(){let e=this.getPayload();return e&&e.sub?e.sub:null}getAttributes(){return{envelope:this.getEnvelope(),payload:this.getPayload()}}}t.LoginTicket=n},95773:(e,t,n)=>{"use strict";let r,{Duplex:i}=n(27910),{randomFillSync:s}=n(55511),o=n(2968),{EMPTY_BUFFER:a,kWebSocket:l,NOOP:u}=n(32435),{isBlob:c,isValidStatusCode:d}=n(58571),{mask:h,toBuffer:p}=n(46471),f=Symbol("kByteLength"),m=Buffer.alloc(4),g=8192;class y{constructor(e,t,n){this._extensions=t||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=u,this[l]=void 0}static frame(e,t){let n,i,o=!1,a=2,l=!1;t.mask&&(n=t.maskBuffer||m,t.generateMask?t.generateMask(n):(8192===g&&(void 0===r&&(r=Buffer.alloc(8192)),s(r,0,8192),g=0),n[0]=r[g++],n[1]=r[g++],n[2]=r[g++],n[3]=r[g++]),l=(n[0]|n[1]|n[2]|n[3])==0,a=6),"string"==typeof e?i=(!t.mask||l)&&void 0!==t[f]?t[f]:(e=Buffer.from(e)).length:(i=e.length,o=t.mask&&t.readOnly&&!l);let u=i;i>=65536?(a+=8,u=127):i>125&&(a+=2,u=126);let c=Buffer.allocUnsafe(o?i+a:a);return(c[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(c[0]|=64),c[1]=u,126===u?c.writeUInt16BE(i,2):127===u&&(c[2]=c[3]=0,c.writeUIntBE(i,4,6)),t.mask)?(c[1]|=128,c[a-4]=n[0],c[a-3]=n[1],c[a-2]=n[2],c[a-1]=n[3],l)?[c,e]:o?(h(e,n,c,a,i),[c]):(h(e,n,e,0,i),[c,e]):[c,e]}close(e,t,n,r){let i;if(void 0===e)i=a;else if("number"==typeof e&&d(e))if(void 0!==t&&t.length){let n=Buffer.byteLength(t);if(n>123)throw RangeError("The message must not be greater than 123 bytes");(i=Buffer.allocUnsafe(2+n)).writeUInt16BE(e,0),"string"==typeof t?i.write(t,2):i.set(t,2)}else(i=Buffer.allocUnsafe(2)).writeUInt16BE(e,0);else throw TypeError("First argument must be a valid error code number");let s={[f]:i.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,i,!1,s,r]):this.sendFrame(y.frame(i,s),r)}ping(e,t,n){let r,i;if("string"==typeof e?(r=Buffer.byteLength(e),i=!1):c(e)?(r=e.size,i=!1):(r=(e=p(e)).length,i=p.readOnly),r>125)throw RangeError("The data size must not be greater than 125 bytes");let s={[f]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,s,n]):this.getBlobData(e,!1,s,n):0!==this._state?this.enqueue([this.dispatch,e,!1,s,n]):this.sendFrame(y.frame(e,s),n)}pong(e,t,n){let r,i;if("string"==typeof e?(r=Buffer.byteLength(e),i=!1):c(e)?(r=e.size,i=!1):(r=(e=p(e)).length,i=p.readOnly),r>125)throw RangeError("The data size must not be greater than 125 bytes");let s={[f]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,s,n]):this.getBlobData(e,!1,s,n):0!==this._state?this.enqueue([this.dispatch,e,!1,s,n]):this.sendFrame(y.frame(e,s),n)}send(e,t,n){let r,i,s=this._extensions[o.extensionName],a=t.binary?2:1,l=t.compress;"string"==typeof e?(r=Buffer.byteLength(e),i=!1):c(e)?(r=e.size,i=!1):(r=(e=p(e)).length,i=p.readOnly),this._firstFragment?(this._firstFragment=!1,l&&s&&s.params[s._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(l=r>=s._threshold),this._compress=l):(l=!1,a=0),t.fin&&(this._firstFragment=!0);let u={[f]:r,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:a,readOnly:i,rsv1:l};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,u,n]):this.getBlobData(e,this._compress,u,n):0!==this._state?this.enqueue([this.dispatch,e,this._compress,u,n]):this.dispatch(e,this._compress,u,n)}getBlobData(e,t,n,r){this._bufferedBytes+=n[f],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){let e=Error("The socket was closed while the blob was being read");process.nextTick(_,this,e,r);return}this._bufferedBytes-=n[f];let i=p(e);t?this.dispatch(i,t,n,r):(this._state=0,this.sendFrame(y.frame(i,n),r),this.dequeue())}).catch(e=>{process.nextTick(v,this,e,r)})}dispatch(e,t,n,r){if(!t)return void this.sendFrame(y.frame(e,n),r);let i=this._extensions[o.extensionName];this._bufferedBytes+=n[f],this._state=1,i.compress(e,n.fin,(e,t)=>{if(this._socket.destroyed)return void _(this,Error("The socket was closed while data was being compressed"),r);this._bufferedBytes-=n[f],this._state=0,n.readOnly=!1,this.sendFrame(y.frame(t,n),r),this.dequeue()})}dequeue(){for(;0===this._state&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][f],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][f],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function _(e,t,n){"function"==typeof n&&n(t);for(let n=0;n<e._queue.length;n++){let r=e._queue[n],i=r[r.length-1];"function"==typeof i&&i(t)}}function v(e,t,n){_(e,t,n),e.onerror(t)}e.exports=y},96542:(e,t,n)=>{var r=n(70223).stringify,i=n(59293);e.exports=function(e){return{parse:i(e),stringify:r}},e.exports.parse=i(),e.exports.stringify=r}};